/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([0], Array(898).concat([function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e) {
        window.history.pushState({}, "", window.location.href)
    }
    function o() {
        if (!Store.Conn.connected)
            return !1;
        var e = n(1089)
          , t = Store.Msg.some(function(e) {
            return 0 === e.ack && e.local && e.isSentByMe
        })
          , r = Store.Chat.some(function(e) {
            return !!e.composeContents.text
        });
        return t || r || e.hasText
    }
    var a = n(433)
      , s = r(a)
      , c = n(2)
      , l = r(c)
      , u = n(6)
      , d = n(37);
    _.defaults(window.Store, n(1261));
    var p = n(53)
      , h = n(10)
      , f = n(12)
      , m = n(69)
      , g = n(15)
      , v = n(1141)
      , y = n(1197)
      , E = n(429)
      , b = n(1274)
      , S = n(1122)
      , M = n(138)
      , C = n(9)
      , T = n(14)
      , w = n(142)
      , k = n(450)
      , x = n(1273)
      , N = n(1167)
      , P = n(134)
      , D = n(133)
      , O = n(81)
      , A = n(1280)
      , R = n(1241)
      , I = n(1227)
      , L = n(0)
      , F = n(1)
      , U = n(442)
      , j = n(209)
      , B = n(67)
      , G = n(139)
      , Y = n(135)
      , H = Y.HotKeys
      , z = Y.HotKeyMapMixin
      , W = [[document, "mousemove"], [document, "scroll"], [document, "keydown"], [window, "focus"], [window, "blur"], [window, "resize"]]
      , q = u.createClass({
        displayName: "Main",
        mixins: [M, z({}), D, O, P],
        propTypes: {
            launchUrl: u.PropTypes.string,
            onLaunchUrlHandled: u.PropTypes.func.isRequired,
            animate: u.PropTypes.bool
        },
        statics: {
            hasPending: o
        },
        getInitialState: function() {
            return this.onBlur = this.safeDebounce(function() {
                if (document.activeElement === document.body) {
                    var e = B.Manager.top;
                    e && e.uie.requestFocus()
                }
            }, 10),
            {
                drawerActive: !1
            }
        },
        componentWillMount: function() {
            m.uiActive = !0,
            m.markAvailable(),
            this.regNativeListener(window, "click", function(e) {
                var t = e.target;
                if (t && "A" === t.nodeName && t.hasAttribute("href")) {
                    var n = U.parseInviteLink(t.getAttribute("href"));
                    n && (e.preventDefault(),
                    C.openModal(u.createElement(I, {
                        groupCode: n
                    })))
                }
            }, !0),
            this.regCmd("rotate_focus", this.onRotateFocus)
        },
        componentWillReceiveProps: function(e) {
            e.launchUrl && this.props.launchUrl !== e.launchUrl && (this.launchInviteUrl(e.launchUrl),
            this.props.onLaunchUrlHandled())
        },
        componentWillUnmount: function() {
            this.onBlur = null ,
            A.trigger(x.Event + ":" + x.Events.LOGGED_OUT),
            U.canMuckHistory && (window.removeEventListener("popstate", i),
            window.history.back()),
            m.uiActive = !1,
            this.clearIdleMonitor(),
            this.clearServerPropsQueryLoop()
        },
        componentDidMount: function() {
            if (A.trigger(x.Event + ":" + x.Events.LOGGED_IN),
            this.props.launchUrl && (this.launchInviteUrl(this.props.launchUrl),
            this.props.onLaunchUrlHandled()),
            U.canMuckHistory && (window.history.pushState({}, "", window.location.href),
            window.addEventListener("popstate", i)),
            this.beginIdleMonitor(!0),
            this.beginServerPropsQueryLoop(),
            this.addObserverAndRun(Store.Conn, "change:tos", this.showTOS),
            G.focus(d.findDOMNode(this)),
            p.isSafari) {
                var e = g.getNUX(h.NUX.SAFARI_LIMITED_SUPPORT);
                (!e || e < e.maxViews) && (this.safeDelay(function() {
                    var e = l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__", h.BROWSER_LINK.CHROME).replace("__firefox_homepage__", h.BROWSER_LINK.FIREFOX).replace("__opera_homepage__", h.BROWSER_LINK.OPERA);
                    C.openModal(u.createElement(E, {
                        onOK: C.closeModal.bind(C),
                        okText: l10n.t("ok_got_it")
                    }, u.createElement("div", {
                        dangerouslySetInnerHTML: {
                            __html: e
                        }
                    })))
                }, 250),
                g.setNUX(h.NUX.SAFARI_LIMITED_SUPPORT, {
                    views: 1,
                    maxViews: 1
                }))
            }
        },
        launchInviteUrl: function(e) {
            F.log("main:openUrl:" + e)();
            var t = U.parseInviteLink(e);
            return !!t && (F.log("code opened!" + t)(),
            C.openModal(u.createElement(I, {
                groupCode: t
            })),
            !0)
        },
        beginIdleMonitor: function(e) {
            var t = this;
            e = e ? h.IDLE_TIMEOUT : 0,
            this.idleMonitor = l["default"].loop(function() {
                return l["default"].delay(e).addCancelControl().then(function() {
                    m.markUnavailable(3e4);
                    var t = void 0
                      , n = new l["default"](function(e) {
                        t = e
                    }
                    );
                    return W.forEach(function(e) {
                        var n = (0,
                        s["default"])(e, 2)
                          , r = n[0]
                          , i = n[1];
                        r.addEventListener(i, t)
                    }),
                    n.addCancelControl()["finally"](function() {
                        W.forEach(function(e) {
                            var n = (0,
                            s["default"])(e, 2)
                              , r = n[0]
                              , i = n[1];
                            r.removeEventListener(i, t)
                        })
                    }).then(function() {
                        m.markAvailable(),
                        e = h.IDLE_TIMEOUT
                    })
                })
            })["finally"](function() {
                t.idleMonitor = null
            })["catch"](l["default"].CancellationError, _.noop).endWithControls("cancel")
        },
        clearIdleMonitor: function() {
            this.idleMonitor && this.idleMonitor.control.cancel()
        },
        beginServerPropsQueryLoop: function() {
            var e = this;
            this.serverPropsQueryLoop = w.setTimeout(function() {
                Store.Props.fetch()["catch"](T.WapDrop, _.noop),
                e.beginServerPropsQueryLoop()
            }, L().add("1", "days").valueOf())
        },
        clearServerPropsQueryLoop: function() {
            w.clearTimeout(this.serverPropsQueryLoop)
        },
        calculateConversationPaneScale: function() {
            if (!(this.refs.chatlist && this.refs.container && this.refs.conversation))
                return null ;
            var e = d.findDOMNode(this.refs.chatlist)
              , t = d.findDOMNode(this.refs.conversation)
              , n = d.findDOMNode(this.refs.container);
            return t.clientWidth / (n.clientWidth - e.clientWidth)
        },
        onRightDrawerIn: function() {
            this.rightDrawerOut = !1,
            C.onPanesWillChange(3),
            this.setState({
                drawerActive: !0
            }, C.onPanesDidChange.bind(C, 3));
            var e = this.calculateConversationPaneScale();
            null !== e && this.animateConversationPane(e)
        },
        onRightDrawerOut: function() {
            this.rightDrawerOut = !0;
            var e = this.calculateConversationPaneScale();
            null !== e && this.animateConversationPane(e),
            1 !== e && (C.onPanesWillChange(2),
            this.setState({
                drawerActive: !1
            }, C.onPanesDidChange.bind(C, 2)))
        },
        onRightDrawerAnimationComplete: function() {
            this.state.drawerActive && this.rightDrawerOut && this.setState({
                drawerActive: !1
            })
        },
        animateConversationPane: function(e) {
            Velocity(d.findDOMNode(this.refs.conversation), {
                scaleX: [1, e]
            }, {
                duration: 300,
                easing: [.1, .82, .25, 1]
            })
        },
        onRotateFocus: function(e) {
            var t = this
              , n = 1;
            e && (e.stopPropagation(),
            e.preventDefault(),
            n = e.shiftKey ? -1 : 1,
            H.flashFocus = Date.now());
            var r = _.toArray(d.findDOMNode(this).querySelectorAll("[data-tab]"));
            if (C.existsDrawerLeft(function(e) {
                if (e) {
                    var n = d.findDOMNode(t.refs.chatlist);
                    r = _.reject(r, function(e) {
                        return n.contains(e)
                    })
                }
            }),
            C.existsDrawerMid(function(e) {
                if (e) {
                    var n = d.findDOMNode(t.refs.conversation);
                    n && (r = _.reject(r, function(e) {
                        return n.contains(e)
                    }))
                }
            }),
            r.length) {
                r = _.sortBy(r, function(e) {
                    return parseInt(e.getAttribute("data-tab"), 10) || 0
                });
                var i = 0
                  , o = document.activeElement;
                o && (i = k.ring(_.findIndex(r, function(e) {
                    return e.contains(o)
                }) + n, r));
                var a = r[i];
                H.flashFocus = Date.now(),
                a.restoreFocus ? a.restoreFocus() : G.focus(a)
            }
        },
        showTOS: function() {
            switch (Store.Conn.tos) {
            case 1:
            case 2:
                C.openModal(u.createElement(R, null ), void 0, void 0, !0);
                break;
            case 3:
                f.logout()
            }
        },
        render: function() {
            var e = this.state.drawerActive ? "app three" : "app two";
            this.props.animate || (e += " no-animation"),
            p.isSafari && (e += " safari-fix");
            var t = {
                tab: this.onRotateFocus,
                "shift+tab": this.onRotateFocus
            };
            return u.createElement(j, {
                state: j.State.INACTIVE,
                ref: "container",
                displayName: "Main"
            }, u.createElement(H, {
                handlers: t,
                className: e,
                onBlur: this.onBlur
            }, u.createElement(b, null ), u.createElement(S, null ), u.createElement("div", {
                className: "drawer-manager"
            }, u.createElement(y, {
                direction: y.Dir.LEFT
            }), u.createElement(y, {
                direction: y.Dir.MID
            }), u.createElement(y, {
                direction: y.Dir.RIGHT,
                ref: "rightDrawer",
                onDrawerIn: this.onRightDrawerIn,
                onDrawerOut: this.onRightDrawerOut,
                onDrawerAnimationComplete: this.onRightDrawerAnimationComplete
            })), u.createElement(v, {
                ref: "chatlist"
            }), u.createElement(N, {
                ref: "conversation",
                animate: this.props.animate
            })))
        }
    });
    e.exports = q
}
, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i() {
        var e = new Uint8Array(8);
        window.crypto.getRandomValues(e);
        for (var t = new Array(16), n = 0, r = 0; n < e.length; n++,
        r += 2) {
            var i = e[n];
            t[r] = ne[i >> 4],
            t[r + 1] = ne[15 & i]
        }
        return "3EB0" + String.fromCharCode.apply(String, t)
    }
    function o(e) {
        return e in re
    }
    function a(e) {
        return new f["default"](function(t, n) {
            ie.push(e),
            oe[e.id] = {
                resolve: t,
                reject: n
            },
            ae.debounceAndCap(100, 500)
        }
        )
    }
    function s(e) {
        return C.getPlaintextMediaInfo(e).then(function(t) {
            if (200 === t.status) {
                var n = t.data;
                return n.length !== e.length ? (b.error("Msg:refreshMedia returned length differs from orig")(),
                f["default"].reject("Msg:refreshMedia returned length differs from orig")) : n.map(function(t, n) {
                    var r = e[n]
                      , i = r.duration || t.d;
                    i = i ? i.toString() : void 0;
                    var o = {
                        clientUrl: t.url,
                        mimetype: r.mimetype || t.mt,
                        duration: i
                    };
                    "image" === r.type && (o.fullWidth = t.w,
                    o.fullHeight = t.h);
                    var a = oe[r.id];
                    return a && (delete oe[r.id],
                    a.resolve(o)),
                    o
                })
            }
            return b.error("Msg:refreshMedia error " + t.status)(),
            f["default"].reject("Msg:refreshMedia error " + t.status)
        })["catch"](function(t) {
            return e.forEach(function(e) {
                var n = oe[e.id];
                n && (delete oe[e.id],
                n.reject(t))
            }),
            f["default"].reject(t)
        })
    }
    function c(e, t) {
        function n() {
            i = 0
        }
        if (t && !e.mediaKey)
            return b.log("processMedia encrypted msg without mediaKey")(),
            f["default"].reject(new T.MediaNeedsReupload);
        e.mediaState = Q.FETCHING;
        var r = void 0;
        r = t ? f["default"].resolve() : a(e)["catch"](T.Server5xxDrop, function() {
            return f["default"].reject(new q)
        }).then(function(t) {
            e.set(t)
        });
        var i = 0
          , o = r.loop(function(t) {
            var r = "GET";
            return U.getResponseIfOnline(e.clientUrl, r, null , x.RESP_TYPE.ARRAY_BUFFER).then(function(r) {
                if (i++,
                !(r && r.status < 500)) {
                    if (i > 3)
                        return f["default"].reject(new T.MediaNeedsReupload);
                    if (!r && F.online)
                        return void (e.clientUrl && (e.clientUrl = e.clientUrl.replace(/^https:\/\/[^\/]+\.whatsapp\.net/, "https://mms.whatsapp.net")));
                    e.mediaState = Q.NEED_POKE;
                    var o = Math.floor(1e3 * B.expBackoff(i, 60, void 0, .1));
                    return f["default"].all([f["default"].delay(o), F.waitForOnline]).addResolveControl("poke", n)
                }
                return r.status >= 400 ? f["default"].reject(new T.MediaNeedsReupload) : void t(r.response)
            })
        });
        return o.then(function(n) {
            return t ? (e.mediaState = Q.DECRYPTING,
            e.needsMediaAck && w.ackE2EMedia(e.type, e.mediaKey, e.clientUrl).then(function() {
                e.needsMediaAck = !1
            }),
            k.decryptE2EMedia(e.type, n, e.mediaKey, e.mimetype)["catch"](T.MediaEncryptionError, function(e) {
                return b.assert(!1, "decryption-error", "msg:processEncryptedMedia " + e)(),
                f["default"].reject(new V)
            })) : new Blob([n],{
                type: e.mimetype
            })
        }).then(function(t) {
            return e.mimetype || (e.mimetype = t.type),
            L.transcode(t, e.mimetype).then(function(e) {
                return {
                    media: t,
                    blob: e
                }
            })
        }).then(function(t) {
            var n = t.media
              , r = t.blob
              , i = window.URL.createObjectURL(r)
              , o = void 0;
            switch (e.type) {
            case "image":
                o = L.image(i).then(function(e) {
                    var t = e.fullWidth
                      , n = e.fullHeight;
                    return {
                        fullWidth: t,
                        fullHeight: n
                    }
                });
                break;
            case "video":
                o = L.video(r).then(function(e) {
                    var t = e.fullWidth
                      , n = e.fullHeight;
                    return {
                        fullWidth: t,
                        fullHeight: n
                    }
                })["catch"](T.MediaUnsupportedError, function(e) {
                    return {
                        mediaState: Q.ERROR_UNSUPPORTED
                    }
                });
                break;
            case "audio":
            case "ptt":
                o = L.audio(i)["return"]({});
                break;
            case "document":
                o = f["default"].resolve({});
                break;
            default:
                o = f["default"].resolve({})
            }
            return o.then(function(e) {
                return (0,
                p["default"])({
                    decryptedMediaBlob: n,
                    url: i
                }, e)
            })
        }).then(function(t) {
            e.set((0,
            p["default"])({
                mediaState: Q.RESOLVED
            }, t))
        })
    }
    function l(e) {
        return e.mediaState = Q.REUPLOADING,
        C.requestMediaReupload(e)["catch"](T.WapDrop, function(e) {
            return !(e instanceof T.LogoutDrop)
        }, function() {
            throw new T.MediaNeedsReupload
        }).then(function(t) {
            return 200 === t.status ? D.isEncryptedMedia(t.url) ? (e.set({
                clientUrl: t.url,
                mediaKey: t.mediaKey || e.mediaKey,
                needsMediaAck: !0
            }),
            c(e, !0)) : (e.set({
                clientUrl: t.url,
                needsMediaAck: !1
            }),
            c(e, !1)) : 404 === t.status ? f["default"].reject(new V) : t.status >= 400 ? f["default"].reject(new T.MediaNeedsReupload) : void 0
        })
    }
    function u(e) {
        if (!e)
            return null ;
        var t = new O({
            from: e.from,
            to: e.to,
            id: e.id,
            participant: e.participant,
            self: e.self
        })
          , n = Store.Msg.get(t);
        return n || (e.id = t,
        n = new te(e)),
        n
    }
    var d = n(890)
      , p = r(d)
      , h = n(2)
      , f = r(h)
      , m = n(54)
      , g = r(m)
      , v = n(891)
      , y = r(v)
      , E = n(10)
      , b = n(1)
      , S = n(82)
      , M = n(210)
      , C = n(45)
      , T = n(14)
      , w = n(1112)
      , k = n(1110)
      , x = n(140)
      , N = n(23)
      , P = n(432)
      , D = n(83)
      , O = n(55)
      , A = n(1107)
      , R = n(101)
      , I = n(1053)
      , L = n(1114)
      , F = n(141)
      , U = n(46)
      , j = n(84)
      , B = n(103)
      , G = n(9)
      , Y = n(1025)
      , H = n(435)
      , z = n(448)
      , W = n(1023)
      , q = T.define("WapBlockedMedia")
      , V = T.define("MediaNotOnPhone")
      , K = {
        NOTIFICATION: "notification",
        GROUP_NOTIFICATION: "group_notification",
        GP2: "gp2",
        BROADCAST_NOTIFICATION: "broadcast_notification",
        E2E_NOTIFICATION: "e2e_notification",
        CALL_LOG: "call_log",
        CHAT: "chat",
        IMAGE: "image",
        VIDEO: "video",
        LOCATION: "location",
        AUDIO: "audio",
        PTT: "ptt",
        VCARD: "vcard",
        CIPHERTEXT: "ciphertext",
        DOCUMENT: "document",
        UNKNOWN: "unknown",
        MULTI_VCARD: "multi_vcard"
    }
      , X = (0,
    y["default"])({}, K.IMAGE, "image/jpeg")
      , Q = W.STAGE
      , J = z.Message.VideoMessage.ATTRIBUTION
      , Z = {
        type: "type",
        body: "preview",
        clientUrl: "mmsUrl",
        decryptedMediaBlob: "mediaBlob",
        decryptionKey: "decryptionKey",
        uploadhash: "uploadHash",
        mediaState: "mediaStage",
        size: "size",
        filehash: "filehash",
        mimetype: "mimetype",
        url: "renderableUrl",
        width: "thumbWidth",
        height: "thumbHeight",
        fullWidth: "fullWidth",
        fullHeight: "fullHeight",
        duration: "duration",
        isGif: "isGif",
        gifAttribution: "gifAttribution",
        streamable: "streamable",
        filename: "filename",
        pageCount: "pageCount",
        streamingSidecar: "sidecar"
    }
      , $ = (0,
    g["default"])(Z)
      , ee = $.map(function(e) {
        return "change:" + e
    }).join(" ")
      , te = S.extend(A, {
        Collection: "Msg",
        props: {
            id: "msgKey",
            body: "string",
            type: {
                type: "string",
                values: _.values(K)
            },
            subtype: "string",
            t: "number",
            notifyName: "string",
            from: "string",
            to: "string",
            author: "string",
            self: {
                type: "string",
                values: ["in", "out"],
                "default": "in"
            },
            ack: "number",
            invis: "boolean",
            isNewMsg: "boolean",
            star: ["boolean", !0, !1],
            recvFresh: "boolean",
            clientUrl: "string",
            url: "string",
            caption: "string",
            mimetype: "string",
            duration: "string",
            filehash: "string",
            size: "number",
            loc: "string",
            lat: "string",
            lng: "string",
            height: "number",
            width: "number",
            filename: "string",
            streamingSidecar: "array",
            title: "string",
            description: "string",
            canonicalUrl: "string",
            matchedText: "string",
            thumbnail: "string",
            recipients: "array",
            broadcast: "boolean",
            avparams: "object",
            mediaKey: "string",
            pageCount: "number",
            isGif: "boolean",
            gifAttribution: "number",
            quotedMsg: "object",
            quotedStanzaID: "string",
            quotedParticipant: "string",
            mentionedJidList: "array",
            multicast: "boolean",
            vcardList: "array"
        },
        session: {
            fullHeight: "number",
            fullWidth: "number",
            decryptedMediaBlob: "object",
            uploadhash: "string",
            mediaState: {
                type: "string",
                values: _.values(Q),
                "default": Q.INIT
            },
            mustDownloadMedia: {
                type: "boolean",
                "default": !1
            },
            promises: {
                type: "object",
                "default": function() {
                    return {}
                }
            },
            _shouldUploadFromPhone: {
                type: "boolean",
                "default": !1
            },
            local: "boolean",
            reupload: "function",
            needsMediaAck: "boolean",
            search: "boolean",
            msgChunk: "object",
            startOfDay: "number",
            startOfDaySkew: "number",
            _quotedMsgObj: "object",
            isQuotedMsgAvailable: {
                type: "boolean",
                "default": !0
            },
            _forceRMRCallback: {
                type: "function",
                "default": null
            }
        },
        children: {
            senderObj: M,
            mediaData: W
        },
        initialize: function() {
            this.sender && (this.senderObj = Store.Contact.gadd({
                id: this.sender
            }),
            this.listenTo(this.senderObj, "all", this._getCachedEventBubblingHandler("senderObj")));
            var e;
            (e = Store.Msg.preAck[this.id]) && (b.log("Msg:initialize updating msg with out of order ack", e)(),
            this.updateAck(e.ack),
            delete Store.Msg.preAck[this.id]),
            this.isMedia && !this.mimetype && (this.mimetype = X[this.type]),
            this.type === K.CIPHERTEXT && this.listenToOnce(this, "change:type", this.onCiphertextDecrypted),
            o(this.type) && (this._updateMediaState(),
            this.listenTo(this, ee, this._updateMediaState))
        },
        derived: {
            chat: {
                fn: function() {
                    return Store.Chat.get(this.id.remote)
                }
            },
            isGroupMsg: {
                fn: function() {
                    return N.isGroup(this.from) || N.isGroup(this.to)
                }
            },
            isSentByMe: {
                fn: function() {
                    var e = this.id;
                    return "in" !== e.self && !this.isNotification && this.from === Store.Conn.me
                }
            },
            isNotification: {
                deps: ["type"],
                fn: function() {
                    switch (this.type) {
                    case K.GROUP_NOTIFICATION:
                    case K.GP2:
                    case K.BROADCAST_NOTIFICATION:
                    case K.NOTIFICATION:
                    case K.E2E_NOTIFICATION:
                    case K.CALL_LOG:
                        return !0;
                    default:
                        return !1
                    }
                }
            },
            isMedia: {
                deps: ["type"],
                fn: function() {
                    return ["image", "video", "audio"].indexOf(this.type) > -1
                }
            },
            isLink: {
                deps: ["type", "subtype", "title", "description"],
                fn: function() {
                    return "chat" === this.type && "url" === this.subtype && (this.title || this.description)
                }
            },
            isDoc: {
                deps: ["type"],
                fn: function() {
                    return "document" === this.type
                }
            },
            isMMS: {
                deps: ["type"],
                fn: function() {
                    return o(this.type)
                }
            },
            eventType: {
                deps: ["type", "invis", "isNewMsg"],
                fn: function() {
                    var e;
                    return this.isNewMsg ? (e = this.eventTypeFromMsgType(),
                    this.invis ? "i" === e ? "i" : "n" : e) : "i"
                }
            },
            sender: {
                fn: function() {
                    return this.isSentByMe ? this.from : this.isGroupMsg ? this.author : this.from
                }
            },
            containsEmoji: {
                deps: ["body", "caption"],
                fn: function() {
                    switch (this.type) {
                    case K.CHAT:
                        return this.body && P.containsEmoji(this.body);
                    case K.IMAGE:
                        return this.caption && P.containsEmoji(this.caption);
                    default:
                        return !1
                    }
                }
            },
            isFailed: {
                deps: ["isSentByMe", "ack"],
                fn: function() {
                    return this.isSentByMe && this.ack < 0
                }
            },
            vcard: {
                deps: ["type", "body"],
                fn: function() {
                    if (this.type === K.VCARD)
                        try {
                            return Y.parse(this.body)
                        } catch (e) {
                            return
                        }
                }
            },
            isUnsentMedia: {
                deps: ["ack", "isMMS", "isSentByMe"],
                fn: function() {
                    return this.ack < 1 && this.isMMS && this.isSentByMe
                }
            },
            dir: {
                deps: ["type", "body", "subtype", "caption"],
                fn: function() {
                    switch (this.type) {
                    case K.CHAT:
                        return I.dir(this.body);
                    case K.VCARD:
                        return this.subtype ? I.dir(this.subtype) : void 0;
                    case K.IMAGE:
                        return this.caption ? I.dir(this.caption) : void 0;
                    default:
                        return
                    }
                }
            },
            rtl: {
                deps: ["type", "body", "subtype", "caption"],
                fn: function() {
                    switch (this.type) {
                    case K.CHAT:
                        return "rtl" === I.dir(this.body);
                    case K.VCARD:
                        return !!this.subtype && "rtl" === I.dir(this.subtype);
                    case K.IMAGE:
                        return !!this.caption && "rtl" === I.dir(this.caption);
                    default:
                        return !1
                    }
                }
            },
            linkPreview: {
                deps: ["matchedText", "body"],
                fn: function() {
                    return _.isString(this.matchedText) && this.body.indexOf(this.matchedText) > -1
                }
            },
            isPersistent: {
                fn: function() {
                    return this.type === K.E2E_NOTIFICATION && "encrypt" === this.subtype
                }
            }
        },
        _updateMediaState: function() {
            for (var e = this.mediaData, t = 0; t < $.length; t++) {
                var n = $[t];
                e[Z[n]] = this[n]
            }
        },
        typeCanChange: function() {
            return this.type === K.CIPHERTEXT
        },
        hasSymbol: function() {
            return ["image", "video", "audio", "ptt", "location", "vcard", "document", "ciphertext", "unknown"].indexOf(this.type) > -1
        },
        mayFail: function() {
            return this.isSentByMe && this.ack < 1
        },
        canReply: function() {
            return this.chat.canSend && !this.mayFail() && !this.isNotification && this.type !== K.UNKNOWN && this.type !== K.CIPHERTEXT && R.supportsFeature(R.F.REPLIES_OUT)
        },
        canForward: function() {
            if (this.isMedia) {
                if (this.isUnsentMedia)
                    return !1;
                if (this.mediaState === Q.ERROR_MISSING)
                    return !1;
                if (this.mediaState === Q.ERROR_UNSUPPORTED)
                    return !1
            }
            return this.type !== K.CIPHERTEXT && this.type !== K.UNKNOWN
        },
        isGroupLeave: function() {
            return "gp2" === this.type && ("leave" === this.subtype || "remove" === this.subtype) && _.head(this.recipients) === Store.Conn.me
        },
        isTrusted: function() {
            return this.sender === Store.Conn.me || (!(!this.senderObj || !this.senderObj.isMyContact) || (this.isGroupMsg ? this.chat.isTrusted() : !!R.supportsFeature(R.F.SPAM) && this.chat.notSpam))
        },
        getWAids: function() {
            return this.type !== K.VCARD ? null : Y.vcardWAids(this.vcard)
        },
        getVCardThumbnailWAid: function() {
            return this.type !== K.VCARD ? null : _.find(this.getWAids(), function(e) {
                return (Store.ProfilePicThumb.get(e) || {}).img
            })
        },
        resumeRemoteUpload: function() {
            if (this._shouldUploadFromPhone = !0,
            this.mediaState === Q.REMOTE_NEED_UPLOAD && this.promises.mediaPromise) {
                var e = this.promises.mediaPromise;
                return e.control.requestPhoneUpload(),
                e
            }
            return this.downloadMedia()
        },
        forceDownloadMedia: function() {
            return this.mustDownloadMedia = !0,
            this.downloadMedia()
        },
        forceRMR: function() {
            var e = this;
            return new f["default"](function(t, n) {
                e.promises.mediaPromise && e.promises.mediaPromise.control && e.promises.mediaPromise.control.forceRMR || n("forceRMR control undefined"),
                e.promises.mediaPromise.control.forceRMR(t)
            }
            )
        },
        isForcingRMR: function() {
            return !!this._forceRMRCallback
        },
        cancelDownload: function() {
            this.promises.mediaPromise.control.cancel()
        },
        resumeUpload: function() {
            return b.assert(this.mediaState === Q.NEED_UPLOAD, "resume-non-need-upload", "resumeUpload called while state was " + this.mediaState)(),
            this.reupload()
        },
        cancelUpload: function() {
            this.promises.uploadPromise2.control.cancel()
        },
        downloadMedia: function() {
            var e = this;
            if (this.mediaState === Q.PREPARING)
                return f["default"].resolve();
            var t = f["default"].resolve();
            if (!this.decryptedMediaBlob || this.promises.mediaPromise && this.promises.mediaPromise.isPending()) {
                if (this.promises.mediaPromise)
                    return this.promises.mediaPromise.control.poke(),
                    this.promises.mediaPromise
            } else
                t = H.validateBlob(this.decryptedMediaBlob).then(function(t) {
                    return t ? f["default"].reject("BLOB VALID") : void e.set({
                        mediaState: Q.FETCHING,
                        url: null
                    })
                });
            return this.promises.mediaPromise = t.loop(function(t) {
                var n = void 0;
                if (e.mediaState === Q.REMOTE_UPLOADING)
                    n = f["default"].sit("phoneResolved");
                else if (e.mediaState === Q.REMOTE_NEED_UPLOAD) {
                    var r = R.supportsFeature(R.F.MEDIA_RETRY);
                    if (e._shouldUploadFromPhone && r)
                        return e.set({
                            _shouldUploadFromPhone: !1,
                            mediaState: Q.REMOTE_UPLOADING
                        }),
                        void Store.Msg.send(e).then(function(t) {
                            "success" !== t && e.promises.mediaPromise.control.phoneResolved(!1)
                        });
                    n = f["default"].sit("requestPhoneUpload", function() {
                        return !1
                    }).addResolveControl("phoneResolved", _.identity)
                }
                return n ? n.then(function(n) {
                    n ? t() : e.mediaState = Q.REMOTE_NEED_UPLOAD
                }) : void t()
            }).loop(function(t) {
                var n = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1]
                  , r = void 0;
                return n ? r = l(e) : (r = f["default"].resolve(),
                r = r.then(function() {
                    return c(e, D.isEncryptedMedia(e.clientUrl))
                })),
                r.then(function(e) {
                    t(e)
                })["catch"](T.MediaNeedsReupload, function() {
                    return f["default"].loop(function(t) {
                        return b.log("msg:downloadMedia need rmr, will auto " + e.mustDownloadMedia)(),
                        e.mustDownloadMedia ? (e.mustDownloadMedia = !1,
                        void t(!0)) : (e.mediaState = Q.NEED_POKE,
                        f["default"].sit("poke"))
                    })
                })["catch"](q, T.MediaLoadError, function(t) {
                    return b.error("msg:processMedia: " + t)(),
                    e.mediaState = Q.NEED_POKE,
                    f["default"].sit("poke")["return"](!1)
                })["catch"](V, function() {
                    return e.mediaState = Q.ERROR_MISSING,
                    U.waitForBBEvent(e, "change:clientUrl")["return"](!1)
                })
            })["catch"]("BLOB VALID", _.noop)["catch"](T.LogoutDrop, _.noop).endWithControls("poke", "phoneResolved", "cancel", "requestPhoneUpload", "forceRMR")
        },
        "delete": function() {
            this.decryptedMediaBlob && this.unset("decryptedMediaBlob"),
            D.isBlob(this.url) && URL.revokeObjectURL(this.url),
            S.prototype["delete"].call(this),
            Store.Msg.remove(this.id),
            Store.StarredMsg.remove(this.id),
            this.msgChunk && this.msgChunk.remove(this.id);
            var e = Store.Chat.get(this.id.remote);
            if (e && (e.unreadMsgAnchor === this && (e.unreadMsgAnchor = void 0),
            e.lastReceivedKey === this.id)) {
                e.lastReceivedKey = void 0;
                var t = e.getLastReceivedMsg();
                t && (e.lastReceivedKey = t.id)
            }
        },
        quotedMsgObj: function() {
            if (!this.quotedMsg)
                return null ;
            if (this._quotedMsgObj) {
                var e = Store.Msg.get(this._quotedMsgObj.id);
                return e ? this._quotedMsgObj = e : this._quotedMsgObj
            }
            var t = !this.quotedParticipant || this.quotedParticipant === Store.Conn.me
              , n = t ? "out" : "in"
              , r = {
                id: this.quotedStanzaID,
                from: t ? Store.Conn.me : this.id.remote,
                to: t ? this.id.remote : Store.Conn.me,
                self: n,
                author: this.quotedParticipant
            }
              , i = N.isGroup(r.from) || N.isGroup(r.to);
            return i && Store.Conn.me !== this.quotedParticipant && (r.participant = this.quotedParticipant),
            _.assign(r, this.quotedMsg),
            this._quotedMsgObj = u(r)
        },
        contextInfo: function() {
            var e = _.omit(this.toJSON(), ["id", "t", "notifyName", "from", "to", "author", "self", "ack", "invis", "isNewMsg", "star", "recvFresh", "recipients", "broadcast", "avparams", "quotedMsg", "quotedStanzaID", "quotedParticipant", "senderObj", "multicast"]);
            return {
                quotedMsg: e,
                quotedParticipant: this.sender,
                quotedStanzaID: this.id.id
            }
        },
        displayName: function(e, t) {
            if (!this.sender)
                return "";
            if (this.sender === Store.Conn.me)
                return l10n.t("web_you");
            var n = this.senderObj
              , r = e ? n.shortName : void 0;
            if (r)
                return r;
            if (n.name)
                return n.name;
            var i = t && this.notifyName ? " ~" + this.notifyName : "";
            return l10n.isRTL() ? l10n.embedLTR(N.formattedUser(this.sender)) + i : N.formattedUser(this.sender) + i
        },
        isQuoted: function(e) {
            var t = this.quotedMsgObj();
            return !!t && t.sender === e
        },
        isMentioned: function(e) {
            return _.indexOf(this.mentionedJidList, e) > -1
        },
        mentionMap: function() {
            if (!this.isGroupMsg || !R.supportsFeature(R.F.MENTIONS_IN))
                return null ;
            if (!_.size(this.mentionedJidList))
                return null ;
            var e = {};
            return _.forEach(this.mentionedJidList, function(t) {
                var n = N.user(t)
                  , r = void 0
                  , i = Store.Contact.get(t);
                i && (i.name ? r = i.name : i.notifyName && (r = i.notifyName.name)),
                r || t !== Store.Conn.me || (r = Store.Conn.pushname),
                r = r || N.formattedUser(t),
                e["@" + n] = {
                    jid: t,
                    display: r
                }
            }),
            e
        },
        updateAck: function(e) {
            var t = this.ack;
            _.isNumber(e) && ("undefined" == typeof t || e > t) ? this.ack = e : e === -1 && 0 === this.ack && (this.ack = -1,
            this.mediaState === te.MEDIA_STATE.REMOTE_UPLOADING && (this.promises.mediaPromise ? this.promises.mediaPromise.control.phoneResolved(!1) : this.mediaState = te.MEDIA_STATE.REMOTE_NEED_UPLOAD))
        },
        sendMediaMsg: function(e) {
            var t = this
              , n = e.filehash;
            return this.mediaKey && (delete e.name,
            e.mimetype = this.mimetype,
            e.size = this.size,
            e.type = this.type === K.PTT ? "audio" : this.type,
            e.height = this.height,
            e.width = this.width,
            e.duration = this.duration,
            e.filehash = this.filehash,
            this.type === K.DOCUMENT && (e.filename = this.filename)),
            this.set({
                mediaState: Q.SENDING,
                avparams: e,
                filehash: e.filehash,
                uploadhash: n,
                size: parseInt(e.size, 10)
            }),
            Store.Msg.send(this).then(function(e) {
                b.assert("dropped" !== e, "media-dropped", "id: " + t.id)(),
                t.mediaState = t.decryptedMediaBlob ? Q.RESOLVED : Q.INIT
            })
        },
        sendPlayed: function() {
            if ("ptt" === this.type && !(this.isSentByMe || this.ack >= E.ACK_PLAYED)) {
                var e = this;
                C.sendMessagePlayed(this.id).then(function(t) {
                    e.ack = E.ACK_PLAYED
                })["catch"](T.WapDrop, _.noop)
            }
        },
        avParams: function() {
            return this.avparams ? this.avparams : {
                url: this.clientUrl,
                type: this.type,
                mimetype: this.mimetype,
                filehash: this.filehash,
                filename: this.filename,
                duration: this.duration,
                width: this.fullWidth,
                height: this.fullHeight
            }
        },
        resend: function() {
            return this.isFailed ? (this.ack = 0,
            this.isMMS ? this.resumeRemoteUpload() : Store.Msg.send(this)) : f["default"].resolve()
        },
        onCiphertextDecrypted: function() {
            o(this.type) && (this._updateMediaState(),
            this.listenTo(this, ee, this._updateMediaState));
            var e = this.chat
              , t = e.msgs.length
              , n = e.msgs.indexOf(this);
            n !== -1 && t - n <= 10 && G.alertNewMsg(this)
        },
        handleUpload: function(e, t, n) {
            var r = this
              , i = t.then(function(t) {
                return e["return"](t)
            }).then(function(e) {
                var t = e.avParams
                  , n = e.mediaKey;
                b.assert(t, "empty-av-params", "id: " + r.id)(),
                r.set({
                    reupload: void 0,
                    clientUrl: t.url,
                    mediaKey: n,
                    mediaState: Q.SENDING
                }),
                r.promises.uploadPromise2 = null ,
                r.sendMediaMsg(t)
            })["catch"](T.GaveUpRetry, f["default"].CancellationError, T.CapabilityError, T.Server5xxDrop, function(e) {
                b.error("msg:handleUpload failed to upload " + r.id + ", " + e)(),
                r.set({
                    mediaState: Q.NEED_UPLOAD
                }),
                r.promises.uploadPromise2 = null
            })["catch"](T.MediaMissing, function() {
                b.warn("msg:handleUpload can not forward " + r.id + ", not on phone")(),
                r.set({
                    uploadPromise2: null ,
                    mediaState: Q.ERROR_MISSING
                })
            })["catch"](T.MediaUnsupportedError, function() {
                b.warn("msg:handleUpload can not forward " + r.id + ", media unsupported")(),
                r.set({
                    uploadPromise2: null ,
                    mediaState: Q.ERROR_UNSUPPORTED
                })
            })["catch"](T.LogoutDrop, function(e) {
                return _.noop
            })["catch"](function(e) {
                b.assert(!1, "upload-uncaught-error", "Error: " + e)()
            })
              , o = function() {
                return r.mediaState === Q.NEED_UPLOAD ? r.handleUpload(e, n(r.to), n) : r.uploadPromise2 || e
            };
            return this.set({
                mediaState: Q.UPLOADING,
                uploadPromise2: t,
                reupload: o
            }),
            this.promises.uploadPromise2 = t,
            i
        },
        eventTypeFromMsgType: function() {
            var e, t, n = this.type, r = this.subtype;
            return n === K.GP2 || n === K.GROUP_NOTIFICATION ? "subject" === r ? e = "n" : "add" === r || "invite" === r ? (t = _.head(this.recipients),
            e = t === Store.Conn.me ? "s" : "i") : "remove" === r ? (t = _.head(this.recipients),
            e = t === Store.Conn.me ? "n" : "i") : e = "create" === r ? "n" : "i" : e = n === K.BROADCAST_NOTIFICATION || n === K.NOTIFICATION || n === K.E2E_NOTIFICATION ? "create" === r ? "n" : "i" : n === K.CALL_LOG ? "n" : this.broadcast ? "i" : "d",
            e
        }
    })
      , ne = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 65, 66, 67, 68, 69, 70]
      , re = {
        image: 1,
        video: 1,
        audio: 1,
        ptt: 1,
        document: 1
    }
      , ie = []
      , oe = {}
      , ae = new j(function() {
        var e = ie;
        ie = [],
        s(e)
    }
    );
    te.TYPE = K,
    te.MEDIA_STATE = Q,
    te.GIF_ATTRIBUTION = J,
    te.newTag = i,
    te.typeIsMMS = o,
    e.exports = te
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(54)
      , o = r(i)
      , a = n(436)
      , s = r(a)
      , c = n(2)
      , l = r(c)
      , u = n(891)
      , d = r(u)
      , p = n(900)
      , h = r(p)
      , f = n(433)
      , m = r(f)
      , g = n(1)
      , v = n(14)
      , y = n(9)
      , _ = n(46)
      , E = n(31)
      , b = {
        async: function(e, t) {
            var n = e.split(".").slice(-1)
              , r = (0,
            m["default"])(n, 1)
              , i = r[0];
            return this._asyncKey(i, e, t)
        },
        asyncState: function(e, t) {
            var n = this
              , r = E.mapValues(e, function(e, t) {
                return n._asyncKey(t, e)
            });
            for (var i in t)
                void 0 === r[i] && (r[i] = t[i]);
            return r
        },
        _asyncKey: function(e, t) {
            var n = arguments.length <= 2 || void 0 === arguments[2] ? this.props : arguments[2]
              , r = t.split(".")
              , i = this._getAsyncIndex(r)
              , o = r.slice(0, i)
              , a = (0,
            h["default"])(o)
              , s = a[0]
              , c = a.slice(1)
              , l = r.slice(i + 1)
              , u = n[r[0]];
            return i && (u = this._getObservable(e, s, c, n, r[i])),
            u ? E.isFunction(u.on) || E.isFunction(u.off) ? this._asyncObserver(e, r, c, u, l) : g.trace("asyncMixin path resolved to non-observable: " + t) : g.trace("asyncMixin path resolved to nonexistent state! path: " + t)
        },
        _getObservable: function(e, t, n, r, i) {
            var o = n.length ? r[t].getp(n) : r[t];
            return o ? Store[i].get(o) : null
        },
        _asyncObserver: function(e, t, n, r, i) {
            var o = this;
            this._loadStale(r);
            var a = "change:" + i.join(".")
              , s = function() {
                return o.setOrQueueState((0,
                d["default"])({}, e, r.getp(i)))
            };
            return r.on(a, s),
            r.isState && r._uiObservers++,
            this._asyncs = this._asyncs || {},
            this._asyncs[e] = {
                key: e,
                splitPath: t,
                basePath: n,
                observable: r,
                callback: s,
                eventKey: a
            },
            r.getp(i)
        },
        _loadStale: function(e) {
            var t = this;
            if (e.stale) {
                var n = e.id;
                y.uiBusy ? !function() {
                    var r = t._waAsyncWaits || (t._waAsyncWaits = [])
                      , i = _.waitForBBEvent(y, "ui_idle").then(function() {
                        return e.getCollection().find(n)
                    })["finally"](function() {
                        t._waAsyncWaits = E.without(t._waAsyncWaits, i)
                    })["catch"](v.WapDrop, E.noop)["catch"](l["default"].CancellationError, E.noop);
                    r.push(i)
                }() : e.getCollection().find(n)["catch"](v.WapDrop, E.noop)
            }
        },
        componentWillMount: function() {
            this.__willMount = !0,
            this.__stateQueue && (this.setState(E.assign.apply(E, [{}].concat((0,
            s["default"])(this.__stateQueue)))),
            this.__stateQueue = void 0)
        },
        setOrQueueState: function(e) {
            this.__willMount ? this.setState(e) : (this.__stateQueue = this.__stateQueue || [],
            this.__stateQueue.push(e))
        },
        _observersMatch: function(e, t, n, r) {
            return n[e] === r[e] && (!t.length || n[e].getp(t) === r[e].getp(t))
        },
        componentWillReceiveProps: function(e) {
            var t = this;
            if (this._asyncs) {
                var n = {};
                E.forIn(this._asyncs, function(r, i) {
                    var o = r.splitPath
                      , a = r.basePath
                      , s = (0,
                    m["default"])(o, 1)
                      , c = s[0];
                    if (!t._observersMatch(c, a, t.props, e)) {
                        var l = r.observable
                          , u = r.callback
                          , d = r.eventKey;
                        l.off(d, u),
                        l.isState && l._uiObservers--,
                        n[i] = t._asyncKey(i, o.join("."), e)
                    }
                }),
                (0,
                o["default"])(n).length && this.setOrQueueState(n)
            }
        },
        componentWillUnmount: function() {
            this._waAsyncUnmount = !0;
            var e = this._waAsyncWaits;
            if (e)
                for (; e.length; )
                    e.shift().cancel();
            this._asyncs && E.forIn(this._asyncs, function(e) {
                var t = e.observable
                  , n = e.callback
                  , r = e.eventKey;
                t.off(r, n),
                t.isState && t._uiObservers--
            })
        },
        _getAsyncIndex: function(e) {
            for (var t = 1; t < e.length; ++t)
                if (e[t].charAt(0).toLowerCase() !== e[t].charAt(0))
                    return t;
            return 0
        }
    };
    e.exports = b
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        switch (t) {
        case "text":
            return e.type === g.TYPE.CHAT && "url" !== e.subtype;
        case "image":
            return e.type === g.TYPE.IMAGE;
        case "video":
            return e.type === g.TYPE.VIDEO && !e.isGif;
        case "gif":
            return e.type === g.TYPE.VIDEO && e.isGif;
        case "audio":
            return e.type === g.TYPE.AUDIO;
        case "ptt":
            return e.type === g.TYPE.PTT;
        case "document":
            return e.type === g.TYPE.DOCUMENT;
        case "location":
            return e.type === g.TYPE.LOCATION;
        case "vcard":
            return e.type === g.TYPE.VCARD || e.type === g.TYPE.MULTI_VCARD;
        case "url":
            return e.type === g.TYPE.CHAT && "url" === e.subtype;
        case void 0:
            return !1;
        default:
            return !1
        }
    }
    var o = n(433)
      , a = r(o)
      , s = n(899)
      , c = r(s)
      , l = n(2)
      , u = r(l)
      , d = n(6)
      , p = n(10)
      , h = n(1)
      , f = n(82)
      , m = n(1038)
      , g = n(986)
      , v = n(210)
      , y = n(1108)
      , E = n(1037)
      , b = n(1017)
      , S = n(1254)
      , M = n(1253)
      , C = n(1252)
      , T = n(101)
      , w = n(9)
      , k = n(69)
      , x = n(45)
      , N = n(15)
      , P = n(137)
      , D = n(14)
      , O = n(55)
      , A = n(83)
      , R = n(23)
      , I = n(443)
      , L = n(68).ActionToast
      , F = n(68).ActionType
      , U = n(1055)
      , j = n(1025)
      , B = 3e5
      , G = {
        GROUP: "group",
        BROADCAST: "broadcast",
        CHAT: "chat"
    }
      , Y = f.extend({
        Collection: "Chat",
        props: {
            id: "string",
            t: "number",
            unreadCount: {
                type: "number",
                "default": 0
            },
            archive: "boolean",
            isReadOnly: "boolean",
            modifyTag: "number",
            muteExpiration: {
                type: "number",
                "default": 0
            },
            name: "string",
            notSpam: "boolean",
            pendingMsgs: "boolean"
        },
        session: {
            createdLocally: "boolean",
            pendingAction: "number",
            formattedTitle: "string",
            active: "boolean",
            pausedTimerId: "number",
            presenceResendTimerId: "number",
            recording: "boolean",
            typing: "boolean",
            unreadDivider: "object",
            colors: "object",
            composeContents: {
                type: "object",
                "default": function() {
                    return {}
                }
            },
            popupPanels: "object",
            popupPositionChange: "number",
            squelch: "number",
            pendingSeenCount: {
                type: "number",
                "default": 0
            },
            markedUnread: "boolean",
            msgChunks: {
                type: "array",
                "default": function() {
                    return []
                }
            },
            trusted: "boolean",
            canSend: "boolean",
            unreadMsgAnchor: "object",
            disableUnreadAnchor: "boolean",
            promises: {
                type: "object",
                "default": function() {
                    return {}
                }
            },
            ftsCache: {
                type: "object",
                "default": function() {
                    return {}
                }
            },
            lastReceivedKey: "object",
            composeQuotedMsg: "object",
            msgsLength: "number",
            msgsChanged: {
                type: "number",
                "default": 0
            }
        },
        collections: {
            msgs: b,
            mediaMsgs: S,
            linkMsgs: M,
            docMsgs: C
        },
        children: {
            presence: m,
            contact: v,
            mute: y,
            groupMetadata: E
        },
        initialize: function() {
            var e = this;
            if (this.msgs.msgLoadState.contextLoaded = !0,
            this.isVisible || (this.msgs.msgLoadState.noEarlierMsgs = !0),
            this.presence = Store.Presence.gadd(this.id),
            this.listenTo(this.presence, "all", this._getCachedEventBubblingHandler("presence")),
            this.mute = Store.Mute.add({
                id: this.id,
                expiration: this.muteExpiration
            }, {
                merge: !0
            }),
            this.listenTo(this.mute, "all", this._getCachedEventBubblingHandler("mute")),
            R.isPSA(this.id) && this._updatePSAName(),
            this.contact = Store.Contact.gadd(this.id),
            this.name && !this.contact.name && (this.contact.name = this.name),
            this.listenTo(this.contact, "all", this._getCachedEventBubblingHandler("contact")),
            this.listenTo(this.contact, "change:formattedName", this.updateTitle),
            this.isGroup && (this.trusted = !0),
            this.isGroup || this.isBroadcast) {
                var t;
                this.isBroadcast && !Store.GroupMetadata.get(this.id) && (t = !0),
                this.groupMetadata = Store.GroupMetadata.gadd({
                    id: this.id
                }),
                this.listenTo(this.groupMetadata, "all", this._getCachedEventBubblingHandler("groupMetadata")),
                this.listenTo(this.groupMetadata, "change:stale", this.updateReadOnly),
                this.listenTo(this.groupMetadata, "change:trusted change:stale", this.isTrusted),
                this.listenTo(this.groupMetadata.participants, "add remove reset", this.updateReadOnly),
                this.listenTo(this.groupMetadata.participants, "change:contact.formattedShortName", this.updateTitle),
                this.updateReadOnly();
                var n = this.id;
                this.listenTo(this, "change:isReadOnly", function() {
                    this.isTrusted(),
                    this.updateCanSend(),
                    Store.ProfilePicThumb.update(n)["catch"](D.WapDrop, _.noop),
                    Store.GroupMetadata.update(n)["catch"](D.WapDrop, _.noop)
                }),
                t && Store.GroupMetadata.update(n)["catch"](D.WapDrop, _.noop)
            } else
                this.listenTo(this.presence, "change:isOnline", this._presenceOnlineChanged),
                this.listenTo(this.contact, "change:isMyContact", this.isTrusted),
                this.listenTo(Store.Blocklist, "add remove reset", this.updateCanSend);
            Store.Chat.notSpam[this.id] && !this.notSpam && this.sendNotSpam()["catch"](_.noop),
            Store.Chat.notSpam[this.id] = !!this.notSpam,
            this.notSpam || this.listenTo(this, "change:notSpam", this.onNotSpamChange),
            this.updateTitle(),
            this.isTrusted(),
            this.updateCanSend(),
            this.listenTo(this.msgs, "add", this.onNewMsg),
            this.listenTo(this.msgs, "remove", this.updateSortTime),
            this.listenTo(this.msgs, "bulk_add", this.addMediaMsgs),
            this.listenTo(this.msgs, "change:last", function() {
                e.msgsChanged++
            }),
            this.listenTo(this.msgs, "add remove bulk_add", function() {
                e.msgsChanged++,
                e.msgsLength = e.msgs.length
            }),
            this.listenTo(this, "change:msgs", this.resetMediaMsgs),
            this._saveAssignedColors = _.debounce(this.saveAssignedColors, 1e3),
            this.listenTo(this, "change:active", this.onActiveUpdate),
            this.pendingAction = 0,
            this.listenTo(this, "change:pendingAction", this.onPendingActionUpdate),
            this.listenTo(this, "change:t change:modifyTag", this._clearFtsCache)
        },
        derived: {
            kind: {
                fn: function() {
                    return this.isGroup ? G.GROUP : this.isBroadcast ? G.BROADCAST : this.isUser ? G.CHAT : void 0
                }
            },
            isGroup: {
                fn: function() {
                    return R.isGroup(this.id)
                }
            },
            isBroadcast: {
                fn: function() {
                    return R.isBroadcast(this.id)
                }
            },
            isUser: {
                fn: function() {
                    return R.isUser(this.id)
                }
            },
            isPSA: {
                fn: function() {
                    return R.isPSA(this.id)
                }
            },
            hasUnread: {
                deps: ["unreadCount"],
                fn: function() {
                    return 0 !== this.unreadCount
                }
            },
            isVisible: {
                deps: ["createdLocally", "msgs", "msgsLength"],
                fn: function() {
                    return !!this._isVisibleLatched || !R.isStatusV3(this.id) && (this._isVisibleLatched = !this.createdLocally || this.msgs.some(function(e) {
                        return e.type !== g.TYPE.E2E_NOTIFICATION
                    }),
                    this._isVisibleLatched)
                }
            },
            previewMessage: {
                deps: ["msgs", "msgsChanged"],
                fn: function() {
                    for (var e = this.msgs.length - 1; e >= 0; e--) {
                        var t = this.msgs.at(e);
                        if (t && t.type !== g.TYPE.E2E_NOTIFICATION)
                            return t
                    }
                    return this.msgs.last()
                }
            }
        },
        onActiveUpdate: function() {
            this.isGroup && this.active && (this.squelch = -1),
            this.presence.chatActive = this.active
        },
        onPendingActionUpdate: function() {
            this.pendingAction < 0 && (h.log("chat:onPendingActionUpdate pendingAction value is invalid")(),
            this.pendingAction = 0)
        },
        onNotSpamChange: function() {
            Store.Chat.notSpam[this.id] = this.notSpam,
            this.isTrusted(),
            this.notSpam && this.stopListening(this, "change:notSpam")
        },
        hasMaybeSentMsgToChat: function() {
            return _.some(this.getAllMsgs(), function(e) {
                return e.isSentByMe
            })
        },
        isTrusted: function() {
            var e = void 0;
            return this.isGroup ? e = T.supportsFeature(T.F.SPAM) ? this.isReadOnly || this.notSpam || this.groupMetadata.isTrusted() : this.groupMetadata.isTrusted() : this.isBroadcast ? e = !0 : this.isUser && (e = !T.supportsFeature(T.F.SPAM) || (this.notSpam || this.contact.isMyContact)),
            !e && this.hasMaybeSentMsgToChat() && (e = !0),
            this.trusted = e
        },
        updateTitle: function() {
            this.isBroadcast ? this.formattedTitle = this.contact.name || this.groupMetadata.participants.map(function(e) {
                return e.contact.formattedShortName
            }).join(", ") : this.isUser ? this.formattedTitle = this.contact.name || R.formattedUser(this.id) : this.isGroup && (this.formattedTitle = this.contact.name)
        },
        title: function() {
            return this.isGroup ? this.formattedTitle || l10n.t("unknown_subject") : this.formattedTitle
        },
        sendExit: function() {
            var e = this;
            if (!this.isGroup)
                return u["default"].reject(new D.ActionError);
            if (this.promises.sendExit)
                return this.promises.sendExit;
            this.promises.sendExit = x.leaveGroup(this.id);
            var t = new F(l10n.t("action_group_exiting"))
              , n = this.promises.sendExit.then(function(e) {
                return 200 === e.status ? new F(l10n.t("action_group_exited")) : e.status >= 400 ? new F(l10n.t("action_group_exit_failed")) : void 0
            })["catch"](function(e) {
                return h.error("models:chat:sendExit dropped")(e),
                new F(l10n.t("action_group_exit_failed"),l10n.t("action_try_again"),this.sendExit.bind(this))
            });
            return w.openToast(d.createElement(L, {
                id: L.genId(),
                initialAction: t,
                pendingAction: n
            })),
            this.promises.sendExit.bind(this).then(function(e) {
                200 !== e.status || e._duplicate || this.exit()
            })["finally"](function() {
                e.promises.sendExit = null
            })
        },
        canExit: function() {
            return T.supportsFeature(T.F.GROUP_EXIT)
        },
        exit: function() {
            this.isGroup && (this.groupMetadata.participants.remove(Store.Conn.me),
            this.isReadOnly = !0)
        },
        sendDelete: function() {
            var e = this;
            if (this.promises.sendDelete)
                return this.promises.sendDelete;
            var t = this.msgs.last()
              , n = t ? t.id : void 0;
            this.promises.sendDelete = x.sendConversationDelete(this.id, n);
            var r, i = this.kind;
            switch (i) {
            case G.GROUP:
                r = l10n.t("action_group_deleting");
                break;
            case G.BROADCAST:
                r = l10n.t("action_broadcast_deleting");
                break;
            case G.CHAT:
                r = l10n.t("action_chat_deleting")
            }
            r = new F(r);
            var o = this.promises.sendDelete.bind(this).then(function(e) {
                if (200 === e.status)
                    switch (i) {
                    case G.GROUP:
                        return new F(l10n.t("action_group_deleted"));
                    case G.BROADCAST:
                        return new F(l10n.t("action_broadcast_deleted"));
                    case G.CHAT:
                        return new F(l10n.t("action_chat_deleted"))
                    }
                else if (e.status >= 400)
                    switch (i) {
                    case G.GROUP:
                        return new F(l10n.t("action_group_delete_failed"));
                    case G.BROADCAST:
                        return new F(l10n.t("action_broadcast_delete_failed"));
                    case G.CHAT:
                        return new F(l10n.t("action_chat_delete_failed"))
                    }
            })["catch"](function(e) {
                h.error("models:chat:sendDelete dropped")(e);
                var t = void 0;
                switch (i) {
                case G.GROUP:
                    t = l10n.t("action_group_delete_failed");
                    break;
                case G.BROADCAST:
                    t = l10n.t("action_broadcast_delete_failed");
                    break;
                case G.CHAT:
                    t = l10n.t("action_chat_delete_failed")
                }
                return new F(t,l10n.t("action_try_again"),this.sendDelete.bind(this))
            });
            return w.openToast(d.createElement(L, {
                id: L.genId(),
                initialAction: r,
                pendingAction: o
            })),
            this.promises.sendDelete.bind(this).then(function(e) {
                if (200 === e.status && !e._duplicate) {
                    var n = this.msgs.last();
                    t === n ? this["delete"](!0) : this.deleteMsgsBeforeMsgInclusive(t)
                }
            })["finally"](function() {
                e.promises.sendDelete = null
            })
        },
        updateCanSend: function() {
            return this.isReadOnly ? this.canSend = !1 : this.isUser ? this.canSend = !(this.contact.isBlocked() || this.isPSA) : this.canSend = !0
        },
        canDelete: function() {
            return T.supportsFeature(T.F.DELETE)
        },
        canClear: function() {
            return T.supportsFeature(T.F.CHAT_CLEAR)
        },
        sendClear: function(e) {
            var t = this;
            if (this.promises.sendClear)
                return this.promises.sendClear;
            var n = this.msgs.last()
              , r = n ? n.id : void 0;
            this.promises.sendClear = x.sendConversationClear(this.id, r, !e);
            var i = new F(l10n.t("action_chat_clearing"))
              , o = this.promises.sendClear.then(function(e) {
                return 200 === e.status ? new F(l10n.t("action_chat_cleared")) : e.status >= 400 ? new F(l10n.t("action_chat_clear_failed")) : void 0
            })["catch"](function(n) {
                return h.error("models:chat:sendClear dropped")(n),
                new F(l10n.t("action_chat_clear_failed"),l10n.t("action_try_again"),t.sendClear.bind(t, e))
            });
            return w.openToast(d.createElement(L, {
                id: L.genId(),
                initialAction: i,
                pendingAction: o
            })),
            this.promises.sendClear.then(function(r) {
                200 !== r.status || r._duplicate || t.deleteMsgsBeforeMsgInclusive(n, e)
            })["finally"](function() {
                t.promises.sendClear = null
            })
        },
        "delete": function(e) {
            this.cancelPendingPromises(),
            f.prototype["delete"].call(this),
            this.groupMetadata["delete"](),
            this.presence["delete"](),
            Store.Mute.remove(this.id),
            this.mute["delete"](),
            this.deleteMsgs(),
            Store.Chat.remove(this.id),
            w.clearChat(this),
            this.mediaMsgs["delete"](),
            this.linkMsgs["delete"](),
            this.docMsgs["delete"]()
        },
        isDirty: function() {
            return 0 !== this.unreadCount
        },
        resetMediaMsgs: function() {
            this.mediaMsgs["delete"](),
            this.mediaMsgs.add(this.msgs.models.filter(function(e) {
                return e.isMedia
            })),
            this.linkMsgs["delete"](),
            this.linkMsgs.add(this.msgs.models.filter(function(e) {
                return e.isLink
            })),
            this.docMsgs["delete"](),
            this.docMsgs.add(this.msgs.models.filter(function(e) {
                return e.isDoc
            }))
        },
        addMediaMsgs: function(e, t) {
            var n = _.isArray(e) ? e : [e]
              , r = n.filter(function(e) {
                return e.isMedia
            });
            r.length > 0 && this.mediaMsgs.add(r, t);
            var i = n.filter(function(e) {
                return e.isLink
            });
            i.length > 0 && this.linkMsgs.add(i, t);
            var o = n.filter(function(e) {
                return e.isDoc
            });
            o.length > 0 && this.docMsgs.add(o, t)
        },
        onNewMsg: function(e) {
            if (e && "i" !== e.eventType && (this.t = e.t,
            this.promises.updateSortTime && this.promises.updateSortTime.cancel(),
            this.archive && (this.archive = !1),
            e.isSentByMe || this.presence.handle({
                id: this.id,
                participant: e.author,
                type: "available"
            }),
            !e.isSentByMe))
                if ("d" === e.eventType)
                    this.unreadCount = this.unreadCount + 1 || 1,
                    e.type !== g.TYPE.CIPHERTEXT && w.alertNewMsg(e),
                    this.msgs.length < p.MSG_PRELOAD_THRESHOLD && this.loadEarlierMsgs();
                else if ("s" === e.eventType) {
                    if ("gp2" === e.type && "add" === e.subtype && _.head(e.recipients) === Store.Conn.me && !this.contact.name)
                        return;
                    w.alertNewMsg(e)
                }
        },
        setArchive: function(e, t) {
            var n = this;
            if (this.archive === e)
                return u["default"].reject(new D.ActionError);
            if (this.promises.setArchive)
                return this.promises.setArchive;
            var r = this.lastReceivedKey
              , i = x.sendConversationArchive(this.id, e, r)
              , o = new F(e ? l10n.t("action_chat_archiving") : l10n.t("action_chat_unarchiving"));
            t = t || L.genId();
            var a = i.then(function(r) {
                var i = void 0;
                return 200 === r.status ? (i = e ? l10n.t("action_chat_archived") : l10n.t("action_chat_unarchived"),
                new F(i,l10n.t("action_undo"),n.setArchive.bind(n, !e, t))) : r.status >= 400 ? new F(e ? l10n.t("action_chat_archive_failed") : l10n.t("action_chat_unarchive_failed")) : void 0
            })["catch"](function(r) {
                h.error("models:chat:setArchive dropped")(r);
                var i = e ? l10n.t("action_chat_archive_failed") : l10n.t("action_chat_unarchive_failed");
                return new F(i,l10n.t("action_try_again"),n.setArchive.bind(n, e, t))
            });
            return w.openToast(d.createElement(L, {
                id: t,
                initialAction: o,
                pendingAction: a
            })),
            this.promises.setArchive = i.bind(this).then(function(t) {
                200 !== t.status || t._duplicate || (this.archive = e)
            })["finally"](function() {
                n.promises.setArchive = null
            })
        },
        canArchive: function() {
            return this.isBroadcast ? T.supportsFeature(T.F.ARCHIVE_BROADCAST) : T.supportsFeature(T.F.ARCHIVE)
        },
        sendSeen: function() {
            if (this.markedUnread || 0 === this.unreadCount)
                return u["default"].resolve();
            if (!k.available)
                return this.listenTo(k, "change:available", this.sendSeen),
                u["default"].resolve();
            this.stopListening(k, "change:available", this.sendSeen);
            var e = this.unreadCount - this.pendingSeenCount
              , t = this.unreadCount === -1 && e === -1;
            if (e <= 0 && !t)
                return u["default"].resolve();
            this.disableUnreadAnchor = !0,
            this.pendingSeenCount = this.unreadCount;
            var n = this
              , r = function() {
                n.pendingSeenCount = n.pendingSeenCount - e,
                n.pendingSeenCount < 0 && (h.error("models:chat:sendSeen unread " + n.unreadCount + " pending: " + n.pendingSeenCount + " delta: " + e)(),
                n.pendingSeenCount = 0)
            }
              , i = this.lastReceivedKey;
            return T.gte([0, 4]) ? x.sendConversationSeen(this.id, i, e).bind(this).then(function(t) {
                return r(),
                200 !== t.status || t._duplicate || this.markSeen(e),
                t
            })["catch"](D.WapDrop, function(e) {
                r(),
                h.error("models:chat:sendConversationSeen dropped")()
            }) : (r(),
            this.markSeen(e),
            x.sendConversationSeen(this.id, i, e).bind(this).then(function(e) {
                return e
            })["catch"](D.WapDrop, function(e) {
                h.error("models:chat:sendConversationSeen dropped")()
            }))
        },
        markSeen: function(e) {
            e && "number" == typeof e ? e > 0 && e <= this.unreadCount ? this.unreadCount = this.unreadCount - e : e === -1 && this.unreadCount <= 0 && (this.unreadCount = 0) : this.unreadCount = 0,
            this.unreadMsgAnchor = void 0,
            this.markedUnread = !1
        },
        markUnread: function(e, t) {
            var n = this;
            if (e ? this.active && (this.markedUnread = !0) : this.markedUnread = !1,
            this.promises.markUnread)
                return this.promises.markUnread;
            this.promises.markUnread = e ? this.sendUnseen() : this.sendSeen();
            var r = new F(e ? l10n.t("action_chat_marking_unread") : l10n.t("action_chat_marking_read"));
            t = t || L.genId();
            var i = this.promises.markUnread.then(function(r) {
                if (200 === r.status) {
                    var i = e ? l10n.t("action_chat_marked_unread") : l10n.t("action_chat_marked_read");
                    return new F(i,l10n.t("action_undo"),n.markUnread.bind(n, !e, t))
                }
                if (r.status >= 400)
                    return new F(e ? l10n.t("action_chat_mark_unread_failed") : l10n.t("action_chat_mark_read_failed"))
            })["catch"](function(r) {
                var i = e ? l10n.t("action_chat_mark_unread_failed") : l10n.t("action_chat_mark_read_failed");
                return new F(i,l10n.t("action_try_again"),n.markUnread.bind(n, e, t))
            });
            return w.openToast(d.createElement(L, {
                id: t,
                initialAction: r,
                pendingAction: i
            })),
            this.promises.markUnread["finally"](function() {
                n.promises.markUnread = null
            })
        },
        canMarkUnseen: function() {
            return T.supportsFeature(T.F.CHAT_MARK_UNSEEN)
        },
        sendUnseen: function() {
            var e = this
              , t = this.msgs.last()
              , n = t ? t.id : void 0;
            return x.sendConversationUnseen(this.id, n).then(function(t) {
                return 200 === t.status ? e.markUnseen() : e.markedUnread = !1,
                t
            })
        },
        markUnseen: function() {
            this.active && (this.markedUnread = !0),
            this.unreadCount = -1
        },
        markRecording: function() {
            if ((this.presence.isOnline || this.isGroup) && !this.recording) {
                var e = this.id;
                x.sendChatstateRecording(e).then(function(t) {
                    t.status >= 400 && h.error("models:chat send presence recording error " + e)()
                })["catch"](D.WapDrop, _.noop),
                this.presenceResendTimerId = _.delay(this._resendPresence.bind(this), p.PRESENCE_RESEND_WAIT)
            }
            this.pausedTimerId && (clearTimeout(this.pausedTimerId),
            this.unset("pausedTimerId")),
            this.recording = !0,
            this.typing = !1
        },
        markComposing: function() {
            if ((this.presence.isOnline || this.isGroup) && !this.typing) {
                var e = this.id;
                x.sendChatstateComposing(e).then(function(t) {
                    t.status >= 400 && h.error("models:chat send presence composing error " + e)()
                })["catch"](D.WapDrop, _.noop),
                this.presenceResendTimerId = _.delay(this._resendPresence.bind(this), p.PRESENCE_RESEND_WAIT)
            }
            this.typing = !0,
            this.pausedTimerId && clearTimeout(this.pausedTimerId),
            this.pausedTimerId = _.delay(this.markPaused.bind(this), p.SEND_PAUSED_WAIT)
        },
        markPaused: function() {
            if ((this.presence.isOnline || this.isGroup) && (this.typing || this.recording)) {
                var e = this.id;
                x.sendChatstatePaused(e).then(function(t) {
                    t.status >= 400 && h.error("models:chat send presence paused error " + e)()
                })["catch"](D.WapDrop, _.noop)
            }
            this.presenceResendTimerId && (clearTimeout(this.presenceResendTimerId),
            this.unset("presenceResendTimerId")),
            this.pausedTimerId && (clearTimeout(this.pausedTimerId),
            this.unset("pausedTimerId")),
            this.typing = this.recording = !1
        },
        _resendPresence: function() {
            var e = this.id;
            if (this.recording)
                x.sendChatstateRecording(e).then(function(t) {
                    t.status >= 400 && h.error("models:chat send presence resend recording error " + e)()
                })["catch"](D.WapDrop, _.noop);
            else {
                if (!this.typing)
                    return void this.unset("presenceResendTimerId");
                x.sendChatstateComposing(e).then(function(t) {
                    t.status >= 400 && h.error("models:chat send presence resend composing error " + e)()
                })["catch"](D.WapDrop, _.noop)
            }
            this.presenceResendTimerId = _.delay(this._resendPresence.bind(this), p.PRESENCE_RESEND_WAIT)
        },
        _messageSent: function() {
            this.presenceResendTimerId && (clearTimeout(this.presenceResendTimerId),
            this.unset("presenceResendTimerId")),
            this.pausedTimerId && (clearTimeout(this.pausedTimerId),
            this.unset("pausedTimerId")),
            this.typing = !1
        },
        _presenceOnlineChanged: function() {
            this.presence.isOnline ? this._resendPresence() : this.presenceResendTimerId && (clearTimeout(this.presenceResendTimerId),
            this.unset("presenceResendTimerId"))
        },
        handleGroupAction: function(e, t, n) {
            var r;
            switch (e) {
            case "subject":
                return void (this.contact.name = n.subject);
            case "add":
            case "promote":
            case "demote":
                var i = "promote" === e;
                return r = _.map(n.participants, function(e) {
                    return {
                        id: e,
                        isAdmin: i
                    }
                }),
                void this.groupMetadata.participants.add(r, {
                    merge: !0
                });
            case "remove":
                return r = this.groupMetadata.participants,
                void _.each(n.participants, function(e) {
                    r.remove(e)
                });
            case "modify":
                return;
            default:
                return
            }
        },
        preload: function() {
            1 === this.msgs.length && this.loadEarlierMsgs()
        },
        loadEarlierMsgs: function(e) {
            return e || (e = this.msgs),
            e.msgLoadState.noEarlierMsgs ? u["default"].resolve() : e.msgLoadState.isLoadingEarlierMsgs ? e.loadEarlierPromise : this._loadMsgs("before", e).then(function(t) {
                return _.isArray(t) && t.length < p.PAGE_SIZE && (e.msgLoadState.noEarlierMsgs = !0),
                t
            })
        },
        isMostRecentCMC: function(e) {
            return this.msgs === e
        },
        loadRecentMsgs: function(e) {
            return e || (e = this.msgs),
            this.isMostRecentCMC(e) ? u["default"].resolve() : e.msgLoadState.isLoadingRecentMsgs ? e.loadRecentPromise : this._loadMsgs("after", e)
        },
        _loadMsgs: function(e, t) {
            var n;
            n = "after" === e ? t.last() : t.head();
            var r = {};
            return n ? r = n.id.clone() : r.remote = this.id,
            r.count = p.PAGE_SIZE,
            r.direction = e,
            this._loadMsgsPromise(n, t, Store.Msg.findQuery(r), e)
        },
        _loadMsgsPromise: function(e, t, n, r) {
            "after" === r ? t.msgLoadState.isLoadingRecentMsgs = !0 : "before" === r ? t.msgLoadState.isLoadingEarlierMsgs = !0 : "around" === r && (t.msgLoadState.isLoadingAroundMsgs = !0);
            var i = this.regCancellablePromise(n)["finally"](function() {
                var n = e && e.msgChunk !== t;
                t.msgLoadState.contextLoaded = !0,
                n && (e.msgChunk.msgLoadState.contextLoaded = !0),
                "after" === r ? t.msgLoadState.isLoadingRecentMsgs = !1 : "before" === r ? t.msgLoadState.isLoadingEarlierMsgs = !1 : "around" === r && (t.msgLoadState.isLoadingAroundMsgs = !1)
            })["catch"](function(e) {
                return h.error("chat:loadMsgs:error " + e)(),
                404 === e ? u["default"].reject(new D.E404) : u["default"].reject(e)
            });
            return "after" === r ? t.loadRecentPromise = i : "before" === r ? t.loadEarlierPromise = i : "around" === r && (t.loadAroundPromise = i),
            i
        },
        getSearchContext: function(e, t) {
            var n = this
              , r = void 0
              , i = void 0;
            e instanceof g ? r = e : e instanceof O && (i = e);
            var o = r ? r.msgChunk : void 0
              , a = (0,
            c["default"])(p.PAGE_SIZE / 3 * 2);
            if (!o || !o.msgLoadState.contextLoaded) {
                o || (o = new b,
                this.msgChunks.push(o),
                r && o.add(r));
                var s = r ? r.id.clone() : i.clone();
                s.count = a;
                var l = function() {
                    if (r)
                        return r.msgChunk;
                    var e = Store.Msg.get(i);
                    return e && e.msgChunk ? e.msgChunk : o
                };
                this._loadMsgsPromise(r, o, Store.Msg.getContext(s, l), "around").then(function(e) {
                    var t = l();
                    t !== o && n.notifyMsgCollectionMerge(t, o, t);
                    var s = e[0]
                      , c = i ? Store.Msg.get(i) : r;
                    c && _.isArray(s) && s.length < a && (c.msgChunk.msgLoadState.noEarlierMsgs = !0,
                    c.msgChunk !== o && (o.msgLoadState.noEarlierMsgs = !0))
                })["catch"](function() {
                    t && (t.isQuotedMsgAvailable = !1)
                })
            }
            return {
                collection: o,
                msg: r,
                key: i,
                highlightMsg: !0
            }
        },
        sendStarMsgs: function(e, t, n) {
            var r = this;
            if (!e)
                return u["default"].reject(new D.ActionError);
            if (_.some(e, function(e) {
                return !e.id
            }))
                return u["default"].reject(new D.ActionError);
            if (this.promises.sendStarMsgs)
                return this.promises.sendStarMsgs;
            this.promises.sendStarMsgs = x.sendMessageStarred(this.id, _.map(e, function(e) {
                return e.id
            }), t);
            var i = _.size(e)
              , o = {
                count: i,
                _plural: i
            }
              , a = new F(t ? l10n.t("action_message_starring", o) : l10n.t("action_message_unstarring", o));
            n = n || L.genId();
            var s = this.promises.sendStarMsgs.then(function(i) {
                if (200 === i.status) {
                    var a = t ? l10n.t("action_message_starred", o) : l10n.t("action_message_unstarred", o);
                    return new F(a,l10n.t("action_undo"),r.sendStarMsgs.bind(r, e, !t, n))
                }
                if (i.status >= 400)
                    return new F(t ? l10n.t("action_message_star_failed", o) : l10n.t("action_message_unstar_failed", o))
            })["catch"](function(i) {
                h.error("models:chat:sendStarMsgs dropped")(i);
                var a = t ? l10n.t("action_message_star_failed", o) : l10n.t("action_message_unstar_failed", o);
                return new F(a,l10n.t("action_try_again"),r.sendStarMsgs.bind(r, e, t, n))
            });
            return w.openToast(d.createElement(L, {
                id: n,
                initialAction: a,
                pendingAction: s
            })),
            this.promises.sendStarMsgs.then(function(n) {
                200 === n.status && (_.forEach(e, function(e) {
                    e.set("star", t)
                }),
                t ? Store.StarredMsg.add(e) : Store.StarredMsg.remove(e))
            })["finally"](function() {
                r.promises.sendStarMsgs = null
            })
        },
        sendNotSpam: function(e, t) {
            var n = this;
            if (!T.supportsFeature(T.F.SPAM))
                return u["default"].resolve();
            if (this.notSpam)
                return u["default"].resolve();
            if (this.notSpam = !0,
            this.promises.sendNotSpam)
                return this.promises.sendNotSpam;
            if (this.promises.sendNotSpam = x.sendConversationNotSpam(this.id),
            e) {
                var r = new F(l10n.t("action_mark_as_not_spam"));
                t = t || L.genId();
                var i = this.promises.sendNotSpam.then(function(e) {
                    return 200 === e.status ? new F(l10n.t("action_marked_as_not_spam")) : e.status >= 400 ? new F(l10n.t("action_mark_as_not_spam_failed")) : void 0
                })["catch"](function(r) {
                    return h.error("models:chat:sendNotSpam dropped")(r),
                    new F(l10n.t("action_mark_as_not_spam_failed"),l10n.t("action_try_again"),n.sendNotSpam(e, t))
                });
                w.openToast(d.createElement(L, {
                    id: t,
                    initialAction: r,
                    pendingAction: i
                }))
            }
            return this.promises.sendNotSpam["finally"](function() {
                n.promises.sendNotSpam = null
            })
        },
        sendSpamReport: function(e) {
            var t = this;
            if (this.promises.sendSpamReport)
                return this.promises.sendSpamReport;
            this.promises.sendSpamReport = x.sendSpamReport(this.id);
            var n = new F(l10n.t("action_spam_report"));
            e = e || L.genId();
            var r = this.promises.sendSpamReport.then(function(e) {
                return 200 === e.status ? new F(l10n.t("action_spam_reported")) : e.status >= 400 ? new F(l10n.t("action_spam_report_failed")) : void 0
            })["catch"](function(n) {
                return h.error("models:chat:sendSpamReport dropped")(n),
                new F(l10n.t("action_spam_report_failed"),l10n.t("action_try_again"),t.sendSpamReport.bind(t, e))
            });
            return w.openToast(d.createElement(L, {
                id: e,
                initialAction: n,
                pendingAction: r
            })),
            this.promises.sendSpamReport["finally"](function() {
                t.promises.sendSpamReport = null
            })
        },
        sendDeleteMsgs: function(e, t) {
            var n = this;
            if (!e)
                return u["default"].reject(new D.ActionError);
            if (_.some(e, function(e) {
                return !e.id
            }))
                return u["default"].reject(new D.ActionError);
            if (this.promises.sendDeleteMsgs)
                return this.promises.sendDeleteMsgs;
            this.promises.sendDeleteMsgs = x.sendMessageDelete(this.id, _.map(e, function(e) {
                return e.id
            }), !0);
            var r = _.size(e)
              , i = {
                count: r,
                _plural: r
            }
              , o = new F(l10n.t("action_message_deleting", i));
            t = t || L.genId();
            var a = this.promises.sendDeleteMsgs.then(function(e) {
                return 200 === e.status ? new F(l10n.t("action_message_deleted", i)) : e.status >= 400 ? new F(l10n.t("action_message_delete_failed", i)) : void 0
            })["catch"](function(r) {
                return h.error("models:chat:sendDeleteMsgs dropped")(r),
                new F(l10n.t("action_message_delete_failed", i),l10n.t("action_try_again"),n.sendDeleteMsgs.bind(n, e, t))
            });
            return w.openToast(d.createElement(L, {
                id: t,
                initialAction: o,
                pendingAction: a
            })),
            this.promises.sendDeleteMsgs.then(function(t) {
                200 === t.status && _.forEach(e, function(e) {
                    e["delete"]()
                })
            })["finally"](function() {
                n.promises.sendDeleteMsgs = null
            })
        },
        removeMsg: function(e) {
            var t = e.msgChunk;
            if (t) {
                var n = t.indexOf(e);
                n < 0 || (h.log("models:Chat:removeMsg " + e.get("id"))(),
                t.remove(e),
                0 === t.length && (t === this.msgs ? (h.log("models:Chat:removeMsg 0 messages left, querying...")(),
                this.loadEarlierMsgs()) : this.removeMsgsCollection(t)))
            }
        },
        deleteMsgs: function(e, t) {
            var n = this;
            this.getAllCMCs().forEach(function(r) {
                r.filter(function(e) {
                    return !t || i(e, t)
                }).filter(function(t) {
                    return (e || !t.star) && !t.isPersistent
                }).forEach(function(e) {
                    e["delete"]()
                }),
                0 === r.length && r !== n.msgs && n.removeMsgsCollection(r)
            }),
            this.unreadCount = 0
        },
        deleteMsgsOlderThan: function(e, t, n) {
            var r = this.msgs
              , o = _.head(r.models);
            if (o && !(o.t >= e)) {
                if (o = _.last(r.models),
                o.t < e)
                    return void this.deleteMsgs(t, n);
                var a = function(r) {
                    return r && (n && !i(r, n) || r.star && !t || r.t >= e || r.isPersistent)
                };
                this.deleteMsgsPartial(a)
            }
        },
        deleteMsgsBeforeMsgInclusive: function(e, t) {
            if (e && this.msgs.get(e.id)) {
                var n = this.msgs.indexOf(e)
                  , r = function(e, r) {
                    return e.msgChunk === this.msgs && r > n || t && e.star || e.isPersistent
                };
                this.deleteMsgsPartial(r)
            }
        },
        deleteMsgsPartial: function(e) {
            var t = this
              , n = this.unreadCount
              , r = _.flatten(this.getAllCMCs().map(function(n) {
                return n.filter(function(n, r, i) {
                    return !e.apply(t, [n, r, i])
                })
            }));
            if (r.forEach(function(e) {
                e["delete"]()
            }),
            _.clone(this.msgChunks).forEach(function(e) {
                0 === e.length && t.removeMsgsCollection(e)
            }),
            this.msgs.length > 0) {
                var i = n > this.msgs.length ? this.msgs.length : n;
                this.unreadCount = i,
                this.msgs.msgLoadState.noEarlierMsgs = !0
            }
        },
        getFirstMsgWithStatus: function() {
            return _.find(this.msgs.models, function(e) {
                return !e.isNotification && (e.isSentByMe || e.type === g.TYPE.PTT)
            })
        },
        getFirstMsgFromMe: function() {
            return _.find(this.msgs.models, function(e) {
                return !e.isNotification && e.isSentByMe
            })
        },
        getLastReceivedMsg: function() {
            for (var e = this.msgs.length - 1; e >= 0; e--) {
                var t = this.msgs.at(e);
                if (t && (!t.local || t.ack > 0))
                    return t
            }
        },
        getLastTimestampMsg: function() {
            for (var e = this.msgs.length - 1; e >= 0; e--) {
                var t = this.msgs.at(e);
                if (t && "i" !== t.eventTypeFromMsgType())
                    return t
            }
        },
        createMessageFromText: function(e) {
            if (e = _.trim(e),
            "" === e)
                return null ;
            var t = this.id
              , n = Store.Conn.me
              , r = new O({
                from: n,
                to: t,
                id: g.newTag(),
                participant: void 0,
                selfDir: "out"
            })
              , i = {
                id: r,
                body: e,
                type: "chat",
                subtype: null ,
                t: P.globalUnixTime(),
                from: n,
                to: t,
                self: "out",
                local: !0,
                ack: 0
            };
            return new g(i)
        },
        sendMessage: function(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] ? {} : arguments[1]
              , n = arguments[2]
              , r = arguments[3];
            if (e = _.trim(e),
            "" === e)
                return u["default"].resolve();
            this._messageSent();
            var i = this.id
              , o = Store.Conn.me
              , a = new O({
                from: o,
                to: i,
                id: g.newTag(),
                participant: void 0,
                selfDir: "out"
            })
              , s = n && n.contextInfo()
              , c = _.defaults({
                id: a,
                body: e,
                type: "chat",
                subtype: t && !_.isEmpty(t) ? "url" : null ,
                t: P.globalUnixTime(),
                from: o,
                to: i,
                self: "out",
                local: !0,
                ack: 0
            }, t, s, {
                mentionedJidList: r
            })
              , l = new g(c)
              , d = Store.Msg.send(l);
            return this.msgs.add(l),
            d
        },
        generateMediaMsgProps: function(e) {
            return {
                t: P.globalUnixTime(),
                from: Store.Conn.me,
                isNewMsg: !0,
                to: this.id,
                self: "out",
                ack: 0,
                local: !0,
                mediaState: e.mediaState || g.MEDIA_STATE.UPLOADING,
                id: e.id || new O({
                    from: Store.Conn.me,
                    to: this.id,
                    id: g.newTag(),
                    participant: void 0,
                    selfDir: "out"
                }),
                body: e.getThumb ? e.getThumb.then(function(e) {
                    var t = e.url;
                    return A.parseDataURL(t).data
                }) : void 0,
                url: e.blob ? window.URL.createObjectURL(e.blob) : void 0,
                size: e.blob ? e.blob.size : void 0,
                filehash: e.getFilehash,
                decryptedMediaBlob: e.blob,
                duration: e.duration || (e.getDuration ? e.getDuration.then(function(e) {
                    return _.isFinite(e) ? e + "" : void 0
                }) : void 0),
                type: e.type || e.msgType,
                mimetype: e.mimetype,
                height: e.height,
                width: e.width,
                fullHeight: e.height,
                fullWidth: e.width,
                caption: e.caption,
                filename: e.filename,
                isGif: e.isGif,
                gifAttribution: e.gifAttribution,
                quotedMsg: e.quotedMsg,
                quotedParticipant: e.quotedParticipant,
                quotedStanzaID: e.quotedStanzaID
            }
        },
        sendPTT: function(e, t, n) {
            var r = this
              , i = this.id
              , o = n ? n.contextInfo() : null
              , a = {
                type: "ptt",
                duration: _.isFinite(t) ? t + "" : void 0,
                mediaState: g.MEDIA_STATE.PREPARING
            };
            _.defaults(a, o),
            a = this.generateMediaMsgProps(a);
            var s = Store.Msg.add(a);
            this.msgs.add(s),
            e.then(function(e) {
                return U.prepFileForUpload(e, {
                    precomputedDuration: t
                })
            }).then(function(e) {
                return e.uploadPromise2 = e.reupload(i),
                e.id = s.id,
                e.msgType = "ptt",
                u["default"].props(r.generateMediaMsgProps(e)).then(function(t) {
                    return s.handleUpload(u["default"].resolve(), e.uploadPromise2, e.reupload),
                    Store.Msg.add(t, {
                        merge: !0
                    }),
                    t
                })
            })["catch"](u["default"].CancellationError, _.noop)["catch"](function(e) {
                h.assert(!1, "media-props-failed", "Got Error " + e)(e)
            })["finally"](function(e) {
                e || (e = {
                    id: s.id,
                    ack: -1
                },
                Store.Msg.add(e, {
                    merge: !0
                }))
            })
        },
        sendMedia2: function(e, t) {
            var n = this;
            e = _.isArray(e) ? e : [e];
            var r = this.id
              , i = 0;
            u["default"].each(e, function(e) {
                e.uploadPromise2 = e.reupload(r)
            }).mapSeries(function(e) {
                var r = e.caption;
                "document" === e.msgType && (e.caption = r || e.filename),
                0 === i && t && _.defaults(e, t.contextInfo()),
                i += 1;
                var o = n.generateMediaMsgProps(e);
                return u["default"].props(o)["catch"](function(e) {
                    h.assert(!1, "media-props-failed", "Got Error " + e)(e)
                }).then(function(t) {
                    if (t) {
                        var r = void 0
                          , i = new u["default"](function(e) {
                            r = e
                        }
                        )
                          , o = e.reupload
                          , a = e.uploadPromise2
                          , s = Store.Msg.add(t)
                          , c = s.handleUpload(i, a, o);
                        return n.msgs.add(s),
                        function() {
                            return r(),
                            c
                        }
                    }
                })
            }).each(function(e) {
                if (e)
                    return e()
            })
        },
        sendContact: function(e) {
            var t = j.cleanValue(e.formattedName)
              , n = "BEGIN:VCARD\nVERSION:3.0\nN:" + j.getName(e) + "\nFN:" + t + "\nTEL;type=CELL;waid=" + e.userid + ":" + R.formattedUser(e.userid) + "\nEND:VCARD"
              , r = {
                ack: 0,
                body: n,
                from: Store.Conn.me,
                id: new O({
                    from: Store.Conn.me,
                    to: this.id,
                    id: g.newTag(),
                    participant: void 0,
                    selfDir: "out"
                }),
                local: !0,
                self: "out",
                subtype: e.formattedName,
                t: P.globalUnixTime(),
                to: this.id,
                type: "vcard"
            }
              , i = Store.Msg.add(r);
            return this.msgs.add(i),
            Store.Msg.send(i)
        },
        forwardMessages: function(e) {
            var t = this
              , n = this.id
              , r = this.contact;
            if (r.isUser && r.isBlocked())
                return u["default"].reject(new D.ContactBlocked("Forwarded to contact is blocked",r));
            var i = []
              , o = g.TYPE;
            return u["default"].mapSeries(e, function(e) {
                var r = e.type === o.PTT ? o.AUDIO : e.type
                  , a = _.omit(e.toJSON(), "quotedMsg")
                  , s = new O({
                    from: Store.Conn.me,
                    to: n,
                    id: g.newTag(),
                    participant: void 0,
                    selfDir: "out"
                });
                switch (_.assign(a, {
                    id: s,
                    from: Store.Conn.me,
                    t: P.globalUnixTime(),
                    to: n,
                    type: r,
                    ack: 0,
                    participant: void 0,
                    caption: r === o.DOCUMENT ? e.caption : void 0,
                    local: !0,
                    self: "out",
                    isNewMsg: !0,
                    star: !1,
                    decryptedMediaBlob: e.decryptedMediaBlob,
                    fullWidth: e.fullWidth,
                    fullHeight: e.fullHeight
                }),
                r) {
                case o.CHAT:
                case o.VCARD:
                case o.LOCATION:
                    var c = Store.Msg.add(a);
                    return t.msgs.add(c),
                    [c, null ];
                case o.DOCUMENT:
                case o.VIDEO:
                case o.IMAGE:
                case o.AUDIO:
                    if (e.mediaState === g.MEDIA_STATE.ERROR_MISSING)
                        return i.push(e),
                        null ;
                    a.mediaState = g.MEDIA_STATE.UPLOADING;
                    var l = void 0
                      , d = new u["default"](function(e) {
                        l = e
                    }
                    )
                      , p = Store.Msg.add(a);
                    t.msgs.add(p);
                    var f = U.forwardMediaMsg(p, e, d);
                    return [p, function() {
                        return l(),
                        f
                    }
                    ];
                default:
                    return h.assert(!1, "unrecognized-forward", "type = " + r)(),
                    null
                }
            }).each(function(e) {
                if (e) {
                    var t = (0,
                    a["default"])(e, 2)
                      , n = t[0]
                      , r = t[1];
                    return r ? r()["catch"](_.noop) : void Store.Msg.send(n)
                }
            })["return"](i)
        },
        shouldSendEncrypted: function(e, t) {
            return U.shouldSendEncrypted(this, e, t)
        },
        updateReadOnly: function() {
            this.isGroup && !this.groupMetadata.stale && (this.isReadOnly = !this.groupMetadata.participants.get(Store.Conn.me)),
            this.isBroadcast && this.updateTitle()
        },
        sortMsgs: function(e) {
            var t = _.map(e, function(e) {
                var t = e.msgChunk;
                return {
                    msg: e,
                    chunkT: t.models[0].t,
                    index: t.indexOf(e)
                }
            });
            return _(t).orderBy(["chunkT", "index"]).map("msg").value()
        },
        _updateAssignedColor: function() {
            if (this.colors) {
                var e = this.groupMetadata.participants;
                if (0 !== e.size) {
                    var t = this.colors
                      , n = _.difference(_.keys(t), e.map("id").map(I));
                    n.forEach(function(e) {
                        delete t[e]
                    }),
                    n.length && this._saveAssignedColors()
                }
            }
        },
        loadAssignedColors: function() {
            return this.listenTo(this.groupMetadata.participants, "remove reset ", this._updateAssignedColor),
            N.getGroupParticipantAssignedColor(this.id) || {}
        },
        saveAssignedColors: function() {
            var e = this.colors;
            e && N.setGroupParticipantAssignedColor(this.id, e)
        },
        assignedColor: function(e) {
            var t, n = this, r = this.colors || (this.colors = this.loadAssignedColors()), i = I(e);
            if (t = r[i])
                return t;
            var o = function() {
                var e = {};
                _.forEach(r, function(t, n) {
                    e[t] ? e[t].push(n) : e[t] = [n]
                });
                for (var o = Number.POSITIVE_INFINITY, a = 1; a < p.NUM_COLORS; a++) {
                    if (!e[a]) {
                        t = a;
                        break
                    }
                    e[a].length < o && (o = e[a].length,
                    t = a)
                }
                return r[i] = t,
                n._saveAssignedColors(),
                {
                    v: t
                }
            }();
            return "object" == typeof o ? o.v : void 0
        },
        setSubject: function() {
            var e = this
              , t = arguments.length <= 0 || void 0 === arguments[0] ? "" : arguments[0]
              , n = arguments[1];
            if (t = t.trim(),
            !t)
                return u["default"].reject(new D.ActionError);
            if (t === this.contact.name)
                return u["default"].reject(new D.ActionError);
            var r = x.changeSubject(this.id, t)
              , i = this.contact.name
              , o = new F(l10n.t("action_group_renaming"));
            n = n || L.genId();
            var a = r.then(function(r) {
                return 200 === r.status ? new F(l10n.t("action_group_renamed", {
                    subject: t
                }),l10n.t("action_undo"),e.setSubject.bind(e, i, n)) : r.status >= 400 ? new F(l10n.t("action_group_rename_failed")) : void 0
            })["catch"](function(r) {
                return h.error("models:chat:setSubject dropped")(r),
                new F(l10n.t("action_group_rename_failed"),l10n.t("action_try_again"),e.setSubject.bind(e, t, n))
            });
            return w.openToast(d.createElement(L, {
                id: n,
                initialAction: o,
                pendingAction: a
            })),
            r.then(function(n) {
                200 !== n.status || n._duplicate || (e.contact.name = t)
            })
        },
        unstarAll: function() {
            this.getAllMsgs().forEach(function(e) {
                e && (e.star = !1)
            }),
            Store.StarredMsg.remove(this.getAllMsgs())
        },
        replaceMsgsCollection: function(e) {
            h.info("model:Chat:replaceMsgsCollection:" + this.id)(),
            this.msgs.replace(e),
            this.notifyMsgCollectionMerge(e, this.msgs, this.msgs),
            this.msgChunks = _.without(this.msgChunks, e)
        },
        notifyMsgCollectionMerge: function(e, t, n) {
            this.trigger("change:cmc:merge", e, t, n)
        },
        removeMsgsCollection: function(e) {
            this.msgChunks = _.without(this.msgChunks, e)
        },
        getAllCMCs: function() {
            return this.msgChunks.concat([this.msgs])
        },
        getAllMsgs: function() {
            return _.flatten(this.getAllCMCs().map(function(e) {
                return e.models
            }))
        },
        getMediaMsgs: function(e) {
            if (!e)
                return this.mediaMsgs;
            var t = void 0;
            return this.mediaMsgs.contains(e) || e.msgChunk === this.msgs ? (t = this.mediaMsgs,
            t.hasMediaAfter = !1) : t = new S,
            t.contains(e) || (e.msgChunk ? t.add(e.msgChunk.filter(function(e) {
                return e.isMedia
            })) : t.add(e)),
            T.supportsFeature(T.F.MEDIA_GALLERY) && t.loadMoreAroundIfNeeded(e),
            t
        },
        fts: function(e) {
            var t = this
              , n = arguments.length <= 1 || void 0 === arguments[1] ? 1 : arguments[1]
              , r = arguments[2];
            if (1 === n) {
                var i = this.ftsCache[e];
                if (i)
                    return i;
                var o = Store.Msg.search(e, n, r, this.id);
                this.ftsCache[e] = o;
                var a = function() {
                    t.ftsCache[e] = null
                };
                return _.delay(a, B),
                o["catch"](a),
                o
            }
            return Store.Msg.search(e, n, r, this.id)
        },
        _clearFtsCache: function() {
            this.ftsCache = {}
        },
        _updatePSAName: function() {
            this.name = l10n.t("whatsapp_psa_contact_name")
        },
        updateSortTime: function() {
            var e = this;
            this.promises.updateSortTime || (this.promises.updateSortTime = u["default"].delay(0).cancellable().then(function() {
                var t = e.getLastTimestampMsg();
                return t ? (e.t = t.t,
                u["default"].resolve()) : e.msgs.msgLoadState.noEarlierMsgs ? (e.t = void 0,
                u["default"].resolve()) : e.pendingMsgs ? u["default"].resolve() : e.loadEarlierMsgs()
            }).then(function(t) {
                if (t) {
                    var n = e.getLastTimestampMsg();
                    e.t = n ? n.t : void 0
                }
            })["catch"](_.noop)["finally"](function() {
                e.promises.updateSortTime = void 0
            }),
            this.regCancellablePromise(this.promises.updateSortTime))
        }
    })
      , H = {};
    Y.linkPreview = function(e) {
        var t = H[e];
        return t ? t : t = H[e] = u["default"].props({
            url: e,
            data: x.queryLinkPreview(e)
        })
    }
    ,
    Y.KIND = G,
    e.exports = Y
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t, n, r, o, a) {
        if (r < n)
            return -1;
        var s, c = Math.round((n + r) / 2), l = e[c], u = l.offsetLeft - o;
        if (u >= t)
            s = a;
        else {
            if (u + l.clientWidth > t)
                return c;
            s = !a
        }
        return s ? i(e, t, n, c - 1, o, a) : i(e, t, c + 1, r, o, a)
    }
    function o(e, t) {
        for (var n = 0, r = e.childNodes, i = 0; i < r.length; i++) {
            var o = r[i];
            if (o === t)
                break;
            n += o.clientWidth
        }
        return n
    }
    var a = n(894)
      , s = r(a)
      , c = n(2)
      , l = r(c)
      , u = n(6)
      , d = n(37)
      , p = n(432)
      , h = n(53)
      , f = n(134)
      , m = n(81)
      , g = n(138)
      , v = n(9)
      , y = n(46)
      , E = n(43)
      , b = n(893)
      , S = n(101)
      , M = n(1117)
      , C = n(1282)
      , T = n(1042)
      , w = n(1115)
      , k = n(1056)
      , x = n(1057)
      , N = n(1060)
      , P = n(1061)
      , D = n(1116)
      , O = n(1058)
      , A = n(1285)
      , R = 4096
      , I = {
        SMALL: "small",
        LARGE: "large"
    }
      , L = u.createClass({
        displayName: "EmojiText",
        mixins: [m, f, g, b],
        statics: {
            EMOJI_SIZE: I
        },
        propTypes: {
            text: u.PropTypes.string,
            highlight: u.PropTypes.array,
            highlightBounary: u.PropTypes.bool,
            mention: u.PropTypes.object,
            emojiSize: u.PropTypes.oneOf(_.values(I)),
            element: u.PropTypes.string,
            classes: u.PropTypes.string,
            direction: u.PropTypes.string,
            linkify: u.PropTypes.bool,
            titlify: u.PropTypes.bool,
            ellipsify: u.PropTypes.bool,
            selectable: u.PropTypes.bool,
            format: u.PropTypes.bool,
            wbr: u.PropTypes.number,
            dirMismatch: u.PropTypes.bool
        },
        getInitialState: function() {
            var e = this.props
              , t = e.ellipsify
              , n = e.format
              , r = e.text;
            if (t && n)
                throw new Error("ellipsify && format are not supported together");
            return this.debouncedRecompute = this.safeDebounce(this.recompute, 20),
            this.reged = !1,
            {
                ellipsified: null ,
                text: p.removeFEOF(r)
            }
        },
        getDefaultProps: function() {
            return {
                emojiSize: I.SMALL,
                element: "span"
            }
        },
        componentWillMount: function() {
            h.isWebkit && this.props.ellipsify && this.containsEmoji() && this.regResizeListener()
        },
        componentWillReceiveProps: function(e) {
            var t = p.removeFEOF(e.text);
            if (h.isWebkit && this.props.ellipsify && t !== this.state.text) {
                var n = (t || "").substring(0, R);
                p.containsEmoji(n) ? (this.recompute(),
                this.regResizeListener()) : (this.setState({
                    ellipsified: null
                }),
                this.unregResizeListener())
            }
            this.setState({
                text: t
            })
        },
        containsEmoji: function() {
            var e = (this.state.text || "").substring(0, R);
            return p.containsEmoji(e)
        },
        regResizeListener: function() {
            this.reged || (this.regNativeListener(window, "resize", this.debouncedRecompute),
            this.regCmd("resize", this.debouncedRecompute),
            this.reged = !0)
        },
        unregResizeListener: function() {
            this.reged && (this.unregNativeListener(window, "resize", this.debouncedRecompute),
            this.unregCmd("resize", this.debouncedRecompute),
            this.reged = !1)
        },
        recompute: function() {
            this.setState({
                ellipsified: null
            }, this.ellipsify)
        },
        ellipsifyCheck: function() {
            this.isMounted() && this.containsEmoji() && this.ellipsify()
        },
        componentDidMount: function() {
            h.isWebkit && this.props.ellipsify && (v.uiBusy ? y.waitForBBEvent(v, "ui_idle").then(this.ellipsifyCheck)["catch"](l["default"].CancellationError, _.noop) : this.ellipsifyCheck())
        },
        ellipsify: function() {
            var e = d.findDOMNode(this);
            if (e) {
                var t = e.querySelectorAll("img");
                if (0 !== t.length) {
                    var n, r = !l10n.isRTL(), a = 0;
                    if (n = e.clientWidth) {
                        if (n === e.scrollWidth)
                            return;
                        a = 0
                    } else {
                        var s = e.parentNode;
                        if (a = o(s, e),
                        n = s.clientWidth - a,
                        s.clientWidth === s.scrollWidth)
                            return
                    }
                    var c = i(t, r ? n : 0, 0, t.length - 1, r ? a : 0, r);
                    if (!(c < 0)) {
                        var l = t[c]
                          , u = 10;
                        u -= Math.floor(u / 4);
                        var p = i(t, r ? n - u : u, 0, c, r ? a : 0, r);
                        p > -1 && (l = t[p]);
                        for (var h = e.childNodes, f = [], m = 0; m < h.length; m++) {
                            var g = h[m];
                            if (g === l)
                                break;
                            3 === g.nodeType ? f.push(g.textContent || "") : f.push(g.alt || "")
                        }
                        if (f.length) {
                            var v = f.length - 1;
                            f[v] = f[v].trimRight()
                        }
                        this.setState({
                            ellipsified: f.join("")
                        })
                    }
                }
            }
        },
        render: function() {
            if (!this.state.text)
                return null ;
            var e = this.state.ellipsified;
            e || (e = this.props.ellipsify ? (this.state.text || "").substring(0, R) : this.state.text);
            var t = this.props.selectable ? "selectable-text" : void 0
              , n = new s["default"];
            n.set("default", {
                className: t
            }),
            n.set(w, {
                size: this.props.emojiSize
            });
            var r = []
              , i = S.supportsFeature(S.F.RICH_TEXT) && this.props.format;
            i && r.push(new T),
            this.props.linkify && r.push(new x),
            i && (r.push(new P),
            r.push(new k),
            r.push(new N)),
            this.props.wbr && r.push(new C(this.props.wbr)),
            r.push(new w);
            var o = this.props.highlight;
            o && o.length > 0 && r.push(new D(o,this.props.highlightBounary)),
            this.props.mention && r.push(new O(this.props.mention));
            var a = M.parse(e, r)
              , c = M.serialize(a, new A(n))
              , l = E(this.props.classes, {
                emojitext: !this.props.classes,
                ellipsify: this.props.ellipsify,
                "inverse-text-direction": this.props.dirMismatch,
                "selectable-text": this.props.selectable
            })
              , d = {
                className: l,
                dir: this.props.direction
            };
            this.props.titlify && (d.title = this.state.text);
            var p = this.props.element;
            return u.createElement(p, d, c, this.props.ellipsified ? "" : null )
        }
    });
    e.exports = L
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e) {
        if (e.dataTransfer) {
            try {
                if (!e.dataTransfer.dropEffect)
                    return
            } catch (e) {
                return
            }
            e.dataTransfer.effectAllowed && (e.nativeEvent.dataTransfer.dropEffect = "copy")
        }
    }
    var o = n(891)
      , a = r(o)
      , s = n(6)
      , c = n(43)
      , l = {
        LEFT: "left",
        MID: "mid",
        RIGHT: "right"
    }
      , u = s.createClass({
        displayName: "Drawer",
        propTypes: {
            children: s.PropTypes.node.isRequired,
            id: s.PropTypes.string,
            variant: s.PropTypes.string,
            noContainer: s.PropTypes.bool,
            position: s.PropTypes.oneOf(_.values(l)),
            onDragLeave: s.PropTypes.func,
            onDrop: s.PropTypes.func,
            onDragOver: s.PropTypes.func
        },
        getDefaultProps: function() {
            return {
                position: "left"
            }
        },
        statics: {
            RIGHT: "right",
            LEFT: "left",
            MID: "mid"
        },
        getInitialState: function() {
            return {
                isDragging: !1
            }
        },
        isDragDropDrawer: function() {
            return this.props.onDragOver && this.props.onDragLeave && this.props.onDrop
        },
        onDragOver: function(e) {
            e.preventDefault(),
            this.isDragDropDrawer() && (i(e),
            this.state.isDragging || (this.props.onDragOver(e),
            this.setState({
                isDragging: !0
            })))
        },
        onDrop: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            this.setState({
                isDragging: !1
            }),
            this.props.onDrop(e)
        },
        onDragLeave: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            this.state.isDragging && (this.setState({
                isDragging: !1
            }),
            this.props.onDragLeave(e))
        },
        render: function() {
            var e, t = this.props, n = c(this.props.className, "drawer", (0,
            a["default"])({}, "drawer-" + t.id, !!t.id));
            if (this.isDragDropDrawer()) {
                var r = this.state.isDragging ? {} : {
                    display: "none"
                };
                e = s.createElement("div", {
                    key: "mask",
                    className: "drag-drop-mask",
                    style: r,
                    onDragLeave: this.onDragLeave,
                    onDrop: this.onDrop
                })
            }
            return s.createElement("div", {
                className: n,
                onDragOver: this.onDragOver
            }, e, t.children)
        }
    });
    u.Position = l,
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(892)
      , s = r(a)
      , c = n(6)
      , l = n(43)
      , u = c.createClass({
        displayName: "DrawerBody",
        propTypes: {
            classes: c.PropTypes.string,
            info: c.PropTypes.bool,
            wide: c.PropTypes.bool
        },
        getDefaultProps: function() {
            return {
                info: !1,
                wide: !1
            }
        },
        render: function() {
            var e = this.props
              , t = e.classes
              , n = e.info
              , r = e.wide
              , i = (0,
            s["default"])(e, ["classes", "info", "wide"])
              , a = l("drawer-body", t, {
                "drawer-body-info": n,
                "drawer-body-wide": r
            });
            return c.createElement("div", (0,
            o["default"])({
                className: a
            }, i), this.props.children)
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(14)
      , s = {
        rejectOnUnmount: function() {
            var e = this;
            return this._reject ? this._reject : (this._reject = new o["default"](function(t, n) {
                e._rejectFn = n
            }
            ),
            this._reject["catch"](_.noop),
            this._isMounted === !1 && this._rejectFn(new a.Unmount),
            this._reject)
        },
        componentWillUnmount: function() {
            this._isMounted = !1,
            this._rejectFn && this._rejectFn(new a.Unmount)
        }
    };
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(434)
      , o = n(43)
      , a = n(1029)
      , s = a.MenuBar
      , c = n(102)
      , l = {
        SMALL: "small",
        LARGE: "large",
        POPUP: "popup",
        OFFSET: "offset"
    }
      , u = r.createClass({
        displayName: "DrawerHeader",
        propTypes: {
            children: r.PropTypes.node,
            title: r.PropTypes.string,
            onBack: r.PropTypes.func,
            onCancel: r.PropTypes.func,
            a8n: r.PropTypes.string,
            type: r.PropTypes.oneOf(_.values(l)).isRequired,
            menu: r.PropTypes.element
        },
        render: function() {
            var e = this.props
              , t = e.title
              , n = e.onBack
              , a = e.onCancel
              , u = e.type
              , d = e.children
              , p = null ;
            if (t) {
                var h = void 0
                  , f = null
                  , m = {
                    textAlign: "initial"
                };
                u === l.SMALL ? (h = {
                    fontWeight: 400,
                    fontSize: 16,
                    lineHeight: "21px"
                },
                m.width = 54) : u === l.LARGE ? (h = {
                    fontWeight: 500,
                    fontSize: 19,
                    lineHeight: "normal"
                },
                f = {
                    backgroundColor: "transparent",
                    padding: "0px"
                },
                m.width = 54) : (h = {
                    fontWeight: 500,
                    fontSize: 19,
                    lineHeight: "19px"
                },
                m.width = 48,
                m.opacity = .7);
                var g = o("icon btn-close-drawer", {
                    "icon-back": u === l.SMALL,
                    "icon-back-light": u !== l.SMALL
                })
                  , v = n ? r.createElement("span", {
                    className: g,
                    "data-a8n": i.key("btn-closer-drawer"),
                    onClick: n
                }) : null
                  , y = o("icon btn-close-drawer", {
                    "icon-x": u === l.SMALL,
                    "icon-x-light": u !== l.SMALL
                })
                  , _ = a ? r.createElement("span", {
                    className: y,
                    "data-a8n": i.key("btn-closer-drawer"),
                    onClick: a
                }) : null
                  , E = o({
                    "pane-header": u === l.LARGE
                }, "drawer-title")
                  , b = this.props.menu ? r.createElement("span", {
                    className: "pane-list-controls"
                }, r.createElement(s, {
                    key: "drawer-header"
                }, r.createElement(c, {
                    transitionName: "btn"
                }, this.props.menu))) : null ;
                p = r.createElement("div", {
                    className: E,
                    style: f
                }, r.createElement("div", {
                    style: m,
                    className: "drawer-title-action"
                }, v, _), r.createElement("span", {
                    "data-a8n": i.key(this.props.a8n),
                    className: "drawer-title-body",
                    style: h
                }, t), b)
            }
            var S = o({
                "drawer-header": u === l.LARGE,
                "drawer-header-small": u === l.SMALL,
                "drawer-header-offset": u === l.OFFSET,
                "drawer-header-popup": u === l.POPUP
            });
            return r.createElement("header", {
                className: S
            }, p, d)
        }
    });
    u.Type = l,
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(43)
      , i = n(6)
      , o = n(1006)
      , a = n(987)
      , s = n(136)
      , c = n(23)
      , l = n(14)
      , u = n(1005)
      , d = {
        SMALL: "small",
        MEDIUM: "medium",
        LARGE: "large",
        AUTO: "auto",
        NONE: "none"
    }
      , p = {
        LOW: "low",
        HIGH: "high"
    }
      , h = i.createClass({
        displayName: "DetailImage",
        mixins: [a],
        propTypes: {
            id: i.PropTypes.string.isRequired,
            size: i.PropTypes.oneOfType([i.PropTypes.number, i.PropTypes.oneOf(_.values(d))]),
            className: i.PropTypes.string,
            loader: i.PropTypes.bool,
            quality: i.PropTypes.oneOf(_.values(p)),
            onClick: i.PropTypes.func,
            onLoad: i.PropTypes.func
        },
        getDefaultProps: function() {
            return {
                size: d.SMALL,
                quality: p.LOW
            }
        },
        getInitialState: function() {
            var e = this.props
              , t = e.id
              , n = e.quality
              , r = !0
              , i = Store.ProfilePicThumb.get(t);
            if (c.isBroadcast(this.props.id))
                return {
                    loading: !1
                };
            if (n === p.HIGH) {
                var o = i && i.imgFull;
                return o && u.isCached(o) && (r = !1,
                this.props.onLoad && this.props.onLoad()),
                {
                    loading: r,
                    imgFull: this.async("id.ProfilePicThumb.imgFull")
                }
            }
            if (n === p.LOW) {
                var a = i && i.img;
                return a && u.isCached(a) && (r = !1,
                this.props.onLoad && this.props.onLoad()),
                {
                    loading: r,
                    img: this.async("id.ProfilePicThumb.img")
                }
            }
        },
        onLoad: function(e) {
            this.state.loading && this.setState({
                loading: !1
            }),
            this.props.onLoad && this.props.onLoad()
        },
        onError: function(e) {
            if (e instanceof l.ServerStatusError) {
                var t = Store.ProfilePicThumb.get(this.props.id);
                t && t.onError(e.status)
            }
            this.state.loading && this.setState({
                loading: !1
            })
        },
        getClasses: function() {
            var e = this.props
              , t = e.id
              , n = e.className;
            return r("avatar", n, {
                "icon-user-default": c.isUser(t),
                "icon-group-default": c.isGroup(t),
                "icon-broadcast-default": c.isBroadcast(t),
                "icon-psa-default": c.isPSA(t)
            })
        },
        getStyle: function() {
            var e = void 0;
            switch (this.props.size) {
            case d.SMALL:
                e = 49;
                break;
            case d.MEDIUM:
                e = 100;
                break;
            case d.LARGE:
                e = 200;
                break;
            case d.NONE:
                e = void 0;
                break;
            default:
                e = this.props.size
            }
            var t = {
                height: e,
                width: e
            };
            return this.props.onClick && (t.cursor = "pointer"),
            t
        },
        render: function() {
            var e = this.state.img || this.state.imgFull
              , t = Store.ProfilePicThumb.get(this.props.id)
              , n = void 0;
            this.props.loader && this.state.loading && (!t || t.stale || e) && (n = i.createElement("div", {
                className: "avatar-spinner-container"
            }, i.createElement(s, {
                size: 50,
                stroke: 3
            })));
            var a = r("avatar-image", {
                "is-loaded": !this.state.loading
            });
            return e = e ? i.createElement(o, {
                src: e,
                hasPrivacyChecks: !0,
                crossOrigin: !1,
                className: a,
                onLoad: this.onLoad,
                onError: this.onError
            }) : null ,
            i.createElement("div", {
                className: this.getClasses(),
                style: this.getStyle(),
                onClick: this.props.onClick
            }, i.createElement("div", {
                className: "avatar-body"
            }, e, n))
        }
    });
    h.Size = d,
    h.Quality = p,
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(135)
      , a = o.HotKeys
      , s = n(434)
      , c = n(134)
      , l = n(43)
      , u = n(67)
      , d = r.createClass({
        displayName: "MenuItem",
        mixins: [c],
        propTypes: {
            children: r.PropTypes.node.isRequired,
            a8n: r.PropTypes.string.isRequired,
            action: r.PropTypes.func,
            tooltip: r.PropTypes.node,
            filePickerMimes: r.PropTypes.string,
            onFilePick: r.PropTypes.func
        },
        getInitialState: function() {
            return {
                hover: !1,
                focus: !1
            }
        },
        componentWillMount: function() {
            this.props.filePickerMimes && this.regNativeListener(window, "focus", this.onWindowFocus)
        },
        onMouseEnter: function() {
            this.setState({
                hover: !0
            })
        },
        onMouseLeave: function() {
            this.setState({
                hover: !1
            })
        },
        onFocus: function() {
            this.setState({
                focus: !0
            })
        },
        onBlur: function() {
            this.setState({
                focus: !1
            })
        },
        preventDefault: function(e) {
            e.preventDefault()
        },
        onAction: function(e) {
            if (e.isTrusted) {
                var t = this.props
                  , n = t.action
                  , r = t.filePickerMimes;
                if (n) {
                    if (n(e),
                    r)
                        return void (this.active = !0);
                    var i = this.context.uim;
                    i && i.uie.requestDismiss()
                }
            }
        },
        triggerInput: function() {
            i.findDOMNode(this.refs.filePicker).click()
        },
        onWindowFocus: function(e) {
            this.active && this.onFilePick()
        },
        onFilePick: function(e) {
            if (this.props.onFilePick) {
                this.props.onFilePick(e);
                var t = this.context.uim;
                t && t.uie.requestDismiss()
            }
        },
        render: function() {
            var e = this.props
              , t = e.children
              , n = e.tooltip
              , i = e.filePickerMimes
              , o = this.state
              , c = o.hover
              , u = o.focus;
            n = (c || u) && n ? n : null ;
            var d = {
                enter: this.onAction
            }
              , h = l("menu-item menu-shortcut", {
                "highlighted-menu-item": c || u
            })
              , f = void 0;
            return i && (f = r.createElement(p, {
                mime: i,
                ref: "filePicker",
                onPick: this.onFilePick
            })),
            _.isString(t) && (t = r.createElement("a", {
                className: "ellipsify",
                title: t
            }, t)),
            r.createElement(a, {
                component: "li",
                className: h,
                handlers: d,
                "data-a8n": s.key(this.props.a8n),
                onContextMenu: this.preventDefault,
                onMouseDown: this.preventDefault,
                onClick: this.onAction,
                onMouseEnter: this.onMouseEnter,
                onMouseLeave: this.onMouseLeave,
                onFocus: this.onFocus,
                onBlur: this.onBlur
            }, t, n, f)
        }
    });
    d.contextTypes = {
        uim: r.PropTypes.instanceOf(u)
    };
    var p = r.createClass({
        displayName: "FilePicker",
        propTypes: {
            mime: r.PropTypes.string.isRequired,
            multiple: r.PropTypes.bool,
            onPick: r.PropTypes.func.isRequired
        },
        getDefaultProps: function() {
            return {
                multiple: !0
            }
        },
        render: function() {
            return r.createElement("input", {
                accept: this.props.mime,
                type: "file",
                multiple: this.props.multiple,
                style: {
                    display: "none"
                },
                onChange: this.props.onPick
            })
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(892)
      , s = r(a)
      , c = n(6)
      , l = n(136)
      , u = n(43)
      , d = n(989)
      , p = function(e) {
        var t = e.className
          , n = u("empty-icon", t);
        return c.createElement("div", {
            className: "empty-icon-container"
        }, c.createElement("span", {
            className: n
        }))
    }
      , h = function(e) {
        var t = e.icon
          , n = e.title
          , r = e.text
          , i = e.className
          , a = e.children
          , l = (0,
        s["default"])(e, ["icon", "title", "text", "className", "children"])
          , p = n ? c.createElement("div", {
            className: "empty-title"
        }, n) : null
          , h = r ? c.createElement(d, {
            element: "div",
            classes: "empty-text",
            text: r
        }) : null
          , f = u("empty", i);
        return c.createElement("div", (0,
        o["default"])({
            className: f
        }, l), t, p, h, a)
    }
      , f = function() {
        var e = c.createElement(p, {
            className: "icon-empty-blocked"
        });
        return c.createElement(h, {
            icon: e,
            title: l10n.t("blocked_empty"),
            text: l10n.t("add_blocked_description")
        })
    }
      , m = function() {
        var e = c.createElement(p, {
            className: "icon-empty-archived"
        });
        return c.createElement(h, {
            icon: e,
            title: l10n.t("archived_empty")
        })
    }
      , g = function() {
        return c.createElement(h, {
            className: "empty-top",
            text: l10n.t("search_no_chats_or_contacts")
        })
    }
      , v = function() {
        return c.createElement(h, {
            className: "empty-top",
            text: l10n.t("searching_chats_contacts_messages")
        })
    }
      , y = function() {
        return c.createElement(h, {
            className: "empty-top",
            text: l10n.t("searching_messages")
        })
    }
      , _ = function() {
        return c.createElement(h, {
            className: "empty-top",
            text: l10n.t("search_no_contacts")
        })
    }
      , E = function() {
        return c.createElement(h, {
            className: "empty-top",
            text: l10n.t("search_no_groups")
        })
    }
      , b = function() {
        return c.createElement(h, {
            className: "empty-top",
            text: l10n.t("search_no_messages")
        })
    }
      , S = function() {
        return c.createElement(h, {
            text: l10n.t("no_chats")
        })
    }
      , M = function() {
        return c.createElement(h, {
            text: l10n.t("no_contacts")
        })
    }
      , C = function() {
        return c.createElement(h, {
            text: l10n.t("no_groups")
        })
    }
      , T = function(e) {
        return c.createElement(h, {
            className: "empty-top",
            text: l10n.t("chat_search_prompt", {
                chatName: e
            })
        })
    }
      , w = function() {
        return c.createElement(h, {
            text: l10n.t("all_chats_archived")
        })
    }
      , k = function() {
        return c.createElement(h, {
            text: l10n.t("no_starred_messages")
        })
    }
      , x = function() {
        return c.createElement(h, {
            text: l10n.t("no_media")
        })
    }
      , N = function() {
        return c.createElement(h, {
            text: l10n.t("no_links")
        })
    }
      , P = function() {
        return c.createElement(h, {
            text: l10n.t("no_docs")
        })
    }
      , D = function() {
        return c.createElement(h, null , c.createElement(l, {
            size: 50,
            stroke: 4
        }))
    };
    e.exports = {
        Blocked: f,
        Archived: m,
        Search: g,
        SearchContacts: _,
        SearchGroups: E,
        SearchMessages: b,
        ListChats: S,
        ListContacts: M,
        ListGroups: C,
        AllArchived: w,
        StarredMsgs: k,
        MediaMsgs: x,
        LinkMsgs: N,
        DocMsgs: P,
        Loading: D,
        Searching: v,
        SearchingMessages: y,
        BeforeSearchMessages: T
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = n(37)
      , g = n(43)
      , v = n(9)
      , y = n(31)
      , _ = n(1022)
      , E = n(1147)
      , b = 72
      , S = "data-list-scroll-container"
      , M = "data-list-scroll-offset"
      , C = function(e) {
        function t() {
            (0,
            s["default"])(this, t);
            var e = (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments));
            return e.scrollTop = 0,
            e.offsetTop = 0,
            e.bodyHeight = 0,
            e.pointerEvents = !0,
            e.enablePointerEvents = y.debounce(function() {
                v.setUiBusy(!1),
                e.pointerEvents = !1,
                m.findDOMNode(e.refs.viewport).style.pointerEvents = "auto",
                e.props.onPointerEventsOn && e.props.onPointerEventsOn()
            }, 150),
            e.onScroll = function(t) {
                e.animationFrame || (e.animationFrame = window.requestAnimationFrame(e._onScroll))
            }
            ,
            e._onScroll = function() {
                var t = e.state.scrollTarget;
                e.disablePointerEvents(),
                t && (e.scrollTop = t.scrollTop);
                var n = e.getPhysicalIndexes(e.props)
                  , r = n.firstPhysicalIndex
                  , i = n.lastPhysicalIndex
                  , o = void 0;
                for (o = r; o < i; o++) {
                    var a = e.props.data[o].id;
                    if (!e.renderedItems[a])
                        break
                }
                return o === i ? e.animationFrame = void 0 : void e.setState({
                    firstPhysicalIndex: r,
                    lastPhysicalIndex: i,
                    renderVisible: !1
                }, function() {
                    e.animationFrame = void 0
                })
            }
            ,
            e.state = {
                scrollTarget: void 0,
                firstVisibleIndex: 0,
                firstPhysicalIndex: 0,
                lastPhysicalIndex: 0,
                renderVisible: !0
            },
            e
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "componentWillReceiveProps",
            value: function(e) {
                y.isNumber(e.scrollTop) && this.state.scrollTarget && (this.state.scrollTarget.scrollTop = e.scrollTop),
                this.props.scrollTarget === e.scrollTarget && this.props.height === e.height && this.props.data.length === e.data.length || this.initialize(e)
            }
        }, {
            key: "componentDidMount",
            value: function() {
                var e = this;
                this.props.addListenerAndRun(window, "resize", function() {
                    return e.initialize()
                })
            }
        }, {
            key: "componentWillUnmount",
            value: function() {
                this.animationFrame && window.cancelAnimationFrame(this.animationFrame),
                this.enablePointerEvents.cancel()
            }
        }, {
            key: "initialize",
            value: function(e) {
                var t = e ? e : this.props;
                this.state.scrollTarget && this.props.removeListener(this.state.scrollTarget, "scroll", this.onScroll);
                for (var n = m.findDOMNode(this), r = void 0, i = n, o = 0; o < 5; o++) {
                    if (i.hasAttribute(S)) {
                        r = i;
                        break
                    }
                    i = i.parentNode
                }
                var a = void 0;
                i = n;
                for (var s = 0; s < o; s++) {
                    if (i.hasAttribute(M)) {
                        a = i;
                        break
                    }
                    i = i.parentNode
                }
                if (!r)
                    throw new Error("list scroll container not found");
                this.props.addListener(r, "scroll", this.onScroll),
                this.scrollTop = r.scrollTop,
                this.offsetTop = a ? a.offsetTop : 0,
                this.bodyHeight = r.clientHeight;
                var c = this.getPhysicalIndexes(t)
                  , l = c.firstPhysicalIndex
                  , u = c.lastPhysicalIndex;
                return this.setState({
                    scrollTarget: r,
                    firstPhysicalIndex: l,
                    lastPhysicalIndex: u,
                    renderVisible: !0
                }),
                this.renderedItems = {},
                r
            }
        }, {
            key: "getFirstVisibleIndex",
            value: function(e) {
                return Math.floor(Math.max(this.scrollTop - this.offsetTop, 0) / e)
            }
        }, {
            key: "getPhysicalIndexes",
            value: function(e) {
                var t = this.getFirstVisibleIndex(e.height)
                  , n = Math.max(this.offsetTop - this.scrollTop, 0)
                  , r = Math.max(this.bodyHeight - n, 0)
                  , i = Math.min(Math.ceil(r / e.height), e.data.length)
                  , o = Math.max(t - e.extraItems, 0)
                  , a = Math.min(t + i + e.extraItems, e.data.length);
                return {
                    firstPhysicalIndex: o,
                    lastPhysicalIndex: a
                }
            }
        }, {
            key: "disablePointerEvents",
            value: function() {
                this.enablePointerEvents(),
                this.pointerEvents || (this.props.onPointerEventsOff && this.props.onPointerEventsOff(),
                m.findDOMNode(this.refs.viewport).style.pointerEvents = "none",
                v.setUiBusy(!0),
                this.pointerEvents = !0)
            }
        }, {
            key: "getComponents",
            value: function() {
                var e = this
                  , t = this.props
                  , n = t.height
                  , r = t.data
                  , i = this.state
                  , o = i.firstPhysicalIndex
                  , a = i.lastPhysicalIndex
                  , s = {}
                  , c = y.chain(r).forEach(function(e, t) {
                    s[e.key] = t
                }).slice(o, a).forEach(function(t) {
                    e.renderedItems[t.key] = t
                }).value()
                  , l = this.state.renderVisible ? c : this.renderedItems;
                return y.sortBy(l, "key").map(function(e) {
                    return f.createElement(E, {
                        key: e.key,
                        rowHeight: n,
                        className: 0 === s[e.key] ? "first" : void 0,
                        zIndex: r.length - s[e.key] - 1,
                        rowNumber: s[e.key]
                    }, e)
                })
            }
        }, {
            key: "render",
            value: function() {
                var e = this.props
                  , t = e.data
                  , n = e.height
                  , r = e.className
                  , i = e.animate
                  , o = {
                    container: {},
                    viewport: {
                        height: t.length * n
                    }
                }
                  , a = {
                    container: g("infinite-list", r, {
                        "infinite-list-animate": i && !this.animationFrame
                    }),
                    viewport: "infinite-list-viewport"
                };
                return f.createElement("div", {
                    className: a.container,
                    style: o.container
                }, f.createElement("div", {
                    className: a.viewport,
                    ref: "viewport",
                    style: o.viewport
                }, this.getComponents()))
            }
        }]),
        t
    }(f.Component);
    C.defaultProps = {
        scrollTarget: null ,
        data: null ,
        height: b,
        extraItems: 30
    },
    C.DEFAULT_HEIGHT = b,
    C.SCROLL_ATTR = S,
    C.SCROLL_OFFSET_ATTR = M,
    e.exports = _(C)
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        var t, n, r = "";
        switch (e.subtype) {
        case "identity":
            t = Store.Contact.get(e.body),
            n = t ? t.formattedName : f.formattedUser(e.body),
            r = l10n.t("web_security_code_change", {
                name: n
            });
            break;
        case "encrypt":
            var i = e.id.remote;
            r = f.isGroup(i) ? l10n.t("web_group_info_encrypted") : f.isBroadcast(i) ? l10n.t("web_broadcast_info_encrypted") : l10n.t("web_contact_info_encrypted")
        }
        return r
    }
    function i(e, t) {
        var n = "";
        switch (e.subtype) {
        case "miss":
            n = t ? l10n.t("web_missed_voice_call_system_message", {
                time: h.timestampStr(e.t)
            }) : l10n.t("web_missed_voice_call_chatlist");
            break;
        case "miss_video":
            n = t ? l10n.t("web_missed_video_call_system_message", {
                time: h.timestampStr(e.t)
            }) : l10n.t("web_missed_video_call_chatlist")
        }
        return n
    }
    function o(e, t) {
        var n, r, i = "";
        if ("create" === e) {
            var o = parseInt(t, 10);
            i = l10n.t("web_you_created_list_unnamed", {
                count: o,
                _plural: o
            })
        } else
            "add" === e ? (n = Store.Contact.get(t),
            r = n ? n.get("name") : "",
            r = r ? r : f.formattedUser(t),
            i = l10n.t("web_list_recipient_added", {
                name: r
            })) : "remove" === e && (n = Store.Contact.get(t),
            r = n ? n.get("name") : "",
            r = r ? r : f.formattedUser(t),
            i = l10n.t("web_list_recipient_removed", {
                name: r
            }));
        return i
    }
    function a(e) {
        var t, n, r = "", i = e.get("type"), o = e.get("subtype"), a = e.displayName(), s = e.get("author"), c = e.get("body");
        if ("group_notification" === i)
            switch (o) {
            case "add":
                r = s === Store.Conn.me ? l10n.t("web_group_participant_added_you") : l10n.t("web_group_participant_added_name", {
                    name: a
                });
                break;
            case "remove":
                r = s === Store.Conn.me ? l10n.t("web_group_participant_removed_you") : l10n.t("web_group_participant_removed_name", {
                    name: a
                });
                break;
            case "leave":
                r = s === Store.Conn.me ? l10n.t("web_group_participant_left_you") : l10n.t("web_group_participant_left_name", {
                    name: a
                });
                break;
            case "picture":
                r = "remove" === c ? s === Store.Conn.me ? l10n.t("web_photo_removed_by_you") : l10n.t("web_photo_removed_by", {
                    name: a
                }) : s === Store.Conn.me ? l10n.t("web_photo_changed_by_you") : l10n.t("web_photo_changed_by", {
                    name: a
                });
                break;
            case "subject":
                r = s === Store.Conn.me ? l10n.t("web_group_subject_changed_by_you", {
                    subject: c
                }) : l10n.t("web_group_subject_changed_by_name", {
                    name: a,
                    subject: c
                });
                break;
            case "modify":
                t = f.formattedUser(e.get("author")),
                n = f.formattedUser(c),
                r = t === a ? l10n.t("web_group_participant_changed_number_unknown_name", {
                    name: a,
                    new_number: n
                }) : l10n.t("web_group_participant_changed_number", {
                    name: a,
                    old_number: t,
                    new_number: n
                });
                break;
            default:
                d.log("wa:formatGroupNotification:unknown message subtype: " + o)()
            }
        else if ("gp2" === i) {
            var l, u = e.recipients, p = u ? u.map(function(e) {
                var t = Store.Contact.get(e);
                return t ? t.get("formattedName") : f.formattedUser(e)
            }).join(l10n.t("enumeration_comma")) : "", h = u ? _.head(u) : "", m = Store.Contact.get(h), g = m ? m.get("formattedName") : h ? f.formattedUser(h) : "";
            switch (o) {
            case "add":
                r = s ? s === Store.Conn.me ? l10n.t("web_group_participants_you_added_names", {
                    participants: p
                }) : h === Store.Conn.me ? l10n.t("web_group_participants_name_added_you", {
                    name: a
                }) : l10n.t("web_group_participants_name_added_names", {
                    name: a,
                    participants: p
                }) : h === Store.Conn.me ? l10n.t("web_group_participant_added_you") : l10n.t("web_group_participant_added_name", {
                    name: g
                });
                break;
            case "remove":
                r = s ? s === Store.Conn.me ? l10n.t("web_group_participants_you_removed_names", {
                    participants: p
                }) : h === Store.Conn.me ? l10n.t("web_group_participants_name_removed_you", {
                    name: a
                }) : l10n.t("web_group_participants_name_removed_names", {
                    name: a,
                    participants: p
                }) : h === Store.Conn.me ? l10n.t("web_group_participant_removed_you") : l10n.t("web_group_participant_removed_name", {
                    name: g
                });
                break;
            case "leave":
                r = h === Store.Conn.me ? l10n.t("web_group_participant_left_you") : l10n.t("web_group_participant_left_name", {
                    name: p
                });
                break;
            case "picture":
                r = "remove" === c ? s === Store.Conn.me ? l10n.t("web_photo_removed_by_you") : l10n.t("web_photo_removed_by", {
                    name: a
                }) : s === Store.Conn.me ? l10n.t("web_photo_changed_by_you") : l10n.t("web_photo_changed_by", {
                    name: a
                });
                break;
            case "subject":
                r = s === Store.Conn.me ? l10n.t("web_group_subject_changed_by_you", {
                    subject: c
                }) : l10n.t("web_group_subject_changed_by_name", {
                    name: a,
                    subject: c
                });
                break;
            case "modify":
                t = f.formattedUser(s),
                n = f.formattedUser(h),
                r = t === a ? l10n.t("web_group_participant_changed_number_unknown_name", {
                    name: a,
                    new_number: n
                }) : l10n.t("web_group_participant_changed_number", {
                    name: a,
                    old_number: t,
                    new_number: n
                });
                break;
            case "create":
                r = s === Store.Conn.me ? c ? l10n.t("web_group_created_by_you", {
                    subject: c
                }) : l10n.t("web_group_created_by_you_no_subject") : c ? l10n.t("web_group_created_by_name", {
                    name: a,
                    subject: c
                }) : l10n.t("web_group_created_by_name_no_subject", {
                    name: a
                });
                break;
            case "delete":
                r = s === Store.Conn.me ? l10n.t("web_group_ended_you") : l10n.t("web_group_ended_name", {
                    name: a
                });
                break;
            case "promote":
                l = u.length,
                r = 1 === l && h === Store.Conn.me ? l10n.t("web_group_participant_promoted_you") : l10n.t("web_group_participant_promoted_names", {
                    count: l,
                    participants: p,
                    _plural: l
                });
                break;
            case "demote":
                l = u.length,
                r = 1 === l && h === Store.Conn.me ? l10n.t("web_group_participant_demoted_you") : l10n.t("web_group_participant_demoted_names", {
                    count: l,
                    participants: p,
                    _plural: l
                });
                break;
            case "invite":
                r = h === Store.Conn.me ? l10n.t("web_group_participant_join_via_invite_you") : l10n.t("web_group_participant_join_via_invite_name", {
                    name: g
                });
                break;
            default:
                d.log("wa:formatGroupNotification:unknown message subtype: " + o)()
            }
        }
        return l10n.isRTL() && (r = l10n.forceRTL(r)),
        r
    }
    function s(e, t) {
        var n = e.mentionMap();
        if (n) {
            var r = u.supportsFeature(u.F.RICH_TEXT) ? [].concat(k, [new T(n)]) : [new T(n)]
              , i = m.parse(t, r);
            return m.serialize(i, new v)
        }
        return c(t)
    }
    function c(e) {
        if (!u.supportsFeature(u.F.RICH_TEXT))
            return e;
        var t = m.parse(e, k);
        return m.serialize(t, new v)
    }
    var l = n(1053)
      , u = n(101)
      , d = n(1)
      , p = n(53)
      , h = n(137)
      , f = n(23)
      , m = n(1117)
      , g = n(986).TYPE
      , v = n(1287)
      , y = n(1042)
      , E = n(1057)
      , b = n(1061)
      , S = n(1056)
      , M = n(1060)
      , C = n(1284)
      , T = n(1058)
      , w = n(1286)
      , k = [new y, new E, new b, new S, new M];
    e.exports = {
        formatBroadcastNotification: o,
        formatGroupNotification: a,
        formatE2ENotification: r,
        formatCallLog: i,
        asDesktopNotification: function(e) {
            var t, n, c, u, f = "", m = e.dir, v = Store.Mute.getGlobalPreviews();
            switch (e.from !== Store.Conn.me && e.isGroupMsg && (f = e.displayName()),
            e.type) {
            case g.CHAT:
                if (v)
                    t = s(e, e.body);
                else if (e.isGroupMsg)
                    t = f ? l10n.t("hidden_group_message_text_with_author", {
                        author: f
                    }) : l10n.t("hidden_group_message_text"),
                    f = "";
                else {
                    var y = e.chat;
                    t = l10n.t("hidden_message_text", {
                        unreadCount: l10n.n(y.unreadCount),
                        _plural: y.unreadCount
                    })
                }
                break;
            case g.IMAGE:
                c = p.hasEmoji ? " " : "",
                t = c + (v && e.caption || l10n.t("web_conversations_most_recent_image"));
                break;
            case g.VIDEO:
                e.isGif ? (c = p.hasEmoji ? " " : "",
                u = v && e.caption || "GIF") : (c = p.hasEmoji ? " " : "",
                u = v && e.caption || l10n.t("web_conversations_most_recent_video"),
                u = u + " (" + h.durationStr(e.duration) + ")"),
                t = c + " " + u;
                break;
            case g.PTT:
                c = p.hasEmoji ? " " : "",
                t = c + " " + l10n.t("web_conversations_most_recent_voice") + " (" + h.durationStr(e.duration) + ")";
                break;
            case g.AUDIO:
                c = p.hasEmoji ? " " : "",
                t = c + " " + l10n.t("web_conversations_most_recent_audio") + " (" + h.durationStr(e.duration) + ")";
                break;
            case g.LOCATION:
                c = p.hasEmoji ? " " : "",
                t = c + (v && e.loc || l10n.t("web_conversations_most_recent_location"));
                break;
            case g.GROUP_NOTIFICATION:
            case g.GP2:
                t = a(e),
                f = "";
                break;
            case g.BROADCAST_NOTIFICATION:
                n = e.subtype;
                var _ = e.body;
                t = o(n, _);
                break;
            case g.NOTIFICATION:
                t = e.body;
                break;
            case g.VCARD:
                c = p.hasEmoji ? " " : "",
                t = c + (e.subtype || l10n.t("web_conversations_most_recent_contact"));
                break;
            case g.DOCUMENT:
                c = p.hasEmoji ? " " : "",
                t = c + (e.subtype || l10n.t("web_conversations_most_recent_file"));
                break;
            case g.E2E_NOTIFICATION:
                t = r(e);
                break;
            case g.CALL_LOG:
                t = i(e, !1);
                break;
            case g.CIPHERTEXT:
                t = l10n.t("placeholder_msg");
                break;
            case g.UNKNOWN:
                t = l10n.t("unsupported_msg");
                break;
            default:
                return d.error("asDesktopNotification: Unrecognized type " + e.type)(),
                ""
            }
            var E = l10n.isRTL() ? "rtl" : "ltr"
              , b = "";
            if (b = h.relativeStr(e.t),
            f) {
                var S = l.dir(f);
                return "ltr" !== E || m && "ltr" !== m || S && "ltr" !== S ? "ltr" !== E || m && "ltr" !== m ? "ltr" !== E || S && "ltr" !== S ? "ltr" === E ? (b && (b = "- " + b + ""),
                "" + f + ": " + t + "" + b) : m && "rtl" !== m || S && "rtl" !== S ? m && "rtl" !== m ? S && "rtl" !== S ? (b && (b = "- " + b + ""),
                "" + f + ": " + t + "" + b) : (b && (b = " - " + b),
                f + ": " + t + "") : (b && (b = " - " + b),
                "" + f + ": " + t + "") : (b && (b = " - " + b),
                f + ": " + t + "") : (b && (b = " - " + b),
                f + ": " + t + "") : (b && (b = " - " + b),
                "" + f + ": " + t + "") : (b && (b = " - " + b),
                f + ": " + t + "")
            }
            return b ? "ltr" === E ? t + " - " + b + "" : t + " - " + b + "" : t
        },
        msgText: function(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] || arguments[1];
            switch (e.type) {
            case g.CIPHERTEXT:
                return l10n.t("placeholder_msg");
            case g.CHAT:
                return t ? s(e, e.body) : e.body;
            case g.IMAGE:
                return e.caption ? t ? s(e, e.caption) : e.caption : l10n.t("web_conversations_most_recent_image");
            case g.VIDEO:
                return e.caption ? t ? s(e, e.caption) : e.caption : e.isGif ? "GIF" : l10n.t("web_conversations_most_recent_video");
            case g.PTT:
                var n = h.durationStr(e.duration);
                return n ? n : l10n.t("web_conversations_most_recent_voice");
            case g.AUDIO:
                return l10n.t("web_conversations_most_recent_audio");
            case g.LOCATION:
                return e.loc || l10n.t("web_conversations_most_recent_location");
            case g.GROUP_NOTIFICATION:
            case g.GP2:
                return a(e);
            case g.BROADCAST_NOTIFICATION:
                return o(e.subtype, e.body);
            case g.NOTIFICATION:
                return e.body;
            case g.VCARD:
                return e.subtype || l10n.t("web_conversations_most_recent_contact");
            case g.DOCUMENT:
                var c = e.pageCount > 0 ? l10n.t("web_conversations_most_recent_document", {
                    count: e.pageCount + "",
                    _plural: e.pageCount
                }) : null ;
                return _.compact([e.caption || e.filename || l10n.t("web_conversations_most_recent_file"), c]).join("  ");
            case g.E2E_NOTIFICATION:
                return r(e);
            case g.CALL_LOG:
                return i(e, !1);
            case g.UNKNOWN:
                return l10n.t("unsupported_msg");
            default:
                return ""
            }
        },
        emojify: function(e) {
            if (!u.supportsFeature(u.F.RICH_TEXT))
                return e;
            var t = [new y, new C((!0))]
              , n = m.parse(e, t);
            return m.serialize(n, new w)
        }
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1001)
      , o = n(989)
      , a = n(986)
      , s = n(9)
      , c = n(23)
      , l = n(43)
      , u = function(e) {
        var t = e.msg
          , n = e.displaySelf
          , a = e.className
          , u = e.disableClick
          , d = t.chat.assignedColor(t.sender)
          , p = t.senderObj
          , h = l("message-author color-" + d, a, {
            "title-number": !p.name
        })
          , f = u ? _.noop : function() {
            Store.Chat.find(t.author).then(function(e) {
                s.openChat(e)
            })
        }
          , m = u ? null : "text-clickable"
          , g = void 0;
        return g = n ? r.createElement(o, {
            text: l10n.t("web_you")
        }) : p.name ? r.createElement("span", {
            className: m,
            onClick: f
        }, r.createElement(o, {
            text: p.name
        })) : [r.createElement("span", {
            className: l("number", m),
            key: t.id + "-number",
            onClick: f
        }, c.formattedUser(p.id)), r.createElement("span", {
            className: l("ellipsify", "screen-name", m),
            key: t.id + "-push-name",
            onClick: f
        }, r.createElement(o, {
            classes: "screen-name-text",
            direction: "auto",
            text: t.notifyName
        }))],
        r.createElement("h3", {
            className: h
        }, r.createElement(i, null , g))
    };
    u.shouldRender = function(e) {
        return !e.isSentByMe && e.isGroupMsg
    }
    ,
    u.propTypes = {
        msg: r.PropTypes.instanceOf(a).isRequired,
        displaySelf: r.PropTypes.bool,
        disableClick: r.PropTypes.bool,
        className: r.PropTypes.string
    },
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    function r(e, t) {
        this.list = e,
        this.index = -1,
        this.value = void 0,
        this.getter = t || function(e) {
            return e
        }
    }
    var i = n(57);
    _.assign(r.prototype, i, {
        init: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? [] : arguments[0]
              , t = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1]
              , n = void 0
              , r = void 0;
            if (this.list = e,
            this.value) {
                if (_.isEmpty(e))
                    return void this.unset();
                if (n = _.indexOf(e, this.value),
                n > -1) {
                    if (n === this.index)
                        return;
                    r = !0,
                    t = !1
                } else
                    n = t && this.index > -1 ? Math.min(Math.max(this.index, 0), e.length - 1) : -1,
                    r = n > -1;
                this.set(n, t, r)
            }
        },
        unset: function() {
            this.value && this.trigger(this.getter(this.value), !1),
            this.value = void 0,
            this.index = -1
        },
        reset: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] || arguments[0];
            this.index < 0 || this.value && this.trigger(this.getter(this.value), "focus", e)
        },
        set: function(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] || arguments[1]
              , n = arguments.length <= 2 || void 0 === arguments[2] || arguments[2];
            if (this.list.length) {
                var r = Math.min(Math.max(e, -1), this.list.length - 1)
                  , i = this.value
                  , o = r > -1 ? this.list[r] : void 0;
                o ? (this.trigger(this.getter(o), t ? "focus" : "select"),
                this.value = o) : n && (this.value = void 0),
                n && i && i !== o && this.trigger(this.getter(i), !1),
                this.index = r
            }
        },
        getVal: function() {
            return this.value
        },
        setVal: function(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] || arguments[1]
              , n = _.indexOf(this.list, e);
            n > -1 ? this.set(n, t) : (this.unset(),
            this.value = e)
        },
        setFirst: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] || arguments[0];
            _.isEmpty(this.list) || this.set(0, e)
        },
        setLast: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] || arguments[0];
            _.isEmpty(this.list) || this.set(this.list.length - 1, e)
        },
        setPrev: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] || arguments[0];
            _.isEmpty(this.list) || this.set(this.prev(), e)
        },
        setNext: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] || arguments[0];
            _.isEmpty(this.list) || this.set(this.next(), e)
        },
        prev: function() {
            return _.isEmpty(this.list) ? -1 : this.index === -1 ? -1 : this.index - 1
        },
        next: function() {
            return _.isEmpty(this.list) ? -1 : Math.min(this.index + 1, this.list.length - 1)
        }
    }),
    e.exports = r
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = r.createClass({
        displayName: "HiddenToken",
        propTypes: {
            children: r.PropTypes.node.isRequired
        },
        render: function() {
            return r.createElement("span", {
                className: "hidden-token"
            }, "", this.props.children, "")
        }
    });
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1001)
      , o = n(1187)
      , a = n(986)
      , s = n(43)
      , c = n(137)
      , l = n(9)
      , u = n(101)
      , d = r.createClass({
        displayName: "Meta",
        propTypes: {
            msg: r.PropTypes.instanceOf(a).isRequired
        },
        openInfoDrawer: function() {
            l.msgInfoDrawer(this.props.msg)
        },
        render: function() {
            var e, t, n = this.props.msg, l = n.broadcast || n.star ? (n.type === a.TYPE.IMAGE || n.type === a.TYPE.VIDEO || n.type === a.TYPE.AUDIO) && !n.caption : null ;
            if (n.broadcast) {
                var d = s("icon-s", {
                    "icon-broadcast-light": l,
                    "icon-broadcast": !l
                });
                e = r.createElement("span", {
                    className: d
                })
            }
            if (n.star) {
                var p = s("icon-s", {
                    "icon-star-light": l,
                    "icon-star": !l && n.isSentByMe,
                    "icon-star-in": !l && !n.isSentByMe
                });
                t = r.createElement("span", {
                    className: p
                })
            }
            var h = n.isSentByMe ? r.createElement(o, {
                msg: this.props.msg
            }) : null
              , f = n.isSentByMe && u.supportsFeature(u.F.MESSAGE_INFO);
            return r.createElement("div", {
                className: f ? "message-meta text-clickable" : "message-meta",
                onClick: f ? this.openInfoDrawer : null
            }, t, e, r.createElement(i, null , r.createElement("span", {
                className: "message-datetime"
            }, n.t ? c.timestampStr(n.t) : null )), h)
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i() {
        return ++m
    }
    var o = n(891)
      , a = r(o)
      , s = n(1)
      , c = n(6)
      , l = n(43)
      , u = n(102)
      , d = n(67)
      , p = n(209)
      , h = {
        DEFAULT_PUSH: "flow-transition-drawer-push",
        DEFAULT_POP: "flow-transition-drawer-pop",
        NONE: "none"
    }
      , f = {
        PUSH: "push",
        POP: "pop"
    }
      , m = 0
      , g = {
        getInitialState: function() {
            return {
                _stack: [],
                _activeKey: void 0,
                _transition: void 0
            }
        },
        defaultTransition: function(e) {
            var t, n = _.isFunction(this.getDefaultTransition) ? this.getDefaultTransition() : {};
            return _.assign((t = {},
            (0,
            a["default"])(t, f.PUSH, h.DEFAULT_PUSH),
            (0,
            a["default"])(t, f.POP, h.DEFAULT_POP),
            t), n)[e]
        },
        push: function(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] ? this.defaultTransition(f.PUSH) : arguments[1]
              , n = this.state._stack.concat(e)
              , r = i();
            this.setState({
                _stack: n,
                _transition: t,
                _activeKey: r
            })
        },
        pop: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? this.defaultTransition(f.POP) : arguments[0]
              , t = _.dropRight(this.state._stack);
            if (t.length) {
                var n = i();
                this.setState({
                    _stack: t,
                    _transition: e,
                    _activeKey: n
                })
            } else
                this.endFlow()
        },
        endFlow: function(e) {
            this.context.uim.uie.requestDismiss(e)
        },
        render: function() {
            var e = this
              , t = this.state
              , n = t._stack
              , r = t._transition
              , i = t._activeKey
              , o = _.last(n);
            s.assert(!!o, "empty-flow", o)(),
            o = c.createElement(p, {
                displayName: "FlowDrawer" + i,
                key: i,
                escapable: !0,
                requestDismiss: function() {
                    return e.pop()
                }
            }, o);
            var a = l("flow-drawer-container");
            return c.createElement(u, {
                transitionName: r,
                className: a
            }, o)
        }
    };
    g.Transition = h,
    g.Dir = f,
    g.contextTypes = {
        uim: c.PropTypes.instanceOf(d)
    },
    e.exports = g
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(210)
      , a = n(1018)
      , s = n(994)
      , c = n(1136)
      , l = n(987)
      , u = n(133)
      , d = n(43)
      , p = n(989)
      , h = n(1024)
      , f = n(139)
      , m = n(135)
      , g = m.HotKeys
      , v = {
        SMALL: "small",
        DEFAULT: "default"
    }
      , y = r.createClass({
        displayName: "Contact",
        mixins: [l, u],
        propTypes: {
            contact: r.PropTypes.instanceOf(o).isRequired,
            onClick: r.PropTypes.func,
            mouseDownAsClick: r.PropTypes.bool,
            onDelete: r.PropTypes.func,
            onContext: r.PropTypes.func,
            contextEnabled: r.PropTypes.func,
            contextMenu: r.PropTypes.bool,
            admin: r.PropTypes.bool,
            active: r.PropTypes.object,
            className: r.PropTypes.string,
            secondary: r.PropTypes.node,
            type: r.PropTypes.oneOf(_.values(v)),
            showNotifyName: r.PropTypes.bool,
            searchText: r.PropTypes.string
        },
        getInitialState: function() {
            var e = this.props.contact
              , t = this.props.active
              , n = {
                formattedName: this.async("contact.formattedName"),
                pendingAction: this.async("contact.pendingAction"),
                active: !!t && t.value === e,
                contextMenu: !1
            };
            return this.props.showNotifyName && (n.notifyName = this.async("contact.notifyName")),
            n
        },
        componentWillMount: function() {
            this.props.active && this.addObserver(this.props.active, this.props.contact.id.toString(), this.onActiveChange)
        },
        onActiveChange: function(e, t) {
            if ("focus" === e) {
                var n = i.findDOMNode(this);
                f.focus(n),
                t && h.scrollIntoViewIfNeeded(n)
            }
            this.setState({
                active: !!e
            })
        },
        contextEnabled: function() {
            return !1
        },
        onDelete: function(e) {
            e.stopPropagation(),
            this.props.onDelete(e, this.props.contact)
        },
        onClick: function(e) {
            _.isFunction(this.props.onClick) && this.props.onClick(e, this.props.contact)
        },
        onMouseDown: function(e) {
            0 === e.button && this.onClick(e)
        },
        onEnter: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            this.onClick(e)
        },
        onContext: function(e) {
            return this.state.contextMenu ? void this.setState({
                contextMenu: !1
            }) : (this.props.onContext(e, this.props.contact, this.onContextClose),
            void this.setState({
                contextMenu: !0
            }))
        },
        onContextClose: function() {
            this.setState({
                contextMenu: !1
            })
        },
        indicateFocus: function(e) {
            if (!(Date.now() - (g.flashFocus || 0) > 200)) {
                var t = i.findDOMNode(this.refs.cell);
                Velocity(t, "stop"),
                Velocity(t, {
                    backgroundColor: ["#e9eaeb", "#cbdde7"]
                }, {
                    duration: 1300,
                    easing: [.19, .69, .01, .99],
                    complete: this.onBlur
                })
            }
        },
        onBlur: function(e) {
            var t = i.findDOMNode(this.refs.cell);
            t && (Velocity(t, "stop"),
            t.style.backgroundColor = "")
        },
        render: function() {
            var e = this.props
              , t = e.contact
              , n = e.secondary
              , i = e.onContext
              , o = e.onDelete
              , l = e.contextEnabled
              , u = e.contextMenu
              , h = e.admin
              , f = e.showNotifyName
              , m = e.className;
            m = d("contact", m, {
                active: !!this.state.active
            });
            var y = void 0
              , _ = void 0
              , E = void 0;
            if (!t.name && f && this.state.notifyName && (E = r.createElement("span", {
                className: "ellipsify screen-name"
            }, r.createElement(p, {
                classes: "screen-name-text",
                direction: "auto",
                text: this.state.notifyName.name
            }))),
            h && (_ = r.createElement("div", {
                className: "chat-meta"
            }, r.createElement("div", {
                className: "chat-marker chat-marker-admin"
            }, l10n.t("web_group_admin")))),
            o) {
                var b = d("icon", {
                    "icon-x-alt-small": this.props.type === v.SMALL,
                    "icon-x-alt": this.props.type !== v.SMALL
                });
                y = r.createElement("div", {
                    className: "chat-controls"
                }, r.createElement("button", {
                    className: b,
                    onClick: this.onDelete
                }))
            }
            n || (n = r.createElement(c, {
                status: t.status
            })),
            i && (i = this.onContext);
            var S = this.props.type === v.SMALL ? 26 : s.Size.DEFAULT
              , M = r.createElement("div", {
                className: "chat-avatar"
            }, r.createElement(s, {
                id: t.id,
                size: S
            }))
              , C = {
                enter: this.onEnter
            }
              , T = this.props.mouseDownAsClick;
            return r.createElement(g, {
                handlers: C,
                onFocus: this.indicateFocus,
                onBlur: this.onBlur
            }, r.createElement(a, {
                id: t.id,
                ref: "cell",
                className: m,
                contextEnabled: l || this.contextEnabled,
                contextMenu: u,
                pendingAction: this.state.pendingAction,
                detail: y,
                image: M,
                primary: this.state.formattedName,
                searchText: this.props.searchText,
                primaryDetail: _,
                secondary: n,
                secondaryDetail: E,
                onClick: T ? null : this.onClick,
                onMouseDown: T ? this.onMouseDown : null ,
                onContext: i
            }))
        }
    });
    y.Type = v,
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        var n = t.x || 0
          , r = t.y || 0;
        t.degrees && (t.radians = t.degrees * (Math.PI / 180)),
        e.translate(n, r),
        e.rotate(t.radians),
        e.translate(-n, -r)
    }
    function o(e, t, n) {
        var r = e.getContext("2d")
          , i = r.getImageData(0, 0, t, n);
        e.width = t,
        e.height = n,
        r.putImageData(i, 0, 0)
    }
    function a(e) {
        var t = e.getContext("2d");
        t.fillStyle = "rgb(247,247,247)",
        t.fillRect(0, 0, e.width, e.height)
    }
    function s(e, t, n) {
        var r = p.boundHeightWidth(e.height, e.width, n, t)
          , i = r.width
          , o = r.height;
        if (i > e.width && o > e.height)
            return e;
        var a = document.createElement("canvas")
          , s = a.getContext("2d");
        return a.width = i,
        a.height = o,
        s.drawImage(e, 0, 0, i, o),
        a
    }
    function c(e) {
        var t = new g;
        return t.writeBytes(255, 216, 255, 224, 0, 16, 74, 70, 73, 70, 0),
        t.writeUint16(e.version),
        t.writeUint8(e.densityUnits),
        t.writeUint16(e.xDensity),
        t.writeUint16(e.yDensity),
        t.writeBytes(0, 0),
        t.readByteArray()
    }
    function l(e, t, n, r, i) {
        if (t > r || n > i)
            throw new Error("Image is too big and must be resized.");
        var o = new g(e)
          , a = new g(e)
          , s = new g
          , l = 2
          , u = 2
          , d = !1
          , p = !1
          , h = !1
          , f = !1
          , m = void 0
          , v = {
            version: 257,
            densityUnits: 0,
            xDensity: 1,
            yDensity: 1
        };
        if (o.readUint8() !== E || o.readUint8() !== b.SOI)
            throw new Error("SOI marker not at the start of the file.");
        a.advance(l);
        for (var y = void 0; y || o.size(); ) {
            if (void 0 === y) {
                var M = o.readUint8();
                if (M !== E)
                    throw new Error("0x" + M.toString(16) + " is not a marker prefix.");
                y = o.readUint8()
            }
            switch (y) {
            case b.APP0:
                if (p)
                    m = o.readUint16(),
                    a.advance(m + l),
                    o.advance(o.size() - a.size());
                else {
                    if (m = o.readUint16(),
                    "JFIF\0" !== o.readString(5))
                        throw new Error("APP0 marker missing 'JFIF' magic bytes.");
                    f = !0,
                    v.version = o.readUint16(),
                    v.densityUnits = o.readUint8(),
                    v.xDensity = o.readUint16(),
                    v.yDensity = o.readUint16(),
                    a.advance(m + l),
                    o.advance(o.size() - a.size()),
                    p = !0
                }
                break;
            case b.SOS:
                if (!h && !f)
                    throw new Error("Missing magic bytes marker.");
                o.advance(o.readUint16() - u);
                for (var C = void 0, T = void 0, w = o.readUint8(); o.size(); ) {
                    if (T = o.readUint8(),
                    C = w === E && _.indexOf(S, T) === -1) {
                        y = T;
                        break
                    }
                    w = T
                }
                s.writeByteArray(a.readByteArray(a.size() - o.size() - l));
                continue;
            case b.APP1:
                if (m = o.readUint16(),
                !h && "Exif\0\0" !== o.readString(6))
                    throw new Error("APP1 marker missing 'EXIF' magic bytes.");
                h = !0,
                a.advance(m + l),
                o.advance(o.size() - a.size());
                break;
            case b.APP13:
            case b.COM:
                if (!h && !f)
                    throw new Error("Missing magic bytes marker.");
                m = o.readUint16(),
                a.advance(m + l),
                o.advance(o.size() - a.size());
                break;
            case b.EOI:
                if (!h && !f)
                    throw new Error("Missing magic bytes marker.");
                d = !0,
                s.writeByteArray(a.readByteArray(l));
                break;
            case b.SOF0:
            case b.SOF1:
            case b.SOF2:
            case b.SOF3:
            case b.SOF5:
            case b.SOF6:
            case b.SOF7:
            case b.SOF9:
            case b.SOF10:
            case b.SOF11:
            case b.SOF13:
            case b.SOF14:
            case b.SOF15:
            case b.DQT:
            case b.DHT:
            case b.DRI:
                if (!h && !f)
                    throw new Error("Missing magic bytes marker.");
                m = o.readUint16(),
                s.writeByteArray(a.readByteArray(l + m)),
                o.advance(o.size() - a.size());
                break;
            case b.APP2:
            case b.APP3:
            case b.APP4:
            case b.APP5:
            case b.APP6:
            case b.APP7:
            case b.APP8:
            case b.APP9:
            case b.APP10:
            case b.APP11:
            case b.APP12:
            case b.APP14:
            case b.APP15:
                throw new Error("Received unexpected APP marker 0x" + y.toString(16));
            default:
                throw new Error("Did not understand marker: 0x" + y.toString(16))
            }
            if (y = void 0,
            d)
                break
        }
        if (!d)
            throw new Error("No EOI tag found.");
        var k = c(v);
        return new Blob([k, s.readByteArray()],{
            type: "image/jpeg"
        })
    }
    var u = n(2)
      , d = r(u)
      , p = n(1113)
      , h = n(901)
      , f = n(435)
      , m = n(14)
      , g = n(13)
      , v = n(1)
      , y = n(1114)
      , E = 255
      , b = {
        SOF0: 192,
        SOF1: 193,
        SOF2: 194,
        SOF3: 195,
        DHT: 196,
        SOF5: 197,
        SOF6: 198,
        SOF7: 199,
        SOF9: 201,
        SOF10: 202,
        SOF11: 203,
        SOF13: 205,
        SOF14: 206,
        SOF15: 207,
        RST0: 208,
        RST1: 209,
        RST2: 210,
        RST3: 211,
        RST4: 212,
        RST5: 213,
        RST6: 214,
        RST7: 215,
        SOI: 216,
        EOI: 217,
        SOS: 218,
        DQT: 219,
        DRI: 221,
        APP0: 224,
        APP1: 225,
        APP2: 226,
        APP3: 227,
        APP4: 228,
        APP5: 229,
        APP6: 230,
        APP7: 231,
        APP8: 232,
        APP9: 233,
        APP10: 234,
        APP11: 235,
        APP12: 236,
        APP13: 237,
        APP14: 238,
        APP15: 239,
        COM: 254
    }
      , S = [0, b.RST0, b.RST1, b.RST2, b.RST3, b.RST4, b.RST5, b.RST6, b.RST7]
      , M = {
        DATA_URL: 1,
        BLOB: 2,
        CANVAS: 4,
        generateVideoThumbAndDuration: function(e, t, n) {
            return y.video(e, !0).then(function(e) {
                var r = e.video
                  , i = e.fullWidth
                  , o = e.fullHeight
                  , a = document.createElement("canvas")
                  , s = p.boundHeightWidth(o, i, n, t);
                a.width = s.width,
                a.height = s.height;
                var c = a.getContext("2d");
                return c.drawImage(r, 0, 0, s.width, s.height),
                {
                    duration: ~~r.seekable.end(0),
                    thumb: {
                        url: a.toDataURL("image/jpeg"),
                        width: s.width,
                        height: s.height,
                        fullWidth: i,
                        fullHeight: o
                    }
                }
            })
        },
        crop: function(e, t, n, r, i, o, a) {
            var s = this
              , c = arguments.length <= 7 || void 0 === arguments[7] ? M.DATA_URL : arguments[7]
              , l = e instanceof HTMLCanvasElement ? d["default"].resolve(e) : y.loadImage(e);
            return l.then(function(e) {
                var l = document.createElement("canvas")
                  , u = l.getContext("2d");
                o && a ? (l.height = a,
                l.width = o,
                u.drawImage(e, t, n, r, i, 0, 0, o, a)) : (l.height = i,
                l.width = r,
                u.drawImage(e, t, n, r, i));
                var p = {};
                return s.getImagePromises(p, l, c),
                d["default"].props(p).then(function(e) {
                    return {
                        images: e,
                        width: r,
                        height: i
                    }
                })
            })
        },
        generateLinkPreview: function(e) {
            return y.loadImage(e).then(function(e) {
                var t = 100
                  , n = 140;
                if (e.width < t || e.height < t)
                    return null ;
                var r = document.createElement("canvas")
                  , i = r.getContext("2d");
                r.height = n,
                r.width = n;
                var o = Math.min(e.width, e.height)
                  , a = (e.width - o) / 2
                  , s = (e.height - o) / 2;
                return i.drawImage(e, a, s, o, o, 0, 0, n, n),
                r.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/, "")
            })["catch"](function() {
                return null
            })
        },
        resizeDataURI: function(e, t, n) {
            return y.loadImage(e).then(function(e) {
                var r = document.createElement("canvas")
                  , i = p.boundHeightWidth(e.height, e.width, n, t);
                r.width = i.width,
                r.height = i.height;
                var o = r.getContext("2d");
                return o.drawImage(e, 0, 0, i.width, i.height),
                r.toDataURL("image/jpeg")
            })
        },
        getImagePromises: function(e, t, n) {
            !e.blob && n & this.BLOB && (e.blob = this.canvasToBlob(t)),
            !e.dataUrl && n & this.DATA_URL && (e.dataUrl = d["default"].resolve(t.toDataURL("image/jpeg"))),
            !e.canvas && n & this.CANVAS && (e.canvas = d["default"].resolve(t))
        },
        rotateAndResize: function(e, t, n) {
            var r = this
              , c = arguments.length <= 3 || void 0 === arguments[3] ? M.BLOB : arguments[3]
              , u = e instanceof HTMLCanvasElement
              , m = void 0
              , g = void 0
              , _ = void 0;
            return u ? (g = d["default"].resolve(e),
            _ = d["default"].resolve(null )) : (m = window.URL.createObjectURL(e),
            g = y.loadImage(m),
            _ = f.blobToArrayBuffer(e)),
            d["default"].props({
                buffer: _,
                image: g
            }).then(function(e) {
                var u = e.buffer
                  , f = e.image
                  , m = {};
                try {
                    m = h(u)
                } catch (g) {}
                var y = 0;
                switch (m.orientation || "UNKNOWN") {
                case "right-top":
                    y = 1;
                    break;
                case "left-bottom":
                    y = -1;
                    break;
                case "bottom-right":
                    y = 2
                }
                var _ = document.createElement("canvas")
                  , E = f.naturalWidth || f.width
                  , b = f.naturalHeight || f.height
                  , S = {};
                if (y) {
                    var C = function() {
                        var e = Math.max(E, b)
                          , l = e / 2;
                        _.width = _.height = e;
                        var u = _.getContext("2d");
                        a(_),
                        i(u, {
                            x: l,
                            y: l,
                            degrees: 90 * y
                        }),
                        1 === y ? u.drawImage(f, 0, e - b) : u.drawImage(f, e - E, 0),
                        i(u, {
                            x: l,
                            y: l,
                            degrees: y * -90
                        }),
                        o(_, b, E);
                        var p = s(_, t, n);
                        return r.getImagePromises(S, p, c),
                        {
                            v: d["default"].props(S).then(function(e) {
                                return {
                                    width: p.width,
                                    height: p.height,
                                    images: e
                                }
                            })
                        }
                    }();
                    if ("object" == typeof C)
                        return C.v
                } else {
                    var T = function() {
                        var e = void 0
                          , i = void 0
                          , o = c & M.BLOB;
                        if (u && o)
                            try {
                                var s = l(u, E, b, t, n);
                                S.blob = s,
                                o = !1,
                                e = E,
                                i = b
                            } catch (h) {
                                v.log("Could not parse JPEG: " + h.message)()
                            }
                        if (o || c & ~M.BLOB) {
                            var m = p.boundHeightWidth(b, E, n, t);
                            _.width = m.width,
                            _.height = m.height,
                            e = _.width,
                            i = _.height;
                            var g = _.getContext("2d");
                            a(_),
                            g.drawImage(f, 0, 0, e, i),
                            r.getImagePromises(S, _, c)
                        }
                        return {
                            v: d["default"].props(S).then(function(t) {
                                return {
                                    width: e,
                                    height: i,
                                    images: t
                                }
                            })
                        }
                    }();
                    if ("object" == typeof T)
                        return T.v
                }
            })["finally"](function() {
                m && window.URL.revokeObjectURL(m)
            })
        },
        canvasToBlob: function(e) {
            arguments.length <= 1 || void 0 === arguments[1] ? "image/jpeg" : arguments[1];
            return e.toBlob ? new d["default"](function(t) {
                e.toBlob(t, "image/jpeg")
            }
            ) : d["default"].resolve(window.dataURLtoBlob(e.toDataURL("image/jpeg")))
        },
        urlToFile: function(e) {
            var t = this;
            return y.loadImage(e).then(function(e) {
                var n = document.createElement("canvas");
                n.width = e.naturalWidth,
                n.height = e.naturalHeight;
                var r = n.getContext("2d");
                return a(n),
                r.drawImage(e, 0, 0),
                t.canvasToBlob(n)
            })["catch"](function() {
                return d["default"].reject(new m.MediaDragDropError("unable to render image",e))
            })
        },
        isCached: function(e) {
            if (!e)
                return !1;
            var t = new Image;
            return t.src = e,
            !!t.complete
        },
        loadImage: y.loadImage
    };
    e.exports = M
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t, n, r) {
        this.key = e,
        this.src = t,
        this.crossOrigin = n,
        this.noXHR = r,
        this.isHttp = "/" === t[0] || T.isHttp(t),
        this.hasPrivacyChecks = !0,
        this.promise = null ,
        this.retainCount = 0,
        this.generation = 0
    }
    function o(e) {
        var t = e.src
          , n = e.crossOrigin
          , r = e.noXHR
          , o = e.hasPrivacyChecks;
        n = !!n,
        r = !!r;
        var a = "CO:" + (n ? "y" : "n") + ",XHR:" + (r ? "y" : "n") + "," + t
          , s = O[a];
        if (s)
            return s.retainCount++,
            s.generation = 0,
            o || (s.hasPrivacyChecks = !1),
            s;
        var l = new i(a,t,n,r);
        return O[a] = l,
        l.retainCount++,
        l.promise = c["default"].loop(function(e) {
            var n = l.generation++;
            if (n > D)
                throw new C.GaveUpRetry("Too many image retries " + l.src);
            return c["default"].delay(Math.floor(1e3 * w.expBackoff(n, 60, 0))).then(function() {
                return l.hasPrivacyChecks && !E.phoneActive && n > 0 ? S.waitForBBEvent(E, "change:phoneActive", N.matches({
                    phoneActive: !0
                })) : b.waitForOnline
            }).cancellable().then(function() {
                return !(0 !== n && l.isHttp && !l.noXHR) || M.get(t).timeout(3e4, "imageTagRetryTimeout").then(function(e) {
                    var t = e.status;
                    if (t >= 200 && t < 400)
                        return !0;
                    if (t >= 500)
                        return !1;
                    throw new C.ServerStatusError(null ,l.src,t)
                }, function() {
                    return !1
                })
            }).then(function(t) {
                if (t)
                    return x.loadImage(l.src, l.crossOrigin).then(e)["catch"](function() {
                        if (!l.isHttp)
                            throw new C.ImageError("Invalid Data URI",l.src)
                    })
            })
        }).cancellable()["finally"](function() {
            l === O[l.key] && delete O[l.key]
        }),
        l
    }
    function a(e) {
        --e.retainCount <= 0 && e.promise.cancel()
    }
    var s = n(2)
      , c = r(s)
      , l = n(52)
      , u = r(l)
      , d = n(36)
      , p = r(d)
      , h = n(44)
      , f = r(h)
      , m = n(208)
      , g = r(m)
      , v = n(207)
      , y = r(v)
      , _ = n(6)
      , E = n(69)
      , b = n(141)
      , S = n(46)
      , M = n(140)
      , C = n(14)
      , T = n(83)
      , w = n(103)
      , k = n(10)
      , x = n(1005)
      , N = n(31)
      , P = n(1208)
      , D = 10
      , O = {}
      , A = function(e) {
        function t(e) {
            (0,
            p["default"])(this, t);
            var n = (0,
            g["default"])(this, (0,
            u["default"])(t).call(this, e));
            return x.isCached(e.src) ? n.state = {
                src: e.src
            } : (n.ensureLoaded(e),
            n.state = {
                src: null
            }),
            n
        }
        return (0,
        y["default"])(t, e),
        (0,
        f["default"])(t, [{
            key: "componentWillReceiveProps",
            value: function(e) {
                this.props.src !== e.src && (x.isCached(e.src) ? this.setState({
                    src: e.src
                }) : (this.ensureLoaded(e),
                this.setState({
                    src: null
                })))
            }
        }, {
            key: "componentWillUnmount",
            value: function() {
                this.ensureLoadedQuery && a(this.ensureLoadedQuery)
            }
        }, {
            key: "ensureLoaded",
            value: function(e) {
                var t = this
                  , n = this.ensureLoadedQuery
                  , r = this.ensureLoadedQuery = o(e);
                n && a(n),
                n !== r && r.promise.checkpoint(this.props.rejectOnUnmount()).then(function() {
                    r === t.ensureLoadedQuery && (t.setState({
                        src: t.props.src
                    }),
                    t.props.onLoaded && t.props.onLoaded())
                })["catch"](C.ImageError, C.ServerStatusError, C.GaveUpRetry, function(e) {
                    r === t.ensureLoadedQuery && (t.props.rejectOnUnmount().isRejected() || t.props.onError && t.props.onError(e))
                })["catch"](C.Unmount, c["default"].CancellationError, N.noop)
            }
        }, {
            key: "render",
            value: function() {
                var e = this.state.src
                  , t = this.props
                  , n = t.onLoad
                  , r = t.alt
                  , i = t.onClick
                  , o = t.onMouseMove
                  , a = t.style
                  , s = t.className;
                return e || (e = k.ONE_BY_ONE_TRANS_GIF,
                n = void 0),
                _.createElement("img", {
                    src: e,
                    alt: r,
                    onLoad: n,
                    onClick: i,
                    onMouseMove: o,
                    style: a,
                    className: s
                })
            }
        }]),
        t
    }(_.Component);
    A.defaultProps = {
        crossOrigin: !0
    },
    e.exports = P(A)
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(134)
      , a = n(43)
      , s = {
        CONTAIN: "contain",
        COVER: "cover",
        SCALE_DOWN: "scaleDown",
        ZOOM_IN: "zoomIn"
    }
      , c = r.createClass({
        displayName: "ObjectFit",
        mixins: [o],
        propTypes: {
            children: r.PropTypes.node.isRequired,
            type: r.PropTypes.oneOf(_.values(s)).isRequired,
            size: r.PropTypes.shape({
                width: r.PropTypes.number.isRequired,
                height: r.PropTypes.number.isRequired
            }),
            style: r.PropTypes.object,
            zoomIn: r.PropTypes.shape({
                factor: r.PropTypes.number,
                translateX: r.PropTypes.number,
                translateY: r.PropTypes.number
            }),
            onObjectLoad: r.PropTypes.func
        },
        statics: {
            TYPES: s
        },
        getInitialState: function() {
            return {
                style: this.props.size,
                className: "object-fit",
                computed: !1
            }
        },
        componentDidMount: function() {
            if (!this.shouldUseNativeObjectFit()) {
                this.initialize();
                var e = this;
                this.regNativeListener(window, "resize", function() {
                    e.initialize()
                })
            }
        },
        componentWillReceiveProps: function(e) {
            this.initialize(e)
        },
        initialize: function(e) {
            var t = this;
            this.shouldUseNativeObjectFit() || (e = e || this.props,
            e.size && this.setState(this[e.type](e.size.width, e.size.height, e.zoomIn), function() {
                _.isFunction(t.props.onObjectLoad) && t.props.onObjectLoad(t.refs.object.firstChild)
            }))
        },
        shouldUseNativeObjectFit: function() {
            return !1
        },
        cover: function(e, t) {
            var n = i.findDOMNode(this)
              , r = n.clientWidth
              , o = n.clientHeight
              , a = e
              , s = t
              , c = 0
              , l = 0;
            return a !== r && (s *= r / a,
            a = r,
            s > o && (c = o / 2 - s / 2)),
            s < o && (a *= o / s,
            s = o,
            a > r && (l = r / 2 - a / 2)),
            {
                style: {
                    width: a,
                    height: s,
                    top: c,
                    left: l,
                    position: "absolute"
                },
                className: "object-fit object-fit-cover",
                computed: !0
            }
        },
        contain: function(e, t) {
            var n = i.findDOMNode(this)
              , r = n.clientWidth
              , o = n.clientHeight
              , a = e
              , s = t
              , c = 0
              , l = 0
              , u = a / r
              , d = s / o;
            return u > d ? (s *= r / a,
            a = r,
            s < o && (c = o / 2 - s / 2)) : (a *= o / s,
            s = o,
            a < r && (l = r / 2 - a / 2)),
            {
                style: {
                    width: a,
                    height: s,
                    top: c,
                    left: l,
                    position: "absolute"
                },
                className: "object-fit object-fit-contain",
                computed: !0
            }
        },
        scaleDown: function(e, t) {
            var n = i.findDOMNode(this)
              , r = n.clientWidth
              , o = n.clientHeight
              , a = t
              , s = e;
            return a > o && (a = o,
            s = e * (o / t)),
            s > r && (s = r,
            a = t * (r / e)),
            {
                style: {
                    width: s,
                    height: a
                },
                className: "object-fit object-fit-scaledown",
                computed: !0
            }
        },
        zoomIn: function(e, t, n) {
            var r = this.scaleDown(e, t);
            return r.className += " object-fit-zoomin",
            r.style.transition = "transform 300ms cubic-bezier(.1,.82,.25,1)",
            n && (r.style.transform = "translateX(" + n.translateX + "px) translateY(" + n.translateY + "px) scale(" + n.factor + ")"),
            r
        },
        render: function() {
            if (this.shouldUseNativeObjectFit())
                return r.createElement("div", {
                    className: "native-scale-down"
                }, this.props.children);
            var e = this.state.computed ? this.state.style : {
                visibility: "hidden"
            };
            return r.createElement("div", {
                style: this.props.style,
                className: a(this.state.className)
            }, r.createElement("div", {
                style: e,
                ref: "object"
            }, this.props.children))
        }
    });
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(892)
      , s = r(a)
      , c = n(6)
      , l = n(434)
      , u = n(1048)
      , d = n(43)
      , p = c.createClass({
        displayName: "DrawerSection",
        propTypes: {
            children: c.PropTypes.node.isRequired,
            title: c.PropTypes.node,
            subtitle: c.PropTypes.node,
            titleOnClick: c.PropTypes.func,
            footer: c.PropTypes.node,
            classes: c.PropTypes.string,
            onMouseDown: c.PropTypes.func,
            noContainer: c.PropTypes.bool,
            a8n: c.PropTypes.string
        },
        getDefaultProps: function() {
            return {
                noContainer: !1
            }
        },
        render: function() {
            var e = this.props
              , t = e.children
              , n = e.title
              , r = e.subtitle
              , i = e.footer
              , a = e.classes
              , p = e.onMouseDown
              , h = e.noContainer
              , f = e.titleOnClick
              , m = e.a8n
              , g = (0,
            s["default"])(e, ["children", "title", "subtitle", "footer", "classes", "onMouseDown", "noContainer", "titleOnClick", "a8n"])
              , v = d(a, "drawer-section", {
                well: !!n
            });
            if (!n)
                return c.createElement("div", {
                    className: v
                }, t);
            var y = r ? r : null
              , _ = t;
            return !h && _ && (_ = c.createElement("div", {
                className: "drawer-section-body"
            }, t)),
            c.createElement("div", (0,
            o["default"])({
                className: v,
                onMouseDown: p
            }, g), c.createElement(u, {
                classes: "drawer-section-title",
                side: y,
                ellipsify: !0,
                "data-a8n": l.key(m),
                onClick: f
            }, n), _, i)
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(223)
      , o = r(i)
      , a = n(894)
      , s = r(a)
      , c = n(890)
      , l = r(c);
    e.exports = {},
    e.exports.matchAll = function(e, t, n) {
        for (var r = [], i = void 0; i = e.exec(t); ) {
            var o = n ? n(i, e) : i;
            o && r.push(o)
        }
        return r
    }
    ;
    var u = n(43)
      , d = n(6)
      , p = d.createElement
      , h = 0
      , f = function(e) {
        return function(t, n, r) {
            return p(e, (0,
            l["default"])({
                key: "k-" + h++
            }, r), n)
        }
    }
      , m = function() {
        for (var e = arguments.length, t = Array(e), n = 0; n < e; n++)
            t[n] = arguments[n];
        var r = t.filter(function(e) {
            return !!e
        });
        return function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? new s["default"] : arguments[0]
              , t = arguments[1]
              , n = arguments[2];
            return r.reduce(function(r, i) {
                var a = i(e, t, n) || {}
                  , s = u(r.className, a.className);
                return (0,
                o["default"])(r, a, s ? {
                    className: s
                } : {})
            }, {})
        }
    }
      , g = function(e, t) {
        return function(n, r, i) {
            return e(n, r, t(i, n, r))
        }
    }
      , v = function(e, t) {
        return m(function(e) {
            return e.get("default")
        }, function(t) {
            return t.get(e)
        }, t)
    }
      , y = function(e, t, n) {
        return g(f(e), v(t, n))
    };
    e.exports.jsx = {
        make: y
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(36)
      , o = r(i)
      , a = n(44)
      , s = r(a)
      , c = n(896)
      , l = function() {
        function e() {
            (0,
            o["default"])(this, e)
        }
        return (0,
        s["default"])(e, [{
            key: "match",
            value: function(e) {
                c(!1, "Subclasses of `Mutator` must implement `match(text)`")
            }
        }, {
            key: "mutate",
            value: function(e, t) {
                return e
            }
        }, {
            key: "group",
            get: function() {
                return 0
            }
        }, {
            key: "isFragment",
            get: function() {
                return !1
            }
        }, {
            key: "isFormatter",
            get: function() {
                return !1
            }
        }, {
            key: "alwaysApply",
            get: function() {
                return !1
            }
        }, {
            key: "formatResult",
            get: function() {
                return !0
            }
        }, {
            key: "mutates",
            get: function() {
                return this.mutate !== e.prototype.mutate
            }
        }]),
        e
    }();
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1198)
      , o = n(1096)
      , a = n(102)
      , s = n(437)
      , c = n(43)
      , l = n(136)
      , u = n(1043)
      , d = n(135)
      , p = d.HotKeys
      , h = n(209)
      , f = n(1012)
      , m = r.createClass({
        displayName: "TextInput",
        propTypes: {
            placeholder: r.PropTypes.string,
            value: r.PropTypes.string,
            error: r.PropTypes.string,
            lowProfile: r.PropTypes.bool,
            multiline: r.PropTypes.bool,
            supportsEmoji: r.PropTypes.bool,
            onChange: r.PropTypes.func.isRequired,
            onBlur: r.PropTypes.func,
            onFocus: r.PropTypes.func,
            onEnter: r.PropTypes.func,
            onFiles: r.PropTypes.func,
            maxLength: r.PropTypes.number,
            showRemaining: r.PropTypes.bool,
            editable: r.PropTypes.bool,
            spellCheck: r.PropTypes.bool,
            focusOnMount: r.PropTypes.bool,
            lockable: r.PropTypes.bool,
            pending: r.PropTypes.bool,
            onCancel: r.PropTypes.func,
            onSave: r.PropTypes.func,
            onError: r.PropTypes.func,
            validate: r.PropTypes.func
        },
        getDefaultProps: function() {
            return {
                maxLength: 25,
                editable: !0
            }
        },
        getInitialState: function() {
            return {
                active: !1,
                locked: this.props.lockable,
                emojiPicker: !1
            }
        },
        componentDidMount: function() {
            this.props.focusOnMount && this.restoreFocus()
        },
        onEmojiPicker: function(e) {
            e && (e.preventDefault(),
            e.stopPropagation());
            var t = r.createElement(o, {
                onEmoji: this.onEmoji
            });
            this.setState({
                emojiPicker: {
                    menu: t,
                    menuDirection: {
                        y: s.Direction.Y.TOP
                    },
                    type: s.Type.EMOJI_PICKER,
                    anchor: e.target
                }
            }),
            this.restoreFocus()
        },
        emojiPickerClose: function() {
            this.setState({
                emojiPicker: !1
            })
        },
        onEmoji: function(e) {
            this.refs.inputLine.replaceSelection(e)
        },
        onEnter: function() {
            this.props.lockable && this.onSaveAndLock(),
            this.props.onEnter && !this.props.multiline && this.props.onEnter()
        },
        onChange: function(e) {
            this.props.onChange && this.props.onChange(e)
        },
        restoreFocus: function() {
            this.refs.inputLine && this.refs.inputLine.restoreFocus()
        },
        onBlur: function(e) {
            this.state.active && this.setState({
                active: !1
            }),
            this.props.onBlur && this.props.onBlur(e)
        },
        onFocus: function(e) {
            e.stopPropagation(),
            this.state.active || this.setState({
                active: !0
            }),
            this.props.onFocus && this.props.onFocus(e);
            var t = this.refs.uiTextInput;
            t && t.raiseToTop()
        },
        onUnlock: function(e) {
            this.setState({
                locked: !1
            })
        },
        onSaveAndLock: function(e) {
            var t = !(!this.props.lowProfile && this.props.error);
            this.props.validate && t && (t = this.props.validate(this.props.value)),
            t ? (this.props.onSave && this.props.onSave(),
            this.setState({
                locked: !0
            })) : this.props.onError && this.props.onError()
        },
        onCancel: function() {
            this.props.onCancel && this.props.onCancel(),
            this.setState({
                locked: !0
            })
        },
        render: function() {
            var e = this.props.editable && !this.state.locked
              , t = e && !!this.props.error && !this.props.lowProfile
              , n = u.multibyteLength(this.props.value || "")
              , o = this.props.maxLength - n < 50 && e
              , s = {
                container: c("text-input", {
                    "no-placeholder": !this.props.placeholder
                }),
                label: c("label-text", {
                    "label-text-float": !!this.props.value
                }),
                inputWrapper: c("input-wrapper", {
                    "input-text-error": t,
                    "input-text-active": this.state.active,
                    locked: this.state.locked
                }),
                infoWrapper: c("input-info-strip", {
                    "input-text-error": t,
                    "input-text-active": this.state.active
                })
            }
              , d = this.props.showRemaining ? r.createElement("div", {
                className: "control-button-container char-counter"
            }, r.createElement("div", {
                className: "char-counter"
            }, o ? this.props.maxLength - n : null )) : null
              , m = e && this.props.supportsEmoji ? r.createElement("button", {
                className: "icon icon-emoji icon-emoji-input",
                onClick: this.onEmojiPicker
            }) : void 0
              , g = void 0;
            this.props.lockable && (this.props.pending ? g = r.createElement("div", {
                className: "icon icon-spinner"
            }, r.createElement(l, {
                size: 18,
                stroke: 6
            })) : this.state.locked ? this.props.editable && (g = r.createElement("span", {
                className: "lock-icon icon icon-pencil",
                onClick: this.onUnlock,
                key: "btn-edit",
                title: l10n.t("edit_button")
            })) : g = r.createElement("span", {
                className: "lock-icon icon icon-checkmark",
                onClick: this.onSaveAndLock,
                key: "btn-done",
                title: l10n.t("click_to_save_esc_to_cancel")
            }),
            g = r.createElement(a, {
                transitionName: "pop",
                component: "div",
                className: "control-button-container"
            }, g));
            var v = this.props.lowProfile ? null : r.createElement("div", {
                className: s.infoWrapper
            }, r.createElement("div", {
                className: "error-text"
            }, t ? this.props.error : null ))
              , y = void 0;
            if (this.props.lockable && !this.state.locked) {
                var _ = void 0;
                this.state.emojiPicker && (_ = r.createElement(h, {
                    displayName: "EmojiPicker",
                    escapable: !0,
                    popable: !0,
                    requestFocus: this.restoreFocus,
                    requestDismiss: this.emojiPickerClose
                }, r.createElement(f, {
                    contextMenu: this.state.emojiPicker
                }))),
                y = r.createElement(h, {
                    displayName: "TextInput",
                    escapable: !0,
                    requestFocus: this.restoreFocus,
                    requestDismiss: this.onCancel
                }, _)
            } else
                !this.props.lockable && this.state.emojiPicker && (y = r.createElement(h, {
                    displayName: "EmojiPicker",
                    escapable: !0,
                    popable: !0,
                    requestFocus: this.restoreFocus,
                    requestDismiss: this.emojiPickerClose
                }, r.createElement(f, {
                    contextMenu: this.state.emojiPicker
                })));
            return r.createElement(p, {
                className: s.container,
                onFocus: this.restoreFocus
            }, r.createElement("span", {
                className: s.label
            }, this.props.placeholder), r.createElement("div", {
                className: "input-spacer"
            }), r.createElement("div", {
                className: s.inputWrapper,
                "data-trump-dominateparent": "click"
            }, r.createElement(i, {
                ref: "inputLine",
                value: this.props.value,
                className: "input-text",
                multiline: this.props.multiline,
                onChange: this.onChange,
                onFocus: this.onFocus,
                onBlur: this.onBlur,
                onEnter: this.onEnter,
                onFiles: this.props.onFiles,
                focusOnChange: !1,
                spellCheck: this.props.spellCheck,
                maxLength: this.props.maxLength,
                showRemaining: this.props.showRemaining,
                editable: this.props.editable && !this.state.locked
            }), r.createElement("div", {
                className: "textinput-controls"
            }, g, r.createElement(a, {
                transitionName: "pop",
                component: "div",
                className: "control-button-container"
            }, m), d)), v, y)
        }
    });
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(892)
      , s = r(a)
      , c = n(6)
      , l = n(9)
      , u = n(67)
      , d = c.createClass({
        displayName: "UIEMenu",
        propTypes: {
            contextMenu: c.PropTypes.object.isRequired
        },
        componentDidMount: function() {
            var e = this
              , t = this.props.contextMenu
              , n = t.menu
              , r = (0,
            s["default"])(t, ["menu"]);
            l.openContextMenu(n, (0,
            o["default"])({}, r), this.context.uim, function(t) {
                return e.element = t
            })
        },
        componentWillUnmount: function() {
            l.closeContextMenu(this.context.uim)
        },
        getElement: function() {
            return this.element
        },
        render: function() {
            return null
        }
    });
    d.contextTypes = {
        uim: c.PropTypes.instanceOf(u)
    },
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(43)
      , o = n(434)
      , a = r.createClass({
        displayName: "DrawerListItem",
        propTypes: {
            onClick: r.PropTypes.func,
            iconClass: r.PropTypes.string,
            className: r.PropTypes.string,
            a8n: r.PropTypes.string.isRequired
        },
        render: function() {
            var e = this.props
              , t = e.onClick
              , n = e.iconClass
              , a = e.className
              , s = e.children
              , c = n ? r.createElement("div", {
                className: "chat-avatar"
            }, r.createElement("div", {
                className: "avatar"
            }, r.createElement("span", {
                className: i("icon", n)
            }))) : null ;
            return r.createElement("div", {
                className: i("chat", a),
                "data-ignore-capture": "any"
            }, r.createElement("div", {
                className: "chat-cell",
                onClick: t,
                "data-a8n": o.key(this.props.a8n)
            }, c, r.createElement("div", {
                className: "chat-body"
            }, r.createElement("div", {
                className: "chat-main"
            }, r.createElement("div", {
                className: "chat-title"
            }, r.createElement("span", {
                className: "emojitext ellipsify",
                dir: "auto"
            }, s))))))
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(10)
      , o = n(429)
      , a = n(9)
      , s = n(53)
      , c = {
        GUIDE_ALLOW: "guide-allow",
        GUIDE_UNBLOCK: "guide-unblock",
        GUIDE_NONE: "guide-none"
    }
      , l = {
        CHROME_MEDIA_ERROR: "__chrome_media_error__",
        FIREFOX_LOCK: "__firefox_lock__",
        OPERA_MEDIA: "__opera_media__"
    }
      , u = r.createClass({
        displayName: "GuidePopup",
        propTypes: {
            title: r.PropTypes.string.isRequired,
            desc: r.PropTypes.string.isRequired,
            browserPrefixDesc: r.PropTypes.bool.isRequired,
            type: r.PropTypes.oneOf(_.values(c)).isRequired,
            onConfirm: r.PropTypes.func,
            onCancel: r.PropTypes.func
        },
        statics: {
            TYPE: c
        },
        getDefaultProps: function() {
            return {
                browserPrefixDesc: !0,
                type: c.GUIDE_NONE,
                onConfirm: a.closeModal.bind(a)
            }
        },
        componentDidMount: function() {
            var e = this.getDescription()
              , t = this.refs.description;
            e.indexOf(l.CHROME_MEDIA_ERROR) > -1 && (t.innerHTML = t.innerHTML.replace(l.CHROME_MEDIA_ERROR, '<span class="chrome-media-icon"></span>')),
            e.indexOf(l.FIREFOX_LOCK) > -1 && (t.innerHTML = t.innerHTML.replace(l.FIREFOX_LOCK, '<span class="firefox-lock-icon"></span>')),
            e.indexOf(l.OPERA_MEDIA) > -1 && (t.innerHTML = t.innerHTML.replace(l.OPERA_MEDIA, '<span class="opera-media-icon"></span>'))
        },
        getDescription: function() {
            var e = this.props.desc + "_" + s.browser;
            return this.props.browserPrefixDesc && l10n.hasT(e) ? l10n.t(e) : l10n.t(this.props.desc)
        },
        render: function() {
            var e = "popup-guide";
            if (s.browser === i.BROWSER_TYPE.CHROME)
                switch (s.os) {
                case i.OS_TYPE.MAC:
                    e += " popup-guide-mac";
                    break;
                case i.OS_TYPE.CHROMEOS:
                    e += " popup-guide-chrome";
                    break;
                case i.OS_TYPE.WINDOWS:
                }
            var t = null ;
            this.props.type !== c.GUIDE_NONE && s.browser === i.BROWSER_TYPE.CHROME && (t = r.createElement("div", {
                className: "round"
            }, r.createElement("div", {
                className: "round-body " + this.props.type
            })));
            var n = this.props.onCancel ? l10n.t("learn_more") : void 0;
            return r.createElement(o, {
                title: l10n.t(this.props.title),
                classes: e,
                onOK: this.props.onConfirm,
                okText: l10n.t("ok_got_it"),
                onCancel: this.props.onCancel,
                cancelText: n
            }, t, r.createElement("div", {
                className: "text text-tip",
                ref: "description"
            }, this.getDescription()))
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(9)
      , a = n(429)
      , s = r.createClass({
        displayName: "MediaMissingModal",
        propTypes: {
            msg: r.PropTypes.instanceOf(i).isRequired
        },
        render: function() {
            var e = void 0
              , t = void 0;
            switch (this.props.msg.type) {
            case i.TYPE.VIDEO:
                e = l10n.t("missing_video_title"),
                t = l10n.t("missing_video_text");
                break;
            case i.TYPE.AUDIO:
                e = l10n.t("missing_audio_title"),
                t = l10n.t("missing_audio_text");
                break;
            case i.TYPE.IMAGE:
                e = l10n.t("missing_photo_title"),
                t = l10n.t("missing_photo_text");
                break;
            case i.TYPE.DOCUMENT:
                e = l10n.t("missing_document_title"),
                t = l10n.t("missing_document_text")
            }
            return r.createElement(a, {
                title: e,
                onOK: o.closeModal.bind(o),
                okText: l10n.t("web_ok")
            }, t)
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(429)
      , o = n(986)
      , a = n(9)
      , s = r.createClass({
        displayName: "RemoteUpload",
        propTypes: {
            msg: r.PropTypes.instanceOf(o).isRequired
        },
        render: function() {
            var e, t;
            switch (this.props.msg.type) {
            case o.TYPE.IMAGE:
                e = l10n.t("retry_upload_photo_title"),
                t = l10n.t("retry_upload_photo_text");
                break;
            case o.TYPE.VIDEO:
                e = l10n.t("retry_upload_video_title"),
                t = l10n.t("retry_upload_video_text");
                break;
            case o.TYPE.AUDIO:
            case o.TYPE.PTT:
                e = l10n.t("retry_upload_audio_title"),
                t = l10n.t("retry_upload_audio_text");
                break;
            case o.TYPE.DOCUMENT:
                e = l10n.t("retry_upload_doc_title"),
                t = l10n.t("retry_upload_doc_text");
                break;
            default:
                e = l10n.t("retry_upload_media_title"),
                t = l10n.t("retry_upload_media_text")
            }
            return r.createElement(i, {
                title: e,
                onOK: a.closeModal.bind(a),
                okText: l10n.t("web_ok")
            }, t)
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(430)
      , i = n(986)
      , o = n(82)
      , a = o.extend({
        props: {
            noEarlierMsgs: "boolean",
            isLoadingEarlierMsgs: "boolean",
            isLoadingRecentMsgs: "boolean",
            isLoadingAroundMsgs: "boolean",
            contextLoaded: "boolean"
        }
    })
      , s = r.extend({
        model: i,
        initialize: function() {
            r.prototype.initialize.call(this),
            this.msgLoadState = new a({
                noEarlierMsgs: !1,
                isLoadingEarlierMsgs: !1,
                isLoadingRecentMsgs: !1,
                isLoadingAroundMsgs: !1,
                contextLoaded: !1
            })
        },
        add: function() {
            var e = this
              , t = r.prototype.add.apply(this, arguments)
              , n = Store.Msg.add(t, arguments[1]);
            return _.isArray(n) ? n.forEach(function(t) {
                e.isModel(t) && (t.msgChunk = e)
            }) : this.isModel(n) && (n.msgChunk = this),
            this.trigger("bulk_add", t, arguments[1]),
            t
        },
        replace: function(e) {
            var t = this;
            this.msgLoadState = e.msgLoadState,
            this.loadRecentPromise = e.loadRecentPromise,
            this.loadEarlierPromise = e.loadEarlierPromise,
            this.loadAroundPromise = e.loadAroundPromise,
            this.set(e.models, {
                silent: !0,
                merge: !1
            }),
            e.models.forEach(function(e) {
                t.isModel(e) && (e.msgChunk = t)
            }),
            this.trigger("bulk_add", e.models)
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(989)
      , o = n(136)
      , a = n(987)
      , s = n(893)
      , c = n(102)
      , l = n(43)
      , u = r.createClass({
        displayName: "Cell",
        mixins: [a, s],
        propTypes: {
            id: r.PropTypes.string.isRequired,
            contextEnabled: r.PropTypes.func.isRequired,
            pendingAction: r.PropTypes.number,
            contextMenu: r.PropTypes.bool,
            className: r.PropTypes.string,
            style: r.PropTypes.object,
            image: r.PropTypes.node,
            detail: r.PropTypes.node,
            primary: r.PropTypes.string,
            searchText: r.PropTypes.string,
            primaryDetail: r.PropTypes.node,
            secondary: r.PropTypes.node,
            secondaryDetail: r.PropTypes.node,
            isPSA: r.PropTypes.bool,
            onClick: r.PropTypes.func,
            onContext: r.PropTypes.func,
            onMouseDown: r.PropTypes.func
        },
        getInitialState: function() {
            return {
                hover: !1,
                contextMenu: !1
            }
        },
        componentWillUpdate: function(e) {
            this.props.contextMenu && this.state.contextMenu && !e.contextMenu && this.setState({
                contextMenu: !1
            })
        },
        onMenuClick: function(e) {
            this.props.contextEnabled() && (e.stopPropagation(),
            e.preventDefault(),
            this.props.onContext({
                anchor: e.target
            }))
        },
        onMenuMouseDown: function(e) {
            e.stopPropagation()
        },
        onContextMenu: function(e) {
            this.props.contextEnabled() && (e.stopPropagation(),
            e.preventDefault(),
            this.props.onContext({
                event: e
            }))
        },
        openContextMenu: function() {
            var e = this;
            this.props.contextEnabled() && this.setState({
                contextMenu: !0
            }, function() {
                e.refs.context.click()
            })
        },
        mouseOver: function() {
            this.state.hover || this.props.contextMenu || !this.props.contextEnabled() || this.setState({
                hover: !0
            })
        },
        mouseEnter: function() {
            this.state.hover || this.props.contextMenu || !this.props.contextEnabled() || this.setState({
                hover: !0
            })
        },
        mouseLeave: function() {
            this.state.hover && this.setState({
                hover: !1
            })
        },
        render: function() {
            var e = this.props.contextMenu || this.state.contextMenu
              , t = e || this.state.hover
              , n = l(this.props.className, {
                chat: !0,
                hover: t
            })
              , a = null
              , s = null ;
            this.props.pendingAction ? s = r.createElement("div", {
                className: "btn-context icon-spinner"
            }, r.createElement(o, {
                size: 18,
                stroke: 6
            })) : t && (a = r.createElement("span", {
                className: "icon icon-down btn-context",
                key: "icon-context",
                ref: "context",
                onMouseDown: this.onMenuMouseDown,
                onClick: this.onMenuClick
            }));
            var u = this.props.detail ? r.createElement("div", {
                className: "chat-body chat-detail"
            }, this.props.detail) : null
              , d = null
              , p = "chat-title";
            this.props.isPSA && (d = r.createElement("span", {
                className: "icon-psa-verified"
            }),
            p += " chat-title-psa");
            var h = this.props.primary ? r.createElement("div", {
                className: p
            }, r.createElement(i, {
                text: this.props.primary,
                direction: "auto",
                highlight: this.props.searchText ? [this.props.searchText] : null ,
                titlify: !0,
                ellipsify: !0
            }), d) : null ;
            return r.createElement("div", {
                className: n,
                style: this.props.style,
                onClick: this.props.onClick,
                onMouseDown: this.props.onMouseDown,
                onContextMenu: this.props.contextEnabled() ? this.onContextMenu : null ,
                onMouseEnter: this.state.hover ? null : this.mouseEnter,
                onMouseOver: this.state.hover ? null : this.mouseOver,
                onMouseLeave: this.state.hover ? this.mouseLeave : null
            }, this.props.image, r.createElement("div", {
                className: "chat-body"
            }, r.createElement("div", {
                className: "chat-main"
            }, h, this.props.primaryDetail), r.createElement("div", {
                className: "chat-secondary"
            }, this.props.secondary, r.createElement("div", {
                className: "chat-meta"
            }, this.props.secondaryDetail, r.createElement(c, {
                transitionName: "pop"
            }, s), r.createElement(c, {
                transitionName: "pop-fast-chat"
            }, t ? a : null )))), u)
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(988)
      , a = n(1018)
      , s = n(994)
      , c = n(1079)
      , l = n(1143)
      , u = n(1075)
      , d = n(1148)
      , p = n(1072)
      , h = n(1128)
      , f = n(1076)
      , m = n(1086)
      , g = n(1132)
      , v = n(987)
      , y = n(133)
      , E = n(10)
      , b = n(9)
      , S = n(43)
      , M = n(1024)
      , C = n(1111)
      , T = n(14)
      , w = n(1012)
      , k = n(209)
      , x = n(139)
      , N = n(135)
      , P = N.HotKeys
      , D = {
        LAST: "last",
        INFO: "info"
    }
      , O = r.createClass({
        displayName: "Chat",
        mixins: [v, y],
        propTypes: {
            chat: r.PropTypes.instanceOf(o).isRequired,
            mode: r.PropTypes.oneOf(_.values(D)).isRequired,
            secondary: r.PropTypes.element,
            searchText: r.PropTypes.string,
            noContext: r.PropTypes.bool,
            mouseDownAsClick: r.PropTypes.bool,
            onClick: r.PropTypes.func,
            active: r.PropTypes.object
        },
        statics: {
            Mode: D
        },
        getDefaultProps: function() {
            return {
                mode: D.LAST
            }
        },
        getInitialState: function() {
            this.hoverCounter = 0;
            var e = this.props.chat
              , t = this.props.active;
            return {
                formattedTitle: this.async("chat.formattedTitle"),
                hasUnread: this.async("chat.hasUnread"),
                isReadOnly: this.async("chat.isReadOnly"),
                pendingAction: this.async("chat.pendingAction"),
                active: !!t && t.value === e,
                contextMenu: !1
            }
        },
        componentDidMount: function() {
            this.props.active && this.addObserver(this.props.active, this.props.chat.id.toString(), this.onActiveChange)
        },
        onActiveChange: function(e, t) {
            if ("focus" === e) {
                var n = i.findDOMNode(this);
                x.focus(n),
                t && M.scrollIntoViewIfNeeded(n)
            }
            this.setState({
                active: !!e
            })
        },
        contextEnabled: function() {
            var e = this.props
              , t = e.chat
              , n = e.noContext;
            return !n && (t.mute.canMute() || t.canArchive() || t.canDelete() || t.canExit())
        },
        onMenu: function(e) {
            if (this.state.contextMenu)
                return void this.setState({
                    contextMenu: !1
                });
            var t = this.props.chat
              , n = [];
            t.canArchive() && n.push(r.createElement(l, {
                key: "archive",
                onArchive: this.onArchive,
                chat: t
            })),
            t.mute.canMute() && n.push(r.createElement(c, {
                key: "mute",
                onMute: this.onMute,
                chat: t
            })),
            t.canDelete() && n.push(r.createElement(u, {
                key: "delete",
                onDeleteOrExit: this.onDeleteOrExit,
                chat: t
            })),
            t.canMarkUnseen() && n.push(r.createElement(d, {
                key: "mark_unread",
                onMarkUnread: this.onMarkUnread,
                chat: t
            })),
            e.event && e.event.persist(),
            this.setState({
                contextMenu: {
                    menu: n,
                    event: e.event,
                    anchor: e.anchor
                }
            })
        },
        removeContext: function() {
            this.setState({
                contextMenu: !1
            })
        },
        onMute: function(e) {
            b.muteChat(this.props.chat, e, this)
        },
        onArchive: function(e) {
            b.archiveChat(this.props.chat, e)
        },
        onDeleteOrExit: function() {
            b.deleteOrExitChat(this.props.chat, this)
        },
        onMarkUnread: function(e) {
            b.markChatUnread(this.props.chat, e)
        },
        onClick: function(e) {
            _.isFunction(this.props.onClick) && this.props.onClick(e, this.props.chat)
        },
        onMouseDown: function(e) {
            0 === e.button && this.onClick(e)
        },
        onEnter: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            P.flashFocus = Date.now(),
            this.onClick(e)
        },
        onDragEnter: function(e) {
            if (this.props.chat.canSend) {
                var t = e.dataTransfer;
                _.includes(t.types, E.DRAG_TYPE_FILE) && (0 === this.hoverCounter && this.setState({
                    dragging: !0
                }),
                this.hoverCounter += 1)
            }
        },
        onDragLeave: function(e) {
            if (this.props.chat.canSend) {
                var t = e.dataTransfer;
                _.includes(t.types, E.DRAG_TYPE_FILE) && (this.hoverCounter -= 1,
                0 === this.hoverCounter && this.setState({
                    dragging: !1
                }))
            }
        },
        onDrop: function(e) {
            var t = this;
            if (this.props.chat.canSend) {
                this.setState({
                    dragging: !1
                });
                var n = e.dataTransfer;
                (_.includes(n.types, E.DRAG_TYPE_FILE) || _.includes(n.types, "text/uri-list") || _.includes(n.types, "text/html")) && C.getFiles(e, 0).then(function(e) {
                    b.openChat(t.props.chat, void 0, !1),
                    b.attachMediaDrawer(t.props.chat, e)
                })["catch"](T.MediaDragDropError, function(e) {
                    b.openChat(t.props.chat, void 0, !1),
                    b.pasteChatTextInput(t.props.chat, e.src)
                })
            }
        },
        indicateFocus: function(e) {
            if (!(Date.now() - (P.flashFocus || 0) > 200)) {
                var t = i.findDOMNode(this.refs.cell);
                Velocity(t, "stop"),
                Velocity(t, {
                    backgroundColor: ["#e9eaeb", "#cbdde7"]
                }, {
                    duration: 1300,
                    easing: [.19, .69, .01, .99],
                    complete: this.onBlur
                })
            }
        },
        onBlur: function(e) {
            var t = i.findDOMNode(this.refs.cell);
            t && (Velocity(t, "stop"),
            t.style.backgroundColor = "")
        },
        render: function() {
            var e = this
              , t = this.props
              , n = t.chat
              , i = t.mode
              , o = t.secondary
              , c = t.className;
            c = S(c, {
                unread: this.state.hasUnread,
                active: !!this.state.active,
                "chat-drag": this.state.dragging
            });
            var l = void 0
              , u = void 0
              , d = void 0;
            switch (i) {
            case D.LAST:
                l = r.createElement(p, {
                    chat: n
                }),
                o || (o = r.createElement(h, {
                    chat: n
                }),
                u = r.createElement(g, {
                    chat: n
                })),
                d = {
                    enter: this.onEnter
                },
                d[l10n.LR("right", "left")] = function() {
                    return e.refs.cell.openContextMenu()
                }
                ;
                break;
            case D.INFO:
                o || (o = n.isGroup ? r.createElement(f, {
                    presence: n.presence,
                    groupMetadata: n.groupMetadata,
                    location: "list"
                }) : r.createElement(m, {
                    presence: n.presence,
                    location: "list"
                })),
                d = {
                    enter: this.onEnter
                }
            }
            var v = r.createElement("div", {
                className: "chat-avatar"
            }, r.createElement(s, {
                id: n.id,
                size: s.Size.NONE
            }))
              , y = this.props.mouseDownAsClick
              , _ = void 0;
            return this.state.contextMenu && (_ = r.createElement(k, {
                displayName: "ChatContextMenu",
                escapable: !0,
                popable: !0,
                requestDismiss: this.removeContext
            }, r.createElement(w, {
                contextMenu: this.state.contextMenu
            }))),
            r.createElement(P, {
                handlers: d,
                onFocus: this.indicateFocus,
                onBlur: this.onBlur,
                className: "chat-drag-cover",
                onDragEnter: this.onDragEnter,
                onDragLeave: this.onDragLeave,
                onDrop: this.onDrop
            }, r.createElement(a, {
                id: n.id,
                ref: "cell",
                className: c,
                contextEnabled: this.contextEnabled,
                pendingAction: this.state.pendingAction,
                contextMenu: !!this.state.contextMenu,
                image: v,
                primary: n.title(),
                searchText: this.props.searchText,
                primaryDetail: l,
                secondary: o,
                secondaryDetail: u,
                isPSA: n.isPSA,
                onClick: y ? null : this.onClick,
                onMouseDown: y ? this.onMouseDown : null ,
                onContext: this.onMenu
            }), _)
        }
    });
    e.exports = O
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(37)
      , c = n(138)
      , l = n(136)
      , u = n(209)
      , d = n(139)
      , p = n(102)
      , h = a.createClass({
        displayName: "ListSearch",
        mixins: [c],
        propTypes: {
            onSearch: a.PropTypes.func.isRequired,
            placeholder: a.PropTypes.string,
            searching: a.PropTypes.bool,
            spellCheck: a.PropTypes.bool
        },
        getDefaultProps: function() {
            return {
                spellCheck: !1
            }
        },
        getInitialState: function() {
            return {
                searchText: "",
                isSearching: !1
            }
        },
        componentWillUnmount: function() {
            this.onCancel()
        },
        componentWillReceiveProps: function(e) {
            this.state.isSearching && !this.state.searchText && (s.findDOMNode(this).contains(document.activeElement) || this.onCancel())
        },
        onBlur: o["default"].wrap(function() {
            this.state.searchText || this.onCancel()
        }),
        onChange: function(e) {
            var t = this
              , n = e.target.value;
            this.setState({
                searchText: n
            }, function() {
                t.props.onSearch(n)
            })
        },
        onCancel: function() {
            this.refs.input.blur(),
            this.setState({
                searchText: "",
                isSearching: !1
            }),
            this.props.onSearch("")
        },
        onReset: function(e) {
            e.stopPropagation(),
            this.focus(),
            this.setState({
                searchText: ""
            }),
            this.props.onSearch("")
        },
        onSearchOn: function(e) {
            this.setState({
                isSearching: !0
            }),
            this.safeDefer(this.focus)
        },
        focus: function() {
            d.focus(this.refs.input)
        },
        isAtBeginning: function() {
            var e = this.refs.input;
            return 0 === e.selectionStart && 0 === e.selectionEnd
        },
        isAtEnd: function() {
            var e = this.refs.input
              , t = e.value.length;
            return e.selectionStart === t && e.selectionEnd === t
        },
        render: function() {
            var e = "pane-subheader pane-list-subheader subheader-search";
            this.state.isSearching && (e += " active");
            var t = null ;
            this.state.isSearching && (this.props.searching ? t = a.createElement("button", {
                className: "btn-context icon-spinner icon-x-alt",
                key: "icon-clear-search",
                onClick: this.onReset
            }, a.createElement(l, {
                size: 20,
                stroke: 5
            })) : _.size(this.state.searchText) && (t = a.createElement("button", {
                className: "icon icon-x-alt",
                key: "icon-clear-search",
                onClick: this.onReset
            })));
            var n = void 0;
            this.state.isSearching && (n = a.createElement(u, {
                displayName: "ListSearch",
                escapable: !0,
                requestDismiss: this.onCancel,
                requestFocus: this.focus
            }));
            var r = this.props.placeholder || l10n.t("search_or_start_new_chat")
              , i = this.state.isSearching ? this.onCancel : this.onSearchOn;
            return a.createElement("div", {
                className: e
            }, a.createElement("button", {
                className: "icon icon-search-morph",
                onMouseDown: i
            }, a.createElement("div", {
                className: "icon icon-back-blue"
            }), a.createElement("div", {
                className: "icon icon-search"
            })), a.createElement(p, {
                transitionName: "pop"
            }, t), a.createElement("div", {
                className: "input-placeholder"
            }, this.state.searchText ? null : r), a.createElement("label", {
                htmlFor: "input-chatlist-search",
                className: "cont-input-search"
            }, a.createElement("input", {
                type: "text",
                ref: "input",
                className: "input input-search",
                "data-tab": 2,
                dir: "auto",
                spellCheck: this.props.spellCheck,
                title: r,
                value: this.state.searchText,
                onBlur: this.onBlur,
                onFocus: this.state.isSearching ? null : this.onSearchOn,
                onChange: this.state.isSearching ? this.onChange : null
            })), n)
        }
    });
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(134)
      , o = n(43)
      , a = r.createClass({
        displayName: "CheckBox",
        mixins: [i],
        propTypes: {
            checked: r.PropTypes.bool.isRequired,
            onChange: r.PropTypes.func.isRequired,
            disabled: r.PropTypes.bool
        },
        onToggle: function(e) {
            e && e.stopPropagation(),
            this.props.onChange()
        },
        render: function() {
            var e = o("checkbox", {
                checked: this.props.checked,
                unchecked: !this.props.checked,
                disabled: this.props.disabled
            });
            return r.createElement("div", {
                className: "checkbox-container",
                onClick: this.onToggle
            }, r.createElement("div", {
                className: e,
                ref: "checkbox"
            }, r.createElement("div", {
                className: "checkmark"
            })))
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(52)
      , s = r(a)
      , c = n(36)
      , l = r(c)
      , u = n(44)
      , d = r(u)
      , p = n(208)
      , h = r(p)
      , f = n(207)
      , m = r(f)
      , g = n(6)
      , v = r(g)
      , y = n(31)
      , _ = r(y)
      , E = n(213)
      , b = r(E)
      , S = n(1)
      , M = r(S);
    e.exports = function(e) {
        var t, n, r;
        return n = t = function(t) {
            function n() {
                var e, t, i, o;
                (0,
                l["default"])(this, n);
                for (var a = arguments.length, c = Array(a), u = 0; u < a; u++)
                    c[u] = arguments[u];
                return t = i = (0,
                h["default"])(this, (e = (0,
                s["default"])(n)).call.apply(e, [this].concat(c))),
                r.call(i),
                o = t,
                (0,
                h["default"])(i, o)
            }
            return (0,
            m["default"])(n, t),
            (0,
            d["default"])(n, [{
                key: "componentDidMount",
                value: function() {
                    var e = this;
                    this.mounted = !0;
                    var t = this.listeners;
                    this.listeners = [],
                    t.forEach(function(t) {
                        e.addListener(t.source, t.event, t.cb, t.capture)
                    })
                }
            }, {
                key: "componentWillUnmount",
                value: function() {
                    var e = this;
                    this.mounted = !1,
                    this.listeners.forEach(function(t) {
                        e.removeListener(t.source, t.event, t.cb, t.capture)
                    }),
                    this.listeners = []
                }
            }, {
                key: "render",
                value: function() {
                    return v["default"].createElement(e, (0,
                    o["default"])({
                        addListener: this.addListener,
                        addListenerAndRun: this.addListenerAndRun,
                        removeListener: this.removeListener
                    }, this.props))
                }
            }, {
                key: "listeners",
                get: function() {
                    return this._listeners || (this._listeners = []),
                    this._listeners
                },
                set: function(e) {
                    this._listeners = e
                }
            }]),
            n
        }(g.Component),
        r = function() {
            var e = this;
            this.mounted = !1,
            this.rr = function() {
                e.setState({})
            }
            ,
            this.addListener = function(t, n) {
                var r = arguments.length <= 2 || void 0 === arguments[2] ? e.rr : arguments[2]
                  , i = arguments[3];
                if (e.listeners.push({
                    source: t,
                    event: n,
                    cb: r,
                    capture: i
                }),
                e.mounted)
                    if ("function" == typeof t.on)
                        t.on(n, r),
                        "number" == typeof t._uiObservers && t._uiObservers++;
                    else {
                        var o = b["default"].prefix(n, t);
                        t.addEventListener(o, r, i)
                    }
            }
            ,
            this.addListenerAndRun = function(t, n) {
                var r = arguments.length <= 2 || void 0 === arguments[2] ? e.rr : arguments[2]
                  , i = arguments[3];
                e.addListener(t, n, r, i),
                r()
            }
            ,
            this.addListenerOnce = function(t, n) {
                var r = arguments.length <= 2 || void 0 === arguments[2] ? e.rr : arguments[2]
                  , i = arguments[3]
                  , o = function() {
                    r.apply(void 0, arguments),
                    e.removeListener(t, n, r, i)
                };
                e.addListener(t, n, o, i),
                e.listeners = _["default"].reject(e.listeners, {
                    source: t,
                    event: n,
                    wrappedCallback: o,
                    capture: i
                }),
                e.listeners.push({
                    source: t,
                    event: n,
                    cb: r,
                    capture: i
                })
            }
            ,
            this.removeListener = function(t, n) {
                var r = arguments.length <= 2 || void 0 === arguments[2] ? e.rr : arguments[2]
                  , i = arguments[3];
                if ("function" == typeof t.off)
                    t.off(n, r),
                    "number" == typeof t._uiObservers && t._uiObservers--;
                else {
                    var o = b["default"].prefix(n, t);
                    t.removeEventListener(o, r, i)
                }
                var a = _["default"].find(e.listeners, {
                    source: t,
                    event: n,
                    cb: r,
                    capture: i
                });
                a ? e.listeners = _["default"].reject(e.listeners, a) : M["default"].error("ListenerHOC:removeListener could not find event: " + n)()
            }
        }
        ,
        n
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(70)
      , i = {
        IMAGE: "image",
        VIDEO: "video",
        AUDIO: "audio",
        PTT: "ptt",
        DOCUMENT: "document",
        UNKNOWN: "unknown"
    }
      , o = {
        INIT: "media_init",
        PREPARING: "media_preparing",
        UPLOADING: "media_uploading",
        SENDING: "media_sending",
        REUPLOADING: "media_reuploading",
        FETCHING: "media_fetching",
        DECRYPTING: "media_decrypting",
        RESOLVED: "media_resolved",
        NEED_POKE: "media_need_poke",
        NEED_UPLOAD: "media_need_upload",
        ERROR_MISSING: "media_error_missing",
        ERROR_UNSUPPORTED: "media_error_unsupported",
        REMOTE_UPLOADING: "media_remote_uploading",
        REMOTE_NEED_UPLOAD: "media_remote_need_upload"
    }
      , a = r.extend({
        extraProperties: "reject",
        type: {
            type: "string",
            values: _.values(i),
            "default": i.UNKNOWN
        },
        props: {
            mmsUrl: "string",
            mediaBlob: "object",
            decryptionKey: "string",
            uploadHash: "string",
            mediaStage: {
                type: "string",
                values: _.values(o),
                "default": o.INIT
            },
            size: "number",
            filehash: "string",
            mimetype: "string",
            renderableUrl: "string",
            thumbHeight: "number",
            thumbWidth: "number",
            fullHeight: "number",
            fullWidth: "number",
            preview: "string",
            sidecar: "array",
            duration: "string",
            isGif: "boolean",
            gifAttribution: "number",
            streamable: {
                type: "boolean",
                "default": !1
            },
            filename: "string",
            pageCount: "number"
        }
    });
    a.TYPE = i,
    a.STAGE = o,
    e.exports = a
}
, function(e, t) {
    "use strict";
    var n = {
        scrollIntoViewIfNeeded: function(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] || arguments[1]
              , n = arguments[2];
            if (_.isFunction(e.scrollIntoViewIfNeeded))
                return e.scrollIntoViewIfNeeded(t);
            n = n || e.parentNode;
            var r = window.getComputedStyle(n, null )
              , i = parseInt(r.getPropertyValue("border-top-width"))
              , o = e.offsetTop - n.offsetTop < n.scrollTop
              , a = e.offsetTop - n.offsetTop + e.clientHeight - i > n.scrollTop + n.clientHeight
              , s = o && !a;
            return (o || a) && t && (n.scrollTop = e.offsetTop - n.offsetTop - n.clientHeight / 2 - i + e.clientHeight / 2),
            !o && !a || t || e.scrollIntoView(s),
            !(o || a)
        },
        scrollIntoView: function(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] || arguments[1]
              , n = arguments[2];
            n = n || e.parentNode;
            var r = window.getComputedStyle(n, null )
              , i = parseInt(r.getPropertyValue("border-top-width"))
              , o = e.offsetTop - n.offsetTop < n.scrollTop
              , a = e.offsetTop - n.offsetTop + e.clientHeight - i > n.scrollTop + n.clientHeight
              , s = o && !a;
            return t ? n.scrollTop = e.offsetTop - n.offsetTop - n.clientHeight / 2 - i + e.clientHeight / 2 : e.scrollIntoView(s),
            !(o || a)
        }
    };
    e.exports = n
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t, n, r) {
        this.type = e,
        this.index = t,
        this.value = r,
        this.properties = n
    }
    function o(e, t, n) {
        e[t] || (e[t] = []),
        e[t].push(n)
    }
    function a(e) {
        var t = {};
        return e ? (e.split(";").forEach(function(e) {
            var n = e.split(/=/);
            if (1 === n.length) {
                var r = n[0];
                o(t, r.toLowerCase(), !0)
            } else if (2 === n.length) {
                var i = (0,
                u["default"])(n, 2)
                  , a = i[0]
                  , s = i[1];
                o(t, a.toLowerCase(), s.toLowerCase())
            }
        }),
        t) : t
    }
    function s(e) {
        if (e)
            return e.replace(/^_\$!<([^>]*)>!\$_$/, "$1").replace(/\\,/, ",").replace(/\\;/, ";").replace(/\\\\/, "\\")
    }
    function c(e) {
        var t = {};
        return _.forEach(e, function(e, n) {
            t[n] = _.sortBy(e, function(e) {
                return e.index
            })
        }),
        t
    }
    var l = n(433)
      , u = r(l)
      , d = n(0)
      , p = n(23)
      , h = /X-([^;:]+)(?:;[^:]+)*:(.+)/
      , f = {
        "X-ABLabel": [/X-ABLabel(?:;([^:]+))*:(.+)/, 1],
        ADR: [/ADR(?:;([^:]+))*:;;(.*);(.*);(.*);(.*);(.*)/, 5],
        "X-ABADR": [/X-ABADR(?:;([^:]+))*:(.*)/, 1],
        URL: [/URL(?:;([^:]+))*:(.*)/, 1],
        EMAIL: [/EMAIL(?:;([^:]+))*:(.+)/, 1],
        TEL: [/TEL(?:;([^:]+))*:(.+)/, 1]
    }
      , m = {
        N: [/N(?:;([^:]+))*:([^;]*);([^;]*);([^;]*);([^;]*);(.*)/, 5],
        FN: [/FN(?:;([^:]+))*:(.*)/, 1],
        NICKNAME: [/NICKNAME(?:;([^:]+))*:(.*)/, 1],
        "X-PHONETIC-FIRST-NAME": [/X-PHONETIC-FIRST-NAME(?:;([^:]+))*:(.*)/, 1],
        "X-PHONETIC-LAST-NAME": [/X-PHONETIC-LAST-NAME(?:;([^:]+))*:(.*)/, 1],
        ORG: [/ORG(?:;([^:]+))*:([^;]*)(?:;(.*))*/, 2],
        TITLE: [/TITLE(?:;([^:]+))*:(.*)/, 1],
        TEL: [/TEL(?:;([^:]+))*:(.*)/, 1],
        PHOTO: [/PHOTO(?:;([^:]+))*:(.*)/, 1],
        BDAY: [/BDAY(?:;([^:]+))*:(.*)/, 1],
        URL: [/URL(?:;([^:]+))*:(.+)/, 1],
        EMAIL: [/EMAIL(?:;([^:]+))*:(.+)/, 1]
    }
      , g = {
        getDate: function(e) {
            var t = [/-([^-]*)-([^-]*)-([^-]*)/, /([^-]*)-([^-]*)-([^-]*)/]
              , n = e;
            return _.forEach(t, function(t) {
                var r = e.match(t);
                if (r) {
                    var i = !r[1].length || "1604" === r[1]
                      , o = i ? "0000" : r[1];
                    return n = d(o + "-" + r[2] + "-" + r[3]).format("l"),
                    i && (n = n.replace(/[.,-\/\s]*0000[.,-\/\s]*/, "")),
                    !1
                }
            }),
            n
        },
        getType: function(e) {
            var t = {
                jabber: l10n.t("vcard_jabber"),
                "skype-username": l10n.t("vcard_skype"),
                skype: l10n.t("vcard_skype"),
                msn: l10n.t("vcard_msn"),
                aim: l10n.t("vcard_aim"),
                yahoo: l10n.t("vcard_yahoo"),
                icq: l10n.t("vcard_icq")
            }
              , n = e.properties["X-ABLabel"] || t[e.type.toLowerCase()];
            if (n)
                return s(n);
            var r = {
                TEL: [[["cell"], l10n.t("vcard_cell")], [["iphone"], l10n.t("vcard_iphone")], [["main"], l10n.t("vcard_main")], [["home", "fax"], l10n.t("vcard_home_fax")], [["work", "fax"], l10n.t("vcard_work_fax")], [["home"], l10n.t("vcard_home")], [["work"], l10n.t("vcard_work")], [["pager"], l10n.t("vcard_pager")], [[], l10n.t("vcard_home")]],
                EMAIL: [[["home"], l10n.t("vcard_home")], [["work"], l10n.t("vcard_work")], [["internet"], l10n.t("vcard_email")]],
                URL: [[["home"], l10n.t("vcard_home")], [["work"], l10n.t("vcard_work")]],
                ADR: [[["home"], l10n.t("vcard_home")], [["work"], l10n.t("vcard_work")]]
            };
            return n = e.type,
            _.forEach(r[e.type], function(t) {
                if (t) {
                    var r = (0,
                    u["default"])(t, 2)
                      , i = r[0]
                      , o = r[1];
                    if (0 === _.difference(i, _.map(e.properties.type, function(e) {
                        return e.toLowerCase()
                    })).length)
                        return n = o,
                        !1
                }
            }),
            n
        },
        vcardWAids: function(e) {
            var t = [];
            return e && e.TEL && _.forEach(e.TEL, function(e) {
                e.properties && e.properties.waid && e.properties.waid.length > 0 && (t = t.concat(_.map(e.properties.waid, p.numberToWid)))
            }),
            t
        },
        parse: function(e) {
            e = e.replace(/\n^[ \t]/gm, "").trim();
            var t = e.split(/\n/)
              , n = {}
              , r = {};
            if ("BEGIN:VCARD" === t[0].trim() && "VERSION:3.0" === t[1].trim() && "END:VCARD" === _.last(t).trim()) {
                for (var s = 2; s < t.length - 1; s++) {
                    var l = t[s]
                      , d = l.match(/item(\d+)\.(.*)/)
                      , p = d ? d[2] : l
                      , g = p.match(/([^:;]*)[:;].*/)[1]
                      , v = d ? f : m
                      , y = g
                      , E = g
                      , b = void 0
                      , S = void 0;
                    if (v[y]) {
                        var M = (0,
                        u["default"])(v[y], 2)
                          , C = M[0]
                          , T = M[1]
                          , w = p.match(C);
                        w && (b = a(w[1]),
                        S = 1 === T ? S = w[2] : w.slice(2, 2 + T))
                    } else {
                        var k = p.match(h);
                        k && (E = "SERVICE",
                        y = k[1],
                        S = k[2],
                        b = {})
                    }
                    if (S)
                        if (d) {
                            var x = d[1];
                            r[x] ? r[x].fields.push(new i(y,null ,b,S)) : r[x] = {
                                type: y,
                                index: s,
                                key: E,
                                properties: b,
                                value: S,
                                fields: []
                            }
                        } else
                            o(n, E, new i(y,s,b,S))
                }
                return _.forEach(_.keys(r), function(e) {
                    var t = r[e]
                      , a = t.key
                      , s = t.index
                      , c = t.type
                      , l = t.value
                      , u = t.properties
                      , d = t.fields;
                    _.forEach(d, function(e) {
                        u[e.type] = e.value
                    }),
                    o(n, a, new i(c,s,u,l))
                }),
                c(n)
            }
        },
        vCardSerialize: function(e) {
            return e.map(function(e) {
                return e.line.replace(/(.{75,75})/g, "$1\n ").replace(/\n^-$/gm, "")
            }).join("\n")
        },
        thumbnail: function(e) {
            if (e) {
                e = e.replace(/\n^ /gm, "");
                var t = e.match(/^PHOTO;(BASE64|ENCODING=b;TYPE=image\/jpeg):(.*)$/m);
                return t ? t[2] : void 0
            }
        },
        getName: function(e) {
            var t = _.filter(e.formattedName.split(e.formattedShortName))
              , n = t.length ? _.trim(t[0]) : void 0
              , r = n ? e.formattedShortName : e.formattedName;
            return this.cleanValue(n) + ";" + this.cleanValue(r) + ";;;"
        },
        cleanValue: function(e) {
            return e ? e.replace(/\\/g, "\\\\").replace(/;/g, "\\;").replace(/,/g, "\\,") : ""
        }
    };
    e.exports = g
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = n(10)
      , g = n(1022)
      , v = n(31)
      , y = n(43)
      , _ = (n(988),
    n(986))
      , E = n(9)
      , b = n(1015)
      , S = n(1077)
      , M = n(136)
      , C = n(1078)
      , T = n(996)
      , w = n(212)
      , k = function(e) {
        function t() {
            (0,
            s["default"])(this, t);
            var e = (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments));
            return e.onScroll = function(t) {
                e.handleScroll(t.target)
            }
            ,
            e.handleScroll = v.throttle(function(t) {
                var n = e.props.chat.mediaMsgs;
                n.hasMediaBefore && t.scrollTop + m.SCROLL_FUDGE > t.scrollHeight - t.clientHeight && e.queryMedia(v.head(n.models))
            }, 100),
            e
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "componentWillMount",
            value: function() {
                this.props.chat.mediaMsgs.hasMediaBefore && this.queryMedia()
            }
        }, {
            key: "componentDidMount",
            value: function() {
                this.props.addListener(this.props.chat.mediaMsgs, "add remove reset"),
                this.props.addListener(this.props.chat.mediaMsgs, "query_media_before")
            }
        }, {
            key: "queryMedia",
            value: function(e) {
                var t = this.props.chat.mediaMsgs;
                t.hasMediaBefore && t.queryMedia(this.props.chat, e)
            }
        }, {
            key: "render",
            value: function() {
                var e = this
                  , t = this.props.chat.mediaMsgs
                  , n = this.props
                  , r = n.fullCollection
                  , i = n.selectedMessages
                  , o = t.map(function(n, o) {
                    var a = null ;
                    !e.props.fullCollection && o >= t.length - 6 && o <= t.length - 4 && (a = "media-canvas-second-row");
                    var s = i && n.id in i;
                    return f.createElement(x, {
                        msg: n,
                        hoverEvent: r,
                        selectable: e.props.selectable,
                        selected: s,
                        onMessageSelect: e.props.onMessageSelect,
                        className: a,
                        key: n.id
                    })
                });
                if (o.reverse(),
                r || (o = v.slice(o, 0, 6)),
                t.queryMediaBefore && (r || o.length < 6)) {
                    var a = y("more", "media-canvas-component", {
                        "media-canvas-second-row": !r && o.length >= 3
                    });
                    o.push(f.createElement("div", {
                        className: a,
                        key: "spinner"
                    }, f.createElement(M, {
                        stroke: 6,
                        size: 24
                    })))
                }
                for (var s = 0; s < 6; s++)
                    o.push(f.createElement("div", {
                        className: "media-canvas-empty",
                        key: "empty" + s
                    }));
                if (0 === t.length) {
                    if (r)
                        return t.queryMediaBefore ? f.createElement("div", {
                            className: "drawer-media-gallery drawer-body"
                        }, f.createElement(T.Loading, null )) : f.createElement(T.MediaMsgs, null );
                    t.queryMediaBefore || (o = [],
                    o.push(f.createElement("div", {
                        className: "media-gallery-no-media",
                        key: "isolated-block"
                    }, f.createElement(S, {
                        className: "textfield-static",
                        dir: "auto"
                    }, w.t("no_media")))))
                }
                var c = y("media-gallery", {
                    "drawer-media-gallery": r
                });
                return f.createElement("div", {
                    onScroll: this.onScroll,
                    className: c
                }, o)
            }
        }]),
        t
    }(f.Component)
      , x = function(e) {
        function t() {
            (0,
            s["default"])(this, t);
            var e = (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments));
            return e.onClick = function(t) {
                var n = e.props
                  , r = n.msg
                  , i = n.selectable
                  , o = n.selected
                  , a = n.onMessageSelect;
                if (i && a)
                    return void a(r, !o);
                if (r.mediaState === _.MEDIA_STATE.ERROR_MISSING)
                    return void E.openModal(f.createElement(b, {
                        msg: r
                    }));
                t && t.stopPropagation();
                var s = void 0
                  , c = r.id;
                r.type === _.TYPE.IMAGE && (s = function(t) {
                    return e.refs && e.refs.canvas && c.equals(t) ? e.refs.canvas.refs.img : null
                }
                ),
                E.mediaViewerModal(r, s)
            }
            ,
            e.onDragStart = function(t) {
                t.nativeEvent.dataTransfer.setData(m.DRAG_TYPE_LOCAL_IMAGE, !0),
                t.nativeEvent.dataTransfer.setData("text/uri-list", e.props.msg.url)
            }
            ,
            e
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "render",
            value: function() {
                var e = this.props.msg
                  , t = e.type === _.TYPE.IMAGE && e.url ? this.onDragStart : null
                  , n = y("media-canvas-component", this.props.className);
                return f.createElement(C, {
                    classes: n,
                    onClick: this.onClick,
                    hoverEvent: this.props.hoverEvent,
                    selectable: this.props.selectable,
                    selected: this.props.selected,
                    onMessageSelect: this.props.onMessageSelect,
                    onDragStart: t,
                    msg: e,
                    ref: "canvas"
                })
            }
        }]),
        t
    }(f.Component);
    e.exports = g(k)
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1)
      , o = n(986)
      , a = n(133)
      , s = r.createClass({
        displayName: "MsgSymbol",
        mixins: [a],
        propTypes: {
            msg: r.PropTypes.instanceOf(o)
        },
        componentWillMount: function() {
            var e = this.props.msg;
            "ptt" === e.type && e.ack < 4 && this.addObserver(this.props.msg, "change:ack")
        },
        getClasses: function() {
            var e = this.props.msg;
            switch (e.type) {
            case "location":
            case "video":
            case "audio":
            case "vcard":
            case "document":
            case "ciphertext":
            case "unknown":
            case "image":
                return "icon media-icon icon-status-" + (e.isGif ? "gif" : e.type);
            case "ptt":
                var t = 4 === e.ack ? "blue" : e.isSentByMe ? "gray" : "green";
                return "icon media-icon icon-status-" + e.type + "-" + t;
            default:
                i.log("chat:getClasses Invalid msg type.")()
            }
            return ""
        },
        render: function() {
            return r.createElement("span", {
                className: this.getClasses()
            })
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1001)
      , o = n(136)
      , a = r.createClass({
        displayName: "Pending",
        render: function() {
            return r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "icon-media icon-media-disabled"
            }, r.createElement(o, {
                size: 50,
                stroke: 3
            })))
        }
    })
      , s = r.createClass({
        displayName: "PendingCancel",
        render: function() {
            return r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "icon-xl icon-media-cancel"
            }, r.createElement(o, {
                size: 50,
                stroke: 3
            })))
        }
    })
      , c = r.createClass({
        displayName: "Cancel",
        render: function() {
            return r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "icon-xl icon-media-download"
            }))
        }
    })
      , l = r.createClass({
        displayName: "Download",
        propTypes: {
            filesize: r.PropTypes.number.isRequired,
            onClick: r.PropTypes.func
        },
        render: function() {
            var e = this.props.onClick || null ;
            return this.props.filesize > 0 ? r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "btn-meta",
                onClick: e
            }, r.createElement("span", {
                className: "icon-xl icon-media-download-noborder"
            }), r.createElement(i, null , l10n.filesize(this.props.filesize)))) : r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "icon-xl icon-media-download",
                onClick: e
            }))
        }
    })
      , u = r.createClass({
        displayName: "Upload",
        propTypes: {
            filesize: r.PropTypes.number.isRequired
        },
        render: function() {
            return this.props.filesize > 0 ? r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "btn-meta"
            }, r.createElement("span", {
                className: "icon-xl icon-media-upload-noborder"
            }), r.createElement(i, null , l10n.filesize(this.props.filesize)))) : r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "icon-xl icon-media-upload"
            }))
        }
    })
      , d = r.createClass({
        displayName: "Play",
        render: function() {
            return r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "icon-xl icon-media-play"
            }))
        }
    })
      , p = r.createClass({
        displayName: "Missing",
        render: function() {
            var e;
            switch (this.props.msg.type) {
            case "image":
                e = l10n.t("missing_photo_title");
                break;
            case "video":
                e = l10n.t("missing_video_title");
                break;
            case "audio":
                e = l10n.t("missing_audio_title")
            }
            return r.createElement("div", {
                className: "media-state-controls"
            }, r.createElement("button", {
                className: "btn-meta missing-text"
            }, e))
        }
    });
    e.exports = {
        Pending: a,
        Cancel: c,
        PendingCancel: s,
        Download: l,
        Upload: u,
        Play: d,
        Missing: p
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(102)
      , o = n(434)
      , a = n(43)
      , s = n(209)
      , c = r.createClass({
        displayName: "MenuBar",
        propTypes: {
            children: r.PropTypes.node
        },
        render: function() {
            return r.createElement("div", {
                className: "menu menu-horizontal"
            }, this.props.children)
        }
    })
      , l = r.createClass({
        displayName: "MenuBarItem",
        propTypes: {
            icon: r.PropTypes.string.isRequired,
            title: r.PropTypes.string.isRequired,
            children: r.PropTypes.node,
            transitionName: r.PropTypes.string,
            onClick: r.PropTypes.func,
            a8n: r.PropTypes.string.isRequired
        },
        getDefaultProps: function() {
            return {
                transitionName: "dropdown"
            }
        },
        getInitialState: function() {
            return {
                active: !1
            }
        },
        onOpen: function(e) {
            this.setState({
                active: !0
            })
        },
        onClose: function(e) {
            this.setState({
                active: !1
            })
        },
        clickHandler: function(e) {
            this.props.onClick && this.props.onClick(e),
            e.isDefaultPrevented() || this.state.active || this.onOpen(e)
        },
        render: function() {
            var e = this
              , t = this.props
              , n = t.children
              , c = t.icon
              , l = t.transitionName
              , u = t.title
              , d = this.state.active
              , p = void 0;
            n && d && (p = r.createElement(s, {
                displayName: "MenuBarMenuItem",
                escapable: !0,
                popable: !0,
                requestDismiss: function() {
                    return e.onClose()
                }
            }, r.Children.only(n)));
            var h = {
                container: a("menu-item", {
                    active: d
                }),
                icon: "icon icon-" + c
            };
            return r.createElement("div", {
                "data-a8n": o.key(this.props.a8n),
                className: h.container
            }, r.createElement("button", {
                className: h.icon,
                onMouseDown: this.clickHandler,
                title: u
            }), r.createElement(i, {
                transitionName: l
            }, p))
        }
    });
    e.exports = {
        MenuBar: c,
        MenuBarItem: l
    }
}
, function(e, t) {
    "use strict";
    e.exports = function(e, t) {
        for (var n = e.childNodes, r = 0; r < n.length; ++r)
            if (n[r] === t)
                return r;
        return -1
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(1047)
      , i = r({
        FORWARD: void 0,
        BACKWARD: void 0
    });
    e.exports = function(e, t) {
        var n = window.getSelection();
        if (!n || !n.rangeCount)
            return null ;
        var r = n.getRangeAt(0);
        if (!r.collapsed)
            return null ;
        var o = r.startContainer
          , a = r.startOffset;
        if (o === e) {
            var s = o.childNodes
              , c = s.length;
            if (t === i.FORWARD && a > c || t === i.BACKWARD && !a)
                return null ;
            var l = t === i.BACKWARD ? 1 : 0
              , u = s[a - l];
            return u instanceof Element ? u : null
        }
        var d = o.length === a;
        if (t === i.BACKWARD && a)
            return null ;
        if (t === i.FORWARD && !d)
            return null ;
        var p = t === i.BACKWARD ? "previousSibling" : "nextSibling"
          , h = o[p];
        return h instanceof Element ? h : null
    }
    ,
    e.exports.Direction = i
}
, function(e, t) {
    "use strict";
    e.exports = function(e) {
        return !e.getModifierState("Shift") && !e.getModifierState("Alt") && !e.getModifierState("Control")
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = r.createClass({
        displayName: "SectionHeader",
        propTypes: {
            header: r.PropTypes.string.isRequired
        },
        render: function() {
            return r.createElement("div", {
                className: "list-title"
            }, this.props.header)
        }
    });
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(6)
      , s = n(37)
      , c = n(1)
      , l = n(987)
      , u = n(133)
      , d = n(992)
      , p = n(986)
      , h = n(9)
      , f = n(81)
      , m = n(429)
      , g = n(989)
      , v = n(1035)
      , y = n(995)
      , E = n(1016)
      , b = n(1021)
      , S = n(1176)
      , M = n(1181)
      , C = n(1095)
      , T = n(1180)
      , w = n(1039)
      , k = new (n(1042))
      , x = n(1012)
      , N = n(209)
      , P = n(897)
      , D = n(43)
      , O = n(101)
      , A = n(10)
      , R = n(102)
      , I = p.MEDIA_STATE
      , L = {
        FRONT: "front",
        MID: "mid",
        END: "end",
        SINGLE: "single"
    }
      , F = a.createClass({
        displayName: "Wrapper",
        mixins: [u, l, f, d],
        propTypes: {
            msg: a.PropTypes.instanceOf(p).isRequired,
            position: a.PropTypes.oneOf(_.values(L)),
            displayType: a.PropTypes.oneOf(_.values(A.DISP_TYPE)),
            isMsgVisible: a.PropTypes.func,
            hideMsgInfo: a.PropTypes.bool,
            selectable: a.PropTypes.bool,
            selected: a.PropTypes.bool,
            current: a.PropTypes.bool,
            onMessageSelect: a.PropTypes.func,
            tailOverride: a.PropTypes.oneOf(["left", "right"]),
            isFocusedMsg: a.PropTypes.bool,
            highlight: a.PropTypes.bool,
            didRenderFocusedMsg: a.PropTypes.func
        },
        getDefaultProps: function() {
            return {
                displayType: A.DISP_TYPE.CONVERSATION
            }
        },
        getInitialState: function() {
            return {
                contextMenu: !1,
                hover: !1,
                highlighting: !1
            }
        },
        componentWillReceiveProps: function(e) {
            this.props.isFocusedMsg && !e.isFocusedMsg && this.unregCmd("focus_show_msg", this.onFocusShow),
            !this.props.isFocusedMsg && e.isFocusedMsg && this.regCmd("focus_show_msg", this.onFocusShow)
        },
        shouldComponentUpdate: function(e, t) {
            return P(this, e, t)
        },
        componentWillMount: function() {
            var e = this
              , t = this.props.msg;
            t.mayFail() && (O.supportsFeature(O.F.RESEND_ICON) || t.type === p.TYPE.PTT) && (this.addObserver(t, "change:isFailed", function() {
                return e.forceUpdate()
            }),
            this.addObserver(t, "change:mediaState", function() {
                return e.forceUpdate()
            })),
            this.props.isFocusedMsg && this.regCmd("focus_show_msg", this.onFocusShow),
            t.typeCanChange() && this.addObserver(t, "change:type", function() {
                return e.forceUpdate()
            })
        },
        componentWillUnmount: function() {
            var e = this.refs.bubble;
            e && Velocity(s.findDOMNode(e), "stop", !0)
        },
        onFocusShow: function(e) {
            this.props.msg.id === e && this.scrollIntoView(!0)
        },
        scrollIntoView: function(e) {
            if (this.props.isFocusedMsg) {
                var t = this.props.didRenderFocusedMsg
                  , n = this.props.highlight ? this.highlight : null ;
                t && this.isMounted() && t(s.findDOMNode(this), n)
            }
        },
        highlight: function() {
            var e = this.refs.highlightTail
              , t = this.refs.bubble;
            if (e && t) {
                this.setState({
                    highlighting: !0
                });
                var n = s.findDOMNode(e)
                  , r = s.findDOMNode(t)
                  , i = 250;
                Velocity(n, "stop", !0),
                Velocity(n, {
                    opacity: [1, 0]
                }, {
                    duration: i
                }),
                Velocity(n, {
                    opacity: [0, 1]
                }, {
                    duration: i,
                    delay: i
                });
                var o = this.props.msg.isSentByMe ? "#dcf8c6" : "#ffffff"
                  , a = this.props.msg.isSentByMe ? "#b3cba1" : "#cccccc";
                Velocity(r, "stop", !0),
                Velocity(r, {
                    backgroundColor: [a, o]
                }, {
                    duration: i
                }),
                Velocity(r, {
                    backgroundColor: [o, a]
                }, {
                    duration: i,
                    delay: i,
                    complete: this.onHighlightComplete
                })
            }
        },
        onHighlightComplete: function() {
            this.setState({
                highlighting: !1
            })
        },
        componentDidUpdate: function(e, t) {
            !e.isFocusedMsg && this.props.isFocusedMsg && this.scrollIntoView()
        },
        componentDidMount: function() {
            this.scrollIntoView()
        },
        resend: function() {
            var e = this.props.msg;
            return e.isMMS && !O.supportsFeature(O.F.MEDIA_RETRY) ? void h.openModal(a.createElement(E, {
                msg: e
            })) : (this.props.msg.resumeRemoteUpload(),
            void e.resend()["catch"](function(e) {
                c.log("wrapper:resend failure: " + e)()
            }))
        },
        openSingleForwardFlow: function() {
            return this._openForwardFlow(!1)
        },
        openForwardFlow: function() {
            return this._openForwardFlow(!0)
        },
        _openForwardFlow: function(e) {
            var t, n = this.props.msg;
            if (n.type === p.TYPE.CIPHERTEXT ? t = l10n.t("err_unsent_forward_text_decrypting") : n.isUnsentMedia && (t = l10n.t("err_unsent_forward_text")),
            t)
                h.openModal(a.createElement(m, {
                    title: l10n.t("err_unsent_forward_title"),
                    onOK: h.closeModal.bind(h),
                    okText: l10n.t("web_ok")
                }, t));
            else {
                if (e && this.props.displayType === A.DISP_TYPE.CONVERSATION)
                    return void this.onSelectClick();
                h.openModal(a.createElement(v, {
                    msgs: [this.props.msg]
                }), "modal-flow")
            }
        },
        openInfoDrawer: function() {
            h.msgInfoDrawer(this.props.msg)
        },
        openContactChat: function() {
            Store.Chat.find(this.props.msg.author).then(function(e) {
                h.openChat(e)
            })
        },
        mouseEnter: function() {
            !this.state.hover && this.contextEnabled() && this.setState({
                hover: !0
            })
        },
        mouseLeave: function() {
            this.state.hover && this.contextEnabled() && this.setState({
                hover: !1
            })
        },
        contextMenu: function(e) {
            e.stopPropagation()
        },
        contextEnabled: function() {
            return !this.props.msg.isNotification
        },
        removeContext: function() {
            this.setState({
                contextMenu: !1
            })
        },
        onDeleteMessage: function() {
            var e = this
              , t = function() {
                h.closeModal(),
                e.props.msg.chat.sendDeleteMsgs([e.props.msg])
            }
              , n = l10n.t("delete_message_confirmation");
            h.openModal(a.createElement(m, {
                onOK: t,
                okText: l10n.t("web_delete"),
                onCancel: h.closeModal.bind(h),
                cancelText: l10n.t("web_cancel")
            }, a.createElement(g, {
                text: n
            })))
        },
        onReplyMessage: function() {
            this.props.msg.chat.composeQuotedMsg = this.props.msg,
            h.focusChatTextInput(this.props.msg.chat)
        },
        onDownload: function() {
            w.initDownload(this.props.msg)
        },
        onStarMessage: function() {
            this.props.msg.chat.sendStarMsgs([this.props.msg], !0)
        },
        onUnstarMessage: function() {
            this.props.msg.chat.sendStarMsgs([this.props.msg], !1)
        },
        onMenu: function(e) {
            if (e.stopPropagation(),
            e.preventDefault(),
            e.isTrusted && this.state.contextMenu)
                return void this.setState({
                    contextMenu: !1
                });
            var t = this.props.msg
              , n = [];
            t.isSentByMe && O.supportsFeature(O.F.MESSAGE_INFO) && this.props.displayType !== A.DISP_TYPE.MSG_INFO && n.push(a.createElement(y, {
                key: "info",
                a8n: "mi-msg-info",
                action: this.openInfoDrawer
            }, l10n.t("message_info"))),
            t.canReply() && n.push(a.createElement(y, {
                key: "reply",
                a8n: "mi-msg-reply",
                action: this.onReplyMessage
            }, l10n.t("reply"))),
            t.url && n.push(a.createElement(y, {
                key: "download",
                a8n: "mi-msg-download",
                action: this.onDownload
            }, l10n.t("web_button_download"))),
            t.canForward() && n.push(a.createElement(y, {
                key: "forward",
                a8n: "mi-msg-forward",
                action: this.openForwardFlow
            }, l10n.t("forward_message"))),
            O.supportsFeature(O.F.STARRED) && (t.star ? n.push(a.createElement(y, {
                key: "star",
                a8n: "mi-msg-unstar",
                action: this.onUnstarMessage
            }, l10n.t("unstar_message"))) : n.push(a.createElement(y, {
                key: "star",
                a8n: "mi-msg-star",
                action: this.onStarMessage
            }, l10n.t("star_message")))),
            O.supportsFeature(O.F.MESSAGE_DELETE) && n.push(a.createElement(y, {
                key: "delete",
                a8n: "mi-msg-delete",
                action: this.onDeleteMessage
            }, l10n.t("delete_message"))),
            t.isGroupMsg && t.author && !t.isSentByMe && n.push(a.createElement(y, {
                key: "author",
                a8n: "mi-msg-author",
                action: this.openContactChat
            }, l10n.t("message_author", {
                author: t.displayName()
            }))),
            this.setState({
                contextMenu: {
                    menu: n,
                    anchor: e.target,
                    classes: "dropdown-compact"
                }
            })
        },
        contextOpen: function() {
            var e = this.refs.context;
            e && e.click()
        },
        contextClose: function() {
            this.setState({
                contextMenu: !1
            })
        },
        getMsgComponent: function() {
            var e = this.props
              , t = e.msg
              , n = e.position
              , r = e.displayType
              , i = e.isMsgVisible
              , o = r !== A.DISP_TYPE.STARRED_MSGS && !!t.quotedMsg || !(n === L.MID || n === L.END)
              , s = void 0;
            if (O.supportsFeature(O.F.REPLIES_IN)) {
                var c = t.quotedMsgObj();
                c && (s = a.createElement(C, {
                    msg: c,
                    rootMsg: t,
                    displayType: r,
                    chat: t.chat
                }))
            }
            return a.createElement(M, {
                msg: t,
                ref: "component",
                quotedMsg: s,
                displayAuthor: o,
                displayType: r,
                isMsgVisible: i
            })
        },
        onSelectClick: function() {
            this.props.onMessageSelect(this.props.msg, !this.props.selected)
        },
        onDoubleClick: function(e) {},
        render: function() {
            var e, t = this.props, n = t.msg, r = t.position, i = t.displayType, s = n.mediaState, c = i === A.DISP_TYPE.CONVERSATION;
            (this.state.hover && !this.state.highlighting || this.props.current || this.state.contextMenu) && (e = a.createElement(T, (0,
            o["default"])({}, this.props, {
                key: "icon-context",
                ref: "context",
                onClick: this.onMenu
            })));
            var l;
            n.type === p.TYPE.PTT && n.isFailed && s === I.PREPARING ? l = a.createElement(S, {
                onResend: _.noop,
                errMsg: l10n.t("ptt_failed")
            }) : O.supportsFeature(O.F.RESEND_ICON) && c && n.isFailed && s !== I.REMOTE_UPLOADING ? l = a.createElement(S, {
                onResend: this.resend,
                errMsg: l10n.t("resend_message")
            }) : !n.isUnsentMedia || s !== I.ERROR_MISSING && s !== I.ERROR_UNSUPPORTED || (l = a.createElement(S, {
                onResend: _.noop,
                errMsg: l10n.t("send_failed")
            }));
            var u = !n.isNotification && this.props.selectable ? a.createElement("div", {
                className: "msg-select",
                onClick: this.onSelectClick
            }, a.createElement(b, {
                onChange: this.onSelectClick,
                checked: this.props.selected
            })) : null
              , d = r === L.MID || r === L.END
              , h = k.match(n.body)
              , f = n.type === p.TYPE.CHAT && 1 === h.length && _.first(h)[0].length === n.body.length
              , m = "message-" + (n.isGif ? p.TYPE.IMAGE : n.type)
              , g = {
                wrapper: D("msg", {
                    "msg-continuation": r === L.FRONT || r === L.MID,
                    "msg-group": n.isGroupMsg && !d,
                    "msg-psa": i !== A.DISP_TYPE.STARRED_MSGS && n.chat.isPSA,
                    selected: this.props.selected
                }),
                container: D("message " + m, {
                    "message-system": n.isNotification,
                    "message-out": !n.isNotification && n.isSentByMe,
                    "message-in": !n.isNotification && !n.isSentByMe,
                    hover: this.state.contextMenu || this.state.hover,
                    tail: !(n.chat.isPSA || this.props.tailOverride || r !== L.END && r !== L.SINGLE),
                    "tail-override-left": "left" === this.props.tailOverride,
                    "tail-override-right": "right" === this.props.tailOverride,
                    "message-chat": n.type === p.TYPE.CHAT && !n.linkPreview,
                    "message-code": f,
                    "message-placeholder": n.type === p.TYPE.CIPHERTEXT || n.type === p.TYPE.UNKNOWN
                })
            }
              , v = this.state.contextMenu ? "none" : "pop-fast"
              , y = a.createElement("span", {
                className: "tail-container highlight",
                ref: "highlightTail"
            })
              , E = void 0;
            this.state.contextMenu && (E = a.createElement(N, {
                displayName: "MsgContextMenu",
                escapable: !0,
                popable: !0,
                requestDismiss: this.contextClose
            }, a.createElement(x, {
                contextMenu: this.state.contextMenu
            })));
            var M = void 0;
            return c && !this.props.selectable && n.canForward() && (n.isMedia || n.linkPreview) && (M = a.createElement("div", {
                className: "icon icon-forward-chat btn-forward-chat",
                onClick: this.openSingleForwardFlow
            })),
            a.createElement("div", {
                className: g.wrapper,
                onDoubleClick: this.onDoubleClick
            }, a.createElement(R, {
                transitionName: "delay-leave"
            }, u), a.createElement("div", {
                className: g.container,
                ref: "bubble"
            }, a.createElement("div", {
                onContextMenu: this.contextMenu,
                onMouseOver: this.mouseEnter,
                onMouseEnter: this.mouseEnter,
                onMouseLeave: this.mouseLeave
            }, a.createElement("span", {
                className: "tail-container"
            }), "  ", y, "                      ", l, this.getMsgComponent(), a.createElement(R, {
                transitionName: v
            }, e)), M), E)
        }
    });
    F.Position = L,
    e.exports = F
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(891)
      , s = r(a)
      , c = n(6)
      , l = n(1003)
      , u = n(429)
      , d = n(986)
      , p = n(9)
      , h = n(14)
      , f = n(989)
      , m = n(1215)
      , g = c.createClass({
        displayName: "ForwardMessageFlow",
        mixins: [l],
        propTypes: {
            msgs: c.PropTypes.arrayOf(c.PropTypes.instanceOf(d)).isRequired,
            onFoward: c.PropTypes.func,
            isGroupInviteForward: c.PropTypes.bool
        },
        getDefaultTransition: function() {
            var e;
            return e = {},
            (0,
            s["default"])(e, l.Dir.PUSH, l.Transition.NONE),
            (0,
            s["default"])(e, l.Dir.POP, l.Transition.NONE),
            e
        },
        componentWillMount: function() {
            var e = void 0;
            e = this.props.isGroupInviteForward ? l10n.t("group_invite_send_link_title") : l10n.t("forward_message_to", {
                _plural: this.props.msgs.length
            });
            var t = _.head(this.props.msgs) && _.head(this.props.msgs).chat;
            this.push(c.createElement(m, {
                onChat: this.confirmForward,
                excludeChat: t,
                title: e
            }))
        },
        checkCanSend: function(e) {
            var t = {};
            return o["default"].map(this.props.msgs, function(n) {
                var r = void 0;
                if (n.isMMS) {
                    var i = n.type;
                    t[i] || (t[i] = e.shouldSendEncrypted(i).then(function() {
                        return !0
                    })["catch"](function() {
                        return !1
                    })),
                    r = t[i]
                } else
                    r = !0;
                return o["default"].props({
                    message: n,
                    canSend: r
                })
            })
        },
        confirmForward: function(e) {
            var t, n = !1;
            this.props.isGroupInviteForward ? t = e.isGroup ? l10n.t("confirm_send_to_group", {
                chat: e.title()
            }) : l10n.t("confirm_send_to_contact", {
                chat: e.title()
            }) : e.isGroup ? t = l10n.t("confirm_forward_to_group", {
                chat: e.title()
            }) : e.isUser && e.contact.isBlocked() ? (t = l10n.t("confirm_unblock_contact_and_forward", {
                chat: e.title()
            }),
            n = !0) : t = l10n.t("confirm_forward_to_contact", {
                chat: e.title()
            }),
            this.push(c.createElement(u, {
                onOK: _.partial(this.onForwardConfirmed, e, n),
                okText: l10n.t("forward"),
                onCancel: this.pop.bind(null , void 0),
                key: "ConfirmPopup",
                cancelText: l10n.t("web_cancel")
            }, c.createElement(f, {
                text: t
            })))
        },
        onForwardConfirmed: function(e, t) {
            var n, r = this, i = Date.now();
            n = t ? e.contact.setBlock(!1) : o["default"].resolve(!0),
            o["default"].all([this.checkCanSend(e), n]).spread(function(t, n) {
                var r = _.map(_.filter(t, {
                    canSend: !0
                }), "message")
                  , i = _.map(_.filter(t, {
                    canSend: !1
                }), "message");
                return o["default"].props({
                    undelivered: e.forwardMessages(r),
                    canSend: r,
                    cannotSend: i
                })
            }).then(function(t) {
                var n = t.undelivered
                  , o = t.canSend
                  , a = t.cannotSend;
                (n.length || a.length) && r.showMediaSendError(e, o, a, n, i)
            })["catch"](h.ContactBlocked, function() {
                r.showContactBlocked(e, i)
            }),
            this.endFlow(),
            _.isFunction(this.props.onForward) && this.props.onForward(this.props.msgs),
            p.openChat(e)
        },
        showContactBlocked: function(e, t) {
            var n = Date.now() - t > 1e3 && void 0;
            p.openModal(c.createElement(u, {
                key: "contactBlocked",
                onOK: p.closeModal.bind(p)
            }, l10n.t("web_cannot_send_to_blocked_contact_1", {
                contact: e.contact.formattedName
            })), n)
        },
        showMediaSendError: function(e, t, n, r, i) {
            var o = t.length - r.length
              , a = [];
            if (o) {
                a.push(l10n.t("forwarded_some_messages", {
                    count: o,
                    _plural: o
                }));
                var s = void 0
                  , l = n.length + r.length;
                s = r.length ? n.length ? e.isUser ? l10n.t("cannot_forward_media_missing_and_capability_contact", {
                    count: l,
                    _plural: l,
                    contact: e.title()
                }) : l10n.t("cannot_forward_media_missing_and_capability_group", {
                    count: l,
                    _plural: l
                }) : l10n.t("cannot_forward_media_missing", {
                    count: l,
                    _plural: l
                }) : e.isUser ? l10n.t("cannot_forward_capability_contact", {
                    count: l,
                    _plural: l,
                    contact: e.title()
                }) : l10n.t("cannot_forward_capability_group", {
                    count: l,
                    _plural: l
                }),
                s && a.push(s)
            } else {
                var d = void 0;
                d = r.length ? n.length ? e.isUser ? l10n.t("cannot_forward_media_missing_and_capability_contact_none", {
                    contact: e.title()
                }) : l10n.t("cannot_forward_media_missing_and_capability_group_none") : l10n.t("cannot_forward_media_missing_none") : e.isUser ? l10n.t("cannot_forward_capability_contact_none", {
                    contact: e.title()
                }) : l10n.t("cannot_forward_capability_group_none"),
                d && a.push(d)
            }
            p.openModal(c.createElement(u, {
                onOK: p.closeModal.bind(p),
                okText: l10n.t("web_ok")
            }, a.map(function(e, t) {
                return c.createElement("p", {
                    key: t
                }, e)
            })), !1)
        },
        onForwardConfirmed2: function(e) {
            var t = this;
            o["default"].map(e, function(e) {
                var n = void 0;
                return n = e.isUser && e.contact.isBlocked() ? e.contact.setBlock(!1) : o["default"].resolve(!0),
                o["default"].all([t.checkCanSend(e), n]).spread(function(t, n) {
                    var r = _.map(_.filter(t, {
                        canSend: !0
                    }), "message")
                      , i = _.map(_.filter(t, {
                        canSend: !1
                    }), "message");
                    return o["default"].props({
                        chat: e,
                        undelivered: e.forwardMessages(r),
                        canSend: r,
                        cannotSend: i
                    })
                })
            }).then(function(e) {
                var n = _.compact(e.map(function(e) {
                    var n = e.chat
                      , r = e.undelivered
                      , i = e.canSend
                      , o = e.cannotSend
                      , a = null ;
                    return (r.length || o.length) && (a = t.getForwardFailReason(n, r, i, o)),
                    a ? {
                        chat: n,
                        reason: a
                    } : null
                }));
                n.length && t.showMediaSendError2(n)
            }),
            this.endFlow(),
            _.isFunction(this.props.onForward) && this.props.onForward(this.props.msgs),
            p.openChat(_.head(e))
        },
        getForwardFailReason: function(e, t, n, r) {
            var i = n.length - t.length
              , o = void 0;
            if (i) {
                var a = r.length + t.length;
                o = t.length ? r.length ? e.isUser ? l10n.t("cannot_forward_media_missing_and_capability_contact", {
                    count: a,
                    _plural: a,
                    contact: e.formattedTitle
                }) : l10n.t("cannot_forward_media_missing_and_capability_group", {
                    count: a,
                    _plural: a
                }) : l10n.t("cannot_forward_media_missing", {
                    count: a,
                    _plural: a
                }) : e.isUser ? l10n.t("cannot_forward_capability_contact", {
                    count: a,
                    _plural: a,
                    contact: e.formattedTitle
                }) : l10n.t("cannot_forward_capability_group", {
                    count: a,
                    _plural: a
                })
            } else
                o = t.length ? r.length ? e.isUser ? l10n.t("cannot_forward_media_missing_and_capability_contact_none", {
                    contact: e.formattedTitle
                }) : l10n.t("cannot_forward_media_missing_and_capability_group_none") : l10n.t("cannot_forward_media_missing_none") : e.isUser ? l10n.t("cannot_forward_capability_contact_none", {
                    contact: e.formattedTitle
                }) : l10n.t("cannot_forward_capability_group_none");
            return o
        },
        showMediaSendError2: function(e) {
            var t = e.map(function(e) {
                var t = e.chat
                  , n = e.reason;
                return c.createElement("p", {
                    key: t.id
                }, t.formattedTitle, " : ", n)
            });
            p.openModal(c.createElement(u, {
                onOK: p.closeModal.bind(p),
                okText: l10n.t("web_ok")
            }, t), void 0)
        }
    });
    e.exports = g
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(891)
      , o = r(i)
      , a = n(6)
      , s = n(43)
      , c = a.createClass({
        displayName: "Modal",
        propTypes: {
            type: a.PropTypes.oneOf(["compact", "box", "tower"]),
            classes: a.PropTypes.string,
            title: a.PropTypes.string,
            children: a.PropTypes.node.isRequired
        },
        getDefaultProps: function() {
            return {
                classes: "",
                type: "compact"
            }
        },
        statics: {
            COMPACT: "compact",
            BOX: "box",
            TOWER: "tower"
        },
        render: function() {
            var e = this.props.title ? a.createElement("div", {
                className: "popup-title",
                dir: "auto"
            }, this.props.title) : null
              , t = s("popup", this.props.classes, (0,
            o["default"])({}, "popup-" + this.props.type, this.props.type !== c.COMPACT));
            return a.createElement("div", {
                className: "backdrop"
            }, a.createElement("div", {
                className: "popup-container"
            }, a.createElement("div", {
                className: t
            }, a.createElement("div", {
                className: "popup-body"
            }, e, a.createElement("div", {
                className: "popup-contents"
            }, this.props.children)))))
        }
    });
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(1)
      , c = n(438)
      , l = n(439)
      , u = n(210)
      , d = n(82)
      , p = n(45)
      , h = n(9)
      , f = n(101)
      , m = n(14)
      , g = n(10)
      , v = n(431)
      , y = n(68).ActionToast
      , _ = n(68).ActionType
      , E = d.extend({
        props: {
            id: "string",
            isAdmin: "boolean"
        },
        children: {
            contact: u
        },
        initialize: function() {
            this.contact = Store.Contact.gadd({
                id: this.id
            }),
            this.listenTo(this.contact, "all", this._getCachedEventBubblingHandler("contact"))
        }
    })
      , b = c.extend(l, {
        model: E,
        comparator: function(e, t) {
            return u.Comparator(e.contact, t.contact)
        },
        initialize: function() {
            this.listenTo(this, "change:contact.name", this.sort),
            this.listenTo(h, "locale_change", this.sort)
        },
        addParticipant: function(e, t) {
            var n = this;
            if (this.get(e.id))
                return h.openToast(a.createElement(v, {
                    id: v.genId(),
                    msg: l10n.t("action_participant_failed_already_added", {
                        participant: e.formattedShortName
                    })
                })),
                o["default"].reject(new m.ActionError);
            if (!this.canAdd())
                return o["default"].reject(new m.ActionError);
            var r = p.addParticipant(this.parent.id, e.id)
              , i = new _(l10n.t("action_participant_adding", {
                participant: e.formattedShortName
            }));
            t = t || y.genId();
            var c = r.then(function(t) {
                return 200 === t.status ? new _(l10n.t("action_participant_added", {
                    participant: e.formattedShortName
                })) : 404 === t.status ? new _(l10n.t("action_participant_add_failed") + " " + l10n.t("action_participant_failed_404")) : 401 === t.status ? new _(l10n.t("action_participant_add_failed") + " " + l10n.t("action_participant_failed_401")) : 403 === t.status ? new _(l10n.t("action_participant_add_failed") + " " + l10n.t("action_participant_failed_403")) : void 0
            })["catch"](function(r) {
                return s.error("models:groupMetadata:participantCollection:addParticipant dropped")(r),
                new _(l10n.t("action_participant_add_failed"),l10n.t("action_try_again"),n.addParticipant.bind(n, e, t))
            });
            return h.openToast(a.createElement(y, {
                id: t,
                initialAction: i,
                pendingAction: c
            })),
            r
        },
        removeParticipant: function(e, t) {
            var n = this;
            if (!this.canRemove(e))
                return o["default"].reject(new m.ActionError);
            var r = p.removeParticipant(this.parent.id, e.id)
              , i = new _(l10n.t("action_participant_removing", {
                participant: e.contact.formattedShortName
            }));
            t = t || y.genId();
            var c = r.then(function(t) {
                return 200 === t.status ? new _(l10n.t("action_participant_removed", {
                    participant: e.contact.formattedShortName
                })) : 404 === t.status ? new _(l10n.t("action_participant_remove_failed") + " " + l10n.t("action_participant_failed_404")) : 401 === t.status ? new _(l10n.t("action_participant_remove_failed") + " " + l10n.t("action_participant_failed_401")) : 403 === t.status ? new _(l10n.t("action_participant_remove_failed") + " " + l10n.t("action_participant_failed_403")) : void 0
            })["catch"](function(r) {
                return s.error("models:groupMetadata:participantCollection:removeParticipant dropped")(r),
                new _(l10n.t("action_participant_remove_failed"),l10n.t("action_try_again"),n.removeParticipant.bind(n, e, t))
            });
            return h.openToast(a.createElement(y, {
                id: t,
                initialAction: i,
                pendingAction: c
            })),
            r
        },
        promoteParticipant: function(e, t) {
            var n = this;
            if (!this.canPromote(e))
                return o["default"].reject(new m.ActionError);
            var r = p.promoteParticipant(this.parent.id, e.id)
              , i = new _(l10n.t("action_participant_promoting", {
                participant: e.contact.formattedShortName
            }));
            t = t || y.genId();
            var c = r.then(function(t) {
                return 200 === t.status ? new _(l10n.t("action_participant_promoted", {
                    participant: e.contact.formattedShortName
                })) : 404 === t.status ? new _(l10n.t("action_participant_promote_failed") + " " + l10n.t("action_participant_failed_404")) : 401 === t.status ? new _(l10n.t("action_participant_promote_failed") + " " + l10n.t("action_participant_failed_401")) : 403 === t.status ? new _(l10n.t("action_participant_promote_failed") + " " + l10n.t("action_participant_failed_403")) : void 0
            })["catch"](function(r) {
                return s.error("models:groupMetadata:participantCollection:removeParticipant dropped")(r),
                new _(l10n.t("action_participant_promote_failed"),l10n.t("action_try_again"),n.promoteParticipant.bind(n, e, t))
            });
            return h.openToast(a.createElement(y, {
                id: t,
                initialAction: i,
                pendingAction: c
            })),
            r
        },
        canAdd: function() {
            return !!f.supportsFeature(f.F.GROUP_ADD_PARTICIPANT) && !!this.iAmAdmin()
        },
        canPromote: function(e) {
            return !!f.supportsFeature(f.F.GROUP_PROMOTE_PARTICIPANT) && (!!e && (Store.Conn.me !== e.id && (!!this.iAmAdmin() && !e.isAdmin)))
        },
        canRemove: function(e) {
            return !!f.supportsFeature(f.F.GROUP_REMOVE_PARTICIPANT) && (!!e && (Store.Conn.me !== e.id && !!this.iAmAdmin()))
        },
        canVerifyIdentity: function(e) {
            return !!f.supportsFeature(f.F.QUERY_IDENTITY) && (!!e && (Store.Conn.me !== e.id && !!e.contact.plaintextDisabled))
        },
        iAmMember: function() {
            return 1 === this.where({
                id: Store.Conn.me
            }).length
        },
        iAmAdmin: function() {
            return 1 === this.where({
                id: Store.Conn.me,
                isAdmin: !0
            }).length
        }
    })
      , S = d.extend({
        Collection: "GroupMetadata",
        props: {
            id: "string",
            creation: "number",
            owner: "string"
        },
        session: {
            stale: ["boolean", !1, !0],
            trusted: ["boolean", !1, !0],
            inviteCode: "string",
            promises: {
                type: "object",
                "default": function() {
                    return {}
                }
            }
        },
        derived: {
            groupInviteLink: {
                deps: ["inviteCode"],
                fn: function() {
                    return this.inviteCode ? "" + g.GROUP_INVITE_LINK_URL + this.inviteCode : null
                }
            }
        },
        collections: {
            participants: b
        },
        "delete": function() {
            d.prototype["delete"].call(this),
            Store.GroupMetadata.remove(this.id),
            this.participants.invokeMap("delete"),
            this.participants.stopListening(),
            this.participants.reset()
        },
        canSetSubject: function() {
            return !!f.supportsFeature(f.F.GROUP_SET_SUBJECT) && !!this.participants.iAmMember()
        },
        initialize: function() {
            this.listenTo(this.participants, "change:isAdmin change:contact.isMyContact sort remove reset", this.isTrusted),
            this.listenTo(this, "change:owner", this.isTrusted),
            this.isTrusted(),
            this.listenTo(this.participants, "add remove reset", this.onParticipantChange)
        },
        isTrusted: function() {
            if (this.stale)
                return this.trusted;
            if (!this.owner)
                return this.trusted = !1;
            if (this.owner === Store.Conn.me)
                return this.trusted = !0;
            var e = Store.Contact.get(this.owner);
            if (e && e.isMyContact)
                return this.trusted = !0;
            for (var t = this.participants.models, n = 0, r = t.length; n < r; ++n) {
                var i = t[n];
                if (i.isAdmin && i.id !== Store.Conn.me && i.contact.isMyContact)
                    return this.trusted = !0
            }
            return this.trusted = !1
        },
        onParticipantChange: function() {
            Store.Contact.get(this.id).unset("_capabilities"),
            Store.GroupMetadata.trigger("group_participant_change", this.id)
        },
        groupInviteCode: function() {
            var e = this;
            return this.promises.groupInviteCode ? this.promises.groupInviteCode : this.promises.groupInviteCode = p.groupInviteCode(this.id).then(function(t) {
                var n = t.status
                  , r = t.code;
                return 200 === n && (e.inviteCode = r),
                n
            })["finally"](function() {
                e.promises.groupInviteCode = null
            })
        },
        revokeGroupInvite: function() {
            var e = this;
            return this.promises.revokeGroupInvite ? this.promises.revokeGroupInvite : this.promises.revokeGroupInvite = p.revokeGroupInvite(this.id).then(function(t) {
                var n = t.status
                  , r = t.code;
                return 200 === n && (e.inviteCode = r),
                n
            })["finally"](function() {
                e.promises.revokeGroupInvite = null
            })
        }
    });
    e.exports = S
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(10)
      , s = n(1)
      , c = n(23)
      , l = n(82)
      , u = n(438)
      , d = n(45)
      , p = n(137)
      , h = 1500
      , f = 2e3
      , m = l.extend({
        props: {
            id: "string",
            type: {
                type: "string",
                values: ["available", "unavailable", "composing", "recording"]
            },
            t: {
                type: "number",
                allowNull: !0
            },
            deny: "boolean"
        },
        session: {
            updateTime: "number",
            _expireTimerId: ["number", !1, 0]
        }
    })
      , g = u.extend({
        model: m
    })
      , v = l.extend({
        Collection: "Presence",
        props: {
            id: "string"
        },
        session: {
            isOnline: "boolean",
            stale: ["boolean", !1, !0],
            hasData: ["boolean", !1, !1],
            isSubscribed: ["boolean", !1, !1],
            withholdDisplay: ["boolean", !1, !0],
            forceDisplay: ["boolean", !1, !1],
            chatActive: ["boolean", !1, !1],
            withholdDisplayTimer: "number",
            forceDisplayTimer: "number"
        },
        children: {
            chatstate: m
        },
        collections: {
            chatstates: g
        },
        derived: {
            isGroup: {
                fn: function() {
                    return c.isGroup(this.id)
                }
            },
            isUser: {
                fn: function() {
                    return c.isUser(this.id)
                }
            }
        },
        initialize: function() {
            this.isGroup ? (this.chatstate.set({
                id: "",
                type: "unavailable"
            }),
            this.listenTo(this.chatstates, "add change", _.debounce(function() {
                var e, t = !1;
                this.chatstates.forEach(function(n) {
                    "composing" !== n.type && "recording" !== n.type || e && !(e.updateTime < n.updateTime) || (e = n),
                    t = t || "unavailable" !== n.type
                }),
                this.set({
                    isOnline: t,
                    chatstate: {
                        id: e ? e.id : "",
                        type: e ? e.type : "unavailable"
                    }
                })
            }))) : (this.chatstate.set({
                id: this.id
            }),
            this.listenTo(this.chatstate, "change:type", function() {
                this.isOnline = "unavailable" !== this.chatstate.type
            })),
            this.listenTo(this, "change:chatActive", this.onChatActiveChange)
        },
        "delete": function() {
            l.prototype["delete"].call(this),
            Store.Presence.remove(this.id),
            this.chatstate["delete"](),
            this.chatstates.forEach(function(e) {
                e["delete"]()
            })
        },
        handle: function(e) {
            "undefined" == typeof e.type ? e.type = this.chatstate.type || "unavailable" : "paused" === e.type && (e.type = "available"),
            this.isGroup && "available" !== e.type && (e.updateTime = Date.now());
            var t;
            if (this.isGroup) {
                if (e.id = e.participant,
                e.participant = void 0,
                !e.id)
                    return;
                t = this.chatstates.add(e, {
                    merge: !0
                })
            } else
                t = this.chatstate.set(e);
            t._expireTimerId && clearTimeout(t._expireTimerId),
            "composing" === t.type || "recording" === t.type ? t._expireTimerId = _.delay(this._expireComposing, a.PRESENCE_COMPOSING_TIMEOUT, t) : t._expireTimerId = 0;
            var n = this.forceDisplay || this.isOnline || this.isUser && !this.chatstate.deny;
            this.set({
                hasData: !0,
                forceDisplay: n
            })
        },
        _expireComposing: function(e) {
            var t = e.type;
            "composing" === t || "recording" === t ? e.type = "available" : s.error("models:presence:expireComposing " + t)()
        },
        reset: function() {
            this.hasData = !1,
            this.isGroup ? this.chatstates.forEach(function(e) {
                e.type = "unavailable"
            }) : this.isUser && (this.chatstate.unset("t"),
            this.chatstate.unset("deny")),
            this.chatstate.set({
                id: this.isGroup ? "" : this.id,
                type: "unavailable",
                t: void 0,
                deny: void 0
            })
        },
        isActive: function() {
            var e = this.chatstate.type;
            return this.hasData && ("composing" === e || "recording" === e)
        },
        getFormattedString: function() {
            if (!this.hasData)
                return null ;
            if (this.isGroup) {
                var e = this.chatstate.id;
                if (!e)
                    return null ;
                var t = Store.Contact.get(e);
                if (!t)
                    return null ;
                var n = t.formattedShortName;
                return "composing" === this.chatstate.type ? l10n.t("web_conversation_name_is_composing", {
                    participant: n
                }) : l10n.t("web_conversation_name_is_recording", {
                    participant: n
                })
            }
            if (!this.isUser)
                return null ;
            var r = this.chatstate;
            switch (r.type) {
            case "available":
                return l10n.t("web_conversation_contact_online");
            case "composing":
                return l10n.t("web_conversation_is_composing");
            case "recording":
                return l10n.t("web_conversation_is_recording");
            case "unavailable":
                return r.deny || !r.t ? null : p.lastSeenStr(r.t)
            }
        },
        onChatActiveChange: function() {
            var e = this.chatActive;
            e ? (this.hasData ? this.withholdDisplay = !1 : this.withholdDisplayTimer = _.delay(function(e) {
                e.set({
                    withholdDisplay: !1,
                    withholdDisplayTimer: 0
                })
            }, h, this),
            this.forceDisplayTimer = _.delay(function(e) {
                e.set({
                    forceDisplay: !0,
                    forceDisplayTimer: 0
                })
            }, f, this)) : (this.withholdDisplayTimer && (clearTimeout(this.withholdDisplayTimer),
            this.withholdDisplayTimer = 0),
            this.forceDisplayTimer && (clearTimeout(this.forceDisplayTimer),
            this.forceDisplayTimer = 0))
        },
        subscribe: function() {
            return this.isSubscribed ? o["default"].resolve() : this.isUser ? this.update() : this.isGroup ? (this.isSubscribed = !0,
            o["default"].all([this.update(), d.presenceSubscribe(this.id)]).bind(this)["catch"](function(e) {
                return this.isSubscribed = !1,
                o["default"].reject(e)
            })) : o["default"].resolve()
        }
    });
    e.exports = v;
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(211)
      , d = n(38)
      , p = n(1)
      , h = n(986)
      , f = n(137)
      , m = n(0)
      , g = function() {
        function e() {
            (0,
            s["default"])(this, e)
        }
        return (0,
        l["default"])(e, [{
            key: "getDefaultName",
            value: function(e) {
                var t = u.getExtension(e.mimetype);
                switch (e.type) {
                case h.TYPE.DOCUMENT:
                    return e.caption || e.filename || l10n.t("untitled_document") + t;
                case h.TYPE.IMAGE:
                case h.TYPE.VIDEO:
                case h.TYPE.AUDIO:
                default:
                    var n = m.unix(e.t).locale("en");
                    return e.filename || "WhatsApp " + _.capitalize(e.type) + " " + (n.format("YYYY-MM-DD") + " at ") + ("" + n.format(f.getIs24Hour() ? "HH.mm.ss" : "h.mm.ss A")) + t
                }
            }
        }, {
            key: "getDownloadData",
            value: function(e) {
                return e.isGif ? this.mp4ToGif(e) : o["default"].resolve({
                    url: e.url,
                    name: this.getDefaultName(e)
                })
            }
        }, {
            key: "mp4ToGif",
            value: function(e) {
                var t = this;
                return new o["default"](function(e, t) {
                    throw new Error("unimplemented")
                }
                ).then(function(t) {
                    return {
                        url: t,
                        name: "WhatsApp-Image-" + m.unix(e.t).format("YYYYMMDD") + ".gif"
                    }
                })["catch"](function() {
                    return {
                        url: e.url,
                        name: t.getDefaultName(e)
                    }
                })
            }
        }, {
            key: "initDownload",
            value: function(e) {
                d.startDownloading();
                var t = document.createElement("a");
                this.getDownloadData(e).then(function(n) {
                    t.href = n.url,
                    t.download = n.name,
                    t.target = "_blank",
                    t.style.display = "none",
                    p.assert(n.url, "no-download-url", "download " + e.id + " type " + e.type + " with state " + e.mediaData.mediaStage)(),
                    document.body.appendChild(t),
                    t.click(),
                    document.body.removeChild(t)
                })
            }
        }]),
        e
    }();
    e.exports = new g
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(9)
      , c = n(14)
      , l = n(1014)
      , u = n(1)
      , d = {
        start: function(e) {
            var t = this;
            if ("camera" !== e && "microphone" !== e)
                return void u.error("mediaCapture:start incompatible type given")();
            var n = new o["default"](function(r, i) {
                t.timeout = setTimeout(function() {
                    var t = "camera" === e ? "guide_desktop_camera_title" : "guide_desktop_mic_title"
                      , n = "camera" === e ? "guide_desktop_camera_description" : "guide_desktop_mic_description";
                    s.openModal(a.createElement(l, {
                        title: t,
                        desc: n,
                        type: l.TYPE.GUIDE_ALLOW
                    }))
                }, 1e3);
                var o = "camera" === e ? {
                    video: !0
                } : {
                    audio: !0
                };
                navigator.getUserMedia(o, function(e) {
                    s.closeModal(),
                    clearTimeout(t.timeout),
                    r(e)
                }, function(e) {
                    var r = _.isString(e) ? e : e.name
                      , o = c.GUM[r] || c.GUM.GUMError;
                    clearTimeout(t.timeout),
                    i(new o),
                    n && !n.isPending() && s.closeModal()
                })
            }
            );
            return n
        },
        stop: function(e) {
            if (_.isFunction(e.stop))
                e.stop();
            else
                for (var t = e.getTracks(), n = 0; n < t.length; n++)
                    t[n].stop()
        }
    };
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(1010)
      , m = function(e) {
        function t(e, n, r) {
            (0,
            s["default"])(this, t);
            var i = (0,
            d["default"])(this, (0,
            o["default"])(t).call(this));
            return i._delimiter = e,
            i._regex = n,
            i._group = r,
            i
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "match",
            value: function n(e) {
                for (var t = [], n = void 0; n = this._regex.exec(e); ) {
                    var r = this._delimiter.length
                      , i = 2 * r + n[this._group].length;
                    if (n[0].length !== i) {
                        var o = n[0].length - i;
                        n.index += o,
                        n[0] = n[0].slice(o)
                    }
                    this._regex.lastIndex--,
                    t.push(n)
                }
                return t
            }
        }, {
            key: "group",
            get: function() {
                return this._group
            }
        }, {
            key: "isFormatter",
            get: function() {
                return !0
            }
        }]),
        t
    }(f);
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(1041)
      , m = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).call(this, "```", /```([\s\S]+?)```/g, 1))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "formatResult",
            get: function() {
                return !1
            }
        }]),
        t
    }(f);
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    var r = n(444)
      , i = {
        multibyteLength: function(e) {
            return r.ucs2.decode(e).length
        },
        multibyteSubstr: function(e, t, n) {
            var i = r.ucs2.decode(e);
            if ("undefined" == typeof n)
                i = i.slice(t);
            else {
                if (n <= 0)
                    return "";
                i = i.slice(t, t + n)
            }
            return r.ucs2.encode(i)
        }
    };
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(43)
      , o = n(211).MIMETYPES
      , a = _.pickBy(o, function(e) {
        return "document" === e.msgType
    })
      , s = r.createClass({
        displayName: "AttachMediaTypeFile",
        propTypes: {
            mimeType: r.PropTypes.string,
            filename: r.PropTypes.string
        },
        render: function() {
            var e = this.props
              , t = e.mimeType
              , n = e.filename
              , o = "icon-doc";
            return a[t] && (o = i(o, a[t].icon)),
            r.createElement("div", {
                className: "media-element-container"
            }, r.createElement("div", {
                className: "media-element"
            }, r.createElement("div", {
                className: "media-document"
            }, r.createElement("div", {
                className: o
            }), r.createElement("div", {
                className: "media-document-text"
            }, n))))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(987)
      , a = n(43)
      , s = r.createClass({
        displayName: "MsgAck",
        mixins: [o],
        propTypes: {
            msg: r.PropTypes.instanceOf(i)
        },
        getInitialState: function() {
            return {
                ack: this.async("msg.ack")
            }
        },
        render: function() {
            var e = this.props.msg.ack
              , t = a("icon", {
                "icon-status-time": e < 1,
                "icon-status-check": 1 === e,
                "icon-status-dblcheck": 2 === e,
                "icon-status-dblcheck-ack": e > 2
            });
            return r.createElement("span", {
                className: t
            })
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(1)
      , c = n(995)
      , l = n(1165)
      , u = n(1052)
      , d = n(1007)
      , p = n(1006)
      , h = n(1005)
      , f = n(434)
      , m = n(1145)
      , g = n(136)
      , v = n(429)
      , y = n(209)
      , E = n(1012)
      , b = n(9)
      , S = n(10)
      , M = n(43)
      , C = n(102)
      , T = 200
      , w = 1.3
      , k = 2
      , x = {
        GROUP: "group",
        PROFILE: "profile",
        NO_EDIT: "no_edit"
    }
      , N = a.createClass({
        displayName: "PhotoPicker",
        propTypes: {
            startImage: a.PropTypes.string,
            type: a.PropTypes.oneOf(_.values(x)).isRequired,
            id: a.PropTypes.string,
            pending: a.PropTypes.bool,
            onImageSet: a.PropTypes.func.isRequired
        },
        statics: {
            Type: x
        },
        getInitialState: function() {
            return {
                img: this.props.startImage,
                imgCanvas: null ,
                left: 0,
                top: 0,
                isEditing: !1,
                hover: !1,
                contextMenu: !1
            }
        },
        componentWillReceiveProps: function(e) {
            this.props.startImage !== e.startImage && this.setState({
                img: e.startImage,
                imgCanvas: null ,
                isEditing: !1,
                left: 0,
                top: 0
            })
        },
        cropImage: function() {
            if (!this.state.img)
                return o["default"].reject("Image missing from state");
            var e = this.state.imgCanvas || this.state.img
              , t = this.state.scale
              , n = Math.abs(this.state.left / t)
              , r = Math.abs(this.state.top / t)
              , i = T / t
              , a = i;
            i > S.MAX_PIC_SIDE ? a = S.MAX_PIC_SIDE : i < S.MIN_PIC_SIDE && (a = S.MIN_PIC_SIDE);
            var s;
            return new o["default"](function(t, o) {
                h.crop(e, n, r, i, i, a, a, h.DATA_URL | h.CANVAS).then(function(e) {
                    var t = e.images;
                    return s = t.dataUrl,
                    h.crop(t.canvas, 0, 0, S.PROF_PIC_THUMB_SIDE, S.PROF_PIC_THUMB_SIDE, h.DATA_URL)
                }).then(function(e) {
                    var n = e.images;
                    t({
                        thumb: n.dataUrl,
                        full: s
                    })
                })["catch"](o)
            }
            )
        },
        onZoomIn: function() {
            var e = this.state.scale * w;
            k <= e || this.setState({
                scale: e
            })
        },
        onZoomOut: function() {
            var e = this.state.scale / w;
            this.state.minScale >= e && (e = this.state.minScale),
            this.setState({
                scale: e
            })
        },
        onCrop: function() {
            this.props.pending || this.cropImage().bind(this).then(function(e) {
                this.props.onImageSet(e.thumb, e.full)
            })["catch"](function() {
                this.setState({
                    img: this.props.startImage,
                    imgCanvas: null ,
                    isEditing: !1
                })
            })
        },
        onDragEnd: function(e, t) {
            this.setState({
                left: e,
                top: t
            })
        },
        onUpload: function(e) {
            var t = this.refs.imageInput;
            return t.click(),
            !0
        },
        removeImage: function() {
            this.props.onImageSet(),
            b.closeModal()
        },
        onRemove: function(e) {
            var t = this.props.type === x.GROUP ? l10n.t("remove_group_icon") : l10n.t("remove_profile_photo");
            b.openModal(a.createElement(v, {
                onOK: this.removeImage,
                okText: l10n.t("remove"),
                onCancel: b.closeModal.bind(b),
                cancelText: l10n.t("web_cancel")
            }, t))
        },
        onView: function() {
            var e = this.refs.imageContainer
              , t = function(t) {
                t(e)
            };
            b.openModalMedia(a.createElement(u, {
                contact: Store.Contact.get(this.props.id),
                animateBorderRadius: !0,
                getZoomNode: t
            }), "profile-viewer")
        },
        onImageTake: function(e) {
            this.createAndSetImage(e)
        },
        onImagePick: function(e) {
            this.contextClose();
            var t = e.target.files[0];
            return !!t && (this.createAndSetImage(t),
            void (e.target.value = ""))
        },
        createAndSetImage: function(e) {
            var t = this;
            h.rotateAndResize(e, 3 * S.IMG_MAX_EDGE, 3 * S.IMG_MAX_EDGE, h.DATA_URL | h.CANVAS).then(function(e) {
                var n = e.width
                  , r = e.height
                  , i = e.images
                  , o = T / Math.min(n, r);
                t.setState({
                    img: i.dataUrl,
                    imgCanvas: i.canvas,
                    isEditing: !0,
                    scale: o,
                    minScale: o
                })
            })["catch"](function(e) {
                s.error("PhotoPicker:createAndSetImage:error " + e)(e)
            })
        },
        onImageClick: function(e) {
            if (this.props.type === x.NO_EDIT && this.state.img)
                return void this.onView();
            if (!this.state.isEditing) {
                e.stopPropagation(),
                e.preventDefault();
                var t = [];
                this.props.id && this.state.img && t.push(a.createElement(c, {
                    a8n: "mi-view-photo",
                    key: "view",
                    action: this.onView
                }, l10n.t("view_photo"))),
                navigator.getUserMedia && t.push(a.createElement(l, {
                    key: "take",
                    onImageTake: this.onImageTake
                })),
                t.push(a.createElement(c, {
                    a8n: "mi-upload-photo",
                    key: "upload",
                    action: this.onUpload
                }, l10n.t("upload_photo"))),
                this.state.img && t.push(a.createElement(c, {
                    a8n: "mi-remove-photo",
                    key: "remove",
                    action: this.onRemove
                }, l10n.t("remove_photo"))),
                e.persist(),
                this.setState({
                    contextMenu: {
                        menu: t,
                        event: e
                    }
                })
            }
        },
        contextClose: function() {
            this.setState({
                contextMenu: !1
            })
        },
        onMouseOver: function(e) {
            this.state.hover || this.setState({
                hover: !0
            })
        },
        onMouseEnter: function(e) {
            this.state.hover || this.setState({
                hover: !0
            })
        },
        onMouseLeave: function(e) {
            this.state.hover && this.setState({
                hover: !1
            })
        },
        onLoad: function(e) {
            var t = e.target.clientWidth
              , n = e.target.clientHeight;
            this.setState({
                imageSize: {
                    width: t,
                    height: n
                }
            })
        },
        render: function() {
            var e;
            if (this.state.img && this.state.isEditing) {
                var t = {
                    width: T,
                    height: T
                };
                e = a.createElement(m, {
                    ref: "img",
                    container: t,
                    onStop: this.onDragEnd,
                    scale: this.state.scale
                }, a.createElement("img", {
                    className: "avatar-original",
                    src: this.state.img
                }))
            } else
                this.state.img && (e = a.createElement(d, {
                    type: d.TYPES.COVER,
                    size: this.state.imageSize
                }, a.createElement(p, {
                    src: this.state.img,
                    crossOrigin: !1,
                    style: {
                        height: "100%",
                        width: "100%"
                    },
                    onLoad: this.onLoad
                })));
            var n;
            (this.props.pending || !this.state.isEditing && this.state.img && !this.state.imageSize) && (n = a.createElement("div", {
                className: "avatar-spinner-container"
            }, a.createElement(g, {
                size: 50,
                stroke: 3
            })));
            var r = null ;
            if (!this.props.pending && this.props.type !== x.NO_EDIT && (!this.state.img || this.state.imageSize) && (!this.state.img || this.state.contextMenu || !this.state.isEditing && this.state.hover)) {
                var i;
                switch (this.props.type) {
                case "group":
                    i = this.state.img ? l10n.t("change_group_icon") : l10n.t("add_group_icon");
                    break;
                case "profile":
                    i = this.state.img ? l10n.t("change_profile_photo") : l10n.t("add_profile_photo")
                }
                r = a.createElement("div", {
                    className: "avatar-overlay",
                    key: "avatar-overlay"
                }, a.createElement("span", {
                    className: "icon icon-camera-light"
                }), a.createElement("div", {
                    "data-a8n": f.key("avatar-text"),
                    className: "avatar-overlay-text"
                }, i))
            }
            var o, s, c = M("avatar", "avatar-l", "draggable-container", {
                "icon-group-default": this.props.type !== x.PROFILE,
                "icon-user-default": this.props.type === x.PROFILE
            });
            this.state.isEditing && (o = a.createElement("div", {
                className: "avatar-picker-controls",
                key: "zoom-controls"
            }, a.createElement("button", {
                className: "icon icon-plus",
                onClick: this.onZoomIn
            }), a.createElement("button", {
                className: "icon icon-minus",
                onClick: this.onZoomOut
            })),
            s = a.createElement("div", {
                className: "tip-container tip-avatar-picker",
                key: "tip-controls"
            }, a.createElement("div", {
                className: "tip"
            }, a.createElement("div", {
                className: "tip-body"
            }, l10n.t("adjust_image")), a.createElement("div", {
                className: "tip-controls"
            }, a.createElement("button", {
                className: "button",
                onClick: this.onCrop
            }, l10n.t("done_adjusting"))))));
            var l = this.props.type === x.NO_EDIT || this.props.pending || !this.state.imageSize && this.state.img ? _.noop : this.onImageClick
              , u = void 0;
            return this.state.contextMenu && (u = a.createElement(y, {
                displayName: "PhotoPickerContextMenu",
                escapable: !0,
                popable: !0,
                requestDismiss: this.contextClose
            }, a.createElement(E, {
                contextMenu: this.state.contextMenu
            }))),
            a.createElement("div", {
                className: "avatar-picker"
            }, a.createElement("div", {
                className: c,
                onClick: l,
                onMouseOver: this.onMouseOver,
                onMouseEnter: this.onMouseEnter,
                onMouseLeave: this.onMouseLeave,
                ref: "imageContainer",
                dir: "ltr"
            }, a.createElement("div", {
                className: "avatar-body"
            }, e), a.createElement(C, {
                transitionName: "fade"
            }, n, r)), a.createElement(C, {
                transitionName: "fade"
            }, o), a.createElement(C, {
                transitionName: "slide"
            }, s), a.createElement("input", {
                ref: "imageInput",
                type: "file",
                accept: "image/gif,image/jpeg,image/jpg,image/png",
                style: {
                    display: "none"
                },
                onChange: this.onImagePick
            }), u)
        }
    });
    e.exports = N
}
, function(e, t) {
    "use strict";
    var n = function(e) {
        var t = {};
        for (var n in e)
            e.hasOwnProperty(n) && (t[n] = n);
        return t
    };
    e.exports = n
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(892)
      , s = r(a)
      , c = n(6)
      , l = n(43)
      , u = c.createClass({
        displayName: "Row",
        propTypes: {
            side: c.PropTypes.node,
            ellipsify: c.PropTypes.bool,
            classes: c.PropTypes.string,
            onClick: c.PropTypes.func
        },
        getDefaultProps: function() {
            return {
                ellipsify: !1
            }
        },
        render: function() {
            var e = this.props
              , t = e.onClick
              , n = e.side
              , r = e.ellipsify
              , i = e.classes
              , a = e.children
              , u = (0,
            s["default"])(e, ["onClick", "side", "ellipsify", "classes", "children"])
              , d = l("row", i, {
                clickable: t
            })
              , p = l("row-main", {
                ellipsify: r
            })
              , h = n ? c.createElement("div", {
                className: "row-side"
            }, n) : null ;
            return c.createElement("div", (0,
            o["default"])({
                className: d,
                onClick: t
            }, u), c.createElement("div", {
                className: "row-body"
            }, c.createElement("div", {
                className: p
            }, a), h))
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(989)
      , o = n(1091)
      , a = n(986)
      , s = r.createClass({
        displayName: "Caption",
        propTypes: {
            msg: r.PropTypes.instanceOf(a).isRequired
        },
        render: function() {
            var e = this.props.msg
              , t = e.mentionMap();
            return r.createElement("div", {
                className: "image-caption message-text",
                "data-id": e.id
            }, r.createElement(o, {
                msg: e
            }), r.createElement(i, {
                direction: e.dir,
                dirMismatch: !(!e.dir || e.rtl === l10n.isRTL()),
                selectable: !0,
                text: e.caption,
                linkify: !0,
                mention: t,
                format: !0,
                wbr: 15
            }))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(986)
      , a = n(133)
      , s = n(1034)
      , c = n(43)
      , l = n(137)
      , u = n(989)
      , d = n(1024)
      , p = n(994)
      , h = n(23)
      , f = n(139)
      , m = n(10)
      , g = n(135)
      , v = g.HotKeys
      , y = r.createClass({
        displayName: "StarredMsg",
        mixins: [a],
        propTypes: {
            msg: r.PropTypes.instanceOf(o).isRequired,
            isMsgVisible: r.PropTypes.func,
            selectable: r.PropTypes.bool,
            selected: r.PropTypes.bool,
            onMessageSelect: r.PropTypes.func,
            currSelection: r.PropTypes.object,
            activeSelection: r.PropTypes.object,
            onClickMsg: r.PropTypes.func.isRequired,
            multiMedia: r.PropTypes.bool
        },
        getInitialState: function() {
            var e = this.props.currSelection
              , t = this.props.activeSelection
              , n = this.props.msg;
            return {
                hover: !1,
                current: !!e && e.value === n,
                active: !!t && t.value === n,
                focus: !1
            }
        },
        componentWillMount: function() {
            var e = this
              , t = this.props.msg
              , n = this.props.currSelection;
            n && this.addObserver(n, t.id.toString(), function(t) {
                var n = "focus" === t;
                if (n) {
                    var r = i.findDOMNode(e);
                    f.focus(r),
                    d.scrollIntoViewIfNeeded(r)
                }
                e.setState({
                    current: n
                })
            });
            var r = this.props.activeSelection;
            r && this.addObserver(r, t.id.toString(), this.onActiveChange)
        },
        onActiveChange: function(e) {
            if ("focus" === e) {
                var t = i.findDOMNode(this);
                f.focus(t),
                d.scrollIntoViewIfNeeded(t)
            }
            this.setState({
                active: !!e
            })
        },
        mouseOver: function() {
            this.state.hover || this.setState({
                hover: !0
            })
        },
        mouseEnter: function() {
            this.state.hover || this.setState({
                hover: !0
            })
        },
        mouseLeave: function() {
            this.state.hover && this.setState({
                hover: !1
            })
        },
        onEnter: function(e) {
            e.stopPropagation(),
            e.preventDefault(),
            this.props.onClickMsg(this.props.msg)
        },
        openContextMenu: function(e) {
            this.refs.wrapper.contextOpen()
        },
        onFocus: function(e) {
            this.setState({
                focus: !0
            }),
            this.indicateFocus(e)
        },
        onBlur: function(e) {
            this.finishFocusIndication(e),
            this.setState({
                focus: !1
            })
        },
        indicateFocus: function(e) {
            if (!(Date.now() - (v.flashFocus || 0) > 200)) {
                var t = this.refs.row
                  , n = this.state.active ? "#d6d7d8" : "#e2e3e3";
                Velocity(t, "stop"),
                Velocity(t, {
                    backgroundColor: [n, "#cbdde7"]
                }, {
                    duration: 1300,
                    easing: [.19, .69, .01, .99],
                    complete: this.finishFocusIndication
                })
            }
        },
        finishFocusIndication: function(e) {
            var t = this.refs.row;
            t && (Velocity(t, "stop"),
            t.style.backgroundColor = "")
        },
        render: function() {
            var e = this
              , t = this.props.msg
              , n = t.senderObj.formattedName
              , i = t.chat.isUser ? Store.Contact.get(t.to).formattedName ? Store.Contact.get(t.to).formattedName : h.formattedUser(t.to) : t.chat.title()
              , o = c("starred-msg-wrapper", {
                hover: this.state.hover,
                current: this.state.current && this.state.focus,
                active: this.state.active
            })
              , a = this.props.multiMedia ? null : r.createElement("div", {
                className: "starred-msg-title"
            }, r.createElement("div", {
                className: "starred-title-main"
            }, r.createElement(p, {
                id: t.senderObj.id,
                size: 26
            }), r.createElement(u, {
                classes: "starred-msg-author",
                text: n,
                direction: "auto",
                ellipsify: !0,
                titlify: !0
            }), r.createElement("span", {
                className: "starred-title-divider"
            }), r.createElement(u, {
                classes: "starred-msg-chat",
                text: i,
                direction: "auto",
                ellipsify: !0,
                titlify: !0
            })), r.createElement("div", {
                className: "starred-title-meta"
            }, l.relativeStr(t.t)), r.createElement("div", {
                className: "icon icon-chevron-right-alt"
            }))
              , d = {
                enter: this.onEnter
            };
            d[l10n.LR("right", "left")] = this.openContextMenu;
            var f = this.props.selectable || this.state.hover && this.props.multiMedia;
            return r.createElement(v, {
                handlers: d,
                onFocus: this.onFocus,
                onBlur: this.onBlur
            }, r.createElement("div", {
                ref: "row",
                className: o,
                onClick: function() {
                    return e.props.onClickMsg(t, !e.props.selected)
                },
                onMouseEnter: this.state.hover ? null : this.mouseEnter,
                onMouseOver: this.state.hover ? null : this.mouseOver,
                onMouseLeave: this.state.hover ? this.mouseLeave : null
            }, a, r.createElement(s, {
                msg: t,
                key: t.id,
                ref: "wrapper",
                current: this.state.current && this.state.focus,
                displayType: m.DISP_TYPE.STARRED_MSGS,
                isMsgVisible: this.props.isMsgVisible,
                selectable: f,
                selected: this.props.selected,
                onMessageSelect: this.props.onMessageSelect,
                position: s.Position.END,
                tailOverride: "left"
            })))
        }
    });
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1103)
      , o = n(1e3)
      , a = n(210)
      , s = n(1004)
      , c = n(1033)
      , l = n(996)
      , u = n(133)
      , d = n(43)
      , p = r.createClass({
        displayName: "ContactsModal",
        mixins: [u],
        propTypes: {
            title: r.PropTypes.string.isRequired,
            contacts: r.PropTypes.arrayOf(r.PropTypes.instanceOf(a)),
            filter: r.PropTypes.func,
            onCancel: r.PropTypes.func.isRequired,
            onSelect: r.PropTypes.func.isRequired
        },
        getDefaultProps: function() {
            return {
                filter: function(e) {
                    return Store.Contact.isFilteredContact(e)
                }
            }
        },
        getInitialState: function() {
            return this.selection = new o([],function(e) {
                return e.id
            }
            ),
            {
                searchFilter: void 0
            }
        },
        componentWillMount: function() {
            this.props.contacts || this.addObserver(Store.Contact, "add remove change:name")
        },
        onSelect: function(e, t) {
            var n = t.props.contact;
            this.props.filter(n) === !0 && this.props.onSelect(n)
        },
        onSearch: function(e) {
            this.setState({
                searchFilter: e
            })
        },
        render: function() {
            var e = this.props
              , t = e.title
              , n = e.onCancel
              , o = e.filter
              , a = e.onSelect
              , u = l10n.accentFold(this.state.searchFilter)
              , p = this.props.contacts || Store.Contact
              , h = p.filter(function(e) {
                return o(e) && (!u || u && e.searchMatch(u))
            })
              , f = [];
            if (h.length) {
                this.selection.init(h.filter(function(e) {
                    return o(e) === !0
                }));
                for (var m = void 0, g = void 0, v = h.length > 10, y = 0; y < h.length; y++) {
                    m = h[y],
                    v && m.header !== g && f.push(r.createElement(c, {
                        key: m.header,
                        header: m.header
                    }));
                    var E = _.isString(o(m))
                      , b = void 0;
                    y < h.length - 1 && h[y + 1].header !== m.header && (b = "last");
                    var S = void 0;
                    E && (S = r.createElement("div", {
                        className: "chat-status ellipsify",
                        title: o(m)
                    }, o(m)),
                    b = d(b, "member")),
                    f.push(r.createElement(s, {
                        contact: m,
                        active: this.selection,
                        className: b,
                        secondary: S,
                        onClick: E ? void 0 : _.once(a.bind(null , m)),
                        key: m.id
                    })),
                    g = m.header
                }
            } else
                f = r.createElement(l.SearchContacts, null );
            return r.createElement(i, {
                title: t,
                selection: this.selection,
                onSearch: this.onSearch,
                searchPlaceholder: l10n.t("search_contacts"),
                onSelect: this.onSelect,
                onCancel: n
            }, f)
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1006)
      , o = n(994)
      , a = n(989)
      , s = n(1007)
      , c = n(210)
      , l = n(9)
      , u = n(987)
      , d = n(43)
      , p = n(209)
      , h = 500
      , f = r.createClass({
        displayName: "PhotoViewerModal",
        mixins: [u],
        propTypes: {
            contact: r.PropTypes.instanceOf(c),
            imgFull: r.PropTypes.string,
            animateBorderRadius: r.PropTypes.bool,
            getZoomNode: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                formattedUser: this.async("contact.formattedUser"),
                imgFull: this.props.imgFull || this.async("contact.profilePicThumb.imgFull"),
                style: {
                    visibility: "hidden"
                }
            }
        },
        onScroll: function(e) {
            Math.abs(e.deltaY) > 3 && this.onClose()
        },
        onClose: function() {
            if (!this.closing) {
                this.closing = !0;
                var e = void 0;
                if (this.props.getZoomNode(function(t) {
                    e = t
                }),
                !e)
                    return l.closeModalMedia();
                var t = this.refs.image
                  , n = t.getBoundingClientRect()
                  , r = e.getBoundingClientRect()
                  , i = r.top - n.top
                  , o = r.left - n.left
                  , a = e.clientWidth / t.clientWidth;
                Velocity(t, {
                    translateX: [o, 0],
                    translateY: [i, 0],
                    scale: [a, 1]
                }, {
                    duration: 200,
                    easing: [.1, .82, .25, 1]
                }).then(function() {
                    l.closeModalMedia()
                })
            }
        },
        onImageLoad: function(e) {
            var t = this
              , n = e.target;
            this.setState({
                size: {
                    width: n.naturalWidth,
                    height: n.naturalHeight
                }
            }, function() {
                t.props.getZoomNode(function(e) {
                    var r = n.getBoundingClientRect()
                      , i = e.getBoundingClientRect()
                      , o = i.top - r.top
                      , a = i.left - r.left
                      , s = e.clientWidth / n.clientWidth
                      , c = {
                        visibility: "hidden",
                        transform: "translateX(" + a + "px) translateY(" + o + "px) scale(" + s + ")",
                        transition: "transform 0s"
                    };
                    t.props.animateBorderRadius && (c.borderRadius = "50%"),
                    t.setState({
                        style: c
                    }, function() {
                        var e = {
                            transform: "translateX(0px) translateY(0px) scale(1)",
                            transition: "transform " + h + "ms cubic-bezier(.1,.82,.25,1)"
                        };
                        t.props.animateBorderRadius && (e = {
                            transform: "translateX(0px) translateY(0px) scale(1)",
                            borderRadius: "0%",
                            transition: "transform " + h + "ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius " + h + "ms cubic-bezier(.1,.82,.25,1)"
                        }),
                        t.setState({
                            style: e
                        })
                    })
                })
            })
        },
        render: function() {
            var e = this.props.contact
              , t = d("media-viewer", "media-viewer-animate")
              , n = d("media-panel-header", {});
            return r.createElement(p, {
                displayName: "PhotoViewer",
                escapable: !0,
                requestDismiss: this.onClose
            }, r.createElement("div", {
                className: t,
                onWheel: this.onScroll,
                onClick: this.onClose
            }, r.createElement("div", {
                className: n
            }, r.createElement("div", {
                className: "chat media-chat"
            }, r.createElement("div", {
                className: "chat-avatar"
            }, r.createElement(o, {
                id: e.id
            })), r.createElement("div", {
                className: "chat-body"
            }, r.createElement("div", {
                className: "chat-main"
            }, r.createElement(a, {
                text: this.state.formattedUser
            })))), r.createElement("div", {
                className: "menu menu-horizontal media-panel-tools"
            }, r.createElement("div", {
                className: "menu-item"
            }, r.createElement("button", {
                className: "icon icon-x-viewer",
                title: l10n.t("web_close"),
                onClick: this.onClose
            })))), r.createElement("div", {
                className: "media-content",
                dir: "ltr",
                ref: "container"
            }, r.createElement("div", {
                className: "media"
            }, r.createElement(s, {
                type: s.TYPES.SCALE_DOWN,
                size: this.state.size
            }, r.createElement("div", {
                className: "profile-viewer",
                ref: "image",
                style: this.state.style
            }, r.createElement(i, {
                src: this.state.imgFull,
                hasPrivacyChecks: !0,
                onLoad: this.onImageLoad,
                className: "profile-viewer-img"
            })))))))
        }
    });
    e.exports = f
}
, function(e, t, n) {
    "use strict";
    function r() {
        if (!o) {
            var e = n(1295)
              , t = e.length / 2;
            o = new Int32Array(t),
            a = new Int32Array(t);
            for (var r = 0, i = 0; r < t; r++,
            i += 2)
                o[r] = e[i] + (0 === r ? 0 : o[r - 1]),
                a[r] = e[i + 1]
        }
    }
    function i(e) {
        r();
        for (var t = 0; t < e.length; t++) {
            var n = 0 | e.charCodeAt(t);
            if (55296 <= n && n < 56320) {
                if (++t === e.length)
                    break;
                var i = e.charCodeAt(t);
                if (!(56320 <= i && i < 57344))
                    continue;
                n = 65536 + ((1023 & n) << 10 | 1023 & i)
            } else if (56320 <= n && n < 57344)
                continue;
            if (!(n < o[0])) {
                for (var s = 0 | o.length, c = 0, l = s - 1 | 0; c < l; ) {
                    var u = l + c >> 1;
                    if (o[u] > n)
                        l = u - 1 | 0;
                    else {
                        if (o[u + 1] > n) {
                            l = u;
                            break
                        }
                        c = u + 1 | 0
                    }
                }
                var d = a[l]
                  , p = o[l] + Math.abs(d) | 0;
                if (n < p)
                    return d < 0 ? "rtl" : "ltr"
            }
        }
    }
    var o, a;
    e.exports = {
        dir: i
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        try {
            return L.exec(e)
        } catch (t) {
            return l.assert(!1, "linkify-regex-error", "text size: " + e.length + ", error: " + t)(t),
            null
        }
    }
    function i(e) {
        L.lastIndex = 0;
        for (var t = [], n = void 0; n = r(e); )
            n = a(n),
            n && t.push(n);
        return t
    }
    function o(e) {
        return L.lastIndex = 0,
        a(r(e))
    }
    function a(e) {
        if (!e)
            return null ;
        var t = e[w].length
          , n = e[0]
          , r = e.index + t
          , i = e.index
          , o = "_" === e[w];
        if (o && i - 1 && /\S/.test(e.input[i - 1]))
            return null ;
        if (e[P]) {
            var a = parseInt(e[P].slice(1), 10);
            if ("0" === e[P][1] || !(0 < a && a < 65536))
                return null
        }
        var s = c.find([A, O, D], function(t) {
            return e[t]
        }) || 0;
        if (s) {
            var l = []
              , u = e[s];
            "_" === u.slice(-1) && "_" === n[r - 1] && (n = n.slice(0, -1),
            e[s] = u = u.slice(0, -1));
            for (var d = 0, p = 0, h = 0; h < u.length; h++) {
                var f = u.charCodeAt(h);
                f === p ? (p = l.pop() || 0,
                0 === p && (d = h)) : f in I ? (0 !== p && l.push(p),
                p = I[f]) : f in R || 0 === p && (d = h)
            }
            for (; 0 !== l.length; )
                l.pop();
            d !== u.length - 1 ? (n = c.compact(e.slice(k, s)).join("") + u.slice(0, d + 1),
            L.lastIndex = r + n.length) : n = n.slice(t)
        } else
            n = n.slice(t);
        var m = n
          , g = e[k];
        return g ? g = g.toLowerCase() : (g = 0 === m.toLowerCase().indexOf("irc.") ? "irc://" : 0 === m.toLowerCase().indexOf("ftp.") ? "ftp://" : e[x] ? "mailto:" : "http://",
        m = g + m),
        {
            href: m,
            url: n,
            index: r,
            input: e.input,
            scheme: g,
            username: e[x],
            domain: e[N],
            port: e[P],
            path: e[D],
            params: e[O],
            anchor: e[A]
        }
    }
    function s(e) {
        var t = o(e);
        return t && t.url === e && "mailto:" === t.scheme && t.username && !t.params && !t.anchor ? t : null
    }
    var c = n(31)
      , l = n(1)
      , u = "abbott|ac|academy|ad|adult|ae|aero|af|ag|agency|ai|al|am|ao|app|ar|as|asia|at|au|audio|ax|az|ba|barclays|bb|bd|be|berlin|best|bet|bf|bg|bh|bi|bid|bike|bio|biz|bj|black|blog|blue|bm|bn|bnpparibas|bo|br|bradesco|brussels|bs|bt|business|buzz|bw|by|bz|bzh|ca|cab|cafe|camera|camp|canon|capital|cards|care|careers|casa|cash|casino|cat|cc|cd|center|cern|cf|cg|ch|chat|cheap|church|ci|city|cl|click|cloud|club|cm|cn|co|coach|codes|coffee|com|community|company|cool|coop|cr|cricket|cu|cv|cx|cy|cz|date|de|deals|desi|design|dev|diamonds|digital|direct|directory|dj|dk|do|dog|domains|download|dz|earth|ec|edu|education|ee|eg|email|engineering|es|et|eu|eus|events|exchange|expert|faith|farm|fi|film|finance|fit|fj|fm|fo|forsale|fr|fund|futbol|fyi|ga|gal|gallery|game|gd|gdn|ge|gg|gh|gi|gift|gl|global|gold|google|gov|gp|gq|gr|graphics|gratis|group|gs|gt|guide|guru|gy|help|hk|hm|hn|horse|host|hosting|house|how|hr|ht|hu|id|ie|il|im|in|info|ink|institute|int|international|io|iq|ir|is|ist|istanbul|it|je|jm|jo|jobs|jp|ke|kg|kh|kim|kitchen|kiwi|koeln|kp|kr|krd|kred|kw|kz|la|land|lat|lb|lc|legal|li|life|limited|link|live|lk|lol|london|love|ls|lt|ltd|lu|lv|ly|ma|market|marketing|md|me|media|men|menu|mg|mil|mk|ml|mm|mn|mo|mobi|moda|moe|monash|money|moscow|movie|mr|ms|mt|mu|museum|mv|mw|mx|my|mz|na|nagoya|name|nc|net|network|news|nf|ng|ngo|ni|nico|ninja|nl|no|np|nr|nu|nyc|nz|office|okinawa|om|one|onl|online|ooo|org|ovh|pa|paris|party|pe|pf|pg|ph|photo|photography|photos|pics|pictures|pink|pk|pl|place|plus|pm|pn|porn|post|pr|press|pro|prod|ps|pt|pub|pw|py|qa|re|red|ren|report|rest|review|reviews|rip|ro|rocks|rs|ru|run|rw|sa|sale|sc|school|science|scot|sd|se|services|sex|sexy|sg|sh|shop|show|si|site|sk|sl|sm|sn|so|social|software|solutions|soy|space|sr|st|store|stream|studio|study|style|su|support|sv|sx|sy|systems|sz|taipei|tc|team|tech|technology|tf|tg|th|tips|tj|tk|tl|tm|tn|to|today|tokyo|tools|top|town|tr|trade|training|travel|tt|tv|tw|tz|ua|ug|uk|uno|uol|us|uy|uz|va|vc|ve|ventures|vg|video|vip|vn|vote|vu|wales|wang|watch|webcam|website|wf|wiki|win|work|works|world|ws|wtf|xyz|ye|yt|za|zm|zone|zw||"
      , d = "(?:http|https)://|mailto:"
      , p = "\\w|[^\\s\0-]|%[0-9a-f][0-9a-f]"
      , h = "(?:" + p + ")|(?:" + p + ")(?:" + p + "|-)*(?:" + p + ")"
      , f = "(?!_)(?:(?:" + h + ")\\.)+(?:" + u + ")(?!\\." + h + ")"
      , m = ":\\d{1,5}"
      , g = "+@!.?,(\\[{<:"
      , v = "(?:" + p + "|[^\\s%])"
      , y = "/" + v + "*?"
      , _ = "[" + g + "]*(?!" + v + "|#)"
      , E = "\\?(?!" + _ + ")" + v + "*?"
      , b = "#" + v + "*?"
      , S = "0-9a-z!#$%&'*+/=?^_`{|}~\\-"
      , M = "\\b\\w[" + S + "]*(?:\\.[" + S + "]+)*"
      , C = "^|\\W\\.|[^/\\w.]|_"
      , T = "(" + C + ")(" + d + ")?(" + M + "@)?(" + f + ")(?:(?!" + h + ")|(?=_))(?:(?=[^:/?#])|(" + m + ")?(" + y + ")?(" + E + ")?(" + b + ")?(?=" + _ + "))"
      , w = 1
      , k = 2
      , x = 3
      , N = 4
      , P = 5
      , D = 6
      , O = 7
      , A = 8
      , R = {
        34: 34,
        39: 39,
        41: 40,
        62: 60,
        93: 91,
        125: 123,
        187: 171,
        8217: 8216,
        8221: 8220
    }
      , I = {
        34: 34,
        39: 39,
        40: 41,
        60: 62,
        91: 93,
        123: 125,
        171: 187,
        8216: 8217,
        8220: 8221
    }
      , L = new RegExp("" + T,"ig");
    e.exports = {
        findLink: o,
        findLinks: i,
        validateEmail: s
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t, n) {
        function r(e) {
            return i ? i(e) : a
        }
        k.log("forwardMediaMsg " + e.id)();
        var i = void 0
          , a = f(e).then(function(n) {
            return !!n || !e.decryptedMediaBlob && t.forceDownloadMedia().then(function() {
                return e.set({
                    url: t.url,
                    clientUrl: t.clientUrl,
                    decryptedMediaBlob: t.decryptedMediaBlob,
                    mediaState: t.mediaState,
                    filehash: t.filehash
                }),
                f(e)
            })
        }).then(function(t) {
            return t ? {
                avParams: e.avParams(),
                mediaKey: e.mediaKey
            } : e.decryptedMediaBlob ? o(e.decryptedMediaBlob, {
                isGif: e.isGif,
                gifAttribution: e.gifAttribution,
                precomputedDuration: e.duration
            }).then(function(e) {
                return g["default"].props(e)
            }).then(function(t) {
                var n = t.getThumb && t.getThumb.url ? O.parseDataURL(t.getThumb.url).data : null ;
                return e.set({
                    decryptedMediaBlob: t.blob,
                    height: t.height,
                    width: t.width,
                    body: n,
                    msgType: t.type,
                    filehash: t.getFilehash,
                    mimetype: t.mimetype
                }),
                (i = t.reupload)(e.to)
            }) : g["default"].reject(new S.MediaMissing("forward media not on phone"))
        }).endWithControls("cancel");
        return e.handleUpload(n, a, r)
    }
    function o(e) {
        var t = arguments.length <= 1 || void 0 === arguments[1] ? void 0 : arguments[1]
          , n = t && t.isGif
          , r = t && t.precomputedDuration
          , i = t && t.gifAttribution
          , o = void 0;
        return new g["default"](function(t, i) {
            if (o = M.typeFromMimetype(e.type))
                if (e.size > v.MAX_MEDIA_UPLOAD_SIZE || "image" === o && e.size > F)
                    i(new S.MediaFileTooLarge(e));
                else if ("document" !== o || T.supportsFeature(T.F.ENC_DOC))
                    if ("image" === o)
                        w.rotateAndResize(e, v.IMG_MAX_EDGE, v.IMG_MAX_EDGE, w.BLOB | w.CANVAS).then(function(e) {
                            var n = e.width
                              , r = e.height
                              , i = e.images;
                            t({
                                blob: i.blob,
                                h: r,
                                w: n,
                                getThumb: w.rotateAndResize(i.canvas, v.IMG_THUMB_MAX_EDGE, v.IMG_THUMB_MAX_EDGE, w.DATA_URL).then(function(e) {
                                    var t = e.images;
                                    return {
                                        url: t.dataUrl
                                    }
                                }),
                                mimetype: "image/jpeg"
                            })
                        })["catch"](i);
                    else if ("video" === o || "audio" === o)
                        t(x.checkAndRepair(e, !!n).then(function(t) {
                            if (!t)
                                return k.error("prepFileForUpload bad video file " + e.type)(e),
                                g["default"].reject(new S.InvalidMediaFileType);
                            var i = t.type;
                            if (e = t.file,
                            n = n || t.isGif,
                            o = M.typeFromMimetype(i),
                            "video" === o)
                                return w.generateVideoThumbAndDuration(e, v.IMG_THUMB_MAX_EDGE, v.IMG_THUMB_MAX_EDGE).then(function(t) {
                                    var n = t.thumb
                                      , r = t.duration;
                                    return {
                                        blob: e,
                                        w: n.fullWidth,
                                        h: n.fullHeight,
                                        getThumb: g["default"].resolve(n),
                                        mimetype: i,
                                        getDuration: g["default"].resolve(r)
                                    }
                                });
                            var a = void 0 === r ? M.getAudioDuration(e) : g["default"].resolve(r);
                            return {
                                blob: e,
                                getThumb: null ,
                                mimetype: i,
                                getDuration: a
                            }
                        }));
                    else if ("document" === o)
                        if (e.type)
                            "*" === L.DOC_MIMES || L.DOC_MIMES.indexOf(e.type) > -1 ? t({
                                blob: e,
                                getThumb: null ,
                                mimetype: e.type
                            }) : i(new S.InvalidMediaFileType("disallowed mimetype: " + e.type));
                        else {
                            var a = M.blobToArrayBuffer(e).then(function(t) {
                                var n, r = C(new Uint8Array(t,0,Math.min(262, e.size)));
                                if (r && r.mime) {
                                    if (n = "*" === L.DOC_MIMES ? r.mime : L.isAllowedDocumentMimetype(r.mime, e.name, !0))
                                        return {
                                            blob: e,
                                            buffer: t,
                                            getThumb: null ,
                                            mimetype: n
                                        }
                                } else if (e.name) {
                                    var i = ""
                                      , o = e.name.split(".");
                                    if (o.length > 1 && (i = o[o.length - 1]),
                                    i.length > 0 && (n = "*" === L.DOC_MIMES ? i in L.EXT_TO_MIME ? L.EXT_TO_MIME[i] : "application/octet-stream" : L.isAllowedDocumentMimetype(L.EXT_TO_MIME[i], e.name, !1)))
                                        return {
                                            blob: e,
                                            buffer: t,
                                            getThumb: null ,
                                            mimetype: n
                                        }
                                }
                                return g["default"].reject(new S.InvalidMediaFileType("type: " + e.type + " name: " + e.name))
                            });
                            t(a)
                        }
                    else
                        t({
                            blob: e,
                            getThumb: null ,
                            mimetype: e.type
                        });
                else
                    i(new S.InvalidMediaFileType);
            else
                i(new S.InvalidMediaFileType("type: " + e.type))
        }
        ).then(function(t) {
            var r = t.blob
              , s = t.buffer
              , c = t.h
              , d = t.w
              , h = t.getThumb
              , f = t.mimetype
              , m = t.getDuration
              , v = s ? g["default"].resolve(s) : M.blobToArrayBuffer(r)
              , _ = M.getHash(v)
              , E = void 0
              , S = void 0
              , C = void 0
              , T = function(t) {
                return p(t, o, f).then(function(i) {
                    if (!i)
                        return _.then(function(e) {
                            var t = e.hash
                              , n = e.size;
                            return A.requestMediaUpload(o, t, n)
                        }).addCancelControl().then(function(n) {
                            var i = n.result
                              , o = n.data;
                            return "duplicate" === i ? {
                                avParams: o
                            } : "ok" === i ? l(o, r, t, e.name).then(function(e) {
                                return {
                                    avParams: e
                                }
                            }) : void 0
                        });
                    var s = function() {
                        E || (E = y.newB64MediaKey(),
                        S = v.then(function(e) {
                            return b.encryptE2EMedia(o, e, E)
                        }),
                        C = S.then(function(e) {
                            return M.getHash(e)
                        }).then(function(e) {
                            var t = e.hash;
                            return t
                        }));
                        var r = a(t, o, E);
                        return {
                            v: C.then(function(e) {
                                var t = "video" === o && n ? "gif" : o;
                                return A.requestEncryptedMediaUpload(t, e)
                            }).addCancelControl().then(function(t) {
                                var n = t.data;
                                return g["default"].all([r, S, C]).addCancelControl().spread(function(t, r, i) {
                                    return u(n, r, e.name, i, t)
                                })
                            }).then(function(e) {
                                return {
                                    avParams: e,
                                    mediaKey: E
                                }
                            })
                        }
                    }();
                    return "object" == typeof s ? s.v : void 0
                }).endWithControls("cancel")
            };
            return {
                blob: r,
                height: c,
                width: d,
                getThumb: h,
                getDuration: m || g["default"].resolve(),
                msgType: o,
                getFilehash: _.then(function(e) {
                    var t = e.hash;
                    return t
                }),
                reupload: T,
                mimetype: f,
                filename: e.name,
                isGif: !("video" !== o || !n) || void 0,
                gifAttribution: i
            }
        })
    }
    function a(e, t, n) {
        var r = void 0
          , i = Store.Conn.me;
        return r = e === i ? [i] : R.isUser(e) ? [e, i] : Store.GroupMetadata.find(e).then(function(e) {
            return e.participants.map(function(e) {
                return e.id
            })
        }),
        g["default"].resolve(r).then(function(e) {
            var r = E.computeKeys(t, n).refKey;
            return y.computeRefs(r, e)
        })
    }
    function s(e) {
        var t = {};
        for (var n in e) {
            var r = e[n]
              , i = parseInt(e[n], 10);
            t[n] = i === i && "" + i === r ? i : r;
        }
        return t
    }
    function c(e, t) {
        var n = e + "?f=j";
        return g["default"].loop(function(e, r, i) {
            if (i > 4)
                throw new S.GaveUpRetry("gave up mms upload after " + i + " tries");
            var o = 3e5 * (i + 1);
            return P.getResponseIfOnline(n, "POST", t).addRawControl("cancel", function(e, t, n) {
                t(new g["default"].CancellationError),
                n.control.cancel()
            }).timeout(o, "postMediaToMMSTimeout").then(function(t) {
                if (!t || 200 !== t.status) {
                    k.log("MediaUpload error: " + (t ? t.status : "offline"))();
                    var n = Math.floor(1e3 * D.expBackoff(i + 1, 60, void 0, .1));
                    return g["default"].all([g["default"].delay(n), N.waitForOnline])
                }
                k.log("MediaUpload success: 200")(),
                e(JSON.parse(t.response))
            })["catch"](g["default"].TimeoutError, _.noop)
        })
    }
    function l(e, t, n, r) {
        var i = new FormData;
        return i.append("from", R.user(Store.Conn.me)),
        i.append("to", R.user(n)),
        i.append("file", t, r),
        c(e, i).then(s)
    }
    function u(e, t, n, r, i) {
        var o = new FormData;
        return o.append("file", t, n),
        o.append("hash", r),
        o.append("refs", i.join("\r\n")),
        c(e, o).then(s)
    }
    function d(e, t, n) {
        var r = new FormData;
        return r.append("hash", t),
        r.append("refs", n.join("\r\n")),
        c(e, r)
    }
    function p(e, t) {
        var n = !1;
        switch (t) {
        case "audio":
        case "ptt":
            n = T.supportsFeature(T.F.ENC_AUDIO);
            break;
        case "video":
            n = T.supportsFeature(T.F.ENC_VIDEO);
            break;
        case "document":
            n = T.supportsFeature(T.F.ENC_DOC);
            break;
        case "image":
            n = T.supportsFeature(T.F.ENC_IMAGE)
        }
        return n ? g["default"].resolve(!0) : g["default"].reject(new S.CapabilityUnsupported)
    }
    function h(e) {
        return e.uploadhash ? g["default"].resolve({
            filehash: e.uploadhash
        }) : e.filehash && !O.isEncryptedMedia(e.clientUrl) ? g["default"].resolve({
            filehash: e.filehash
        }) : I.headRetry(e.clientUrl).then(function(t) {
            if (200 !== t.status)
                throw new S.MediaNeedsReupload;
            var n = t.getResponseHeader("X-WA-Metadata");
            return k.assert(n, "wa-metadata-header-missing", "HEAD " + e.clientUrl + " got " + t.status)(),
            _.fromPairs(n.split("; ").map(function(e) {
                return e.split("=", 2)
            }))
        })
    }
    function f(e) {
        return g["default"].all([p(e.to, e.type, e.mimetype), h(e)]).addCancelControl().spread(function(t, n) {
            var r = n.filehash
              , i = O.isEncryptedMedia(e.clientUrl);
            return t && i ? (e.uploadhash = r,
            A.requestEncryptedMediaUpload(e.type, r).then(function(t) {
                var n = t.data;
                return a(e.to, e.type, e.mediaKey).then(function(e) {
                    return d(n, r, e)
                }).then(function(e) {
                    return !!e.url
                })
            })) : !t && !i && (e.set({
                uploadhash: r,
                filehash: r
            }),
            A.requestMediaUpload(e.type, r, e.size).then(function(e) {
                return "duplicate" === e.result
            }))
        })["catch"](S.MediaNeedsReupload, function() {
            return !1
        })
    }
    var m = n(2)
      , g = r(m)
      , v = n(10)
      , y = n(1112)
      , E = n(214)
      , b = n(1110)
      , S = n(14)
      , M = n(435)
      , C = n(451)
      , T = n(101)
      , w = n(1005)
      , k = n(1)
      , x = n(1099)
      , N = n(141)
      , P = n(46)
      , D = n(103)
      , O = n(83)
      , A = n(45)
      , R = n(23)
      , I = n(1119)
      , L = n(211)
      , F = 26214400;
    e.exports = {
        computeRefs: a,
        prepFileForUpload: o,
        shouldSendEncrypted: p,
        forwardMediaMsg: i
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(208)
      , l = r(c)
      , u = n(207)
      , d = r(u)
      , p = n(1041)
      , h = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            l["default"])(this, (0,
            o["default"])(t).call(this, "_", /(?:^|[*_~\s])_((?:[\S])|(?:\S[^\n]*?\S))_(?=_|\W|$)/g, 1))
        }
        return (0,
        d["default"])(t, e),
        t
    }(p);
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(1010)
      , m = n(1054)
      , g = m.findLinks
      , v = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "match",
            value: function(e) {
                return g(e).map(function(e) {
                    return {
                        0: e.url,
                        href: e.href,
                        input: e.input,
                        index: e.index
                    }
                })
            }
        }]),
        t
    }(f);
    e.exports = v
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(1010)
      , m = n(1009)
      , g = m.matchAll
      , v = n(31)
      , y = function(e) {
        function t(e) {
            (0,
            s["default"])(this, t);
            var n = (0,
            d["default"])(this, (0,
            o["default"])(t).call(this));
            n._map = e;
            var r = v.keys(e).map(v.escapeRegExp).join("|");
            return n._regex = new RegExp("(" + r + ")","g"),
            n
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "match",
            value: function(e) {
                var t = this;
                return g(this._regex, e, function(e) {
                    return e.jid = t._map[e[0]].jid,
                    e
                })
            }
        }, {
            key: "mutate",
            value: function(e) {
                var t = this._map[e];
                return "@" + t.display
            }
        }]),
        t
    }(f);
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(36)
      , o = r(i)
      , a = n(44)
      , s = r(a)
      , c = function() {
        function e(t) {
            (0,
            o["default"])(this, e),
            this.args = t
        }
        return (0,
        s["default"])(e, [{
            key: "onRoot",
            value: function(e) {
                return e
            }
        }, {
            key: "onMutatorNode",
            value: function(e, t) {
                return {
                    mutator: e.mutator,
                    children: t
                }
            }
        }, {
            key: "onDelimiter",
            value: function(e) {
                return e
            }
        }, {
            key: "onText",
            value: function(e) {
                return e
            }
        }]),
        e
    }();
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(208)
      , l = r(c)
      , u = n(207)
      , d = r(u)
      , p = n(1041)
      , h = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            l["default"])(this, (0,
            o["default"])(t).call(this, "~", /(?:^|[*_~\s])~((?:[\S])|(?:\S[^\n]*?\S))~(?=_|\W|$)/g, 1))
        }
        return (0,
        d["default"])(t, e),
        t
    }(p);
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(208)
      , l = r(c)
      , u = n(207)
      , d = r(u)
      , p = n(1041)
      , h = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            l["default"])(this, (0,
            o["default"])(t).call(this, "*", /(?:^|[*_~\s])\*((?:[\S])|(?:\S[^\n]*?\S))\*(?=_|\W|$)/g, 1))
        }
        return (0,
        d["default"])(t, e),
        t
    }(p);
    e.exports = h
}
, , , , , , , , , , , function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(988)
      , o = n(986)
      , a = n(137)
      , s = n(0)
      , c = n(133)
      , l = n(81)
      , u = r.createClass({
        displayName: "Timestamp",
        mixins: [c, l],
        propTypes: {
            chat: r.PropTypes.instanceOf(i),
            msg: r.PropTypes.instanceOf(o)
        },
        componentWillMount: function() {
            this.props.chat && this.addObserver(this.props.chat, "change:previewMessage")
        },
        componentDidMount: function() {
            this.maybeRegMidnight()
        },
        componentDidUpdate: function() {
            this.maybeRegMidnight()
        },
        rerender: function() {
            this.forceUpdate()
        },
        maybeRegMidnight: function() {
            var e = this.timestamp();
            if (e) {
                this.unregCmd("midnight", this.rerender);
                var t = s().startOf("day").subtract(7, "day");
                e >= t.unix() && this.regCmd("midnight", this.rerender)
            }
        },
        timestamp: function() {
            if (this.props.msg)
                return this.props.msg.t;
            var e = this.props.chat.previewMessage;
            return e && e.t
        },
        render: function() {
            var e = this.timestamp();
            return e ? r.createElement("div", {
                className: "chat-meta"
            }, r.createElement("span", {
                className: "chat-time"
            }, a.relativeStr(e))) : null
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(997)
      , a = n(1004)
      , s = n(1033)
      , c = n(1e3)
      , l = n(135)
      , u = l.HotKeys
      , d = r.createClass({
        displayName: "ContactList",
        propTypes: {
            contacts: r.PropTypes.array.isRequired,
            exclude: r.PropTypes.array,
            onClick: r.PropTypes.func,
            onFocusSearch: r.PropTypes.func
        },
        getInitialState: function() {
            this.selection = new c(this.props.contacts,function(e) {
                return e.id
            }
            );
            var e = this.props.exclude;
            return e && (e = _.fromPairs(e.map(function(e) {
                return [e.id, !0]
            }))),
            {
                exclude: e
            }
        },
        componentWillReceiveProps: function(e) {
            this.selection.init(e.contacts)
        },
        onFocusGain: function(e) {
            e.target === i.findDOMNode(this) && (this.selection.index < 0 ? this.focusFirst() : this.selection.reset())
        },
        focusFirst: function() {
            this.selection.setFirst()
        },
        onNextContact: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            this.selection.setNext()
        },
        onPrevContact: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = this.selection.prev();
            t > -1 ? this.selection.setPrev() : (this.selection.unset(),
            this.props.onFocusSearch(e))
        },
        render: function() {
            for (var e, t = this.props.contacts, n = [], i = t.length > 10, c = this.state.exclude || {}, l = "XXX", d = 0; d < t.length; d++) {
                var p = t[d];
                if (e = null ,
                i) {
                    var h = p.header;
                    d < t.length - 1 && h !== t[d + 1].header && (e = "last"),
                    h !== l && (n.push(r.createElement(s, {
                        key: h,
                        header: h
                    })),
                    l = h)
                }
                var f = p.id;
                n.push(r.createElement(a, {
                    contact: p,
                    active: this.selection,
                    className: e,
                    onClick: this.props.onClick,
                    member: c[f],
                    key: f
                }))
            }
            var m = {
                down: this.onNextContact,
                up: this.onPrevContact
            };
            return r.createElement(u, {
                handlers: m,
                onFocus: this.onFocusGain,
                "data-tab": 3
            }, r.createElement(o, {
                className: "chatlist",
                data: n,
                height: 72,
                extraItems: 4
            }))
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(12)
      , a = n(81)
      , s = n(134)
      , c = n(138)
      , l = n(9)
      , u = n(53)
      , d = n(986)
      , p = r.createClass({
        displayName: "AudioTag",
        mixins: [a, s, c],
        propTypes: {
            msg: r.PropTypes.instanceOf(d).isRequired,
            className: r.PropTypes.string,
            controls: r.PropTypes.bool,
            preload: r.PropTypes.string,
            type: r.PropTypes.string,
            onClick: r.PropTypes.func,
            onPlay: r.PropTypes.func,
            onError: r.PropTypes.func,
            autoPlay: r.PropTypes.bool
        },
        componentDidMount: function() {
            var e = i.findDOMNode(this);
            this.regNativeListener(e, "error", this.onPlayerError, !0),
            this.regNativeListener(e, "playing", this.onPlaying),
            this.regCmd("mediaPlaying", this.onOtherPlaying),
            (u.isGecko || u.isSafari) && (this.props.autoPlay ? (this.checkIteration = 0,
            this.checkForSuccessInterval = this.safeInterval(this.checkForSuccess, 250)) : this.props.autoPlay ? this.startCheckForSuccess() : this.regNativeListener(e, "play", this.startCheckForSuccess))
        },
        startCheckForSuccess: function() {
            this.checkIteration = 0,
            this.checkForSuccessInterval = this.safeInterval(this.checkForSuccess, 250)
        },
        clearCheckForSuccess: function() {
            this.checkForSuccessInterval && (this.clearSafeInterval(this.checkForSuccessInterval),
            delete this.checkForSuccessInterval,
            delete this.checkIteration)
        },
        checkForSuccess: function() {
            if (o.state === o.STATE.CONNECTED) {
                if (this.checkIteration++,
                this.checkIteration > 40)
                    return void this.onPlayerError({
                        target: {
                            src: this.state.src,
                            error: {
                                code: window.MediaError.MEDIA_ERR_NETWORK
                            }
                        }
                    });
                var e = i.findDOMNode(this)
                  , t = e.buffered;
                t && t.length && t.end(0) > 0 && this.onPlaying({
                    target: e
                })
            }
        },
        onPlayerError: function(e) {
            this.clearCheckForSuccess(),
            this.props.onError(e.target.src)
        },
        onOtherPlaying: function(e) {
            e !== this && i.findDOMNode(this).pause()
        },
        onPlaying: function(e) {
            this.clearCheckForSuccess(),
            l.mediaPlaying(this),
            this.props.onPlay && this.props.onPlay(e)
        },
        render: function() {
            return r.createElement("audio", {
                src: this.props.msg.url,
                className: this.props.className,
                onClick: this.props.onClick,
                controls: this.props.controls,
                preload: this.props.preload,
                type: this.props.type,
                autoPlay: this.props.autoPlay
            }, this.props.children)
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(988)
      , o = n(987)
      , a = n(995)
      , s = r.createClass({
        displayName: "DeleteMenuItem",
        mixins: [o],
        propTypes: {
            chat: r.PropTypes.instanceOf(i).isRequired,
            onDeleteOrExit: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                isReadOnly: this.async("chat.isReadOnly")
            }
        },
        render: function() {
            var e;
            switch (this.props.chat.kind) {
            case i.KIND.GROUP:
                e = this.props.chat.isReadOnly ? l10n.t("web_delete_group") : l10n.t("web_exit_group");
                break;
            case i.KIND.BROADCAST:
                e = l10n.t("web_delete_list");
                break;
            case i.KIND.CHAT:
                e = l10n.t("delete_chat")
            }
            return r.createElement(a, {
                a8n: "mi-delete",
                action: this.props.onDeleteOrExit,
                shortcut: "x"
            }, e)
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(133)
      , o = n(989)
      , a = n(14)
      , s = n(1038)
      , c = n(1037)
      , l = r.createClass({
        displayName: "GroupSubtitle",
        mixins: [i],
        propTypes: {
            presence: r.PropTypes.instanceOf(s),
            groupMetadata: r.PropTypes.instanceOf(c),
            placeholder: r.PropTypes.node,
            location: r.PropTypes.oneOf(["list", "title"])
        },
        componentWillMount: function() {
            Store.GroupMetadata.find(this.props.groupMetadata.id)["catch"](a.WapDrop, _.noop);
            var e = this.props.groupMetadata.participants;
            this.addObserver(e, "sort remove reset"),
            "list" !== this.props.location && this.addObserver(this.props.presence, "change:chatstate.id change:chatstate.type change:forceDisplay change:withholdDisplay")
        },
        getSubtitle: function() {
            return this.props.groupMetadata.participants.map(function(e) {
                return e.contact.formattedShortNameWithNonBreakingSpaces
            }).join(", ")
        },
        render: function() {
            var e, t = this.props.presence;
            return "list" === this.props.location ? (e = this.getSubtitle(),
            e ? r.createElement(o, {
                ellipsify: !0,
                titlify: !0,
                text: e
            }) : null ) : (e = t.withholdDisplay ? this.props.placeholder : t.getFormattedString() || (t.forceDisplay ? this.getSubtitle() : this.getSubtitle() || this.props.placeholder),
            e ? r.createElement("div", {
                className: "chat-status ellipsify"
            }, r.createElement(o, {
                ellipsify: !0,
                titlify: !0,
                text: e
            })) : null )
        }
    });
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(892)
      , o = r(i)
      , a = n(6)
      , s = a.createClass({
        displayName: "IsolatedBlock",
        propTypes: {
            Component: a.PropTypes.string.isRequired
        },
        getDefaultProps: function() {
            return {
                Component: "span"
            }
        },
        render: function() {
            var e = this.props
              , t = e.Component
              , n = e.children
              , r = (0,
            o["default"])(e, ["Component", "children"]);
            return a.createElement(t, r, "", n, "")
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e) {
        var t = e.duration
          , n = v.durationStr(t);
        return n ? m.createElement("span", {
            className: "media-canvas-duration"
        }, n) : null
    }
    var o = n(52)
      , a = r(o)
      , s = n(36)
      , c = r(s)
      , l = n(44)
      , u = r(l)
      , d = n(208)
      , p = r(d)
      , h = n(207)
      , f = r(h)
      , m = n(6)
      , g = n(986)
      , v = n(137)
      , y = n(1021)
      , _ = function(e) {
        function t() {
            (0,
            c["default"])(this, t);
            var e = (0,
            p["default"])(this, (0,
            a["default"])(t).apply(this, arguments));
            return e.onSelectClick = function(t) {
                e.props.onMessageSelect && e.props.onMessageSelect(e.props.msg, !e.props.selected)
            }
            ,
            e.onMouseOver = function(t) {
                e.state.hover || e.setState({
                    hover: !0
                })
            }
            ,
            e.onMouseEnter = function(t) {
                e.state.hover || e.setState({
                    hover: !0
                })
            }
            ,
            e.onMouseLeave = function(t) {
                e.state.hover && e.setState({
                    hover: !1
                })
            }
            ,
            e.state = {
                hover: !1
            },
            e
        }
        return (0,
        f["default"])(t, e),
        (0,
        u["default"])(t, [{
            key: "render",
            value: function() {
                var e = this.props
                  , t = e.msg
                  , n = e.selected
                  , r = e.selectable
                  , o = void 0
                  , a = null
                  , s = null
                  , c = null
                  , l = null ;
                switch (t.type) {
                case g.TYPE.AUDIO:
                    o = "media-canvas attach-media-audio-thumb",
                    s = m.createElement("span", {
                        className: "icon-s icon-msg-audio-light"
                    }),
                    c = m.createElement(i, {
                        duration: t.duration
                    });
                    break;
                case g.TYPE.VIDEO:
                    a = m.createElement("div", {
                        className: "shade"
                    }),
                    t.isGif ? (o = t.body ? "media-canvas" : "media-canvas media-video-thumb",
                    s = m.createElement("span", {
                        className: "icon-s icon-msg-gif-light"
                    })) : (o = "media-canvas",
                    s = m.createElement("span", {
                        className: "icon-s icon-msg-video-light"
                    }),
                    c = m.createElement(i, {
                        duration: t.duration
                    })),
                    t.body && (l = {
                        backgroundImage: 'url("data:image/jpeg;base64,' + t.body + '")'
                    });
                    break;
                case g.TYPE.IMAGE:
                    o = "media-canvas",
                    t.url ? l = {
                        backgroundImage: "url(" + t.url + ")"
                    } : t.body && (l = {
                        backgroundImage: 'url("data:image/jpeg;base64,' + t.body + '")'
                    })
                }
                var u = void 0;
                u = this.props.onDragStart ? m.createElement("div", {
                    className: o,
                    style: l,
                    onClick: this.props.onClick || null ,
                    ref: "img",
                    onDragStart: this.props.onDragStart,
                    draggable: !0
                }) : m.createElement("div", {
                    className: o,
                    style: l,
                    onClick: this.props.onClick || null ,
                    ref: "img"
                });
                var d = r || this.state.hover ? m.createElement("div", {
                    className: "media-select",
                    onClick: this.onSelectClick
                }, m.createElement("div", {
                    className: "shade"
                }), m.createElement(y, {
                    onChange: this.onSelectClick,
                    checked: n
                })) : null
                  , p = null
                  , h = null
                  , f = null ;
                return this.props.hoverEvent && (p = this.onMouseOver,
                h = this.onMouseEnter,
                f = this.onMouseLeave),
                m.createElement("div", {
                    className: this.props.classes,
                    onMouseOver: p,
                    onMouseEnter: h,
                    onMouseLeave: f
                }, d, u, a, s, c)
            }
        }]),
        t
    }(m.Component);
    e.exports = _
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(988)
      , o = n(987)
      , a = n(995)
      , s = r.createClass({
        displayName: "MuteMenuItem",
        mixins: [o],
        propTypes: {
            chat: r.PropTypes.instanceOf(i).isRequired,
            onMute: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                isMuted: this.async("chat.mute.isMuted")
            }
        },
        render: function() {
            var e = this.props.onMute.bind(null , !this.state.isMuted);
            return r.createElement(a, {
                action: e,
                shortcut: "m",
                a8n: "mi-mute"
            }, this.state.isMuted ? l10n.t("web_menuitem_mute_off") : l10n.t("web_menuitem_mute"))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(987)
      , o = n(9)
      , a = n(1048)
      , s = n(1021)
      , c = n(988)
      , l = n(429)
      , u = r.createClass({
        displayName: "MuteRow",
        mixins: [i],
        propTypes: {
            chat: r.PropTypes.instanceOf(c).isRequired
        },
        getInitialState: function() {
            return this.asyncState({
                isMuted: "chat.mute.isMuted"
            })
        },
        onMute: function(e) {
            o.muteChat(this.props.chat, e, this)
        },
        onUnmute: function() {
            var e = this.props.chat.isGroup ? l10n.t("confirm_unmute_group") : l10n.t("confirm_unmute_chat");
            o.openModal(r.createElement(l, {
                onOK: this.unmute,
                okText: l10n.t("action_chat_unmute"),
                onCancel: function() {
                    return o.closeModal()
                },
                cancelText: l10n.t("web_cancel")
            }, e))
        },
        unmute: function() {
            this.onMute(!1),
            o.closeModal()
        },
        render: function() {
            var e = this
              , t = this.props.chat.mute.isMuted
              , n = t ? this.onUnmute : function() {
                e.onMute(!0)
            }
              , i = r.createElement(s, {
                checked: t,
                onChange: n
            })
              , o = t ? l10n.t("web_chat_muted") : l10n.t("web_menuitem_mute");
            return r.createElement(a, {
                classes: "row-drawer-item",
                side: i,
                onClick: n,
                ellipsify: !0
            }, r.createElement("span", {
                className: "title"
            }, o))
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(436)
      , o = r(i)
      , a = n(894)
      , s = r(a)
      , c = n(36)
      , l = r(c)
      , u = n(44)
      , d = r(u)
      , p = function() {}
      , h = function() {
        function e() {
            (0,
            l["default"])(this, e),
            this.internalHandlers = new s["default"]
        }
        return (0,
        d["default"])(e, [{
            key: "initialize",
            value: function(e) {
                this.ctx = e
            }
        }, {
            key: "registerHandler",
            value: function(e, t) {
                this.internalHandlers.set(e, t)
            }
        }, {
            key: "unregisterHandler",
            value: function(e) {
                this.internalHandlers["delete"](e)
            }
        }, {
            key: "handle",
            value: function(e) {
                var t = arguments.length <= 1 || void 0 === arguments[1] ? [] : arguments[1];
                return (this.internalHandlers.get(e) || p).apply(void 0, (0,
                o["default"])(t))
            }
        }]),
        e
    }();
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(436)
      , o = r(i)
      , a = n(433)
      , s = r(a)
      , c = n(54)
      , l = r(c)
      , u = function(e) {
        for (var t = {
            edges: {}
        }, n = t, r = 0; r < e.length; ++r) {
            for (var i = e[r], o = 0; o < i.length; ++o) {
                var a = i[o];
                n.edges[a] || (n.edges[a] = {
                    edges: {}
                }),
                n = n.edges[a],
                o === i.length - 1 && (n.idx = r)
            }
            n = t
        }
        return t
    }
      , d = (0,
    l["default"])(n(449))
      , p = u(d)
      , h = function(e, t) {
        for (var n = [], r = e.length, i = t, o = 0, a = void 0; (a = o) < r; ) {
            var s = i.edges[e[o++]];
            if (s) {
                i = s;
                for (var c = i.idx; (i = i.edges[e[o]]) && ++o; )
                    void 0 !== i.idx && (c = i.idx);
                void 0 === c ? o = a + 1 : n.push([a, o - 1]),
                i = t
            }
        }
        return n
    }
      , f = function(e) {
        for (var t = [], n = 0, r = e.length; n < r; ) {
            var i = e.charCodeAt(n++);
            if (i >= 55296 && i <= 56319 && n < r) {
                var o = e.charCodeAt(n++);
                if (56320 === (64512 & o)) {
                    t.push(e.substr(n - 2, n - 1));
                    continue
                }
                --n
            }
            t.push(e[n - 1])
        }
        return t
    };
    e.exports = function(e) {
        if (!e || !e.length)
            return [];
        for (var t = [], n = 0, r = h(e, p), i = 0; i < r.length; ++i) {
            var a = (0,
            s["default"])(r[i], 2)
              , c = a[0]
              , l = a[1];
            c !== n && t.push.apply(t, (0,
            o["default"])(f(e.substring(n, c)))),
            t.push(e.slice(c, l + 1)),
            n = l + 1
        }
        return n < e.length && t.push.apply(t, (0,
        o["default"])(f(e.substr(n)))),
        t
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(1047);
    e.exports = r({
        CHANGE: void 0,
        MOUNT: void 0
    })
}
, function(e, t, n) {
    "use strict";
    var r = n(1047);
    e.exports = r({
        SEARCH: void 0,
        INACTIVE: void 0,
        ENTER: void 0,
        TAB: void 0,
        DOWN: void 0,
        UP: void 0
    })
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = r.createClass({
        displayName: "Tooltip",
        propTypes: {
            body: r.PropTypes.node.isRequired,
            direction: r.PropTypes.oneOf(["top", "right", "bottom", "left"]).isRequired
        },
        render: function() {
            var e = "tooltip " + this.props.direction;
            return r.createElement("div", {
                className: e
            }, this.props.body)
        }
    });
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(987)
      , o = n(989)
      , a = n(1038)
      , s = r.createClass({
        displayName: "UserSubtitle",
        mixins: [i],
        propTypes: {
            presence: r.PropTypes.instanceOf(a),
            placeholder: r.PropTypes.node,
            location: r.PropTypes.oneOf(["list", "title"])
        },
        getInitialState: function() {
            return {
                hasData: this.async("presence.hasData"),
                type: this.async("presence.chatstate.type"),
                deny: this.async("presence.chatstate.deny"),
                t: this.async("presence.chatstate.t"),
                forceDisplay: this.async("presence.forceDisplay"),
                withholdDisplay: this.async("presence.withholdDisplay")
            }
        },
        render: function() {
            var e, t = this.props.presence;
            return "list" === this.props.location ? (e = t.getFormattedString(),
            e ? r.createElement(o, {
                ellipsify: !0,
                titlify: !0,
                text: e
            }) : null ) : (e = t.withholdDisplay ? this.props.placeholder : t.getFormattedString() || (t.forceDisplay ? "" : this.props.placeholder),
            e ? r.createElement("div", {
                className: "chat-status ellipsify"
            }, r.createElement(o, {
                ellipsify: !0,
                titlify: !0,
                text: e
            })) : null )
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(134)
      , a = n(893)
      , s = r.createClass({
        displayName: "Video",
        mixins: [o, a],
        propTypes: {
            src: r.PropTypes.string.isRequired,
            onPlay: r.PropTypes.func
        },
        componentDidMount: function() {
            var e = i.findDOMNode(this)
              , t = this;
            this.regNativeListener(e, "playing", function(n) {
                e.videoHeight && e.videoWidth || (e.pause(),
                e.play()),
                e.videoHeight && e.videoWidth && t.props.onPlay(n)
            })
        },
        render: function() {
            return r.createElement("video", this.props)
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(12)
      , a = n(81)
      , s = n(134)
      , c = n(138)
      , l = n(9)
      , u = n(53)
      , d = n(986)
      , p = n(10)
      , h = r.createClass({
        displayName: "VideoTag",
        mixins: [a, s, c],
        propTypes: {
            msg: r.PropTypes.instanceOf(d).isRequired,
            poster: r.PropTypes.string,
            style: r.PropTypes.object,
            className: r.PropTypes.string,
            controls: r.PropTypes.bool,
            width: r.PropTypes.number,
            height: r.PropTypes.number,
            onClick: r.PropTypes.func,
            onPlay: r.PropTypes.func,
            onError: r.PropTypes.func,
            autoPlay: r.PropTypes.bool,
            loop: r.PropTypes.bool,
            muted: r.PropTypes.bool,
            onLoad: r.PropTypes.func,
            onResize: r.PropTypes.func
        },
        componentDidMount: function() {
            var e = i.findDOMNode(this)
              , t = this.props.msg;
            t.isGif || (this.regNativeListener(e, "playing", this.onPlaying),
            this.regCmd("mediaPlaying", this.onOtherPlaying)),
            this.regNativeListener(e, "error", this.onPlayerError, !0),
            (u.isGecko || u.isSafari) && (this.props.autoPlay ? this.startCheckForSuccess() : this.regNativeListener(e, "play", this.startCheckForSuccess))
        },
        startCheckForSuccess: function() {
            this.checkIteration = 0,
            this.checkForSuccessInterval = this.safeInterval(this.checkForSuccess, 250)
        },
        clearCheckForSuccess: function() {
            this.checkForSuccessInterval && (this.clearSafeInterval(this.checkForSuccessInterval),
            delete this.checkForSuccessInterval,
            delete this.checkIteration)
        },
        checkForSuccess: function() {
            if (o.state === o.STATE.CONNECTED) {
                if (this.checkIteration++,
                this.checkIteration > 240)
                    return void this.onPlayerError({
                        target: {
                            src: this.props.src,
                            error: {
                                code: window.MediaError.MEDIA_ERR_NETWORK
                            }
                        }
                    });
                var e = i.findDOMNode(this)
                  , t = e.buffered;
                t && t.length && t.end(0) > 0 && this.onPlaying({
                    target: e
                })
            }
        },
        onPlayerError: function(e) {
            this.clearCheckForSuccess(),
            this.props.onError && this.props.onError(e)
        },
        onOtherPlaying: function(e) {
            e !== this && i.findDOMNode(this).pause()
        },
        onPlaying: function(e) {
            this.clearCheckForSuccess(),
            l.mediaPlaying(this),
            this.props.onPlay && this.props.onPlay(e)
        },
        render: function() {
            var e = this.props.msg
              , t = e.streamable && !e.url ? p.VIDEO_STREAM_URL + "?key=" + e.id.toString() : e.url;
            return r.createElement("video", {
                src: t,
                poster: this.props.poster,
                style: this.props.style,
                width: this.props.width,
                height: this.props.height,
                className: this.props.className,
                onClick: this.props.onClick,
                controls: this.props.controls,
                autoPlay: this.props.autoPlay,
                loop: this.props.loop,
                muted: this.props.muted,
                onEnded: this.props.onEnded,
                onLoadStart: this.props.onLoad
            }, this.props.children)
        }
    });
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(2)
      , s = r(a)
      , c = n(6)
      , l = n(37)
      , u = n(10)
      , d = n(988)
      , p = n(1096)
      , h = n(1155)
      , f = n(81)
      , m = n(138)
      , g = n(987)
      , v = n(133)
      , y = n(9)
      , E = n(429)
      , b = n(14)
      , S = n(435)
      , M = n(83)
      , C = n(1097)
      , T = n(1195)
      , w = n(1095)
      , k = n(1170)
      , x = n(1054)
      , N = n(1)
      , P = n(992)
      , D = n(998)
      , O = n(101)
      , A = n(43)
      , R = n(209)
      , I = n(67)
      , L = n(1142)
      , F = n(140)
      , U = n(135)
      , j = U.HotKeys
      , B = n(1194)
      , G = function() {
        return O.supportsFeature(O.F.LINK_PREVIEW) || O.supportsFeature(O.F.SEND_LINK_PREVIEW) && !1
    }
      , Y = c.createClass({
        displayName: "ComposeBox",
        mixins: [f, m, g, P, v],
        propTypes: {
            chat: c.PropTypes.instanceOf(d).isRequired,
            onPageUpDown: c.PropTypes.func.isRequired,
            onComposeHeightChange: c.PropTypes.func
        },
        getInitialState: function() {
            var e = this.props.chat;
            this.text = e.composeContents.text || "",
            this.selection = e.composeContents.selection,
            this.omittedURL = e.composeContents.omittedURL,
            this.pendingLinkPreviewPromises = [],
            this.preview = this.omittedURL,
            this.scanForLinks = this.safeDebounce(this._scanForLinks, 500);
            var t;
            return t = 0,
            {
                trusted: this.async("chat.trusted"),
                hasText: !!this.text,
                emojiExpanded: !1,
                recording: !1,
                linkPreview: null ,
                quotedMsg: e.composeQuotedMsg,
                textsize: t
            }
        },
        componentWillMount: function() {
            var e = this.props.chat;
            e.composeContents = {},
            this.regCmd("focus_chat_text_input_" + this.props.chat.id, this.restoreFocus),
            this.regCmd("focus_chat_text_input", this.restoreFocus),
            this.regCmd("paste_chat_text_input_" + this.props.chat.id, this.pasteEmojiInput),
            this.regCmd("enter_chat_text_input_" + this.props.chat.id, this.onSendText),
            this.addObserver(e, "change:composeQuotedMsg", this.onQuotedMsgChange)
        },
        componentDidMount: function() {
            var e = this;
            this.height = l.findDOMNode(this.refs.composeBlock).clientHeight,
            G() && this.scanForLinks(),
            this.regCmd("textsize_change", function(t) {
                e.setState({
                    textsize: t
                })
            })
        },
        componentWillUnmount: function() {
            var e = this.props.chat;
            e.composeContents.text = this.text,
            e.composeContents.selection = this.selection,
            e.composeContents.omittedURL = this.omittedURL
        },
        pasteEmojiInput: function(e) {
            return " " !== e || this.hasText() ? void (this.refs.input && (this.refs.input.focus(!0),
            this.refs.input.replaceSelection(e))) : y.scrollMessages()
        },
        onMaxPasteExceeded: function() {
            y.openModal(c.createElement(E, {
                title: l10n.t("message_too_large_title"),
                onOK: y.closeModal.bind(y),
                okText: l10n.t("web_ok")
            }, l10n.t("message_too_large_text")))
        },
        restoreFocus: function() {
            this.refs.input && this.refs.input.focus()
        },
        clearLinkPreview: function() {
            this.preview = null ,
            this.omitLinkPreview()
        },
        cancelPendingLinkPreviews: function() {
            _.forEach(this.pendingLinkPreviewPromises, function(e) {
                return e.cancel()
            }),
            this.pendingLinkPreviewPromises = []
        },
        omitLinkPreview: function(e) {
            e !== !0 && this.state.linkPreview && (this.setState({
                linkPreview: null
            }),
            this.omittedURL = this.preview)
        },
        omitQuotedPreview: function(e) {
            e !== !0 && (this.props.chat.composeQuotedMsg = null )
        },
        _findFirstWebLink: function() {
            return _.head(x.findLinks(this.text).filter(function(e) {
                var t = e.url;
                return M.isHttp(t)
            }))
        },
        _scanForLinks: function() {
            var e = this;
            if (!this.state.hasText)
                return void this.clearLinkPreview();
            var t = this._findFirstWebLink();
            if (!t)
                return void this.clearLinkPreview();
            var n = t.url;
            if (!this.preview || this.preview !== n) {
                this.preview = n,
                this.omittedURL = null ;
                var r = d.linkPreview(n).checkpoint(this.rejectOnUnmount()).cancellable();
                this.pendingLinkPreviewPromises.push(r),
                r.then(function(t) {
                    var n = t.url
                      , r = t.data;
                    e.preview && e.preview !== n || (r.title || r.description) && e.setState({
                        linkPreview: r
                    })
                })["catch"](b.Unmount, _.noop)["catch"](b.WapDrop, _.noop)["catch"](s["default"].CancellationError, _.noop)
            }
        },
        onQuotedMsgChange: function() {
            var e = this.props.chat
              , t = !1;
            (this.state.quotedMsg ? !e.composeQuotedMsg : e.composeQuotedMsg) && (t = !0),
            t && !e.composeQuotedMsg ? this.setState({
                quotedMsg: null
            }) : this.setState({
                quotedMsg: e.composeQuotedMsg
            })
        },
        indicateFocus: function(e) {
            var t = this.refs.container;
            if (t && t.activate(),
            !(Date.now() - (j.flashFocus || 0) > 200)) {
                var n = l.findDOMNode(this.refs.input_hotkey);
                Velocity(n, "stop"),
                Velocity(n, {
                    backgroundColor: ["#ffffff", "#D9F3FF"],
                    borderColor: ["#ffffff", "#CBE4EF"]
                }, {
                    duration: 1300,
                    easing: [.24, .91, .01, .99]
                }),
                this.refs.input.focus(!1)
            }
        },
        onPageUpDown: function(e) {
            var t = this;
            this.props.onPageUpDown && (e.stopPropagation(),
            this.props.onPageUpDown(e),
            this.safeDefer(function() {
                return t.refs.input && t.refs.input.focus(!0)
            }))
        },
        handleEmoji: function(e) {
            this.refs.input.focus(!1),
            this.refs.input.replaceSelection(e)
        },
        handleGif: function(e, t) {
            var n = F.get(e, F.RESP_TYPE.BLOB).then(function(e) {
                var n = e.response;
                return n.isGifHackDoNotUse = !0,
                n.gifAttributionHackDoNotUse = t,
                n
            })["catch"](function(e) {
                throw N.error("failed loading gif (" + e + ")")(),
                new b.MediaFileFailedLoad
            });
            this.closeEmojiPanel(),
            y.attachMediaDrawer(this.props.chat, [n])
        },
        openEmojiPanel: function() {
            this.state.emojiExpanded !== !0 && this.setState({
                emojiExpanded: !0
            })
        },
        closeEmojiPanel: function() {
            this.state.emojiExpanded !== !1 && this.setState({
                emojiExpanded: !1
            })
        },
        onPTT: function(e) {
            this.setState({
                recording: e === B.REC
            })
        },
        preventBlur: function(e) {
            var t = e.target
              , n = l.findDOMNode(this.refs.input)
              , r = l.findDOMNode(this.refs.container);
            do
                if (t === n)
                    return;
            while (t !== r && (t = t.parentNode));e.preventDefault(),
            e.stopPropagation(),
            this.refs.input.focus(!1)
        },
        onChange: function(e) {
            var t = l.findDOMNode(this.refs.composeBlock)
              , n = t.clientHeight
              , r = n - this.height;
            r && this.props.onComposeHeightChange({
                input: r
            }),
            this.height = n;
            var i = this.hasText();
            this.text = e;
            var o = this.hasText();
            if (o !== i && this.setState({
                hasText: o
            }),
            o ? (this.props.chat.presence.subscribe()["catch"](b.WapDrop, _.noop),
            this.props.chat.markComposing()) : this.props.chat.markPaused(),
            G()) {
                var a = this._findFirstWebLink();
                (!a && this.preview || a && a.url !== this.preview) && this.clearLinkPreview(),
                this.scanForLinks()
            }
        },
        _getSendButton: function() {
            var e = navigator.getUserMedia && window.AudioContext;
            if (this.state.hasText || !e)
                return c.createElement("button", {
                    className: "icon btn-icon icon-send send-container",
                    onClick: this.onSendText,
                    disabled: !this.hasText
                });
            var t = this.props.chat;
            return c.createElement(B, {
                key: "ptt",
                chat: t,
                onStateChange: this.onPTT
            })
        },
        _getPopupPanel: function() {
            var e = void 0;
            this.state.linkPreview && (e = c.createElement(R, {
                displayName: "ComposeBoxLinkPreview",
                escapable: !0,
                requestDismiss: this.omitLinkPreview
            }, c.createElement("div", {
                className: "compose-popup-panel"
            }, c.createElement(k, (0,
            o["default"])({
                onOmit: this.omitLinkPreview
            }, this.state.linkPreview)))));
            var t = void 0;
            this.state.quotedMsg && (t = c.createElement(R, {
                displayName: "ComposeBoxQuotedMsg",
                escapable: !0,
                requestDismiss: this.omitQuotedPreview
            }, c.createElement("div", {
                className: "compose-popup-panel"
            }, c.createElement(w, {
                msg: this.state.quotedMsg,
                onOmit: this.omitQuotedPreview,
                chat: this.state.quotedMsg.chat
            }))));
            var n = null ;
            return this.state.emojiExpanded && (n = c.createElement(R, {
                displayName: "ComposeBoxEmojiPanel",
                escapable: !0,
                requestDismiss: this.closeEmojiPanel
            }, c.createElement(p, {
                key: "compose-emoji-panel",
                ref: "emojiPanel",
                onEmoji: this.handleEmoji,
                onGif: u.SHOW_GIF_SEARCH ? this.handleGif : void 0,
                text: this.text
            }))),
            c.createElement("div", {
                className: "compose-box-items-positioning-container"
            }, c.createElement("div", {
                className: "compose-box-items-overlay-container"
            }, c.createElement(L, {
                onHeightChange: this.onHeightChange
            }, n, t, e)))
        },
        onHeightChange: function(e, t) {
            this.props.onComposeHeightChange({
                overlay: e
            }, t)
        },
        onFiles: function(e) {
            var t = e.getFiles()
              , n = _.filter(t, function(e) {
                var t = S.typeFromMimetype(e.type);
                return "image" === t || "video" === t
            });
            if (n.length) {
                var r = _.reject(t, {
                    kind: "string",
                    type: "text/html"
                });
                if (r.length === n.length)
                    return void y.openDrawerMid(c.createElement(C, {
                        files: n,
                        chat: this.props.chat
                    }), "slide-up", this.context.uim)
            }
        },
        onSelectionChange: function(e) {
            this.selection = e
        },
        hasText: function() {
            return Y.hasText = this.text.trim().length > 0
        },
        onSendText: function() {
            var e = this.text.trim();
            if (e.length) {
                var t = /\u200B((\d+)@c\.us)\u200B/g
                  , n = []
                  , r = e.replace(t, function(e, t, r) {
                    return n.push(t),
                    "@" + r
                });
                this.props.chat.sendMessage(D.emojify(r), this.state.linkPreview, this.props.chat.composeQuotedMsg, n),
                this.cancelPendingLinkPreviews(),
                this.setState({
                    emojiExpanded: !1,
                    hasText: !1,
                    linkPreview: null ,
                    quotedMsg: this.props.chat.composeQuotedMsg = null
                }),
                this.props.chat.composeContents = {},
                this.refs.input.reset(),
                this.text = "",
                this.hasText()
            }
        },
        onKeyDown: function(e) {
            if (" " !== e.key)
                return !1;
            var t = "" === this.text;
            return t && y.scrollMessages(),
            t
        },
        onTab: function(e) {
            return y.rotateFocus(e),
            !0
        },
        render: function() {
            var e, t = this, n = this.props.chat, r = this.state.emojiExpanded ? c.createElement("button", {
                className: "icon icon-hide btn-emoji",
                onClick: this.closeEmojiPanel
            }) : c.createElement("button", {
                className: "icon icon-smiley btn-emoji",
                onClick: this.openEmojiPanel
            }), i = A("input-container", {
                disabled: this.state.recording
            }), o = {
                pagedown: this.onPageUpDown,
                pageup: this.onPageUpDown
            }, a = l10n.t("type_a_message"), s = O.supportsFeature(O.F.SPAM) ? c.createElement(T, {
                chat: n
            }) : null , l = _.find(u.TEXTSIZE_CLASS_MAP, function(e) {
                return e.scale === t.state.textsize
            });
            l && (e = l.classname);
            var d = A("block-compose", e, {
                "ptt-open": this.state.recording
            });
            return c.createElement(R, {
                displayName: "ComposeBox",
                ref: "container",
                state: R.State.PASSIVE,
                requestFocus: this.restoreFocus
            }, c.createElement(j, {
                component: "footer",
                handlers: o,
                className: "pane-footer pane-chat-footer",
                onMouseDown: this.preventBlur,
                onContextMenu: this.preventBlur
            }, s, c.createElement("div", {
                className: d,
                ref: "composeBlock"
            }, r, c.createElement(j, {
                ref: "input_hotkey",
                className: i,
                onFocus: this.indicateFocus
            }, c.createElement(h, {
                placeholder: a,
                readOnly: this.state.recording,
                ref: "input",
                initialValue: this.text,
                initialSelection: this.selection,
                spellCheck: !0,
                multiline: !0,
                maxLength: u.MAX_TXT_MSG_SIZE,
                onMaxPasteExceeded: this.onMaxPasteExceeded,
                onEnter: this.onSendText,
                onFiles: this.onFiles,
                onChange: this.onChange,
                onSelect: this.onSelectionChange,
                className: "input",
                onKeyDown: this.onKeyDown,
                onTab: this.onTab
            })), this._getSendButton()), this._getPopupPanel(), c.createElement(h.Suggestions, {
                chat: this.props.chat
            })))
        }
    });
    Y.contextTypes = {
        uim: c.PropTypes.instanceOf(I)
    },
    e.exports = Y
}
, function(e, t, n) {
    "use strict";
    function r(e, t) {
        var n = [];
        return n.push(a.createElement(c, {
            key: "info",
            a8n: "mi-group-info",
            action: function() {
                return s.chatInfoDrawer(e)
            },
            shortcut: "i"
        }, l10n.t("web_group_info"))),
        n.push(a.createElement(c, {
            a8n: "mi-select-messages",
            key: "select",
            action: t,
            shortcut: "e"
        }, l10n.t("web_select_messages"))),
        e.mute.canMute() && n.push(a.createElement(l, {
            key: "mute",
            onMute: function(t) {
                return s.muteChat(e, t)
            },
            chat: e
        })),
        e.canClear() && n.push(a.createElement(c, {
            key: "clear",
            a8n: "mi-clear",
            shortcut: "e",
            action: function() {
                return s.clearChatMsgs(e)
            }
        }, l10n.t("clear_chat"))),
        e.canDelete() && n.push(a.createElement(u, {
            key: "delete",
            onDeleteOrExit: function() {
                return s.deleteOrExitChat(e)
            },
            chat: e
        })),
        n
    }
    function i(e, t) {
        var n = [];
        return n.push(a.createElement(c, {
            key: "info",
            a8n: "mi-broadcast-info",
            action: function() {
                return s.chatInfoDrawer(e)
            },
            shortcut: "i"
        }, l10n.t("web_list_info"))),
        n.push(a.createElement(c, {
            a8n: "mi-select-messages",
            key: "select",
            action: t,
            shortcut: "e"
        }, l10n.t("web_select_messages"))),
        e.canClear() && n.push(a.createElement(c, {
            key: "clear",
            a8n: "mi-clear",
            shortcut: "e",
            action: function() {
                return s.clearChatMsgs(e)
            }
        }, l10n.t("clear_chat"))),
        e.canDelete() && n.push(a.createElement(u, {
            key: "delete",
            onDeleteOrExit: function() {
                return s.deleteOrExitChat(e)
            },
            chat: e
        })),
        n
    }
    function o(e, t) {
        var n = [];
        return e.isPSA || n.push(a.createElement(c, {
            key: "info",
            a8n: "mi-contact",
            action: function() {
                return s.chatInfoDrawer(e)
            },
            shortcut: "i"
        }, l10n.t("web_contact_info"))),
        n.push(a.createElement(c, {
            a8n: "mi-select-messages",
            key: "select",
            action: t,
            shortcut: "e"
        }, l10n.t("web_select_messages"))),
        e.mute.canMute() && n.push(a.createElement(l, {
            key: "mute",
            onMute: function(t) {
                return s.muteChat(e, t)
            },
            chat: e
        })),
        e.canClear() && n.push(a.createElement(c, {
            key: "clear",
            a8n: "mi-clear",
            shortcut: "e",
            action: function() {
                return s.clearChatMsgs(e)
            }
        }, l10n.t("clear_chat"))),
        e.canDelete() && n.push(a.createElement(u, {
            key: "delete",
            onDeleteOrExit: function() {
                return s.deleteOrExitChat(e)
            },
            chat: e
        })),
        n
    }
    var a = n(6)
      , s = n(9)
      , c = n(995)
      , l = n(1079)
      , u = n(1075);
    e.exports = {
        group: r,
        contact: o,
        broadcast: i
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(137)
      , a = r.createClass({
        displayName: "HiddenText",
        propTypes: {
            msg: r.PropTypes.instanceOf(i).isRequired
        },
        render: function() {
            var e = this.props.msg
              , t = e.senderObj.formattedUser
              , n = "[" + o.timeStr(e.t) + "]";
            return r.createElement("span", {
                className: "message-pre-text"
            }, "", n, "", t, ":")
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1001)
      , o = n(987)
      , a = n(134)
      , s = n(986)
      , c = n(1002)
      , l = n(999)
      , u = n(83)
      , d = n(43)
      , p = n(1006)
      , h = n(441)
      , f = n(1005)
      , m = 50
      , g = ["foursquare.com", "facebook.com", "maps.google.com"]
      , v = r.createClass({
        displayName: "Location",
        mixins: [o, a],
        propTypes: {
            msg: r.PropTypes.instanceOf(s).isRequired,
            quotedMsg: r.PropTypes.element,
            displayAuthor: r.PropTypes.bool
        },
        statics: {
            previewWidth: 270,
            previewHeight: 150
        },
        getInitialState: function() {
            var e = ""
              , t = !1
              , n = this.getStaticMapUrl();
            return f.isCached(n) && (e = n,
            t = !0),
            {
                src: e,
                hiResAvail: t
            }
        },
        componentDidMount: function() {
            this.updateResolution(),
            this.regNativeListener(window, "dpichange", this.updateResolution)
        },
        getClientThumb: function() {
            return "data:image/jpeg;base64," + this.async("msg.body")
        },
        getStaticMapUrl: function() {
            var e = this.props.msg
              , t = v.previewWidth
              , n = v.previewHeight + m
              , r = h.currentRes === h.RES.HIGH ? 2 : 1
              , i = u.build("https://maps.googleapis.com/maps/api/staticmap", {
                markers: "color:red|" + e.lat + ", " + e.lng,
                zoom: 14,
                size: t + "x" + n,
                scale: r,
                language: l10n.getLocale(),
                client: u.GSM_NAME
            });
            return u.gsmURL(i, u.GSM_NUMS)
        },
        getMapUrl: function() {
            var e = this.props.msg
              , t = this.loc();
            return t && t.name ? ["https://maps.google.com/maps/search", encodeURIComponent(t.name), "@" + e.lat + "," + e.lng + ",17z"].join("/") + "?hl=" + l10n.getLocale() : u.build("https://maps.google.com/maps", {
                q: e.lat + "," + e.lng,
                z: 17,
                hl: l10n.getLocale()
            })
        },
        loc: function y() {
            var y = this.props.msg.get("loc");
            if (y)
                return y = y.split("\n"),
                2 === y.length ? {
                    name: y[0],
                    addr: y[1]
                } : {
                    name: y
                }
        },
        getLocationDetails: function() {
            var e = this.props.msg
              , t = this.loc()
              , n = this.props.msg.clientUrl || this.getMapUrl()
              , o = void 0
              , a = void 0
              , s = void 0
              , c = u.hostname(n)
              , l = _.isEmpty(g.filter(function(e) {
                return c.indexOf(e) > -1
            }));
            if (s = l ? r.createElement("div", {
                className: "location-page-host location-caption"
            }, r.createElement(i, null , c)) : null ,
            t) {
                o = t.name ? r.createElement("a", {
                    href: n,
                    title: t.name,
                    target: "_blank",
                    className: "text-title"
                }, r.createElement(i, null , t.name)) : null ;
                var p = d("text-contents", {
                    "location-caption": !s
                });
                a = t.addr ? r.createElement("div", {
                    title: t.addr,
                    className: p
                }, r.createElement(i, null , t.addr)) : null
            }
            var h = o && a ? r.createElement("div", {
                className: "image-caption message-text",
                "data-id": e.id
            }, o, a, s) : null ;
            return h
        },
        updateResolution: function() {
            this.setState({
                src: this.getStaticMapUrl()
            })
        },
        onImgLoaded: function() {
            this.state.hiResAvail || this.setState({
                hiResAvail: !0
            })
        },
        onClick: function(e) {
            e.stopPropagation()
        },
        render: function() {
            var e = this.props.msg
              , t = this.getLocationDetails()
              , n = t ? null : r.createElement("div", {
                className: "shade"
            })
              , i = this.props.displayAuthor && l.shouldRender(e) ? r.createElement(l, {
                msg: e
            }) : null
              , o = d("bubble-location", {
                "bubble-location-caption": t,
                "bubble-broadcast": t && e.broadcast,
                "bubble-star": t && e.star
            })
              , a = {
                background: "url(" + this.getClientThumb() + ")",
                backgroundSize: "cover",
                width: v.previewWidth,
                height: this.state.hiResAvail ? void 0 : v.previewHeight
            }
              , s = {
                height: v.previewHeight
            }
              , u = d("image-thumb-body", {
                "image-thumb-location-lores": !this.state.hiResAvail
            });
            return r.createElement("div", {
                className: o
            }, i, this.props.quotedMsg, r.createElement("div", {
                className: "image-thumb",
                onClick: this.onClick,
                style: s
            }, r.createElement("a", {
                href: this.getMapUrl(),
                target: "_blank"
            }, r.createElement(p, {
                src: this.state.src,
                className: u,
                style: a,
                hasPrivacyChecks: !1,
                onLoaded: this.onImgLoaded,
                noXHR: !0
            })), n), t, r.createElement(c, {
                msg: e
            }))
        }
    });
    e.exports = v
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(891)
      , o = r(i)
      , a = n(6)
      , s = n(1001)
      , c = n(986)
      , l = n(137)
      , u = n(43)
      , d = n(83)
      , p = a.createClass({
        displayName: "PreviewImage",
        propTypes: {
            duration: a.PropTypes.oneOfType([a.PropTypes.string, a.PropTypes.number]),
            shade: a.PropTypes.bool,
            thumb: a.PropTypes.string,
            className: a.PropTypes.string,
            type: a.PropTypes.oneOf([c.TYPE.AUDIO, c.TYPE.LOCATION, c.TYPE.VIDEO, c.TYPE.PTT, c.TYPE.VCARD]).isRequired
        },
        getDefaultProps: function() {
            return {
                shade: !0
            }
        },
        getIconClassNames: function() {
            return this.props.type === c.TYPE.VIDEO ? "icon-sm icon-video-inv" : this.props.type === c.TYPE.AUDIO ? "icon-sm icon-arrow-inv" : void 0
        },
        getClassNames: function() {
            return u("preview", this.props.className, (0,
            o["default"])({
                "icon-user-default": this.props.type === c.TYPE.VCARD,
                "icon-user-default-square": this.props.type !== c.TYPE.VCARD
            }, "preview-" + this.props.type + " no-image", !this.props.thumb))
        },
        getStyles: function() {
            var e = this.props.thumb;
            return e ? d.isHttp(e) ? {
                backgroundImage: 'url("' + e + '")'
            } : {
                backgroundImage: 'url("data:image/jpeg;base64,' + e + '")'
            } : {}
        },
        render: function() {
            var e = l.durationStr(this.props.duration)
              , t = this.props.shade ? a.createElement("span", {
                className: "shade"
            }) : null ;
            return a.createElement("div", {
                className: this.getClassNames(),
                style: this.getStyles()
            }, t, a.createElement("span", {
                className: "meta meta-audio"
            }, a.createElement("span", {
                className: this.getIconClassNames()
            }), a.createElement(s, null , e)))
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1093)
      , o = n(994)
      , a = n(133)
      , s = n(992)
      , c = n(986)
      , l = r.createClass({
        displayName: "ProfileImage",
        mixins: [a, s],
        propTypes: {
            waid: r.PropTypes.string,
            thumb: r.PropTypes.string,
            className: r.PropTypes.string
        },
        componentWillMount: function() {
            var e = this
              , t = this.props.waid;
            t && Store.ProfilePicThumb.find(t).checkpoint(this.rejectOnUnmount()).then(function(t) {
                e.addObserverAndRun(t, "change:img", function() {
                    e.setState({
                        img: t.img
                    })
                })
            })["catch"](_.noop)
        },
        render: function() {
            return this.state.img ? r.createElement("div", {
                className: this.props.className
            }, r.createElement(o, {
                id: this.props.waid
            })) : r.createElement(i, {
                className: this.props.className,
                thumb: this.props.thumb,
                type: c.TYPE.VCARD,
                shade: !1
            })
        }
    });
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(9)
      , o = n(1001)
      , a = n(986)
      , s = n(988)
      , c = n(998)
      , l = n(999)
      , u = n(1027)
      , d = n(893)
      , p = n(133)
      , h = n(992)
      , f = n(989)
      , m = n(1094)
      , g = n(137)
      , v = n(1025)
      , y = n(987)
      , _ = n(43)
      , E = n(102)
      , b = n(10)
      , S = a.TYPE
      , M = S.CHAT
      , C = S.IMAGE
      , T = S.VIDEO
      , w = S.LOCATION
      , k = S.DOCUMENT
      , x = S.VCARD
      , N = S.AUDIO
      , P = r.createClass({
        displayName: "QuotedMsg",
        mixins: [y, p, d, h],
        propTypes: {
            msg: r.PropTypes.instanceOf(a).isRequired,
            chat: r.PropTypes.instanceOf(s).isRequired,
            onOmit: r.PropTypes.func,
            rootMsg: r.PropTypes.instanceOf(a),
            displayType: r.PropTypes.string
        },
        getInitialState: function() {
            return this.props.rootMsg ? this.asyncState({
                clickable: "rootMsg.isQuotedMsgAvailable",
                mediaState: "msg.mediaState"
            }, {
                hover: !1
            }) : this.asyncState({
                mediaState: "msg.mediaState"
            }, {
                hover: !1
            })
        },
        componentDidUpdate: function(e, t) {
            var n = this.refs.preview;
            t.hover && !this.state.hover ? n && (n.style.visibility = "hidden") : !t.hover && this.state.hover && n && (n.style.visibility = "visible")
        },
        onClick: function() {
            if (this.state.clickable) {
                var e = this.props
                  , t = e.chat
                  , n = e.rootMsg
                  , r = e.msg
                  , o = r.id
                  , a = t.getSearchContext(Store.Msg.get(o) || o, n);
                a && (a.slideToMsg = !0),
                i.openChat(t, a, !1),
                i.focusShowMsg(o)
            }
        },
        onMouseOver: function(e) {
            !this.state.hover && this.props.rootMsg && this.setState({
                hover: !0
            })
        },
        onMouseEnter: function(e) {
            !this.state.hover && this.props.rootMsg && this.setState({
                hover: !0
            })
        },
        onMouseLeave: function(e) {
            this.state.hover && this.setState({
                hover: !1
            })
        },
        render: function() {
            var e = this.props
              , t = e.msg
              , n = e.displayType
              , i = this.props.chat.assignedColor(t.sender)
              , a = n === b.DISP_TYPE.CONVERSATION
              , s = r.createElement(l, {
                msg: t,
                className: "quoted-msg-bubble-ptt-author",
                displaySelf: t.sender === Store.Conn.me,
                disableClick: !0
            })
              , d = [];
            t.hasSymbol() && d.push(r.createElement(u, {
                msg: t,
                key: "msg-symbol"
            })),
            [T, N].indexOf(t.type) > -1 && !t.isGif && d.push(g.durationStr(t.duration) + " ");
            var p = void 0
              , h = null ;
            [C, T, M].indexOf(t.type) > -1 ? (p = c.msgText(t, !1),
            h = t.mentionMap()) : p = c.msgText(t),
            d.push(r.createElement(f, {
                format: !0,
                mention: h,
                text: p,
                direction: "auto",
                key: "status"
            }));
            var y = null
              , S = void 0
              , P = "quoted-msg-image";
            switch (t.type) {
            case C:
            case T:
            case w:
            case k:
                if (t.body) {
                    var D = t.type === C && t.url ? t.url : "data:image/jpeg;base64," + t.body;
                    S = r.createElement("div", {
                        style: {
                            backgroundImage: "url(" + D + ")"
                        },
                        className: P
                    })
                }
                break;
            case M:
                t.thumbnail && (S = r.createElement("div", {
                    style: {
                        backgroundImage: 'url("data:image/jpeg;base64,' + t.thumbnail + '")'
                    },
                    className: P
                }));
                break;
            case x:
                S = r.createElement(m, {
                    waid: t.getVCardThumbnailWAid(),
                    thumb: t.body && v.thumbnail(t.body),
                    className: P
                })
            }
            var O = _("quoted-msg", {
                "quoted-msg-hover": this.state.hover
            })
              , A = this.props.onOmit ? r.createElement("div", {
                style: {
                    display: "flex",
                    flex: "0 0 auto"
                }
            }, S, r.createElement("div", {
                className: "btn-background"
            }, r.createElement("button", {
                className: "icon icon-x",
                onClick: this.props.onOmit
            }))) : S;
            return r.createElement("div", {
                onMouseOver: a ? this.onMouseOver : null ,
                onMouseEnter: a ? this.onMouseEnter : null ,
                onMouseLeave: a ? this.onMouseLeave : null
            }, r.createElement(E, {
                transitionName: "quoted-msg-preview",
                className: "quoted-msg-preview-wrapper"
            }, y), r.createElement("div", {
                className: O,
                onClick: a ? this.onClick : null
            }, r.createElement("div", {
                className: "quoted-msg-status"
            }, r.createElement("span", {
                className: "bg-color-" + i + " quoted-msg-color-bar"
            }), r.createElement("div", {
                className: "quoted-msg-info"
            }, r.createElement("div", null , s, r.createElement("div", {
                className: "chat-status message-text quoted-msg-text"
            }, r.createElement(o, null , d))))), A))
        }
    });
    e.exports = P
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t, n) {
        this.key = e,
        this.css = t,
        this.title = n,
        this.className = "emoji-" + e
    }
    var o, a = n(891), s = r(a), c = n(6), l = n(15), u = n(135), d = u.HotKeys, p = n(139), h = p.focus, f = n(37), m = n(133), g = n(134), v = n(138), y = n(81), E = n(432), b = n(1279), S = n(989), M = n(995), C = n(437), T = n(1207), w = n(102), k = n(67), x = n(209), N = n(1166), P = n(215), D = P.EMOJI.CATEGORIES, O = 44, A = (o = {},
    (0,
    s["default"])(o, D.RECENT, new i(D.RECENT,"icon-emoji-recent",function() {
        return l10n.t("emoji_tab_recent")
    }
    )),
    (0,
    s["default"])(o, D.SMILEYS_PEOPLE, new i(D.SMILEYS_PEOPLE,"icon-emoji-people",function() {
        return l10n.t("emoji_tab_smileys_people")
    }
    )),
    (0,
    s["default"])(o, D.ANIMALS_NATURE, new i(D.ANIMALS_NATURE,"icon-emoji-nature",function() {
        return l10n.t("emoji_tab_animals_nature")
    }
    )),
    (0,
    s["default"])(o, D.FOOD_DRINK, new i(D.FOOD_DRINK,"icon-emoji-food",function() {
        return l10n.t("emoji_tab_food_drink")
    }
    )),
    (0,
    s["default"])(o, D.ACTIVITY, new i(D.ACTIVITY,"icon-emoji-activity",function() {
        return l10n.t("emoji_tab_activity")
    }
    )),
    (0,
    s["default"])(o, D.TRAVEL_PLACES, new i(D.TRAVEL_PLACES,"icon-emoji-travel",function() {
        return l10n.t("emoji_tab_travel_places")
    }
    )),
    (0,
    s["default"])(o, D.OBJECTS, new i(D.OBJECTS,"icon-emoji-objects",function() {
        return l10n.t("emoji_tab_objects")
    }
    )),
    (0,
    s["default"])(o, D.SYMBOLS, new i(D.SYMBOLS,"icon-emoji-symbols",function() {
        return l10n.t("emoji_tab_symbols")
    }
    )),
    (0,
    s["default"])(o, D.FLAGS, new i(D.FLAGS,"icon-emoji-flags",function() {
        return l10n.t("emoji_tab_flags")
    }
    )),
    (0,
    s["default"])(o, D.GIFS, new i(D.GIFS,"icon-emoji-gifs",function() {
        return l10n.t("emoji_tab_gifs")
    }
    )),
    o), R = [A.RECENT, A.SMILEYS_PEOPLE, A.ANIMALS_NATURE, A.FOOD_DRINK, A.ACTIVITY, A.TRAVEL_PLACES, A.OBJECTS, A.SYMBOLS, A.FLAGS], I = R.concat([A.GIFS]), L = [""].concat(E.skinToneVariations), F = c.createClass({
        displayName: "EmojiPanel",
        propTypes: {
            onEmoji: c.PropTypes.func.isRequired,
            onGif: c.PropTypes.func
        },
        getInitialState: function() {
            var e = R;
            this.props.onGif && (e = I);
            var t = Store.RecentEmoji.length > 0 ? A.RECENT : A.SMILEYS_PEOPLE
              , n = A[l.getLastEmojiTab()];
            return n && e.indexOf(n) > -1 && (t = n),
            {
                tabs: e,
                selected: t
            }
        },
        componentWillUnmount: function() {
            l.setLastEmojiTab(this.state.selected.key)
        },
        onSelectTab: function(e) {
            var t = this.state.tabs
              , n = t.indexOf(this.state.selected)
              , r = t.indexOf(e)
              , i = r > n ? "right" : "left";
            this.setState({
                selected: e,
                direction: i
            })
        },
        onEmoji: function(e) {
            this.props.onEmoji(e),
            Store.RecentEmoji.increment(e)
        },
        render: function() {
            var e = this
              , t = void 0;
            t = this.state.selected === A.GIFS ? c.createElement(T, {
                onGif: this.props.onGif
            }) : c.createElement("div", {
                className: "emoji-panel-body",
                key: this.state.selected.key
            }, c.createElement(j, {
                tab: this.state.selected,
                onEmoji: this.onEmoji
            }));
            var n = this.state.tabs
              , r = n.indexOf(this.state.selected)
              , i = n.map(function(t) {
                return c.createElement("button", {
                    className: "menu-item" + (e.state.selected === t ? " active" : ""),
                    onClick: function() {
                        return e.onSelectTab(t)
                    },
                    key: t.key,
                    title: t.title()
                }, c.createElement("span", {
                    className: "icon " + t.css
                }))
            })
              , o = l10n.isRTL() ? -1 : 1
              , a = {
                width: 100 / i.length + "%",
                transform: "translateX(" + 100 * r * o + "%)"
            }
              , s = "right" === this.state.direction ? "slide-forward" : "slide-back";
            return c.createElement("div", {
                className: "emoji-panel k"
            }, c.createElement("div", {
                className: "menu-tabs menu-tabs-emoji emoji-panel-header",
                "data-active-tab": this.state.selected.key
            }, c.createElement("div", {
                style: a,
                className: "menu-tabs-marker"
            }), i), c.createElement(w, {
                transitionName: s
            }, t))
        }
    });
    e.exports = F;
    var U = function(e, t, n) {
        for (var r = arguments.length, i = Array(r > 3 ? r - 3 : 0), o = 3; o < r; o++)
            i[o - 3] = arguments[o];
        return function(r) {
            return r && (r.preventDefault(),
            r.stopPropagation()),
            t && (n ? t.call.apply(t, [e, r].concat(i)) : t.apply(e, i))
        }
    }
      , j = c.createClass({
        displayName: "EmojiTab",
        mixins: [m, v, g, y],
        propTypes: {
            tab: c.PropTypes.oneOf(R).isRequired,
            onEmoji: c.PropTypes.func.isRequired
        },
        getInitialState: function() {
            var e = {
                skinTonePicker: !1,
                searchText: null
            };
            return this.props.tab === A.RECENT && (e.recent = Store.RecentEmoji.models.map(function(e) {
                return E.emojiMap[e["char"]]
            }),
            e.variants = {}),
            e
        },
        componentDidMount: function() {
            var e = this;
            this.addObserver(Store.EmojiVariant, "add remove change:variant", function() {
                return e.forceUpdate()
            }),
            this.focusSearchInput()
        },
        onEmoji: function(e) {
            this.props.onEmoji(e)
        },
        setEmojiVariant: function(e, t) {
            if (this.onEmoji(t),
            Store.EmojiVariant.setVariant(e, t),
            this.state.recent) {
                var n = this.state.variants;
                n[e] = t,
                this.setState({
                    variants: n
                })
            }
        },
        onContextMenu: function(e, t, n) {
            this.clearPickerTimer(),
            e && (e.preventDefault(),
            e.stopPropagation());
            var r = this.setEmojiVariant
              , i = E.skinToneEmojis[t]
              , o = L.map(function(e, n) {
                var o = E.variantToUnicode(i, e);
                return c.createElement(M, {
                    key: o,
                    a8n: "mi-emoji-variant",
                    action: _.partial(r, t, o)
                }, c.createElement(S, {
                    text: o,
                    emojiSize: S.EMOJI_SIZE.LARGE
                }))
            });
            this.setState({
                skinTonePicker: {
                    menu: o,
                    anchor: n || e.target,
                    type: C.Type.PICKER,
                    menuDirection: {
                        x: C.Direction.X.RIGHT,
                        y: C.Direction.Y.TOP
                    }
                }
            })
        },
        closeSkinTonePicker: function() {
            this.setState({
                skinTonePicker: !1
            })
        },
        clearPickerTimer: function() {
            this.pickerTimer && (this.unregNativeListener(window, "mouseup", this.clearPickerTimer, !0),
            this.clearSafeTimeout(this.pickerTimer),
            this.pickerTimer = null )
        },
        eatClick: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            this.unregCmd("window_click", this.eatClick)
        },
        startPickerTimer: function(e, t) {
            var n = this;
            this.clearPickerTimer();
            var r = e.target;
            this.pickerTimer = this.safeDelay(function() {
                n.regCmd("window_click", n.eatClick),
                n.onContextMenu(null , t, r)
            }, 250),
            this.regNativeListener(window, "mouseup", this.clearPickerTimer, !0)
        },
        getEmojiList: function() {
            var e = void 0;
            return e = this.state.recent ? this.state.recent : b[this.props.tab.key]
        },
        getEmoji: function() {
            var e = this
              , t = this.onContextMenu
              , n = this.startPickerTimer
              , r = this.onEmoji
              , i = this.state
              , o = i.recent
              , a = i.variants
              , s = this.getEmojiList()
              , l = s.map(function(i, s) {
                var l = E.codeToEmoji[i]
                  , u = void 0
                  , d = void 0
                  , p = void 0;
                if (E.skinToneEmojis[l]) {
                    p = U(e, t, !0, l),
                    u = U(e, n, !0, l);
                    var h;
                    o ? (h = a[l],
                    h ? (i = E.emojiMap[h],
                    d = U(e, r, !1, h)) : d = U(e, r, !1, l)) : (h = Store.EmojiVariant.getVariant(l),
                    h ? (i = E.emojiMap[h],
                    d = U(e, r, !1, h)) : d = p)
                } else
                    u = U(),
                    d = U(e, r, !1, l);
                return c.createElement("span", {
                    key: l,
                    ref: l,
                    tabIndex: "-1",
                    "data-emoji-index": s,
                    onClick: d,
                    onContextMenu: p,
                    onMouseDown: u,
                    className: "emojik emoji" + i
                })
            })
              , u = {};
            return c.createElement(d, {
                handlers: u
            }, l)
        },
        onSearchEmoji: function(e) {
            this.setState({
                searchText: e.target.value.trim()
            })
        },
        onSearchEnter: function() {
            var e = _.first(this.getEmojiList());
            if (e) {
                var t = E.codeToEmoji[e];
                if (E.skinToneEmojis[t]) {
                    var n = this.state.variants[t];
                    this.props.onEmoji(n || t)
                } else
                    this.props.onEmoji(t)
            }
        },
        onSearchDown: function() {
            this.getEmojiList().length && this.focusEmoji(0)
        },
        onEmojiArrow: function(e, t) {
            var n = e.target.dataset.emojiIndex;
            if (n) {
                n = Number(n);
                var r = this.getEmojiList()
                  , i = this.getEmojiRowLength()
                  , o = n;
                switch (t) {
                case "up":
                    if (n < i && this.refs.searchInput)
                        return d.flashFocus = Date.now(),
                        void this.focusSearchInput();
                    o = n - i;
                    break;
                case "down":
                    o = Math.min(n + i, r.length - 1);
                    break;
                case "left":
                    o = Math.max(n - 1, 0);
                    break;
                case "right":
                    o = Math.min(n + 1, r.length - 1)
                }
                this.focusEmoji(o)
            }
        },
        getEmojiRowLength: function() {
            var e = this.refs.emojiPanel && this.refs.emojiPanel.offsetWidth;
            return e ? Math.floor(e / O) : 1
        },
        onEmojiEnter: function(e) {
            var t = e.target.dataset.emojiIndex;
            if (t) {
                var n = this.getEmojiList()
                  , r = n[t]
                  , i = E.codeToEmoji[r];
                if (E.skinToneEmojis[i]) {
                    var o = this.state.variants[i];
                    this.props.onEmoji(o || i)
                } else
                    this.props.onEmoji(i)
            }
        },
        focusEmoji: function(e) {
            var t = this.getEmojiList();
            if (!(e < 0 || e > t.length - 1)) {
                var n = E.codeToEmoji[t[e]];
                this.refs[n] && h(this.refs[n])
            }
        },
        focusSearchInput: function() {
            if (this.refs.searchInput && (h(this.refs.searchInput),
            !(Date.now() - (d.flashFocus || 0) > 200))) {
                var e = f.findDOMNode(this.refs.searchContainer);
                Velocity(e, "stop"),
                Velocity(e, {
                    backgroundColor: ["#e0e1e2", "#D9F3FF"]
                }, {
                    duration: 1300,
                    easing: [.24, .91, .01, .99]
                })
            }
        },
        getSearchBox: function() {
            if (this.state.recent) {
                var e = l10n.t("search_emoji")
                  , t = {};
                return c.createElement(d, {
                    handlers: t,
                    onFocus: this.focusSearchInput
                }, c.createElement("div", {
                    className: "emoji-search-row"
                }, c.createElement("label", {
                    ref: "searchContainer",
                    className: "emoji-search-row-input"
                }, c.createElement("div", {
                    className: "input-container"
                }, c.createElement("input", {
                    ref: "searchInput",
                    className: "input input-search",
                    type: "text",
                    dir: "auto",
                    title: e,
                    placeholder: e,
                    onMouseDown: function(e) {
                        e.stopPropagation()
                    },
                    onChange: this.onSearchEmoji
                })))))
            }
            return null
        },
        render: function() {
            var e = void 0;
            this.state.skinTonePicker && (e = c.createElement(x, {
                displayName: "SkinTonePicker",
                popable: !0,
                escapable: !0,
                requestDismiss: this.closeSkinTonePicker
            }, c.createElement(N, {
                tooltip: this.state.skinTonePicker
            })));
            var t = null ;
            return c.createElement("div", {
                ref: "emojiPanel",
                className: this.props.tab.className
            }, t, this.getEmoji(), e)
        }
    });
    j.contextTypes = {
        uim: c.PropTypes.instanceOf(k)
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1003)
      , o = n(138)
      , a = n(1211)
      , s = n(988)
      , c = n(9)
      , l = n(53)
      , u = n(1246)
      , d = r.createClass({
        displayName: "AttachMediaFlow",
        mixins: [i, o],
        propTypes: {
            files: r.PropTypes.array,
            chat: r.PropTypes.instanceOf(s).isRequired
        },
        getInitialState: function() {
            this.mediaCollection = new u
        },
        componentWillMount: function() {
            c.closeContextMenu(),
            c.closeTooltip(),
            this.push(r.createElement(a, {
                chat: this.props.chat,
                files: this.props.files,
                onBack: this.endFlow,
                onSendMedia: _.once(this.sendMedia),
                onDropText: _.once(this.setText),
                mediaCollection: this.mediaCollection
            }))
        },
        componentDidMount: function() {
            this.safeDelay(this.initializeFiles, 300)
        },
        componentWillUnmount: function() {
            var e = this;
            l.isGecko ? _.defer(function() {
                return c.focusChatTextInput(e.props.chat)
            }) : c.focusChatTextInput(this.props.chat),
            this.mediaCollection && this.mediaCollection["delete"]()
        },
        initializeFiles: function() {
            var e = this.props.files;
            e && this.mediaCollection.processFiles(e, this.props.chat)
        },
        sendMedia: function(e) {
            var t = this.props.chat;
            _.delay(function() {
                t.sendMedia2(e, t.composeQuotedMsg),
                t.composeQuotedMsg = null
            }, 300),
            this.endFlow()
        },
        setText: function(e) {
            var t = this.props.chat;
            _.delay(function() {
                c.pasteChatTextInput(t, e)
            }, 300),
            this.endFlow()
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1003)
      , o = n(988)
      , a = n(1105)
      , s = n(1232)
      , c = n(1226)
      , l = n(101)
      , u = n(1225)
      , d = n(1218)
      , p = n(1213)
      , h = r.createClass({
        displayName: "InfoFlow",
        mixins: [i],
        propTypes: {
            chat: r.PropTypes.instanceOf(o).isRequired
        },
        componentWillMount: function() {
            var e = l.supportsFeature(l.F.STARRED) && l.supportsFeature(l.F.FULL_TEXT_SEARCH)
              , t = e ? this.onStarred : null
              , n = l.supportsFeature(l.F.MEDIA_GALLERY) ? this.onMediaGallery : null
              , i = null ;
            this.props.chat.isGroup ? i = r.createElement(u, {
                chat: this.props.chat,
                onVerification: this.onVerification,
                onStarred: t,
                onMediaGallery: n,
                onGroupInviteLink: this.onGroupInviteLink,
                onClose: this._pop
            }) : this.props.chat.isBroadcast ? i = r.createElement(p, {
                chat: this.props.chat,
                onStarred: t,
                onMediaGallery: n,
                onClose: this._pop
            }) : this.props.chat.isUser && (i = r.createElement(d, {
                contact: this.props.chat.contact,
                onVerification: this.onVerification,
                onStarred: t,
                onMediaGallery: n,
                onClose: this._pop
            })),
            this.push(i)
        },
        onStarred: function() {
            var e = r.createElement(a, {
                type: this.props.type,
                chat: this.props.chat,
                onClose: this._pop
            });
            this.push(e)
        },
        onMediaGallery: function() {
            var e = r.createElement(s, {
                chat: this.props.chat,
                onBack: this._pop
            });
            this.push(e)
        },
        onGroupInviteLink: function() {
            var e = r.createElement(c, {
                chat: this.props.chat,
                onBack: this._pop
            });
            this.push(e)
        },
        _pop: function() {
            this.pop()
        }
    });
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        var n = new p.WebcMediaAnalyzed;
        return a({
            type: "prep",
            file: e,
            asGif: t
        }).then(function(e) {
            var t = e.type
              , n = e.result
              , r = e.error
              , i = e.filename
              , o = e.file;
            switch (t) {
            case "result":
                return u.log("MediaAnalyzer:checkAndRepair approved file")(),
                n;
            case "parsingError":
                return u.info("trouble parsing file " + o + " (fossil " + i + ") " + r)(),
                o && (u.error("mediajs-error " + r)(),
                l.uploadFossil(o, i)),
                void u.log("MediaAnalyzer:checkAndRepair rejected file (" + r + ")")()
            }
        })["catch"](function(e) {
            u.assert(!1, "media-detection-error", "MediaAnalyzer:checkAndRepair got error! " + e)()
        })["finally"](function(t) {
            if (n) {
                var r = void 0;
                if (e.name) {
                    var i = e.name.split(".");
                    i.length > 1 && (r = i[i.length - 1])
                }
                n.set({
                    webcMediaSupported: !!t,
                    webcMediaExtensions: r
                }),
                n.markWebcMediaAnalyzeT(),
                n.commit()
            }
        })
    }
    function o(e, t) {
        return u.log("MediaAnalyzer:reportFossil fossilizing for " + t)(),
        a({
            type: "fossilize",
            file: e
        }).then(function(t) {
            var n = t.file;
            u.log("MediaAnalyzer:reportFossil successfully fossilized: " + !!n)(),
            n && l.uploadFossil(n, e.name + ".prefos")
        })
    }
    function a(e) {
        var t = void 0;
        return new c["default"](function(n, r) {
            u.log("MediaAnalyzer:sendMessageToWorker")(),
            t = new d,
            t.onmessage = function(e) {
                try {
                    e.data && "log" === e.data.type ? u.log("(via Milan) " + e.data.msg)() : n(e.data)
                } catch (t) {
                    r(t)
                }
            }
            ,
            t.onerror = function(e) {
                r("Milan.onerror = " + (e && e.message ? e.message : e))
            }
            ,
            t.postMessage(e)
        }
        )["finally"](function() {
            t && t.terminate()
        })
    }
    var s = n(2)
      , c = r(s)
      , l = n(24)
      , u = n(1)
      , d = n(1297)
      , p = n(56);
    e.exports = {
        checkAndRepair: i,
        reportFossil: o
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(84)
      , i = 50
      , o = 75
      , a = {
        getInitialState: function() {
            var e = this;
            this._setState = this.setState,
            this.setState = function(t, n, r) {
                _.assign(e.getBatchRenderState(), t),
                _.isUndefined(n) && _.isUndefined(r) ? e._debounceSetState.forceRun() : _.isUndefined(r) ? e._debounceSetState.debounce(n) : e._debounceSetState.debounceAndCap(n, r)
            }
        },
        componentWillMount: function() {
            var e = this;
            this._debounceSetState = new r(function() {
                e._setState(e._batchRenderMixinState),
                e._batchRenderMixinState = {}
            }
            )
        },
        componentWillUnmount: function() {
            this._debounceSetState.cancel()
        },
        getBatchRenderState: function() {
            return this._batchRenderMixinState || (this._batchRenderMixinState = {}),
            this._batchRenderMixinState
        }
    };
    a.DD = o,
    a.CD = i,
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(1)
      , a = n(1087)
      , s = n(1007)
      , c = n(138)
      , l = n(134)
      , u = n(990)
      , d = n(993)
      , p = n(991)
      , h = n(43)
      , f = n(1011)
      , m = n(10)
      , g = n(998)
      , v = n(1040)
      , y = n(102)
      , E = {
        ANIMATING: "animating",
        LOADING: "loading",
        RECORDING: "active",
        SENDING: "sending"
    }
      , b = r.createClass({
        displayName: "CaptureDrawer",
        mixins: [l, c],
        propTypes: {
            noContainer: r.PropTypes.bool,
            stream: r.PropTypes.object.isRequired,
            caption: r.PropTypes.bool,
            onBack: r.PropTypes.func.isRequired,
            onSend: r.PropTypes.func.isRequired
        },
        statics: {
            State: E
        },
        getInitialState: function() {
            return {
                state: E.ANIMATING,
                img: void 0,
                url: void 0
            }
        },
        componentDidMount: function() {
            this.safeDelay(function() {
                this.setState({
                    state: E.LOADING,
                    url: window.URL.createObjectURL(this.props.stream)
                })
            }, 300)
        },
        componentWillUnmount: function() {
            if (this.state.url) {
                var e = this.props.stream;
                v.stop(e),
                window.URL.revokeObjectURL(this.state.url)
            }
        },
        onCapture: function(e) {
            var t = document.createElement("canvas");
            if (this.refs.video) {
                var n = i.findDOMNode(this.refs.video);
                t.height = n.videoHeight,
                t.width = n.videoWidth;
                var r = t.getContext("2d");
                r.translate(t.width, 0),
                r.scale(-1, 1),
                r.drawImage(n, 0, 0, n.videoWidth, n.videoHeight);
                var o = t.toDataURL("image/jpeg");
                this.setState({
                    state: E.SENDING,
                    img: o
                })
            }
        },
        onVideoLoaded: function(e) {
            this.setState({
                state: E.RECORDING,
                videoSize: {
                    width: e.target.videoWidth,
                    height: e.target.videoHeight
                }
            })
        },
        onRetake: function(e) {
            this.setState({
                state: E.RECORDING,
                caption: void 0
            })
        },
        onSend: function(e) {
            this.props.onSend({
                file: window.dataURLtoBlob(this.state.img),
                caption: g.emojify(_.trim(this.state.caption))
            })
        },
        onCaptionChange: function(e) {
            this.setState({
                caption: e.target.value
            })
        },
        render: function() {
            var e, t, n, i;
            switch (this.state.state) {
            case E.ANIMATING:
                break;
            case E.LOADING:
            case E.RECORDING:
                var c = h("capture-video media-viewer-img webcam", {
                    "capture-video-inactive": this.state.state === E.LOADING
                });
                n = r.createElement("div", {
                    key: "webcam"
                }, r.createElement(s, {
                    type: s.TYPES.CONTAIN,
                    size: this.state.videoSize
                }, r.createElement(a, {
                    className: c,
                    autoPlay: !0,
                    ref: "video",
                    onPlay: this.onVideoLoaded,
                    src: this.state.url
                }))),
                e = r.createElement("div", {
                    className: "drawer-controls fade",
                    key: "btn-capture"
                }, r.createElement("button", {
                    className: "btn btn-round btn-l",
                    onClick: this.onCapture
                }, r.createElement("span", {
                    className: "icon icon-camera-light"
                })));
                break;
            case E.SENDING:
                n = r.createElement("div", {
                    key: "snapshot"
                }, r.createElement(s, {
                    type: s.TYPES.CONTAIN,
                    size: this.state.videoSize
                }, r.createElement("img", {
                    className: "capture-image snapshot",
                    src: this.state.img
                })));
                var l = this.props.noContainer ? "icon icon-checkmark-light-l" : "icon icon-send-light";
                e = r.createElement("div", {
                    className: "drawer-controls btn-send",
                    key: "btn-send"
                }, r.createElement("button", {
                    className: "btn btn-round btn-l",
                    onClick: this.onSend
                }, r.createElement("span", {
                    className: l
                }))),
                t = r.createElement("div", {
                    className: "drawer-header-action",
                    onClick: this.onRetake
                }, r.createElement("span", {
                    className: "icon icon-refresh-light"
                }), l10n.t("retake")),
                i = r.createElement(f, {
                    ref: "emojiInput",
                    editable: !0,
                    value: this.state.caption,
                    maxLength: m.MAX_CAPTION_LENGTH,
                    showRemaining: !0,
                    placeholder: l10n.t("add_a_caption"),
                    onEnter: this.onSend,
                    onChange: this.onCaptionChange,
                    supportsEmoji: !0,
                    focusOnMount: !0
                });
                break;
            default:
                o.log("captureDrawer:render Unhandled video capture state " + this.state.state)()
            }
            var g = void 0;
            g = this.props.caption ? r.createElement("div", {
                className: "capture-footer"
            }, r.createElement(y, {
                transitionName: "media-caption",
                className: "media-caption"
            }, i), r.createElement(y, {
                transitionName: "pop_delay"
            }, e)) : r.createElement("div", {
                className: "capture-footer"
            }, r.createElement(y, {
                transitionName: "pop_delay"
            }, e));
            var v = this.props.noContainer ? d.Type.POPUP : d.Type.OFFSET;
            return r.createElement(u, {
                key: "attach-capture-modal",
                position: "right",
                id: "capture",
                variant: "noheader",
                noContainer: this.props.noContainer
            }, r.createElement(d, {
                title: l10n.t("take_photo"),
                type: v,
                onCancel: this.props.onBack
            }, t), r.createElement(p, null , r.createElement("div", {
                className: "media-body"
            }, r.createElement("div", {
                className: "media-body-container"
            }, r.createElement(y, {
                transitionName: "capture"
            }, n))), g))
        }
    });
    e.exports = b
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(137)
      , a = n(990)
      , s = n(991)
      , c = n(1024)
      , l = n(987)
      , u = n(133)
      , d = n(81)
      , p = n(992)
      , h = n(1100)
      , f = n(134)
      , m = n(1020)
      , g = n(996)
      , v = n(998)
      , y = n(53)
      , E = n(136)
      , b = n(997)
      , S = n(9)
      , M = n(101)
      , C = n(1043)
      , T = n(14)
      , w = n(1e3)
      , k = n(10)
      , x = n(986)
      , N = n(988)
      , P = n(1045)
      , D = n(1027)
      , O = n(1018)
      , A = n(989)
      , R = n(1276)
      , I = n(139)
      , L = n(67)
      , F = n(893)
      , U = n(43)
      , j = n(135)
      , B = j.HotKeys
      , G = 2
      , Y = 100
      , H = r.createClass({
        displayName: "ChatSearch",
        mixins: [u, d, F, p, h],
        propTypes: {
            chat: r.PropTypes.instanceOf(N)
        },
        getInitialState: function() {
            var e = this;
            return this.ftsResultPage = 0,
            this.fts = _.debounce(function() {
                e.pending = !1,
                e.setState({
                    ftsLoading: !0
                }, h.DD);
                var t = _.trim(e.state.searchText || "");
                C.multibyteLength(t) < G || (e._ftsPromise && e._ftsPromise.cancel(),
                e._ftsPromise = e.props.chat.fts(t, ++e.ftsResultPage, Y).checkpoint(e.rejectOnUnmount()).then(function(n) {
                    if (t === _.trim(e.state.searchText)) {
                        var r = e.ftsResultPage > 1 ? e.state.ftsResult.concat(n.messages) : n.messages;
                        e.setState({
                            ftsResult: r,
                            searching: !1
                        }, h.DD),
                        M.supportsFeature(M.F.FTS_PAGINATION) && !n.eof || (e.ftsResultPage = 0,
                        e.setState({
                            ftsLoading: !1
                        }, h.DD))
                    }
                })["catch"](T.Unmount, _.noop)["catch"](function() {
                    e.pending || e.setState({
                        searching: !1,
                        ftsLoading: !1
                    }, h.DD)
                }))
            }, 750),
            this.selection = new w([],function(e) {
                return e.id.toString()
            }
            ),
            {
                searchText: "",
                searching: !1,
                ftsResult: [],
                ftsLoading: !1
            }
        },
        componentDidMount: function() {
            this.onFocusSearch()
        },
        componentDidUpdate: function() {
            this.shouldFTSSearch(this.refs.panel) && (this.fts(),
            this.pending = !0)
        },
        componentWillUnmount: function() {
            this.fts.cancel(),
            this._ftsPromise && this._ftsPromise.cancel()
        },
        fullTextSearch: function(e) {
            var t = _.trim(e);
            C.multibyteLength(t) >= G && M.supportsFeature(M.F.FULL_TEXT_SEARCH) ? (this.fts(),
            this.pending = !0,
            this.state.searching || this.setState({
                searching: !0
            }, h.DD)) : (this.fts.cancel(),
            this._ftsPromise && this._ftsPromise.cancel(),
            this.ftsResultPage = 0,
            this.pending = !1,
            (this.state.searching || this.state.ftsLoading) && this.setState({
                searching: !1,
                ftsLoading: !1
            }, h.DD))
        },
        shouldFTSSearch: function(e) {
            var t = this.state.ftsResult;
            if (!t || 0 === t.length || 0 === this.ftsResultPage || this.pending)
                return !1;
            var n = _.last(e.children);
            return e.scrollHeight < e.clientHeight + n.scrollHeight
        },
        onSearch: function(e) {
            if (this.isMounted()) {
                if (!e)
                    return void this.onStopSearch();
                var t = this.state.searchText;
                if (e !== t) {
                    var n = {
                        searchText: e
                    };
                    this.fullTextSearch(e),
                    t && 0 === e.indexOf(t) ? this.ftsResultPage = 0 : n.ftsResult = [],
                    this.setState({
                        searchText: e
                    }),
                    this.setState(n, h.DD)
                }
            }
        },
        onStopSearch: function() {
            this.fts.cancel(),
            this._ftsPromise && this._ftsPromise.cancel(),
            this.ftsResultPage = 0,
            this.pending = !1,
            this.setState({
                searchText: "",
                ftsResult: [],
                ftsLoading: !1,
                searching: !1
            })
        },
        onFocusList: function(e) {
            e.repeat || this.refs.msglist && this.refs.search.isAtEnd() && (e.preventDefault(),
            e.stopPropagation(),
            B.flashFocus = Date.now(),
            this.refs.msglist.focusFirst())
        },
        onOpenFirst: function(e) {
            e.preventDefault();
            var t = _.head(this.state.ftsResult);
            if (t) {
                var n = t.chat
                  , r = n.getSearchContext(t);
                S.openChat(n, r, !0),
                S.focusShowMsg(r.msg.id),
                this.onClose()
            }
        },
        onFocusSearch: function(e) {
            B.flashFocus = Date.now(),
            I.focus(this.refs.search)
        },
        onClose: function() {
            this.context.uim.uie.requestDismiss()
        },
        indicateFocus: function(e) {
            if (!(Date.now() - (B.flashFocus || 0) > 200)) {
                var t = i.findDOMNode(this.refs.input_hotkey);
                Velocity(t, "stop"),
                Velocity(t, {
                    backgroundColor: ["#fbfbfb", "#D9F3FF"]
                }, {
                    duration: 1600,
                    easing: [.19, .69, .01, .99]
                })
            }
        },
        onScroll: function(e) {
            this.handleScroll(e.target)
        },
        handleScroll: _.throttle(function(e) {
            e.scrollTop + k.SCROLL_FUDGE > e.scrollHeight - e.clientHeight && this.ftsResultPage > 0 && !this.pending && (this.fts(),
            this.pending = !0)
        }, 100),
        getEmptyChatlistState: function(e) {
            if (e.length)
                return null ;
            var t = _.trim(this.state.searchText || "");
            return C.multibyteLength(t) >= G ? this.state.searching ? r.createElement(g.SearchingMessages, null ) : r.createElement(g.SearchMessages, null ) : g.BeforeSearchMessages(this.props.chat.name)
        },
        render: function() {
            var e = this.state.ftsResult
              , t = this.getEmptyChatlistState(e);
            if (!t) {
                var n = this.state.searchText ? _.trim(this.state.searchText) : null ;
                t = r.createElement(z, {
                    ref: "msglist",
                    isSearching: !!this.state.searchText,
                    searchText: n,
                    ftsResult: e,
                    selection: this.selection,
                    onFocusSearch: this.onFocusSearch
                })
            }
            var i = {
                down: this.onFocusList,
                enter: this.onOpenFirst
            }
              , o = this.state.ftsLoading && e.length ? r.createElement("div", {
                className: "more",
                style: {
                    alignSelf: "center"
                }
            }, r.createElement(E, {
                stroke: 6,
                size: 24
            })) : null ;
            return r.createElement(a, {
                key: "search-modal",
                id: "search",
                variant: "panel",
                onCancel: this.onClose
            }, r.createElement("header", {
                className: "pane-header"
            }, r.createElement("div", {
                className: "header-close"
            }, r.createElement("button", {
                onClick: this.onClose
            }, r.createElement("span", {
                className: "icon icon-x"
            }))), r.createElement("div", {
                className: "header-body"
            }, r.createElement("div", {
                className: "header-main"
            }, r.createElement("div", {
                className: "header-title"
            }, l10n.t("search_msgs"))))), r.createElement(s, null , r.createElement(B, {
                handlers: i,
                onFocus: this.indicateFocus,
                ref: "input_hotkey",
                className: "search-container"
            }, r.createElement(m, {
                ref: "search",
                onSearch: this.onSearch,
                placeholder: l10n.t("search"),
                searching: this.state.searching
            })), r.createElement("div", {
                ref: "panel",
                className: "pane-body pane-list-body",
                onScroll: this.onScroll,
                id: "pane-side",
                "data-list-scroll-container": !0
            }, t, o)))
        }
    });
    H.contextTypes = {
        uim: r.PropTypes.instanceOf(L)
    };
    var z = r.createClass({
        displayName: "MsgList",
        mixins: [u, d, f],
        propTypes: {
            isSearching: r.PropTypes.bool,
            searchText: r.PropTypes.string,
            ftsResult: r.PropTypes.array,
            onClick: r.PropTypes.func,
            selection: r.PropTypes.instanceOf(w),
            onFocusSearch: r.PropTypes.func
        },
        getDefaultProps: function() {
            return {
                chats: []
            }
        },
        getInitialState: function() {
            return this._listPointerEvents = !0,
            {}
        },
        componentWillMount: function() {
            this.props.selection.init(this.getSelection())
        },
        onListPointerEventsOff: function() {
            this._listPointerEvents = !1
        },
        onListPointerEventsOn: function() {
            this._listPointerEvents = !0
        },
        onClick: function(e, t, n) {
            var r = this;
            e.preventDefault(),
            e.stopPropagation(),
            Store.Chat.find(t.id).then(function(e) {
                r.props.isSearching && r.props.onClick && r.props.onClick(),
                2 === R.column && r.context.uim.uie.requestDismiss(),
                S.openChat(e, n, !0),
                n && S.focusShowMsg(n.msg.id)
            })
        },
        getSelection: function() {
            return this.props.ftsResult || []
        },
        getList: function() {
            var e = this;
            return this.props.ftsResult.map(function(t) {
                return r.createElement(W, {
                    msg: t,
                    searchText: e.props.searchText,
                    onClick: e.onClick,
                    active: e.props.selection,
                    key: t.id.toString()
                })
            })
        },
        restoreFocus: function() {
            this.props.selection.reset()
        },
        onFocusGain: function(e) {
            e.target === i.findDOMNode(this) && this._listPointerEvents && (this.props.selection.index < 0 ? this.focusFirst() : this.props.selection.reset())
        },
        focusFirst: function() {
            this.props.selection.setFirst()
        },
        onNextChat: function(e, t, n) {
            e && (e.preventDefault(),
            e.stopPropagation());
            var r = this.props.selection.next();
            this.props.selection.index !== r && this.props.selection.setNext()
        },
        onPrevChat: function(e, t, n) {
            e && (e.stopPropagation(),
            e.preventDefault());
            var r = this.props.selection.prev();
            r > -1 ? (this.props.selection.setPrev(),
            this.focusComposer = n) : t || this.props.onFocusSearch()
        },
        render: function() {
            var e = this
              , t = {
                down: function(t) {
                    return e.onNextChat(t)
                },
                up: function(t) {
                    return e.onPrevChat(t)
                }
            };
            return r.createElement(B, {
                handlers: t,
                onFocus: this.onFocusGain,
                "data-tab": 3
            }, r.createElement(b, {
                className: "chatlist",
                data: this.getList(),
                height: 72,
                animate: !0,
                extraItems: 4,
                onPointerEventsOff: this.onListPointerEventsOff,
                onPointerEventsOn: this.onListPointerEventsOn
            }))
        }
    });
    z.contextTypes = {
        uim: r.PropTypes.instanceOf(L)
    };
    var W = r.createClass({
        displayName: "Message",
        mixins: [l, u],
        propTypes: {
            msg: r.PropTypes.instanceOf(x).isRequired,
            searchText: r.PropTypes.string,
            mouseDownAsClick: r.PropTypes.bool,
            onClick: r.PropTypes.func,
            active: r.PropTypes.object
        },
        getInitialState: function() {
            var e = this.props
              , t = e.msg
              , n = e.active
              , r = {
                formattedTitle: this.async("msg.chat.formattedTitle"),
                active: !!n && n.value === t
            };
            return t.sender && t.isGroupMsg && !t.isNotification && (t.isSentByMe ? r.formattedShortName = t.senderObj.formattedShortName : r.formattedShortName = this.async("msg.senderObj.formattedShortName")),
            r
        },
        componentWillMount: function() {
            this.props.active && this.addObserver(this.props.active, this.props.msg.id.toString(), this.onActiveChange)
        },
        onActiveChange: function(e, t) {
            if ("focus" === e) {
                var n = i.findDOMNode(this);
                I.focus(n),
                t && c.scrollIntoViewIfNeeded(n)
            }
            this.setState({
                active: !!e
            })
        },
        onClick: function(e) {
            if (_.isFunction(this.props.onClick)) {
                var t = this.props.msg
                  , n = t.chat
                  , r = n.getSearchContext(t);
                r.msg = t,
                this.props.onClick(e, n, r)
            }
        },
        onMouseDown: function(e) {
            0 === e.button && this.onClick(e)
        },
        onEnter: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            B.flashFocus = Date.now(),
            this.onClick(e)
        },
        indicateFocus: function(e) {
            if (!(Date.now() - (B.flashFocus || 0) > 200)) {
                var t = i.findDOMNode(this.refs.cell);
                Velocity(t, "stop"),
                Velocity(t, {
                    backgroundColor: ["#e9eaeb", "#cbdde7"]
                }, {
                    duration: 1300,
                    easing: [.19, .69, .01, .99],
                    complete: this.onBlur
                })
            }
        },
        onBlur: function(e) {
            var t = i.findDOMNode(this.refs.cell);
            t && (Velocity(t, "stop"),
            t.style.backgroundColor = "")
        },
        contextEnabled: function() {
            return !1
        },
        render: function() {
            var e = this.props.msg
              , t = r.createElement("span", {
                className: "chat-time-title"
            }, o.relativeStr(e.t))
              , n = [];
            if (e.isSentByMe && n.push(r.createElement(P, {
                msg: e,
                key: "symbol"
            })),
            !e.isSentByMe && e.isGroupMsg && !e.isNotification) {
                var i = U("chat-status-name", {
                    number: !e.senderObj.name
                });
                n.push(r.createElement(A, {
                    text: this.state.formattedShortName,
                    direction: "auto",
                    classes: i,
                    key: "author"
                })),
                n.push(r.createElement("span", {
                    className: "chat-status-divider",
                    key: "divider"
                }, ":"))
            }
            e.hasSymbol() && n.push(r.createElement(D, {
                msg: e,
                key: "msg-symbol"
            })),
            n.push(r.createElement(A, {
                direction: e.dir,
                ellipsify: !0,
                highlight: this.props.searchText ? [this.props.searchText] : null ,
                text: v.msgText(e),
                key: "status"
            }));
            var a = "chat-status";
            y.isGecko && (a += " ellipsify");
            var s = l10n.embedDir(v.msgText(e), e.rtl)
              , c = r.createElement("div", {
                className: a,
                title: s
            }, n)
              , l = {
                enter: this.onEnter
            }
              , u = U("message", {
                active: !!this.state.active
            })
              , d = this.props.mouseDownAsClick;
            return r.createElement(B, {
                handlers: l,
                onFocus: this.indicateFocus,
                onBlur: this.onBlur,
                className: "chat-drag-cover"
            }, r.createElement(O, {
                id: e.id + "",
                ref: "cell",
                contextEnabled: this.contextEnabled,
                className: u,
                primaryDetail: t,
                secondary: c,
                onClick: d ? null : this.onClick,
                onMouseDown: d ? this.onMouseDown : null ,
                onContext: this.onMenu
            }))
        }
    });
    e.exports = H
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(991)
      , s = n(135)
      , c = s.HotKeys
      , l = n(1020)
      , u = n(997)
      , d = n(1036)
      , p = n(1e3)
      , h = n(139)
      , f = {
        LIST: "list",
        SEARCH: "search"
    }
      , m = r.createClass({
        displayName: "ListModal",
        propTypes: {
            title: r.PropTypes.string.isRequired,
            selection: r.PropTypes.instanceOf(p),
            onSearch: r.PropTypes.func,
            searchPlaceholder: r.PropTypes.string,
            onCancel: r.PropTypes.func.isRequired,
            onSelect: r.PropTypes.func
        },
        onNext: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = this.props.selection;
            t && t.setNext()
        },
        onPrev: function(e) {
            var t = this.props.selection;
            if (t) {
                e.preventDefault(),
                e.stopPropagation();
                var n = t.prev();
                n > -1 ? t.setPrev() : (t.unset(),
                c.flashFocus = Date.now(),
                h.focus(this.refs[f.SEARCH]))
            }
        },
        onFocusList: function(e) {
            this.refs[f.LIST] && (e.preventDefault(),
            e.stopPropagation(),
            c.flashFocus = Date.now(),
            this.props.selection.setFirst())
        },
        onSelectFirst: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = _.head(this.props.children);
            t && this.props.onSelect(e, t)
        },
        onSearch: function(e) {
            this.props.onSearch(e)
        },
        render: function() {
            var e = this.props
              , t = e.title
              , n = e.onCancel
              , s = e.onSearch
              , p = e.searchPlaceholder
              , h = e.children
              , m = {
                down: this.onFocusList,
                enter: this.onSelectFirst
            }
              , g = {
                down: this.onNext,
                up: this.onPrev
            }
              , v = void 0;
            s && (v = r.createElement(c, {
                handlers: m
            }, r.createElement(l, {
                ref: f.SEARCH,
                onSearch: this.onSearch,
                placeholder: p || l10n.t("search")
            })));
            var y = void 0;
            return y = h && h.length ? r.createElement(c, {
                handlers: g
            }, r.createElement(u, {
                className: "chatlist",
                ref: f.LIST,
                data: h,
                height: 72,
                extraItems: 4
            })) : h,
            r.createElement(d, {
                type: d.TOWER
            }, r.createElement(i, {
                key: "contact-modal",
                onCancel: n,
                position: "right"
            }, r.createElement(o, {
                title: t,
                type: o.Type.POPUP,
                onCancel: n
            }), v, r.createElement(a, {
                "data-list-scroll-container": !0
            }, y)))
        }
    });
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(1008)
      , s = n(991)
      , c = n(1046)
      , l = n(429)
      , u = n(9)
      , d = n(987)
      , p = n(133)
      , h = n(992)
      , f = n(1011)
      , m = n(10)
      , g = n(998)
      , v = n(67)
      , y = r.createClass({
        displayName: "ProfileDrawer",
        mixins: [d, p, h],
        propTypes: {
            id: r.PropTypes.string.isRequired,
            onClose: r.PropTypes.func
        },
        getInitialState: function() {
            return this.asyncState({
                status: "id.Status.status",
                imgFull: "id.ProfilePicThumb.imgFull"
            }, {
                pushname: Store.Conn.pushname,
                status: l10n.t("contact_status_loading"),
                pendingPushname: !1,
                pendingStatus: !1,
                pendingPhoto: !1
            })
        },
        componentWillMount: function() {
            var e = this;
            this.addObserver(Store.Conn, "change:pushname", function() {
                e.setState({
                    pushname: Store.Conn.pushname
                })
            })
        },
        validateStatus: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? "" : arguments[0];
            return !!e.trim()
        },
        onSetStatusError: function() {
            u.openModal(r.createElement(l, {
                onOK: u.closeModal.bind(u),
                okText: l10n.t("web_ok")
            }, l10n.t("action_status_empty")))
        },
        onSetStatus: function(e) {
            if (Store.Status.canSetMyStatus()) {
                var t = Store.Status.get(this.props.id).status
                  , n = g.emojify(this.state.status);
                if (n === t)
                    return this.setState({
                        status: n
                    });
                this.setState({
                    pendingStatus: !0
                }),
                Store.Status.setMyStatus(g.emojify(this.state.status)).bind(this)["finally"](function() {
                    this.isMounted() && this.setState({
                        status: Store.Status.get(this.props.id).status,
                        pendingStatus: !1
                    })
                })
            }
        },
        onBack: function() {
            this.props.onClose ? this.props.onClose() : this.context.uim.uie.requestDismiss()
        },
        onStatusChange: function(e) {
            this.setState({
                status: e.target.value
            })
        },
        onCancelStatus: function() {
            this.setState({
                status: Store.Status.get(this.props.id).status
            })
        },
        validatePushname: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? "" : arguments[0];
            return !!e.trim()
        },
        onSetPushname: function(e) {
            var t = this;
            if (Store.Conn.canSetMyPushname()) {
                var n = Store.Conn.pushname
                  , r = g.emojify(this.state.pushname);
                if (r === n)
                    return this.setState({
                        pushname: r
                    });
                this.setState({
                    pendingPushname: !0
                }),
                Store.Conn.updatePushname(g.emojify(this.state.pushname)).checkpoint(this.rejectOnUnmount())["finally"](function() {
                    t.setState({
                        pendingPushname: !1
                    })
                })
            }
        },
        onSetPushnameError: function() {
            u.openModal(r.createElement(l, {
                onOK: u.closeModal.bind(u),
                okText: l10n.t("web_ok")
            }, l10n.t("action_pushname_empty")))
        },
        onPushnameChange: function(e) {
            this.setState({
                pushname: e.target.value
            })
        },
        onCancelPushname: function() {
            this.setState({
                pushname: Store.Conn.pushname
            })
        },
        onImageSet: function(e, t) {
            var n = Store.ProfilePicThumb.get(this.props.id);
            this.setState({
                pendingPhoto: !0
            });
            var r;
            r = e && t ? n.setPicture(e, t) : n.deletePicture(),
            r.bind(this).then(function() {
                this.isMounted() && this.setState({
                    pendingPhoto: !1
                })
            })
        },
        render: function() {
            var e = Store.ProfilePicThumb.get(this.props.id)
              , t = e.canSet() || e.canDelete() ? c.Type.PROFILE : c.Type.NO_EDIT
              , n = r.createElement(c, {
                type: t,
                id: this.props.id,
                pending: this.state.pendingPhoto,
                startImage: this.state.imgFull,
                onImageSet: this.onImageSet
            });
            return r.createElement(i, {
                onCancel: this.onBack,
                id: "profile"
            }, r.createElement(o, {
                a8n: "drawer-title-profile",
                title: l10n.t("menuitem_profile_status"),
                onBack: this.onBack,
                type: o.Type.LARGE
            }), r.createElement(s, null , r.createElement("div", {
                className: "drawer-section drawer-scale drawer-section-photo"
            }, n), r.createElement(a, {
                a8n: "col-main-profile",
                title: l10n.t("pushname"),
                classes: "animate-enter1 well-input"
            }, r.createElement(f, {
                value: this.state.pushname,
                editable: Store.Conn.canSetMyPushname(),
                pending: this.state.pendingPushname,
                showRemaining: !0,
                validate: this.validatePushname,
                maxLength: m.MAX_PUSHNAME_LENGTH,
                onChange: this.onPushnameChange,
                onSave: this.onSetPushname,
                onError: this.onSetPushnameError,
                onCancel: this.onCancelPushname,
                supportsEmoji: !0,
                lockable: !0,
                lowProfile: !0
            })), r.createElement("div", {
                className: "hint animate-enter1 well-transparent"
            }, l10n.t("pushname_description")), r.createElement(a, {
                a8n: "col-main-profile",
                title: l10n.t("web_status"),
                classes: "animate-enter1 well-input"
            }, r.createElement(f, {
                value: this.state.status,
                editable: Store.Status.canSetMyStatus(),
                pending: this.state.pendingStatus,
                showRemaining: !0,
                validate: this.validateStatus,
                maxLength: m.MAX_STATUS_LENGTH,
                onChange: this.onStatusChange,
                onSave: this.onSetStatus,
                onError: this.onSetStatusError,
                onCancel: this.onCancelStatus,
                supportsEmoji: !0,
                lockable: !0,
                lowProfile: !0
            }))))
        }
    });
    y.contextTypes = {
        uim: r.PropTypes.instanceOf(v)
    },
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e.scrollTop + c.SCROLL_FUDGE > e.scrollHeight - e.clientHeight
    }
    function i(e, t, n) {
        for (var r = n; r < e.length; r++)
            if (e[r] === t) {
                _.pullAt(e, r);
                break
            }
    }
    function o(e, t, n) {
        e.splice(n, 0, t)
    }
    var a = n(6)
      , s = n(37)
      , c = n(10)
      , l = n(9)
      , u = n(990)
      , d = n(996)
      , p = n(993)
      , h = n(991)
      , f = n(133)
      , m = n(992)
      , g = n(102)
      , v = n(1050)
      , y = n(1e3)
      , E = n(1118)
      , b = n(136)
      , S = n(14)
      , M = n(101)
      , C = n(1)
      , T = n(986)
      , w = n(139)
      , k = n(134)
      , x = n(988)
      , N = n(1029)
      , P = N.MenuBarItem
      , D = n(995)
      , O = n(437)
      , A = n(1242)
      , R = n(67)
      , I = n(135)
      , L = I.HotKeys
      , F = a.createClass({
        displayName: "StarredDrawer",
        mixins: [f, m, k],
        propTypes: {
            chat: a.PropTypes.instanceOf(x),
            onClose: a.PropTypes.func
        },
        getInitialState: function() {
            if (this.handleScroll = _.throttle(this._handleScroll, 100),
            this.props.chat) {
                var e = this.props.chat.id;
                Store.StarredMsg.syncState[e] || (Store.StarredMsg.syncState[e] = Store.StarredMsg.syncState[Store.StarredMsg.ALL])
            }
            return this.msgListInfo = {
                visibleMsgs: {}
            },
            {
                cursor: new E(Store.StarredMsg,(void 0),c.RENDOR_CURSOR.STARRED_DRAWER).loadAfter(c.MSG_PRELOAD_THRESHOLD),
                msgs: []
            }
        },
        componentWillMount: function() {
            this.currSelection = new y([],function(e) {
                return e.id.toString()
            }
            ),
            this.activeSelection = new y([],function(e) {
                return e.id.toString()
            }
            ),
            this.checkSyncState(Store.StarredMsg.SYNC_STATES.NONE) && this.loadEarlierMsgs()
        },
        componentDidMount: function() {
            var e = this;
            this.focus(),
            this.regNativeListener(window, "resize", this.updateMsgListInfo),
            this.checkSyncState(Store.StarredMsg.SYNC_STATES.READY) ? this.initObservers() : this.addObserverOnce(Store.StarredMsg, "sync", this.initObservers),
            this.addObserver(Store.StarredMsg, "reset", function() {
                e.setState(e.getInitialState()),
                e.loadEarlierMsgs()
            })
        },
        componentWillUnmount: function() {
            this._firstSyncComplete && this._firstSyncComplete.cancel(),
            this.handleScroll.cancel()
        },
        componentDidUpdate: function() {
            this.updateMsgListInfo()
        },
        initObservers: function() {
            var e = this
              , t = this.props.chat;
            this.addObserverAndRun(Store.StarredMsg, "reset sync", function() {
                var n = t ? Store.StarredMsg.filter(function(t) {
                    return t.chat.id === e.props.chat.id
                }) : Store.StarredMsg.filter(function(e) {
                    return !0
                });
                e.initSelectionObjects(n),
                e.setState({
                    msgs: n
                })
            }),
            this.addObserver(Store.StarredMsg, "add", function(t) {
                e.handleStarChange(t, o)
            }),
            this.addObserver(Store.StarredMsg, "remove", function(t) {
                e.handleStarChange(t, i)
            }),
            this.onFocusGain()
        },
        handleStarChange: function(e, t) {
            var n = this.props.chat
              , r = this.state.msgs;
            if (!n || n.id === e.chat.id) {
                var i = _.sortedIndexBy(r, e, function(e) {
                    return -1 * e.t
                });
                t(r, e, i),
                this.initSelectionObjects(r),
                this.setState({
                    msgs: r
                })
            }
        },
        initSelectionObjects: function(e) {
            this.currSelection.init(e, !0),
            this.activeSelection.init(e)
        },
        loadEarlierMsgs: function() {
            var e = this
              , t = this.state.cursor
              , n = this.props.chat ? this.props.chat.id : Store.StarredMsg.ALL
              , r = n === Store.StarredMsg.ALL ? void 0 : n;
            if (t.end < this.state.msgs.length)
                this.setState({
                    cursor: t.loadAfter()
                });
            else {
                if (Store.StarredMsg.isSynced(n))
                    return;
                var i = void 0;
                i = M.supportsFeature(M.F.STARRED_PAGINATION) ? Store.StarredMsg.sync(!0, r) : Store.StarredMsg.sync(!1),
                i.checkpoint(this.rejectOnUnmount()).then(function() {
                    t.end < e.state.msgs.length && e.setState({
                        cursor: t.loadAfter()
                    })
                })["catch"](S.Unmount, _.noop)["catch"](function(e) {
                    C.log("StarredDrawer:loadEarlierMsgs failed")(),
                    C.log(e)()
                })
            }
        },
        onClose: function() {
            this.props.onClose ? this.props.onClose() : this.context.uim.uie.requestDismiss()
        },
        focus: function() {
            w.focus(s.findDOMNode(this.refs.body))
        },
        onFocusGain: function(e) {
            var t = e ? e.target : document.activeElement;
            t === s.findDOMNode(this.refs.body) && (this.currSelection.index < 0 ? this.currSelection.setFirst() : this.currSelection.reset())
        },
        onNextMsg: function(e) {
            e && (e.preventDefault(),
            e.stopPropagation());
            var t = this.currSelection.next();
            this.currSelection.index !== t && this.currSelection.setNext()
        },
        onPrevMsg: function(e) {
            e && (e.stopPropagation(),
            e.preventDefault());
            var t = this.currSelection.prev();
            t > -1 && this.currSelection.setPrev()
        },
        onScroll: function(e) {
            this.handleScroll(e.target)
        },
        _handleScroll: function(e) {
            this.updateMsgListInfo(),
            r(e) && this.loadEarlierMsgs()
        },
        selectMsg: function(e) {
            this.currSelection.setVal(e),
            this.activeSelection.setVal(e),
            l.openChat(e.chat, e.chat.getSearchContext(e), !1),
            l.focusShowMsg(e.id)
        },
        getMsgs: function() {
            var e = this.state.cursor
              , t = this.props.chat ? this.props.chat.id : Store.StarredMsg.ALL
              , n = void 0
              , r = Store.StarredMsg.loadMarker[t]
              , i = r ? this.state.msgs.indexOf(Store.StarredMsg.get(r)) : -1
              , o = i < 0 || Store.StarredMsg.isSynced(t) ? e.end : Math.min(e.end, i + 1);
            return n = this.state.msgs.slice(e.start, o),
            this.length = n.length,
            n
        },
        checkSyncState: function(e) {
            var t = this.props.chat
              , n = t ? t.id : Store.StarredMsg.ALL;
            return Store.StarredMsg.syncState[n] === e
        },
        getMsgVisibility: function(e) {
            if (!e)
                return c.VISIBILITY.BELOW;
            var t = s.findDOMNode(this.refs.scrollContainer)
              , n = t.previousSibling.clientHeight
              , r = t.scrollTop + n
              , i = r + t.clientHeight
              , o = s.findDOMNode(e);
            return o ? o.offsetTop + o.clientHeight <= r ? c.VISIBILITY.ABOVE : o.offsetTop >= i ? c.VISIBILITY.BELOW : c.VISIBILITY.VISIBLE : c.VISIBILITY.BELOW
        },
        isMsgVisible: function(e) {
            var t = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1];
            return !!this.msgListInfo.visibleMsgs[e.toString()] && (!!t || this.getMsgComponent(e))
        },
        getMsgComponent: function(e) {
            var t = this.refs[e.toString()];
            if (t) {
                var n = t.refs.wrapper;
                if (n)
                    return n.refs.component && n.refs.component.refs.msg
            }
        },
        updateMsgListInfo: _.throttle(function() {
            for (var e = this.getMsgs(), t = {}, n = 0, r = this.length - 1; n < r; ) {
                var i = Math.floor((n + r) / 2)
                  , o = this.refs[e[i].id.toString()];
                this.getMsgVisibility(o) === c.VISIBILITY.ABOVE ? n = i + 1 : r = i
            }
            for (var a = n; a < e.length; a++) {
                var s = this.refs[e[a].id.toString()];
                if (this.getMsgVisibility(s) !== c.VISIBILITY.VISIBLE)
                    break;
                t[e[a].id.toString()] = !0
            }
            this.pauseHiddenGifs(this.msgListInfo.visibleMsgs, t),
            this.msgListInfo.visibleMsgs = t
        }, 100),
        pauseHiddenGifs: function(e, t) {
            for (var n in e)
                if (!t[n]) {
                    var r = Store.StarredMsg.get(n);
                    if (r && r.isGif) {
                        var i = this.getMsgComponent(n);
                        i && i.pause()
                    }
                }
        },
        render: function() {
            var e = this
              , t = this.getMsgs()
              , n = this.state.cursor
              , r = this.props.chat || null
              , i = this.props.chat ? this.props.chat.id : Store.StarredMsg.ALL
              , o = void 0
              , s = void 0;
            if (s = Store.StarredMsg.isSynced(i) && n.end >= this.state.msgs.length ? null : this.checkSyncState(Store.StarredMsg.SYNC_STATES.SYNCING) ? a.createElement("div", {
                className: "more"
            }, a.createElement("div", {
                className: "btn-more",
                title: l10n.t("loading_messages")
            }, a.createElement(b, {
                stroke: 6,
                size: 24
            }))) : a.createElement("div", {
                className: "more"
            }, a.createElement("div", {
                className: "btn-more",
                title: l10n.t("load_earlier_messages"),
                onClick: this.loadEarlierMsgs
            }, a.createElement("span", {
                className: "icon icon-refresh"
            }))),
            t.length > 0) {
                var c = t.map(function(t) {
                    var n = t.type === T.TYPE.IMAGE || t.type === T.TYPE.VIDEO || t.type === T.TYPE.AUDIO;
                    return a.createElement(v, {
                        key: t.id,
                        ref: t.id.toString(),
                        msg: t,
                        isMsgVisible: n ? e.isMsgVisible : _.noop,
                        currSelection: e.currSelection,
                        activeSelection: e.activeSelection,
                        onClickMsg: e.selectMsg
                    })
                });
                o = a.createElement(g, {
                    transitionName: "slide"
                }, c)
            } else
                Store.StarredMsg.isSynced(i) ? o = a.createElement(d.StarredMsgs, null ) : this.checkSyncState(Store.StarredMsg.SYNC_STATES.SYNCING) && (o = a.createElement(d.Loading, null ),
                s = null );
            var l = {
                down: this.onNextMsg,
                up: this.onPrevMsg
            }
              , f = t.length || this.checkSyncState(Store.StarredMsg.SYNC_STATES.SYNCED)
              , m = M.supportsFeature(M.F.UNSTAR_ALL) ? a.createElement(P, {
                a8n: "starred-menu",
                icon: "menu-white",
                title: l10n.t("menutitle_menu"),
                disabled: !f
            }, a.createElement(U, {
                chat: r,
                msgs: this.state.msgs
            })) : null ;
            return a.createElement(u, {
                id: "starred",
                onCancel: this.onClose
            }, a.createElement(L, {
                className: "drawer",
                handlers: l,
                onFocus: this.onFocusGain,
                "data-tab": 2,
                ref: "body"
            }, a.createElement(p, {
                title: l10n.t("starred_flow_title"),
                onBack: this.onClose,
                type: p.Type.LARGE,
                menu: m
            }), a.createElement(h, {
                onScroll: this.onScroll,
                ref: "scrollContainer"
            }, o, s)))
        }
    });
    F.contextTypes = {
        uim: a.PropTypes.instanceOf(R)
    },
    e.exports = F;
    var U = a.createClass({
        displayName: "StarredHeaderDropdown",
        propTypes: {
            chat: a.PropTypes.instanceOf(x),
            msgs: a.PropTypes.array
        },
        sendUnstarAll: function() {
            l.openModal(a.createElement(A, {
                msgs: this.props.msgs,
                chat: this.props.chat
            }))
        },
        render: function() {
            return a.createElement(O, {
                type: O.Type.DROPDOWN_MENU,
                flipOnRTL: !0,
                key: "StarredDrawerHeader",
                direction: {
                    x: O.Direction.X.LEFT
                }
            }, a.createElement(D, {
                a8n: "mi-unstar-all menu-item",
                action: this.sendUnstarAll
            }, l10n.t("unstar_all")))
        }
    })
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(82)
      , s = n(435)
      , c = n(1055)
      , l = n(1278)
      , u = n(14)
      , d = s.FILETYPE
      , p = d.IMAGE
      , h = d.DOCUMENT
      , f = {
        READY: "ready",
        PROCESSING: "processing",
        ERROR: "error"
    }
      , m = a.extend({
        props: {
            id: "number",
            file: "object",
            uiProcessed: "boolean"
        },
        session: {
            state: {
                type: "string",
                values: _.values(f)
            },
            media: "object",
            url: "string",
            name: "string",
            preview: "string",
            processPromise: "object",
            exception: "object",
            chat: "object",
            original: "object"
        },
        initialize: function() {
            this.processFile(this.file)
        },
        processFile: function(e) {
            var t = this;
            this.state = f.PROCESSING;
            var n = void 0
              , r = void 0;
            return this.processPromise = o["default"].resolve(e).then(function(e) {
                r = e,
                e.isGifHackDoNotUse && (n = {
                    isGif: !0,
                    gifAttribution: e.gifAttributionHackDoNotUse
                });
                var i = s.typeFromMimetype(e.type);
                if (i === h)
                    return t.chat.shouldSendEncrypted(h)
            }).then(function() {
                return c.prepFileForUpload(r, n)
            }).then(function(e) {
                return l.enrich(e)
            }).then(function(e) {
                var n = window.URL.createObjectURL(e.blob);
                return e.getThumb ? e.getThumb.then(function(r) {
                    var i = r.url;
                    return _.assign(t, {
                        media: e,
                        url: i,
                        preview: n,
                        state: f.READY
                    })
                }) : _.assign(t, {
                    media: e,
                    url: "",
                    name: r.name,
                    preview: n,
                    state: f.READY
                })
            })["catch"](u.MediaFileTooLarge, u.InvalidMediaFileType, u.MediaFileFailedLoad, function(e) {
                return _.assign(t, {
                    exception: e,
                    state: f.ERROR
                })
            })["catch"](function() {
                return _.assign(t, {
                    exception: new u.InvalidMediaFileType,
                    state: f.ERROR
                })
            })
        },
        getFileType: function() {
            return s.typeFromMimetype(this.file.type)
        },
        editImage: function(e) {
            return this.getFileType() !== p ? null : (window.URL.revokeObjectURL(this.preview),
            e.original = this.original || new m(this.toJSON()),
            this.set(e),
            void this.initialize())
        },
        revertImage: function() {
            if (this.getFileType() !== p)
                return null ;
            if (!this.original)
                return this;
            window.URL.revokeObjectURL(this.preview);
            var e = this.original.toJSON();
            return e.original = null ,
            this.set(e),
            this.initialize(),
            this
        }
    });
    m.STATE = f,
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    var r = n(55)
      , i = {
        dataTypes: {
            msgKey: {
                set: function(e) {
                    if (e instanceof r)
                        return {
                            val: e,
                            type: "msgKey"
                        }
                },
                compare: function(e, t, n) {
                    return e instanceof r && e.equals(t)
                }
            }
        }
    };
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(1)
      , c = n(23)
      , l = n(82)
      , u = n(45)
      , d = n(9)
      , p = n(101)
      , h = n(14)
      , f = n(68).ActionToast
      , m = n(68).ActionType
      , g = n(0)
      , v = n(142)
      , y = l.extend({
        props: {
            id: "string",
            expiration: {
                type: "number",
                "default": 0
            }
        },
        session: {
            _unmuteTimer: "string",
            promises: {
                type: "object",
                "default": function() {
                    return {}
                }
            }
        },
        derived: {
            isMuted: {
                deps: ["expiration"],
                fn: function() {
                    return !!this.expiration
                }
            }
        },
        initialize: function() {
            this.expiration && this.mute(this.expiration)
        },
        setMute: function(e, t) {
            (e || this.expiration) && e !== this.expiration && (e ? this.mute(e, t) : this.unmute(t))
        },
        mute: function E(e, t, n) {
            var r = this;
            if (!_.isNumber(e))
                return s.log("models:Mute:mute called with invalid expiration " + e)(),
                o["default"].reject(new h.ActionError);
            e = Math.round(e),
            e > 2e9 && s.log("models:Mute:mute called with wrong units?" + this.id + " exp:" + e)();
            var E = function() {
                this.isMuted && this._clearUnmuteTimer();
                var t = e - g().unix();
                s.log("models:Mute:mute " + this.id + " duration:" + t)(),
                this._unmuteTimer = v.setTimeout(this.unmute.bind(this), 1e3 * e),
                this.set({
                    expiration: e
                })
            }
            .bind(this)
              , i = c.isGroup(this.id);
            if (t) {
                if (this.promises.mute)
                    return this.promises.mute;
                this.promises.mute = u.sendConversationMute(this.id, e, this.expiration);
                var l = new m(i ? l10n.t("action_group_muting") : l10n.t("action_chat_muting"));
                n = n || f.genId();
                var p = this.promises.mute["catch"](function(o) {
                    s.error("models:Mute:mute dropped")(o);
                    var a = i ? l10n.t("action_group_mute_failed") : l10n.t("action_chat_mute_failed");
                    throw new m(a,l10n.t("action_try_again"),r.mute.bind(r, e, t, n))
                }).then(function(e) {
                    if (200 === e.status) {
                        var o = i ? l10n.t("action_group_muted") : l10n.t("action_chat_muted");
                        return new m(o,l10n.t("action_undo"),r.unmute.bind(r, t, n))
                    }
                    if (e.status >= 400)
                        throw new m(i ? l10n.t("action_group_mute_failed") : l10n.t("action_chat_mute_failed"))
                });
                return d.openToast(a.createElement(f, {
                    id: n,
                    initialAction: l,
                    pendingAction: p
                })),
                this.promises.mute.then(function(e) {
                    200 !== e.status || e._duplicate || E()
                })["finally"](function() {
                    r.promises.mute = null
                })
            }
            return E(),
            o["default"].resolve()
        },
        canMute: function() {
            return p.supportsFeature(p.F.MUTE) && c.isGroup(this.id) || p.supportsFeature(p.F.MUTE_1_1) && c.isUser(this.id)
        },
        _clearUnmuteTimer: function() {
            v.clearTimeout(this._unmuteTimer),
            this.unset("_unmuteTimer"),
            this.expiration = 0
        },
        unmute: function b(e, t) {
            var n = this
              , b = function() {
                s.log("models:Mute:unmute " + this.id)(),
                this._clearUnmuteTimer()
            }
            .bind(this)
              , r = c.isGroup(this.id);
            if (e) {
                if (this.promises.unmute)
                    return this.promises.unmute;
                this.promises.unmute = u.sendConversationMute(this.id, !1, this.expiration);
                var i = new m(r ? l10n.t("action_group_unmuting") : l10n.t("action_chat_unmuting"));
                t = t || f.genId();
                var l = this.promises.unmute["catch"](function(i) {
                    s.error("models:Mute:unmute dropped")(i);
                    var a = r ? l10n.t("action_group_unmute_failed") : l10n.t("action_chat_unmute_failed");
                    return o["default"].reject(new m(a,l10n.t("action_try_again"),n.unmute.bind(n, e, t)))
                }).then(function(e) {
                    if (200 === e.status)
                        return new m(r ? l10n.t("action_group_unmuted") : l10n.t("action_chat_unmuted"));
                    if (e.status >= 400)
                        throw new m(r ? l10n.t("action_group_unmute_failed") : l10n.t("action_chat_unmute_failed"))
                });
                return d.openToast(a.createElement(f, {
                    id: t,
                    initialAction: i,
                    pendingAction: l
                })),
                this.promises.unmute.then(function(e) {
                    200 !== e.status || e._duplicate || b()
                })["finally"](function() {
                    n.promises.unmute = null
                })
            }
            return b(),
            o["default"].resolve()
        },
        "delete": function() {
            l.prototype["delete"].call(this),
            this._clearUnmuteTimer()
        }
    });
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(988)
      , a = n(9)
      , s = n(429)
      , c = n(989)
      , l = n(1035)
      , u = n(101)
      , d = n(133)
      , p = r.createClass({
        displayName: "MultiselectBar",
        mixins: [d],
        propTypes: {
            chat: r.PropTypes.instanceOf(o).isRequired,
            selectedMessages: r.PropTypes.arrayOf(r.PropTypes.instanceOf(i)).isRequired,
            onCancel: r.PropTypes.func.isRequired,
            noSortOnForward: r.PropTypes.bool
        },
        componentWillMount: function() {
            this.componentWillReceiveProps()
        },
        componentWillReceiveProps: function() {
            var e = this
              , t = arguments.length <= 0 || void 0 === arguments[0] ? {} : arguments[0]
              , n = t.selectedMessages || []
              , r = this.props.selectedMessages;
            _.difference(n, r).forEach(function(t) {
                return e.addObserver(t, "change:star")
            }),
            _.difference(r, n).forEach(function(t) {
                return e.removeObserver(t, "change:star")
            })
        },
        onStarSelected: function() {
            this.props.chat.sendStarMsgs(this.props.selectedMessages, !0),
            this.props.onCancel()
        },
        onUnstarSelected: function() {
            this.props.chat.sendStarMsgs(this.props.selectedMessages, !1),
            this.props.onCancel()
        },
        onDeleteSelected: function() {
            var e = this
              , t = this.props.selectedMessages
              , n = function() {
                a.closeModal(),
                e.props.chat.sendDeleteMsgs(t),
                e.props.onCancel()
            }
              , i = _.size(t)
              , o = l10n.t("delete_message_confirmation", {
                count: i,
                _plural: i
            });
            a.openModal(r.createElement(s, {
                onOK: n,
                okText: l10n.t("web_delete"),
                onCancel: a.closeModal.bind(a),
                cancelText: l10n.t("web_cancel")
            }, r.createElement(c, {
                text: o
            })))
        },
        onForwardSelected: function() {
            var e = this
              , t = this.props.selectedMessages;
            this.props.noSortOnForward || (t = this.props.chat.sortMsgs(t));
            var n = _.size(t)
              , i = function() {
                e.props.onCancel()
            }
              , o = _.filter(t, function(e) {
                return e.canForward()
            });
            if (_.size(o))
                if (n !== _.size(o)) {
                    var c = function() {
                        a.openModal(r.createElement(l, {
                            msgs: o,
                            onForward: i
                        }), "modal-flow")
                    };
                    a.openModal(r.createElement(s, {
                        title: l10n.t("confirm_forward_partial_messages_title"),
                        onOK: c,
                        okText: l10n.t("forward"),
                        onCancel: a.closeModal.bind(a),
                        cancelText: l10n.t("web_cancel")
                    }, l10n.t("confirm_forward_partial_messages_text")))
                } else
                    a.openModal(r.createElement(l, {
                        msgs: t,
                        onForward: i
                    }), "modal-flow");
            else
                a.openModal(r.createElement(s, {
                    title: l10n.t("err_unsent_forward_title"),
                    onOK: a.closeModal.bind(a),
                    okText: l10n.t("web_ok")
                }, l10n.t("err_unsent_forward_text", {
                    count: n,
                    _plural: n
                })))
        },
        render: function() {
            var e, t = this.props.selectedMessages, n = _.size(t), o = u.supportsFeature(u.F.ENC_DOC) || _.every(t, function(e) {
                return e.type !== i.TYPE.DOCUMENT
            }), a = _.some(t, function(e) {
                return e.canForward()
            }), s = r.createElement("button", {
                className: "btn-icon btn-forward",
                disabled: n && o && a ? null : "disabled",
                title: l10n.t("forward_message", {
                    count: n,
                    _plural: n
                }),
                onClick: this.onForwardSelected
            }, r.createElement("span", {
                className: "icon icon-forward"
            }));
            u.supportsFeature(u.F.MESSAGE_DELETE) && (e = r.createElement("button", {
                className: "btn-icon btn-delete",
                disabled: n ? null : "disabled",
                title: l10n.t("delete_message", {
                    count: n,
                    _plural: n
                }),
                onClick: this.onDeleteSelected
            }, r.createElement("span", {
                className: "icon icon-delete"
            })));
            var c;
            if (u.supportsFeature(u.F.STARRED)) {
                var l, d, p;
                n && _.every(t, "star") ? (l = this.onUnstarSelected,
                d = r.createElement("span", {
                    className: "icon icon-unstar-btn"
                }),
                p = l10n.t("unstar_message", {
                    count: n,
                    _plural: n
                })) : (l = this.onStarSelected,
                d = r.createElement("span", {
                    className: "icon icon-star-btn"
                }),
                p = l10n.t("star_message", {
                    count: n,
                    _plural: n
                })),
                c = r.createElement("button", {
                    className: "btn-icon btn-star",
                    disabled: n ? null : "disabled",
                    title: p,
                    onClick: l
                }, d)
            }
            return r.createElement("div", {
                className: "multi-controls"
            }, r.createElement("button", {
                className: "btn-icon btn-cancel",
                onClick: this.props.onCancel
            }, r.createElement("span", {
                className: "icon icon-x"
            })), r.createElement("span", {
                className: "multi-count"
            }, l10n.t("selected_count", {
                count: n,
                _plural: n
            })), c, e, s)
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e) {
        return (0,
        u["default"])(_.pick(e, ["message", "filename", "lineno", "colno"]))
    }
    function o(e, t, n, r) {
        if (!e)
            throw new f.MediaEncryptionError('decrypt async, missing "type"');
        if (!t)
            throw new f.MediaEncryptionError('decrypt async, missing "buffer"');
        if (!n)
            throw new f.MediaEncryptionError('decrypt async, missing "mediaKey"');
        var o = new m.WebcCryptoMedia({
            webcCryptoType: m.WEBC_CRYPTO_TYPE_CODE.DECRYPT
        });
        return p.supportsWebCrypto().then(function(a) {
            return a ? (o.webcCryptoLibrary = m.WEBC_CRYPTO_LIBRARY_CODE.WEBCRYPTO,
            d.decryptE2EMediaWithWebCrypto(e, t, n, r)) : (o.webcCryptoLibrary = m.WEBC_CRYPTO_LIBRARY_CODE.CRYPTOJS,
            new c["default"](function(i, o) {
                var a = new h;
                a.onmessage = i,
                a.onerror = o,
                a.postMessage({
                    command: "decrypt-e2e-media",
                    type: e,
                    buffer: t,
                    mediaKey: n,
                    mimetype: r
                })
            }
            )["catch"](function(e) {
                throw new Error(i(e))
            }).then(function(e) {
                return e.data
            }))
        }).then(function(e) {
            return o.webcCryptoFileSize = t.byteLength,
            o.markWebcCryptoElapsedT(),
            o.commit(),
            e
        })
    }
    function a(e, t, n) {
        if (!e)
            throw new f.MediaEncryptionError('encrypt async, missing "type"');
        if (!t)
            throw new f.MediaEncryptionError('encrypt async, missing "buffer"');
        if (!n)
            throw new f.MediaEncryptionError('encrypt async, missing "mediaKey"');
        var r = new m.WebcCryptoMedia({
            webcCryptoType: m.WEBC_CRYPTO_TYPE_CODE.ENCRYPT
        });
        return p.supportsWebCrypto().then(function(o) {
            return o ? (r.webcCryptoLibrary = m.WEBC_CRYPTO_LIBRARY_CODE.WEBCRYPTO,
            d.encryptE2EMediaWithWebCrypto(e, t, n)) : (r.webcCryptoLibrary = m.WEBC_CRYPTO_LIBRARY_CODE.CRYPTOJS,
            new c["default"](function(r, i) {
                var o = new h;
                o.onmessage = r,
                o.onerror = i,
                o.postMessage({
                    command: "encrypt-e2e-media",
                    type: e,
                    buffer: t,
                    mediaKey: n
                })
            }
            )["catch"](function(e) {
                throw new Error(i(e))
            }).then(function(e) {
                return e.data
            }))
        }).then(function(e) {
            return r.webcCryptoFileSize = e.size,
            r.markWebcCryptoElapsedT(),
            r.commit(),
            e
        })
    }
    var s = n(2)
      , c = r(s)
      , l = n(21)
      , u = r(l)
      , d = n(214)
      , p = n(219)
      , h = n(1296)
      , f = n(14)
      , m = n(56);
    e.exports = {
        decryptE2EMedia: o,
        encryptE2EMedia: a
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(1005)
      , s = n(14)
      , c = {
        getFiles: function(e, t) {
            var n = e.target.files || e.dataTransfer.files;
            if (n = _.map(n, function(e, t) {
                return e
            }),
            n.length)
                return o["default"].resolve(n);
            if (e.dataTransfer.getData("text/uri-list"))
                return a.urlToFile(e.dataTransfer.getData("text/uri-list")).then(function(e) {
                    return [e]
                });
            if (e.dataTransfer.getData("text/html")) {
                var r = new DOMParser
                  , i = r.parseFromString(e.dataTransfer.getData("text/html"), "text/html");
                if (i.createNodeIterator(i.childNodes[0], NodeFilter.SHOW_TEXT).nextNode()) {
                    if (e.dataTransfer.getData("text/plain") && !t)
                        return o["default"].reject(new s.MediaDragDropError("dropped html has text nodes",e.dataTransfer.getData("text/plain")))
                } else {
                    var c = i.getElementsByTagName("img");
                    if (c.length)
                        return a.urlToFile(c[0].src).then(function(e) {
                            return [e]
                        })
                }
            }
            return o["default"].resolve(n)
        }
    };
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return CryptoJS.lib.WordArray.create(new Uint8Array(e))
    }
    var i = n(214)
      , o = n(13)
      , a = n(14)
      , s = n(32)
      , c = n(1)
      , l = n(1119)
      , u = n(23)
      , d = {
        ackE2EMedia: function(e, t, n) {
            if (t && n && e) {
                var a = u.userToLegacy(Store.Conn.me)
                  , d = o.build(a).readBuffer()
                  , p = CryptoJS.lib.WordArray.create(d)
                  , h = r(i.computeKeys(e, t).refKey)
                  , f = CryptoJS.HmacSHA256(p, h);
                f.sigBytes = 20,
                f.clamp();
                var m = s.urlSafe(f.toString(CryptoJS.enc.Base64))
                  , g = n + "?ack=" + m;
                return c.log("crypto:ack:" + g)(),
                l.postRetry(g)
            }
        },
        computeRefs: function(e, t) {
            if (!e || !t || t.filter(function(e) {
                return !u.isUser
            }).length > 0)
                throw new a.MediaEncryptionError("computeRefs error: " + !!e + "," + (t && t.join()));
            var n = r(e);
            return t.map(function(e) {
                var t = CryptoJS.HmacSHA256(CryptoJS.enc.Utf8.parse(u.userToLegacy(e)), n);
                return t.sigBytes = 20,
                t.clamp(),
                s.urlSafe(t.toString(CryptoJS.enc.Base64))
            })
        },
        newB64MediaKey: function() {
            var e = new Uint8Array(32);
            return window.crypto.getRandomValues(e),
            s.encode(e)
        }
    };
    e.exports = d
}
, function(e, t) {
    "use strict";
    var n = {
        boundHeightWidth: function(e, t, n, r) {
            return t = t || r,
            e = e || n,
            t > e ? t > r && (e *= r / t,
            t = r) : e > n && (t *= n / e,
            e = n),
            {
                width: Math.max(t, 1),
                height: Math.max(e, 1)
            }
        }
    };
    e.exports = n
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e) {
        var t = arguments.length <= 1 || void 0 === arguments[1] || arguments[1]
          , n = void 0;
        return new u["default"](function(r, i) {
            n = new Image,
            t && 0 !== e.indexOf("data:") && n.setAttribute("crossOrigin", "anonymous"),
            n.onload = r,
            n.onabort = function() {
                i(new Error("loadImage onabort"))
            }
            ,
            n.onerror = function() {
                i(new Error("loadImage onerror"))
            }
            ,
            n.src = e
        }
        )["return"](n)
    }
    function o(e) {
        return i(e).then(function(t) {
            return t.naturalWidth > 0 ? {
                img: t,
                fullWidth: t.naturalWidth,
                fullHeight: t.naturalHeight
            } : u["default"].reject(new d.MediaLoadError("image loaded with zero width",e))
        })["catch"](function() {
            return u["default"].reject(new d.MediaLoadError("unable to render image",e))
        })
    }
    function a(e) {
        var t = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1]
          , n = void 0
          , r = void 0
          , i = ++E
          , o = new u["default"](function(o, a) {
            m.log("MediaLoad:video called (#" + i + ") for " + e.name)(),
            n = document.createElement("video"),
            n.volume = 0,
            n.autoplay = !0,
            n.onloadedmetadata = function() {
                m.log("MediaLoad:video.onloadedmetadata #" + i)()
            }
            ,
            t ? (n.onloadeddata = function() {
                m.log("MediaLoad:video.onloadeddata #" + i)()
            }
            ,
            n.onprogress = function() {
                m.log("MediaLoad:video.onprogress #" + i)()
            }
            ) : (n.onloadeddata = o,
            n.onprogress = o),
            n.onplay = o,
            n.onerror = function() {
                m.error("MediaLoad:video.onerror #" + i)(),
                a(new d.MediaLoadError("unable to play video",r))
            }
            ,
            n.src = r = window.URL.createObjectURL(e),
            n.load()
        }
        );
        return setTimeout(function() {
            o.isPending() && (m.error("unable to load video #" + i + " (" + e.size + " bytes)")(),
            0 === _ && (b = e),
            3 === ++_ && (m.assert(!1, "dead-video", "had " + _ + " silent videos")(),
            f(b)))
        }, 8e3),
        o.delay(10).then(function() {
            if (m.log("MediaLoad:video #" + i + " successful")(),
            n.pause(),
            n.videoWidth > 0)
                return {
                    video: n,
                    fullWidth: n.videoWidth,
                    fullHeight: n.videoHeight
                };
            throw n.duration > 0 ? new d.MediaUnsupportedError("video loaded with duration but no dims") : new d.MediaLoadError("video loaded with zero width",r)
        })["finally"](function() {
            n && (n.onloadedmetadata = null ,
            n.onloadeddata = null ,
            n.onplay = null ,
            n.onerror = null ),
            r && window.URL.revokeObjectURL(r)
        })
    }
    function s(e) {
        var t = void 0;
        return new u["default"](function(n, r) {
            t = document.createElement("audio"),
            t.volume = 0,
            t.autoplay = !0,
            t.onplay = function(e) {
                t.pause(),
                n({
                    audio: t
                })
            }
            ,
            t.onerror = function() {
                r(new d.MediaLoadError("unable to play audio",e))
            }
            ,
            t.src = e
        }
        )["finally"](function() {
            t && (t.onplay = t.onerror = null )
        })
    }
    function c(e, t) {
        var n = t.indexOf(p.MIMETYPE_OGG) > -1;
        if (n && !y) {
            if (e.size <= v) {
                var r = new g(e);
                return r.generateBlob()
            }
            throw new d.MediaLoadError("media-load:transcode blob too large",e.size)
        }
        return u["default"].resolve(e)
    }
    var l = n(2)
      , u = r(l)
      , d = n(14)
      , p = n(10)
      , h = n(1099)
      , f = h.reportFossil
      , m = n(1)
      , g = n(1288)
      , v = 3e5
      , y = (new Audio).canPlayType("audio/ogg")
      , _ = 0
      , E = 0
      , b = null ;
    e.exports = {
        loadImage: i,
        image: o,
        video: a,
        audio: s,
        transcode: c
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(432)
      , m = n(1010)
      , g = n(1009)
      , v = g.matchAll
      , y = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "match",
            value: function(e) {
                return v(f.emojiRegex(), e)
            }
        }, {
            key: "alwaysApply",
            get: function() {
                return !0
            }
        }]),
        t
    }(m);
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(1010)
      , m = n(1009)
      , g = m.matchAll
      , v = n(31)
      , y = function(e) {
        function t(e) {
            var n = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1];
            (0,
            s["default"])(this, t);
            var r = (0,
            d["default"])(this, (0,
            o["default"])(t).call(this))
              , i = e.map(v.escapeRegExp)
              , a = n ? "(?:^|\\b)" : "";
            return r._regex = new RegExp(a + "(" + i.join("|") + ")","ig"),
            r
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "match",
            value: function(e) {
                return g(this._regex, e)
            }
        }]),
        t
    }(f);
    e.exports = y
}
, function(e, t) {
    "use strict";
    var n = 0
      , r = 1
      , i = 2
      , o = function(e, t) {
        for (var n = [], r = 0; r < t.length; ++r) {
            var i = t[r]
              , o = i.match(e);
            if (o && o.length) {
                for (var a = i.group, s = 0; s < o.length; ++s) {
                    var c = o[s]
                      , l = c[0]
                      , u = c.index;
                    if (c.idx = r,
                    c.end = u + l.length - 1,
                    a) {
                        var d = c[a];
                        c.gindex = u + l.indexOf(d),
                        c.gend = c.gindex + d.length - 1
                    } else
                        c.gindex = u,
                        c.gend = c.end
                }
                n.push(o)
            }
        }
        if (!n.length)
            return n;
        if (1 === n.length)
            return n[0].reverse();
        for (var p = [], h = 0; h < n.length; ++h)
            p[h] = n[h].length - 1;
        for (var f = [], m = 0; n.length > 1; ) {
            for (var g = 0, v = -1; g < n.length; ++g)
                n[g][p[g]].index > v && (m = g,
                v = n[g][p[g]].index);
            f.push(n[m][p[m]]),
            --p[m] < 0 && (n.splice(m, 1),
            p.splice(m, 1))
        }
        return f.push.apply(f, n[0].slice(0, p[0] + 1).reverse()),
        f
    }
      , a = function(e, t) {
        if (1 === e.length)
            return e;
        for (var n = [], r = void 0; r = e.pop(); ) {
            var i = e.length;
            if (!i && n.push(r))
                break;
            for (var o = r, a = o.end, s = o.gend, c = o.idx, l = t[c], u = l.alwaysApply, d = l.formatResult, p = l.mutates, h = !0, f = i - 1; f >= 0; --f) {
                var m = e[f];
                if (m.index > a)
                    break;
                if (m.end > s) {
                    if (c < m.idx && e.splice(f, 1))
                        continue;
                    h = !1;
                    break
                }
                if (!p || !e.splice(f, 1)) {
                    var g = t[m.idx];
                    if (!u && !g.formatResult) {
                        h = !1;
                        break
                    }
                    d || g.alwaysApply || !e.splice(f, 1)
                }
            }
            h && n.push(r)
        }
        return n
    }
      , s = function(e, t) {
        for (var o = e[0].input, a = {
            children: []
        }, s = 0, l = a, u = void 0, d = 0; d < e.length; ++d) {
            for (var p = e[d], h = p.index, f = p.gindex; l.parent && h > (u = l.match.gend); ) {
                if (s <= u && l.children.push({
                    type: n,
                    value: o.substring(s, u + 1)
                }),
                s = l.match.end + 1,
                l.mutator.isFragment) {
                    var m = l.parent.children;
                    m.pop(),
                    m.push.apply(m, l.children)
                }
                l.mutator.isFormatter && u !== l.match.end && l.parent.children.push({
                    type: r,
                    value: o.substring(u + 1, s)
                }),
                l = l.parent
            }
            s < h && l.children.push({
                type: n,
                value: o.substring(s, h)
            });
            var g = t[p.idx]
              , v = g.mutates
              , y = g.isFormatter;
            s = f,
            y && h !== f && l.children.push({
                type: r,
                value: o.substring(h, f)
            });
            var _ = {
                children: [],
                match: p,
                mutator: g,
                parent: l,
                type: i
            };
            if (v) {
                var E = p[g.group]
                  , b = g.mutate(E, p);
                if (E !== b) {
                    var S = c(b, t);
                    _.children = S.children,
                    s = p.gend + 1
                }
            }
            l.children.push(_),
            l = _
        }
        do {
            var M = l.match
              , C = M.end
              , T = M.gend;
            if (s <= T && l.children.push({
                type: n,
                value: o.substring(s, T + 1)
            }),
            s = C + 1,
            l.mutator.isFragment) {
                var w = l.parent.children;
                w.pop(),
                w.push.apply(w, l.children)
            }
            l.mutator.isFormatter && T !== C && l.parent.children.push({
                type: r,
                value: o.substring(T + 1, s)
            })
        } while ((l = l.parent) && l.parent);return s !== o.length && l.children.push({
            type: n,
            value: o.substring(s)
        }),
        a
    }
      , c = function(e, t) {
        var r = o(e, t);
        return r.length ? s(a(r, t), t) : {
            children: [{
                type: n,
                value: e
            }]
        }
    }
      , l = function u(e, t) {
        var o = e.children
          , a = e.type
          , s = e.value;
        if (a === r)
            return t.onDelimiter(s);
        if (a === n)
            return t.onText(s);
        var c = o.map(function(e) {
            return u(e, t)
        }).filter(function(e) {
            return !!e
        });
        return a === i ? t.onMutatorNode(e, c) : t.onRoot(c)
    };
    e.exports = {
        parse: c,
        serialize: l
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t, n) {
        var r = e.models;
        if (n === E.BEFORE) {
            var i = function() {
                var e = 0;
                return {
                    v: {
                        hasNext: function() {
                            return t >= e
                        },
                        next: function() {
                            return r[t--]
                        }
                    }
                }
            }();
            if ("object" == typeof i)
                return i.v
        } else {
            if (n !== E.AFTER)
                throw new Error("RendorCursor:invalid direction");
            var o = function() {
                var e = r.length - 1;
                return {
                    v: {
                        hasNext: function() {
                            return t <= e
                        },
                        next: function() {
                            return r[t++]
                        }
                    }
                }
            }();
            if ("object" == typeof o)
                return o.v
        }
    }
    function o(e, t, n) {
        for (var r = arguments.length <= 3 || void 0 === arguments[3] ? 1 : arguments[3], o = T * r, a = i(e, t, n), s = 0, l = 0, u = void 0; a.hasNext(); ) {
            var d = a.next()
              , p = c(d)
              , h = 2 * d.isNotification + d.isSentByMe
              , f = h && h === u ? b : S;
            if (s += p + f,
            l++,
            s > o)
                break;
            u = h
        }
        return l
    }
    function a(e, t, n) {
        for (var r = arguments.length <= 3 || void 0 === arguments[3] ? 1 : arguments[3], o = T * r, a = i(e, t, n), s = 0, l = 0, u = void 0; a.hasNext(); ) {
            var d = a.next()
              , p = c(d)
              , h = d.author || (d.isSentByMe ? Store.Conn.me : void 0)
              , f = h && !d.isSentByMe && h !== u ? M : 0
              , m = h && h === u ? b : S;
            if (s += p + f + m,
            l++,
            s > o)
                break;
            u = h
        }
        return l
    }
    function s(e, t, n) {
        for (var r = arguments.length <= 3 || void 0 === arguments[3] ? 1 : arguments[3], o = T * r, a = i(e, t, n), s = 0, l = 0; a.hasNext(); ) {
            var u = a.next()
              , d = c(u);
            if (s += d + C,
            l++,
            s > o)
                break
        }
        return l
    }
    function c(e) {
        var t = 0;
        switch (e.quotedMsg && (t += 54),
        e.caption && (t += 31),
        e.type) {
        case m.TYPE.NOTIFICATION:
        case m.TYPE.GROUP_NOTIFICATION:
        case m.TYPE.GP2:
        case m.TYPE.BROADCAST_NOTIFICATION:
        case m.TYPE.E2E_NOTIFICATION:
        case m.TYPE.CALL_LOG:
        case m.TYPE.CIPHERTEXT:
        case m.TYPE.CHAT:
            e.linkPreview && (t += 53);
            var n = y(e.body).length;
            return t + 19 * _.ceil(n / 100) + 13;
        case m.TYPE.IMAGE:
            return t + e.fullWidth && e.fullHeight ? Math.floor(Math.min(330 / e.fullWidth * e.fullHeight, 330)) : 330;
        case m.TYPE.VIDEO:
        case m.TYPE.AUDIO:
            return e.isGif ? t + 137 : t + 166;
        case m.TYPE.LOCATION:
            return t + v.previewHeight;
        case m.TYPE.PTT:
            return t + 67;
        case m.TYPE.VCARD:
            return t + 74;
        case m.TYPE.DOCUMENT:
            return t + 188;
        case m.TYPE.UNKNOWN:
        default:
            return t
        }
    }
    function l(e) {
        switch (e) {
        case g.RENDOR_CURSOR.CONVERSATION:
        case g.RENDOR_CURSOR.GROUP_CONVERSATION:
            return g.RENDOR_CURSOR.RECENT_AT_BOTTOM;
        case g.RENDOR_CURSOR.STARRED_DRAWER:
            return g.RENDOR_CURSOR.RECENT_AT_TOP;
        default:
            return g.RENDOR_CURSOR.RECENT_AT_BOTTOM
        }
    }
    function u(e) {
        switch (e) {
        case g.RENDOR_CURSOR.CONVERSATION:
            return o;
        case g.RENDOR_CURSOR.GROUP_CONVERSATION:
            return a;
        case g.RENDOR_CURSOR.STARRED_DRAWER:
            return s;
        default:
            return o
        }
    }
    var d = n(36)
      , p = r(d)
      , h = n(44)
      , f = r(h)
      , m = n(986)
      , g = n(10)
      , v = n(1092)
      , y = n(1082)
      , E = {
        BEFORE: "before",
        AFTER: "after"
    }
      , b = 2
      , S = 12
      , M = 19
      , C = 65
      , T = window.innerHeight
      , w = _.debounce(function(e) {
        T = window.innerHeight
    }, 500);
    window.addEventListener("resize", w);
    var k = function() {
        function e(t, n, r) {
            var i = this;
            (0,
            p["default"])(this, e);
            var o = u(r);
            this.msgCollection = t,
            this.type = r,
            this.dir = l(r),
            this.cursorSize = function(e, t) {
                if (e === E.BEFORE)
                    return o(i.msgCollection, i.start - 1, e, t);
                if (e === E.AFTER)
                    return o(i.msgCollection, i.end, e, t);
                throw new Error("RendorCursor:invalid direction")
            }
            ,
            this.init(n)
        }
        return (0,
        f["default"])(e, [{
            key: "init",
            value: function(e) {
                return this.before = 0,
                this.after = 0,
                this.setKey(e),
                this.loadBefore(void 0, 1),
                this.loadAfter(void 0, 1),
                this
            }
        }, {
            key: "setKey",
            value: function(e) {
                return this.msgKey = e,
                this.updatePrev(),
                e || (this.before += this.after),
                this
            }
        }, {
            key: "onRemove",
            value: function(e) {
                e.id === this.prevKey ? this.updatePrev() : e.id === this.msgKey && this.focusBefore()
            }
        }, {
            key: "updatePrev",
            value: function() {
                this.prevKey = this.index > 0 ? this.msgCollection.models[this.index - 1].id : void 0
            }
        }, {
            key: "focusBefore",
            value: function() {
                this.msgKey = this.prevKey,
                this.updatePrev()
            }
        }, {
            key: "loadBefore",
            value: function(e) {
                var t = arguments.length <= 1 || void 0 === arguments[1] ? 2 : arguments[1]
                  , n = e || this.cursorSize(E.BEFORE, t);
                return this.before += n,
                this
            }
        }, {
            key: "loadAfter",
            value: function(e) {
                var t = arguments.length <= 1 || void 0 === arguments[1] ? 2 : arguments[1]
                  , n = e || this.cursorSize(E.AFTER, t);
                return this.after += n,
                this
            }
        }, {
            key: "index",
            get: function() {
                if (this.msgKey) {
                    var e = this.msgCollection.get(this.msgKey)
                      , t = this.msgCollection.indexOf(e);
                    if (t !== -1)
                        return t
                }
                return this.dir === g.RENDOR_CURSOR.RECENT_AT_TOP ? 0 : this.msgCollection.length - 1
            }
        }, {
            key: "start",
            get: function() {
                return Math.max(this.index - this.before, 0)
            }
        }, {
            key: "end",
            get: function() {
                return Math.min(this.index + this.after + 1, this.msgCollection.length)
            }
        }]),
        e
    }();
    e.exports = k
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        return s(function() {
            return p.get(e, t)
        })
    }
    function o(e) {
        return s(function() {
            return p.head(e)
        })
    }
    function a(e, t) {
        return s(function() {
            return p.post(e, t)
        })
    }
    function s(e) {
        return d.loopOnError(f.ShouldLoop, function(t) {
            var n;
            return n = u.state === u.STATE.CONNECTED ? l["default"].delay(Math.floor(1e3 * h.expBackoff(t, 60, void 0, .1))) : d.waitForBBEvent(u, "change:state", _.matches({
                state: u.STATE.CONNECTED
            })),
            n.then(function() {
                return e().then(function(e) {
                    if (e.status >= 500)
                        throw new f.ShouldLoop;
                    return e
                })["catch"](function() {
                    throw new f.ShouldLoop
                })
            })
        })
    }
    var c = n(2)
      , l = r(c)
      , u = n(12)
      , d = n(46)
      , p = n(140)
      , h = n(103)
      , f = n(14);
    e.exports = {
        headRetry: o,
        getRetry: i,
        postRetry: a
    }
}
, function(e, t, n) {
    e.exports = function() {
        return new Worker(n.p + "0faa3c71ab66799033db.worker.js")
    }
}
, , function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(9)
      , o = n(81)
      , a = n(67)
      , s = r.createClass({
        displayName: "ActionListener",
        mixins: [o],
        componentWillMount: function() {
            this.regCmd("mute_chat", this.onMute),
            this.regCmd("delete_or_exit_chat", this.onDeleteOrExit),
            this.regCmd("archive_chat", this.onArchive),
            this.regCmd("clear_chat_msgs", this.onClear),
            this.regCmd("mark_chat_unread", this.onMarkUnread)
        },
        onMute: function c(e, t) {
            if (t) {
                var o = n(1235)
                  , c = function(t) {
                    e.pendingAction++,
                    e.mute.mute(t, !0)["finally"](function() {
                        e.pendingAction--
                    })
                };
                i.openModal(r.createElement(o, {
                    chat: e,
                    onMute: c
                }), "modal", this.context.uim)
            } else
                e.pendingAction++,
                e.mute.unmute(!0)["finally"](function() {
                    e.pendingAction--
                })
        },
        onDeleteOrExit: function(e) {
            var t = n(1220)
              , o = function(t) {
                e.pendingAction++,
                t["finally"](function() {
                    e.pendingAction--
                })
            };
            i.openModal(r.createElement(t, {
                chat: e,
                onDeleteOrExit: o
            }), "modal", this.context.uim)
        },
        onClear: function(e) {
            var t = n(1216);
            i.openModal(r.createElement(t, {
                chat: e
            }), "modal", this.context.uim)
        },
        onArchive: function(e, t) {
            e.pendingAction++,
            e.setArchive(t)["catch"](_.noop)["finally"](function() {
                e.pendingAction--
            })
        },
        onMarkUnread: function(e, t) {
            e.pendingAction++,
            e.markUnread(t)["finally"](function() {
                e.pendingAction--
            })
        },
        render: function() {
            return null
        }
    });
    s.contextTypes = {
        uim: r.PropTypes.instanceOf(a)
    },
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(211).MIMETYPES
      , o = _.pickBy(i, function(e) {
        return "audio" === e.msgType
    })
      , a = r.createClass({
        displayName: "AttachMediaTypeAudio",
        propTypes: {
            mimeType: r.PropTypes.oneOf(_.keys(o)).isRequired,
            url: r.PropTypes.string.isRequired
        },
        render: function() {
            var e = this.props
              , t = e.mimeType
              , n = e.url;
            return r.createElement("div", {
                className: "media-element-container"
            }, r.createElement("div", {
                className: "media-element"
            }, r.createElement("audio", {
                controls: !0,
                type: t,
                src: n
            })))
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1007)
      , o = n(1044)
      , a = r.createClass({
        displayName: "AttachMediaTypeDoc",
        propTypes: {
            preview: r.PropTypes.object,
            mimeType: r.PropTypes.string,
            filename: r.PropTypes.string
        },
        render: function() {
            var e = this.props.preview;
            return e ? r.createElement("div", {
                className: "media-element-pdf-container"
            }, r.createElement("div", {
                className: "media-element-pdf-preview"
            }, r.createElement(i, {
                type: i.TYPES.SCALE_DOWN,
                size: {
                    width: e.width,
                    height: e.height
                }
            }, r.createElement("img", {
                src: e.url,
                className: "media-viewer-img"
            })))) : r.createElement(o, {
                mimeType: this.props.mimeType,
                filename: this.props.filename
            })
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(6)
      , s = n(1007)
      , c = n(211).MIMETYPES
      , l = _.pickBy(c, function(e) {
        return "image" === e.msgType || "video" === e.msgType
    })
      , u = a.createClass({
        displayName: "AttachMediaTypeMedia",
        propTypes: {
            mimeType: a.PropTypes.oneOf(_.keys(l)).isRequired,
            url: a.PropTypes.string.isRequired,
            isGif: a.PropTypes.bool,
            size: a.PropTypes.shape({
                width: a.PropTypes.number,
                height: a.PropTypes.number
            })
        },
        render: function() {
            var e = this.props
              , t = e.mimeType
              , n = e.url
              , r = e.size
              , i = void 0;
            if ("image" === l[t].msgType)
                i = a.createElement("img", {
                    src: n,
                    className: "media-viewer-img"
                });
            else if ("video" === l[t].msgType) {
                var c = this.props.isGif ? {
                    loop: !0,
                    autoPlay: !0,
                    muted: !1,
                    controls: !1
                } : {};
                i = a.createElement("video", (0,
                o["default"])({
                    controls: !0,
                    className: "media-viewer-img",
                    type: t
                }, c, {
                    src: n
                }))
            } else
                "audio" === l[t].msgType && (i = a.createElement("audio", {
                    controls: !0,
                    className: "media-viewer-audio",
                    type: t,
                    src: n
                }));
            return a.createElement("div", {
                className: "media-element-container"
            }, a.createElement("div", {
                className: "media-element"
            }, a.createElement(s, {
                type: s.TYPES.SCALE_DOWN,
                size: r
            }, i)))
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1007)
      , o = n(1044)
      , a = r.createClass({
        displayName: "AttachMediaTypePdf",
        propTypes: {
            preview: r.PropTypes.object,
            mimeType: r.PropTypes.string,
            filename: r.PropTypes.string
        },
        componentWillUnmount: function() {},
        render: function() {
            var e = this.props.preview;
            if (e) {
                var t = l10n.t("attach_document_pdf_total_pages", {
                    count: e.pdfPages,
                    _plural: e.pdfPages
                });
                return r.createElement("div", {
                    className: "media-element-pdf-container"
                }, r.createElement("div", {
                    className: "media-element-pdf-preview"
                }, r.createElement(i, {
                    type: i.TYPES.SCALE_DOWN,
                    size: {
                        width: e.width,
                        height: e.height
                    }
                }, r.createElement("img", {
                    src: e.url,
                    className: "media-viewer-img"
                }))), r.createElement("div", {
                    className: "media-element-pdf-caption"
                }, t))
            }
            return r.createElement(o, {
                mimeType: this.props.mimeType,
                filename: this.props.filename
            })
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1)
      , o = n(53)
      , a = n(221)
      , s = n(12)
      , c = n(143)
      , l = n(69)
      , u = n(218)
      , d = n(56)
      , p = n(84)
      , h = n(0)
      , f = n(46)
      , m = n(133)
      , g = n(81)
      , v = n(138)
      , y = n(10)
      , E = n(9)
      , b = n(43)
      , S = n(102)
      , M = n(1014)
      , C = r.createClass({
        displayName: "ButterBar",
        mixins: [m, g],
        getInitialState: function() {
            var e = this;
            this._showNotifyTimer = new p(this.showPrompt),
            this._showBatteryTimer = new p(function() {
                return e.batteryUpdate()
            }
            );
            var t = u.battery < y.BATTERY_LOW_THRESHOLD_1 ? u.battery < y.BATTERY_LOW_THRESHOLD_2 ? 2 : 1 : 0;
            return {
                lowBatteryWarning: u.plugged ? 0 : t,
                notifyPermission: window.Notification && window.Notification.permission,
                showNotify: !1
            }
        },
        componentWillMount: function() {
            this.addObserver(l, "change:displayInfo"),
            this.addObserver(l, "change:needsUpdate"),
            this.addObserver(l, "change:needsManualDownload"),
            this.addObserver(u, "change:plugged", this.batteryUpdate),
            this.addObserver(u, "change:battery", this.batteryUpdate)
        },
        componentWillUnmount: function() {
            this._showNotifyTimer.cancel(),
            this._showBatteryTimer.cancel()
        },
        onReload: function() {
            a.restart()
        },
        onClickManualDownload: function() {},
        batteryUpdate: function(e) {
            var t = this.state.lowBatteryWarning;
            u.plugged || u.battery > y.BATTERY_LOW_THRESHOLD_1 ? 0 !== t && this.setState({
                lowBatteryWarning: 0
            }) : u.battery <= y.BATTERY_LOW_THRESHOLD_2 ? t !== -2 && (e ? this._showBatteryTimer.onOrBefore(y.BATTERY_DELAY) : 2 !== t && this.setState({
                lowBatteryWarning: 2
            })) : t > -1 && u.battery <= y.BATTERY_LOW_THRESHOLD_1 && (e ? this._showBatteryTimer.onOrBefore(y.BATTERY_DELAY) : 1 !== t && this.setState({
                lowBatteryWarning: 1
            }))
        },
        dismissLowBatteryWarning: function() {
            var e = this.state.lowBatteryWarning;
            e > 0 && this.setState({
                lowBatteryWarning: -e
            })
        },
        showPrompt: function(e) {
            this.setState({
                showNotify: e
            })
        },
        guideConfirm: function() {
            E.closeModal()
        },
        guideLearnMore: function() {
            switch (o.browser) {
            case y.BROWSER_TYPE.CHROME:
                return window.open("https://www.whatsapp.com/faq/web/28080004", "_blank");
            case y.BROWSER_TYPE.FIREFOX:
                return window.open("https://www.whatsapp.com/faq/web/28080006", "_blank");
            case y.BROWSER_TYPE.SAFARI:
                return window.open("https://www.whatsapp.com/faq/web/28080008", "_blank");
            case y.BROWSER_TYPE.OPERA:
                return window.open("https://www.whatsapp.com/faq/web/28080007", "_blank");
            default:
                return window.open("https://www.whatsapp.com/faq/web/28080004", "_blank")
            }
        },
        requestPermissions: function() {
            E.openModal(r.createElement(M, {
                title: "guide_desktop_notifications_title",
                desc: "guide_desktop_notifications_description",
                onConfirm: this.guideConfirm,
                onCancel: this.guideLearnMore,
                type: M.TYPE.GUIDE_ALLOW
            }));
            var e = this;
            window.Notification.requestPermission(function(t) {
                E.closeModal(),
                e.setState({
                    notifyPermission: t
                })
            })
        },
        render: function() {
            var e = null ;
            switch (l.displayInfo) {
            case l.INFO.OFFLINE:
                e = r.createElement(k, {
                    key: "bbar"
                });
                break;
            case l.INFO.OPENING:
            case l.INFO.CONNECTING:
                e = r.createElement(x, {
                    key: "bbar"
                });
                break;
            case l.INFO.NORMAL:
                break;
            case l.INFO.RESUMING:
            case l.INFO.TIMEOUT:
                var t = function() {
                    window.open("http://www.whatsapp.com/faq/web/28080002")
                }
                  , n = r.createElement("span", null , l10n.t("make_sure_phone_active_internet_connection"), "", r.createElement("span", {
                    className: "action",
                    onClick: t
                }, l10n.t("learn_more")));
                e = r.createElement(T, {
                    type: "phone",
                    key: "bbar",
                    title: l10n.t("phone_not_connected"),
                    text: n
                })
            }
            if (!e && this.state.lowBatteryWarning > 0 && (e = r.createElement(T, {
                type: "battery",
                key: "bbar",
                title: l10n.t("phone_battery_low"),
                text: l10n.t("charge_phone_description"),
                dismissable: !0,
                onDismiss: this.dismissLowBatteryWarning
            })),
            !e && l.needsUpdate && (e = r.createElement(T, {
                type: "update",
                key: "bbar",
                title: l10n.t("update_available"),
                text: l10n.t("click_to_update_whatsapp_web"),
                action: this.onReload
            })),
            l.needsManualDownload && (e = r.createElement(T, {
                type: "update",
                key: "bbar",
                title: l10n.t("desktop_client_update_available"),
                text: l10n.t("click_to_download_desktop_client"),
                action: this.onClickManualDownload
            })),
            e)
                this.state.showNotify && this._showNotifyTimer.onOrBefore(0, !1);
            else if (this.state.showNotify) {
                if (window.Notification && this.state.notifyPermission === y.PERMISSION_DEFAULT) {
                    var i = r.createElement("span", {
                        className: "action",
                        onClick: this.requestPermissions
                    }, l10n.t("enable_desktop_notifications"));
                    e = r.createElement(T, {
                        type: "notification",
                        key: "bbar",
                        title: l10n.t("get_notified_of_new_messages"),
                        text: i
                    })
                }
            } else
                this._showNotifyTimer.onOrBefore(y.NOTIFICATION_PROMPT_DELAY, !0);
            return r.createElement("div", {
                className: "butterbar-container"
            }, r.createElement(S, {
                transitionName: "butterbar"
            }, e))
        }
    })
      , T = r.createClass({
        displayName: "BB",
        propTypes: {
            type: r.PropTypes.oneOf(["computer", "phone", "notification", "battery", "update"]),
            title: r.PropTypes.node.isRequired,
            text: r.PropTypes.node,
            dismissable: r.PropTypes.bool,
            onDismiss: r.PropTypes.func,
            action: r.PropTypes.func
        },
        onClick: function() {
            this.props.action && this.props.action()
        },
        render: function() {
            var e, t;
            switch (this.props.type) {
            case "computer":
            case "phone":
            case "notification":
            case "battery":
            case "update":
                e = "butterbar-" + this.props.type,
                t = "icon-alert-" + this.props.type;
                break;
            default:
                i.log("butterbar:render invalid type")()
            }
            var n = b("butterbar", e, {
                action: this.props.action
            })
              , o = b("icon", "icon-alert", t)
              , a = this.props.dismissable ? r.createElement("div", {
                className: "butterbar-controls"
            }, r.createElement("button", {
                className: "icon icon-x-light",
                onClick: this.props.onDismiss
            })) : null
              , s = this.props.text ? r.createElement("div", {
                className: "butterbar-text"
            }, this.props.text) : null ;
            return r.createElement("div", {
                className: "butterbar-wrapper"
            }, r.createElement("div", {
                className: n,
                onClick: this.onClick
            }, r.createElement("div", {
                className: "butterbar-icon"
            }, r.createElement("span", {
                className: o
            })), r.createElement("div", {
                className: "butterbar-body"
            }, r.createElement("div", {
                className: "butterbar-title"
            }, this.props.title), s), a))
        }
    })
      , w = 3e3
      , k = r.createClass({
        displayName: "Offline",
        mixins: [v],
        getInitialState: function() {
            return {
                allowReconnect: !0
            }
        },
        reconnect: function() {
            var e = c.numSocketsAttempted + 1;
            s.poke(),
            f.waitForBBEvent(l, "change:displayInfo", function() {
                return l.displayInfo === l.INFO.NORMAL
            }).then(function() {
                new d.WebcManualWebsocketAttempt({
                    webcManualWebsocketAttemptSuccessful: c.numSocketsAttempted === e
                }).commit()
            }),
            this.setState({
                allowReconnect: !1
            }),
            this.reconnectTimeout = this.safeDelay(this.resetReconnectTimeout, w)
        },
        resetReconnectTimeout: function() {
            this.clearSafeTimeout(this.reconnectTimeout),
            delete this.reconnectTimeout,
            this.setState({
                allowReconnect: !0
            })
        },
        render: function() {
            var e, t;
            return this.state.allowReconnect ? (e = r.createElement("span", null , l10n.t("make_sure_computer_active_internet_connection") + " ", r.createElement("span", {
                className: "action",
                onClick: this.reconnect
            }, l10n.t("reconnect"))),
            t = l10n.t("computer_not_connected")) : (e = null ,
            t = l10n.t("connecting_to_whatsapp_or_phone")),
            r.createElement(T, {
                type: "computer",
                title: t,
                text: e
            })
        }
    })
      , x = r.createClass({
        displayName: "Resume",
        mixins: [m],
        getInitialState: function() {
            return {
                takingTooLong: !1,
                didShowSubtitle: !1
            }
        },
        componentWillMount: function() {
            this._timeoutTimer = new p(this.timedOut),
            this._intervalTimer = new p(this.onInterval),
            this.addObserver(s, "change:state", this.onProgress),
            this.addObserver(s, "change:retryTimestamp", this.onProgress)
        },
        componentDidMount: function() {
            this._timeoutTimer.onOrBefore(3e3)
        },
        componentWillUnmount: function() {
            this._timeoutTimer.cancel(),
            this._intervalTimer.cancel()
        },
        timedOut: function() {
            this._intervalTimer.onOrAfter(1e3),
            this.setState({
                takingTooLong: !0,
                didShowSubtitle: !0
            })
        },
        onProgress: function() {
            this._intervalTimer.cancel(),
            this._timeoutTimer.onOrBefore(3e3),
            this.setState({
                takingTooLong: !1
            })
        },
        onInterval: function() {
            this._intervalTimer.onOrAfter(1e3),
            this.setState({
                now: Date.now()
            })
        },
        retry: function(e) {
            s.poke(),
            this.onProgress()
        },
        render: function() {
            var e, t;
            if (l.displayInfo === l.INFO.OPENING)
                e = l10n.t("connecting_to_whatsapp");
            else {
                if (l.displayInfo !== l.INFO.CONNECTING)
                    return null ;
                e = l10n.t("connecting_to_whatsapp_or_phone")
            }
            if (this.state.takingTooLong) {
                var n = s.retryTimestamp - Date.now();
                if (n < 1)
                    n = l10n.t("retrying"),
                    _.defer(function() {
                        return s.poke()
                    });
                else if (n < 6e4) {
                    var i = Math.ceil(n / 1e3);
                    n = l10n.t("retrying_in_some_seconds", {
                        number: i,
                        _plural: i
                    })
                } else
                    n = l10n.t("retrying_in", {
                        duration: h.duration(n).humanize()
                    });
                t = r.createElement("span", null , n, " ", r.createElement("span", {
                    className: "action",
                    onClick: this.retry
                }, l10n.t("retry_now")))
            } else
                t = this.state.didShowSubtitle ? r.createElement("span", null , l10n.t("retrying")) : null ;
            return r.createElement(T, {
                type: "computer",
                title: e,
                text: t
            })
        }
    });
    e.exports = C
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = (n(988),
    n(989))
      , g = n(1133)
      , v = n(1022)
      , y = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "componentWillMount",
            value: function() {
                var e = this.props
                  , t = e.chat
                  , n = e.addListener;
                n(t, "change:previewMessage"),
                n(t.presence, "change:chatstate.id change:chatstate.type change:withholdDisplay")
            }
        }, {
            key: "render",
            value: function() {
                var e = this.props.chat
                  , t = e.presence;
                if (t.isActive()) {
                    var n = t.getFormattedString();
                    if (n)
                        return f.createElement("div", {
                            className: "chat-status typing ellipsify",
                            dir: "auto"
                        }, f.createElement(m, {
                            ellipsify: !0,
                            titlify: !0,
                            text: n
                        }))
                }
                var r = e.previewMessage;
                return r ? f.createElement(g, {
                    key: r.id,
                    msg: r
                }) : f.createElement("div", {
                    className: "chat-status"
                })
            }
        }]),
        t
    }(f.Component);
    e.exports = v(y)
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(137)
      , o = r.createClass({
        displayName: "ContactMsgInfoCell",
        propTypes: {
            title: r.PropTypes.string.isRequired,
            icon: r.PropTypes.node.isRequired,
            t: r.PropTypes.number
        },
        render: function() {
            var e = this.props
              , t = e.title
              , n = e.t
              , o = e.icon
              , a = n ? i.relativeDateAndTimeStr(n) : "-"
              , s = {
                cursor: "auto"
            };
            return r.createElement("div", {
                className: "contact chat",
                style: s
            }, r.createElement("div", {
                className: "chat-body"
            }, r.createElement("div", {
                className: "chat-main"
            }, r.createElement("div", {
                className: "chat-title"
            }, r.createElement("span", {
                className: "ellipsify",
                dir: "auto"
            }, o, t))), r.createElement("div", {
                className: "chat-secondary"
            }, r.createElement("div", {
                className: "chat-status ellipsify"
            }, r.createElement("span", {
                className: "ellipsify",
                dir: "auto"
            }, a)))))
        }
    });
    e.exports = o
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = n(10)
      , g = n(1022)
      , v = n(31)
      , y = (n(988),
    n(986),
    n(9))
      , _ = n(1050)
      , E = n(136)
      , b = n(996)
      , S = function(e) {
        function t() {
            (0,
            s["default"])(this, t);
            var e = (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments));
            return e.onScroll = function(t) {
                e.handleScroll(t.target)
            }
            ,
            e.handleScroll = v.throttle(function(t) {
                var n = e.props.chat.docMsgs;
                n.hasDocBefore && t.scrollTop + m.SCROLL_FUDGE > t.scrollHeight - t.clientHeight && e.queryDocs(n.head())
            }, 100),
            e.onClickMsg = function(t, n) {
                e.props.selectable && void 0 !== n ? e.props.onMessageSelect(t, n) : (y.openChat(t.chat, t.chat.getSearchContext(t), !1),
                y.focusShowMsg(t.id))
            }
            ,
            e
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "componentWillMount",
            value: function() {
                this.props.chat.docMsgs.hasDocBefore && this.queryDocs()
            }
        }, {
            key: "componentDidMount",
            value: function() {
                this.props.addListener(this.props.chat.docMsgs, "add remove reset", this.rerender.bind(this)),
                this.props.addListener(this.props.chat.docMsgs, "query_doc_before", this.rerender.bind(this))
            }
        }, {
            key: "rerender",
            value: function() {
                this.setState({})
            }
        }, {
            key: "queryDocs",
            value: function(e) {
                var t = this.props.chat.docMsgs;
                t.hasDocBefore && t.queryDocs(this.props.chat, e)
            }
        }, {
            key: "render",
            value: function() {
                var e = this
                  , t = this.props.chat.docMsgs
                  , n = this.props.selectedMessages
                  , r = t.map(function(t) {
                    var r = n && t.id in n;
                    return f.createElement(_, {
                        key: t.id,
                        ref: t.id.toString(),
                        msg: t,
                        multiMedia: !0,
                        selectable: e.props.selectable,
                        selected: r,
                        onMessageSelect: e.props.onMessageSelect,
                        onClickMsg: e.onClickMsg
                    })
                });
                if (r.reverse(),
                t.queryDocBefore) {
                    if (0 === r.length)
                        return f.createElement(b.Loading, null );
                    r.push(f.createElement("div", {
                        className: "more",
                        key: "spinner"
                    }, f.createElement(E, {
                        stroke: 6,
                        size: 24
                    })))
                }
                return 0 !== t.length || t.queryDocBefore ? f.createElement("div", {
                    onScroll: this.onScroll,
                    className: "doc-gallery"
                }, r) : f.createElement(b.DocMsgs, null )
            }
        }]),
        t
    }(f.Component);
    e.exports = g(S)
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1018)
      , o = n(994)
      , a = n(137)
      , s = n(987)
      , c = r.createClass({
        displayName: "GroupMsgInfoCell",
        mixins: [s],
        propTypes: {
            participant: r.PropTypes.instanceOf(Object).isRequired
        },
        getInitialState: function() {
            return {
                formattedName: this.async("participant.contact.formattedName")
            }
        },
        render: function() {
            var e = this.props.participant
              , t = r.createElement("div", {
                className: "chat-avatar"
            }, r.createElement(o, {
                id: e.id
            }))
              , n = {
                cursor: "auto"
            };
            return r.createElement(i, {
                id: e.id,
                contextEnabled: function() {
                    return !1
                },
                image: t,
                primary: this.state.formattedName,
                secondary: a.relativeDateAndTimeStr(e.t),
                style: n
            })
        }
    });
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(987)
      , o = n(102)
      , a = r.createClass({
        displayName: "Icons",
        mixins: [i],
        propTypes: {
            chat: r.PropTypes.object.isRequired
        },
        getInitialState: function() {
            return {
                isMuted: this.async("chat.mute.isMuted"),
                unreadCount: this.async("chat.unreadCount"),
                archive: this.async("chat.archive")
            }
        },
        render: function() {
            var e = this.props.chat
              , t = this.state.isMuted ? r.createElement("span", {
                className: "icon icon-meta icon-muted",
                key: "icon-muted"
            }) : null
              , n = 0 !== e.unreadCount ? r.createElement("span", {
                className: "icon-meta unread-count",
                key: "icon-unread"
            }, e.unreadCount > 0 ? l10n.n(this.state.unreadCount) : r.createElement("span", null , "")) : null
              , i = this.state.archive ? r.createElement("span", {
                className: "icon-meta chat-marker chat-marker-archived",
                key: "icon-archived"
            }, l10n.t("chat_archived")) : null ;
            return r.createElement(o, {
                transitionName: "pop"
            }, t, i, n)
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(53)
      , a = n(998)
      , s = n(1045)
      , c = n(1027)
      , l = n(989)
      , u = n(987)
      , d = n(43)
      , p = r.createClass({
        displayName: "LastMsg",
        mixins: [u],
        propTypes: {
            msg: r.PropTypes.instanceOf(i).isRequired
        },
        getInitialState: function() {
            var e = this.props.msg
              , t = {};
            return e.sender && (t.formattedShortName = this.async("msg.senderObj.formattedShortName")),
            e.type === i.TYPE.PTT && (t.duration = this.async("msg.duration")),
            e.typeCanChange() && (t.type = this.async("msg.type")),
            t
        },
        render: function() {
            var e = this.props.msg
              , t = [];
            if (e.isSentByMe && t.push(r.createElement(s, {
                msg: e,
                key: "symbol"
            })),
            !e.isSentByMe && e.isGroupMsg && !e.isNotification) {
                var n = d("chat-status-name", {
                    number: !e.senderObj.name
                });
                t.push(r.createElement(l, {
                    text: this.state.formattedShortName,
                    direction: "auto",
                    classes: n,
                    key: "author"
                })),
                t.push(r.createElement("span", {
                    className: "chat-status-divider",
                    key: "divider"
                }, ":"))
            }
            e.hasSymbol() && t.push(r.createElement(c, {
                msg: e,
                key: "msg-symbol"
            })),
            t.push(r.createElement(l, {
                direction: e.dir,
                ellipsify: !0,
                text: a.msgText(e),
                key: "status"
            }));
            var i = "chat-status";
            o.isGecko && (i += " ellipsify");
            var u = l10n.embedDir(a.msgText(e), e.rtl);
            return r.createElement("div", {
                className: i,
                title: u
            }, t)
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = n(10)
      , g = n(1022)
      , v = n(31)
      , y = (n(988),
    n(986),
    n(9))
      , _ = n(1050)
      , E = n(136)
      , b = n(996)
      , S = function(e) {
        function t() {
            (0,
            s["default"])(this, t);
            var e = (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments));
            return e.onScroll = function(t) {
                e.handleScroll(t.target)
            }
            ,
            e.handleScroll = v.throttle(function(t) {
                var n = e.props.chat.linkMsgs;
                n.hasLinkBefore && t.scrollTop + m.SCROLL_FUDGE > t.scrollHeight - t.clientHeight && e.queryLinks(n.head())
            }, 100),
            e.onClickMsg = function(t, n) {
                e.props.selectable && void 0 !== n ? e.props.onMessageSelect(t, n) : (y.openChat(t.chat, t.chat.getSearchContext(t), !1),
                y.focusShowMsg(t.id))
            }
            ,
            e
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "componentWillMount",
            value: function() {
                this.props.chat.linkMsgs.hasLinkBefore && this.queryLinks()
            }
        }, {
            key: "componentDidMount",
            value: function() {
                this.props.addListener(this.props.chat.linkMsgs, "add remove reset", this.rerender.bind(this)),
                this.props.addListener(this.props.chat.linkMsgs, "query_link_before", this.rerender.bind(this))
            }
        }, {
            key: "rerender",
            value: function() {
                this.setState({})
            }
        }, {
            key: "queryLinks",
            value: function(e) {
                var t = this.props.chat.linkMsgs;
                t.hasLinkBefore && t.queryLinks(this.props.chat, e)
            }
        }, {
            key: "render",
            value: function() {
                var e = this
                  , t = this.props.chat.linkMsgs
                  , n = this.props.selectedMessages
                  , r = t.map(function(t) {
                    var r = n && t.id in n;
                    return f.createElement(_, {
                        key: t.id,
                        ref: t.id.toString(),
                        msg: t,
                        multiMedia: !0,
                        selectable: e.props.selectable,
                        selected: r,
                        onMessageSelect: e.props.onMessageSelect,
                        onClickMsg: e.onClickMsg
                    })
                });
                if (r.reverse(),
                t.queryLinkBefore) {
                    if (0 === r.length)
                        return f.createElement(b.Loading, null );
                    r.push(f.createElement("div", {
                        className: "more",
                        key: "spinner"
                    }, f.createElement(E, {
                        stroke: 6,
                        size: 24
                    })))
                }
                return 0 !== t.length || t.queryLinkBefore ? f.createElement("div", {
                    onScroll: this.onScroll,
                    className: "link-gallery"
                }, r) : f.createElement(b.LinkMsgs, null )
            }
        }]),
        t
    }(f.Component);
    e.exports = g(S)
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(987)
      , a = n(1018)
      , s = n(989)
      , c = n(1072)
      , l = n(1027)
      , u = n(986)
      , d = n(43)
      , p = n(1024)
      , h = n(133)
      , f = n(53)
      , m = n(998)
      , g = n(1045)
      , v = n(139)
      , y = n(135)
      , E = y.HotKeys
      , b = r.createClass({
        displayName: "Message",
        mixins: [o, h],
        propTypes: {
            msg: r.PropTypes.instanceOf(u).isRequired,
            searchText: r.PropTypes.string,
            mouseDownAsClick: r.PropTypes.bool,
            onClick: r.PropTypes.func,
            active: r.PropTypes.object
        },
        getInitialState: function() {
            var e = this.props
              , t = e.msg
              , n = e.active
              , r = {
                formattedTitle: this.async("msg.chat.formattedTitle"),
                active: !!n && n.value === t
            };
            return t.sender && t.isGroupMsg && !t.isNotification && (t.isSentByMe ? r.formattedShortName = t.senderObj.formattedShortName : r.formattedShortName = this.async("msg.senderObj.formattedShortName")),
            r
        },
        componentWillMount: function() {
            this.props.active && this.addObserver(this.props.active, this.props.msg.id.toString(), this.onActiveChange)
        },
        onActiveChange: function(e) {
            if ("focus" === e) {
                var t = i.findDOMNode(this);
                v.focus(t),
                p.scrollIntoViewIfNeeded(t)
            }
            this.setState({
                active: !!e
            })
        },
        onClick: function(e) {
            if (_.isFunction(this.props.onClick)) {
                var t = this.props.msg
                  , n = t.chat
                  , r = n.getSearchContext(t);
                r.msg = t,
                this.props.onClick(e, n, r)
            }
        },
        onMouseDown: function(e) {
            0 === e.button && this.onClick(e)
        },
        onEnter: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            E.flashFocus = Date.now(),
            this.onClick(e)
        },
        indicateFocus: function(e) {
            if (!(Date.now() - (E.flashFocus || 0) > 200)) {
                var t = i.findDOMNode(this.refs.cell);
                Velocity(t, "stop"),
                Velocity(t, {
                    backgroundColor: ["#e9eaeb", "#cbdde7"]
                }, {
                    duration: 1300,
                    easing: [.19, .69, .01, .99],
                    complete: this.onBlur
                })
            }
        },
        onBlur: function(e) {
            var t = i.findDOMNode(this.refs.cell);
            t && (Velocity(t, "stop"),
            t.style.backgroundColor = "")
        },
        contextEnabled: function() {
            return !1
        },
        render: function() {
            var e = this.props.msg
              , t = r.createElement(c, {
                msg: e
            })
              , n = [];
            if (e.isSentByMe && n.push(r.createElement(g, {
                msg: e,
                key: "symbol"
            })),
            !e.isSentByMe && e.isGroupMsg && !e.isNotification) {
                var i = d("chat-status-name", {
                    number: !e.senderObj.name
                });
                n.push(r.createElement(s, {
                    text: this.state.formattedShortName,
                    direction: "auto",
                    classes: i,
                    key: "author"
                })),
                n.push(r.createElement("span", {
                    className: "chat-status-divider",
                    key: "divider"
                }, ":"))
            }
            e.hasSymbol() && n.push(r.createElement(l, {
                msg: e,
                key: "msg-symbol"
            }));
            var o = this.props.searchText ? _.uniq(_.compact(_.split(_.toLower(this.props.searchText), " "))) : null ;
            n.push(r.createElement(s, {
                direction: e.dir,
                ellipsify: !0,
                highlight: o,
                text: m.msgText(e),
                key: "status"
            }));
            var u = "chat-status";
            f.isGecko && (u += " ellipsify");
            var p = l10n.embedDir(m.msgText(e), e.rtl)
              , h = r.createElement("div", {
                className: u,
                title: p
            }, n)
              , v = {
                enter: this.onEnter
            }
              , y = d("message", {
                active: !!this.state.active
            })
              , b = this.props.mouseDownAsClick;
            return r.createElement(E, {
                handlers: v,
                onFocus: this.indicateFocus,
                onBlur: this.onBlur,
                className: "chat-drag-cover"
            }, r.createElement(a, {
                id: e.id + "",
                ref: "cell",
                contextEnabled: this.contextEnabled,
                className: y,
                primary: e.chat.title(),
                primaryDetail: t,
                secondary: h,
                onClick: b ? null : this.onClick,
                onMouseDown: b ? this.onMouseDown : null ,
                onContext: this.onMenu
            }))
        }
    });
    e.exports = b
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(440)
      , o = n(989)
      , a = n(987)
      , s = r.createClass({
        displayName: "Status",
        mixins: [a],
        propTypes: {
            status: r.PropTypes.instanceOf(i)
        },
        getInitialState: function() {
            return {
                status: this.async("status.status")
            }
        },
        render: function() {
            return _.isUndefined(this.state.status) ? r.createElement("div", {
                className: "muted"
            }, l10n.t("contact_status_loading")) : r.createElement("div", {
                className: "chat-status ellipsify",
                title: this.state.status
            }, r.createElement(o, {
                direction: "auto",
                ellipsify: !0,
                text: this.state.status
            }))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(9)
      , c = n(81)
      , l = n(988)
      , u = n(67)
      , d = n(1023)
      , p = a.createClass({
        displayName: "ChatActionListener",
        mixins: [c],
        componentWillMount: function() {
            this.regCmd("chat_info_drawer", this.onChatInfoDrawer),
            this.regCmd("msg_info_drawer", this.onMsgInfoDrawer),
            this.regCmd("chat_search", this.onChatSearch),
            this.regCmd("attach_media_drawer", this.onAttachMediaDrawer),
            this.regCmd("verification_drawer", this.onVerificationDrawer),
            this.regCmd("media_viewer_modal", this.onMediaViewer)
        },
        onChatInfoDrawer: function(e) {
            var t = n(1098);
            s.openDrawerRight(a.createElement(t, {
                chat: e
            }), "slide-left", this.context.uim)
        },
        onVerificationDrawer: function(e) {
            var t = n(1244);
            s.openDrawerRight(a.createElement(t, {
                contact: Store.Contact.get(e),
                isFirstLevel: !0
            }), "slide-left", this.context.uim)
        },
        onMsgInfoDrawer: function(e) {
            if (e.chat.kind === l.KIND.CHAT) {
                var t = n(1219);
                s.openDrawerRight(a.createElement(t, {
                    msg: e
                }), "slide-left", this.context.uim)
            } else {
                var r = n(1229);
                s.openDrawerRight(a.createElement(r, {
                    msg: e
                }), "slide-left", this.context.uim)
            }
        },
        onAttachMediaDrawer: function(e, t) {
            var r = n(1097);
            s.openDrawerMid(a.createElement(r, {
                chat: e,
                files: t
            }), "slide-up", this.context.uim)
        },
        onChatSearch: function(e) {
            var t = n(1102);
            s.openDrawerRight(a.createElement(t, {
                chat: e
            }), "slide-left", this.context.uim)
        },
        onMediaViewer: function(e, t) {
            var r = this
              , i = void 0;
            if (Store.Msg.get(e.id))
                i = o["default"].resolve(e);
            else {
                var c = n(1017)
                  , l = new c;
                e.mediaState = d.STAGE.PREPARING,
                e.id.count = 1,
                e.chat.msgChunks.push(l),
                i = Store.Msg.getContext(e.id, l).then(function(t) {
                    var n = _.last(_.head(t));
                    if (e.id.toString() === n.id.toString())
                        return n
                })["catch"](function(t) {
                    return e.mediaState = d.STAGE.ERROR_MISSING,
                    null
                })
            }
            i.then(function(i) {
                if (i) {
                    var o = n(1203);
                    s.openModalMedia(a.createElement(o, {
                        msg: i,
                        getZoomNode: t
                    }), "media-viewer", r.context.uim)
                } else {
                    var c = n(1015);
                    s.openModal(a.createElement(c, {
                        msg: e
                    }))
                }
            })
        },
        render: function() {
            return null
        }
    });
    p.contextTypes = {
        uim: a.PropTypes.instanceOf(u)
    },
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(436)
      , o = r(i)
      , a = n(6)
      , s = n(37)
      , c = n(997)
      , l = n(9)
      , u = n(1033)
      , d = n(133)
      , p = n(81)
      , h = n(134)
      , f = n(1e3)
      , m = n(209)
      , g = n(10)
      , v = n(1019)
      , y = n(988)
      , E = n(1004)
      , b = n(1135)
      , S = n(101)
      , M = n(135)
      , C = M.HotKeys
      , T = a.createClass({
        displayName: "Chatlist",
        mixins: [d, p, h],
        propTypes: {
            isSearching: a.PropTypes.bool,
            searchText: a.PropTypes.string,
            chats: a.PropTypes.array,
            contacts: a.PropTypes.array,
            ftsResult: a.PropTypes.array,
            onClick: a.PropTypes.func,
            selection: a.PropTypes.instanceOf(f),
            onFocusSearch: a.PropTypes.func
        },
        getDefaultProps: function() {
            return {
                chats: []
            }
        },
        getInitialState: function() {
            var e = this;
            this._listPointerEvents = !0,
            this.debouncedOpenSelected = _.debounce(function() {
                e.openSelected(e.focusComposer),
                e.focusComposer = !1
            }, 200);
            var t;
            return t = 0,
            {
                textsize: t
            }
        },
        componentWillMount: function() {
            this.props.selection.init(this.getSelection())
        },
        componentWillUnmount: function() {
            var e = this.getSelection()
              , t = this.props.selection.getVal();
            t && t.isState && !this.props.isSearching && !e.length && l.clearChat(t)
        },
        componentDidMount: function() {
            var e = this;
            this.regCmd("focus_chat_list", this.restoreFocus),
            this.regCmd("focus_next_chat", this.onNextChat.bind(this, null , !0)),
            this.regCmd("focus_prev_chat", this.onPrevChat.bind(this, null , !0)),
            this.regCmd("update_chatlist_selection", this.updateSelected),
            this.regCmd("textsize_change", function(t) {
                e.setState({
                    textsize: t
                })
            })
        },
        componentDidUpdate: function() {
            var e = this.props.selection.getVal();
            this.props.selection.init(this.getSelection(), !this.props.isSearching),
            e !== this.props.selection.getVal() && (this.focusComposer = !0,
            this.debouncedOpenSelected())
        },
        onListPointerEventsOff: function() {
            this._listPointerEvents = !1
        },
        onListPointerEventsOn: function() {
            this._listPointerEvents = !0
        },
        updateSelected: function(e) {
            this.debouncedOpenSelected.cancel(),
            this.props.selection.setVal(e, !1)
        },
        openSelected: function() {
            var e = !(arguments.length <= 0 || void 0 === arguments[0]) && arguments[0]
              , t = this.props.selection.getVal();
            t && t instanceof y && l.openChat(t, !1, e, !1)
        },
        onClick: function(e, t, n) {
            var r = this;
            e.preventDefault(),
            e.stopPropagation(),
            Store.Chat.find(t.id).then(function(e) {
                r.props.isSearching && r.props.onClick && r.props.onClick(),
                l.openChat(e, n, !0),
                n && l.focusShowMsg(n.msg.id)
            })
        },
        getSelection: function() {
            return [].concat((0,
            o["default"])(this.props.chats), (0,
            o["default"])(this.props.contacts), (0,
            o["default"])(this.getFTSStarred()), (0,
            o["default"])(this.getFTSMessages()))
        },
        getFTSStarred: function() {
            return _.filter(this.props.ftsResult, {
                star: !0
            })
        },
        getFTSMessages: function() {
            return _.filter(this.props.ftsResult, {
                star: !1
            })
        },
        getList: function() {
            for (var e = this.props, t = e.chats, n = e.contacts, r = [], i = 0; i < t.length; i++) {
                var o = t[i];
                o && (this.props.isSearching && 0 === i && r.push(a.createElement(u, {
                    key: "chat-header",
                    header: l10n.t("web_chats")
                })),
                r.push(a.createElement(v, {
                    chat: o,
                    mode: v.Mode.LAST,
                    searchText: this.props.searchText,
                    onClick: this.onClick,
                    mouseDownAsClick: !0,
                    active: this.props.selection,
                    key: o.id
                })))
            }
            for (var s = 0; s < n.length; s++) {
                var c = n[s];
                c && (0 === s && r.push(a.createElement(u, {
                    key: "contact-header",
                    header: l10n.t("web_contacts")
                })),
                r.push(a.createElement(E, {
                    contact: c,
                    active: this.props.selection,
                    searchText: this.props.searchText,
                    onClick: this.onClick,
                    mouseDownAsClick: !0,
                    key: c.id
                })))
            }
            if (S.supportsFeature(S.F.FULL_TEXT_SEARCH)) {
                for (var l = this.getFTSStarred(), d = 0; d < l.length; d++) {
                    var p = l[d];
                    0 === d && r.push(a.createElement(u, {
                        key: "fts-header-starred",
                        header: l10n.t("web_starred_messages")
                    })),
                    r.push(a.createElement(b, {
                        msg: p,
                        searchText: this.props.searchText,
                        onClick: this.onClick,
                        active: this.props.selection,
                        key: p.id.toString()
                    }))
                }
                for (var h = this.getFTSMessages(), f = 0; f < h.length; f++) {
                    var m = h[f];
                    0 === f && r.push(a.createElement(u, {
                        key: "fts-header-messages",
                        header: l10n.t("web_messages")
                    })),
                    r.push(a.createElement(b, {
                        msg: m,
                        searchText: this.props.searchText,
                        onClick: this.onClick,
                        active: this.props.selection,
                        key: m.id.toString()
                    }))
                }
            }
            return r
        },
        restoreFocus: function() {
            this.props.selection.reset()
        },
        onFocusGain: function(e) {
            var t = this.refs.uie;
            t && t.activate(),
            e.target === s.findDOMNode(this) && this._listPointerEvents && (this.props.selection.index < 0 ? this.focusFirst() : this.props.selection.reset())
        },
        focusFirst: function() {
            this.props.selection.setFirst(),
            this.debouncedOpenSelected()
        },
        onNextChat: function(e, t, n) {
            e && (e.preventDefault(),
            e.stopPropagation());
            var r = this.props.selection.next();
            this.props.selection.index !== r && (this.props.selection.setNext(),
            this.focusComposer = n,
            this.debouncedOpenSelected())
        },
        onPrevChat: function(e, t, n) {
            e && (e.stopPropagation(),
            e.preventDefault());
            var r = this.props.selection.prev();
            r > -1 ? (this.props.selection.setPrev(),
            this.focusComposer = n,
            this.debouncedOpenSelected()) : t || (this.debouncedOpenSelected.cancel(),
            this.openSelected(),
            this.props.onFocusSearch())
        },
        render: function() {
            var e = this
              , t = {
                down: function(t) {
                    return e.onNextChat(t)
                },
                up: function(t) {
                    return e.onPrevChat(t)
                }
            }
              , n = 72
              , r = _.find(g.LIST_HEIGHT_TEXTSIZE_MAP, function(t) {
                return t.scale === e.state.textsize
            });
            return r && (n = r.height),
            a.createElement(m, {
                displayName: "Chatlist",
                ref: "uie",
                state: m.State.PASSIVE,
                requestFocus: function() {
                    return e.props.selection.reset(!1)
                }
            }, a.createElement(C, {
                handlers: t,
                onFocus: this.onFocusGain,
                "data-tab": 3
            }, a.createElement(c, {
                className: "chatlist",
                data: this.getList(),
                height: n,
                animate: !0,
                extraItems: 4,
                onPointerEventsOff: this.onListPointerEventsOff,
                onPointerEventsOn: this.onListPointerEventsOn
            })))
        }
    });
    e.exports = T
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(12)
      , o = n(1104)
      , a = n(429)
      , s = n(1204)
      , c = n(1205)
      , l = n(1206)
      , u = n(1210)
      , d = n(1105)
      , p = n(15)
      , h = n(437)
      , f = n(995)
      , m = n(994)
      , g = n(9)
      , v = n(987)
      , y = n(138)
      , _ = n(1029)
      , E = _.MenuBarItem
      , b = _.MenuBar
      , S = n(101)
      , M = n(431)
      , C = n(43)
      , T = n(102)
      , w = "global_mute"
      , k = r.createClass({
        displayName: "ChatlistHeader",
        mixins: [v, y],
        getDefaultProps: function() {
            return {
                muteId: w
            }
        },
        getInitialState: function() {
            return Store.Mute.globalMute(),
            {
                isMuted: this.async("muteId.Mute.isMuted")
            }
        },
        componentWillMount: function() {},
        onWindowFocus: function() {
            var e = this;
            this.setState({
                newlyFocused: !0
            }),
            this.safeDelay(function() {
                return e.setState({
                    newlyFocused: !1
                })
            }, 100)
        },
        componentWillUnmount: function() {},
        onMouseDown: function() {},
        onDrag: function(e) {
            this.didDrag = !0
        },
        onClickCapture: function(e) {},
        onNewChat: function(e) {
            e.preventDefault(),
            g.openDrawerLeft(r.createElement(s, null ))
        },
        onProfile: function() {
            g.openDrawerLeft(r.createElement(o, {
                id: Store.Conn.me
            }))
        },
        onUnmute: function() {
            Store.Mute.globalMute().unmute(),
            g.openToast(r.createElement(M, {
                msg: l10n.t("global_unmuted"),
                id: M.genId()
            }))
        },
        render: function() {
            var e = null ;
            this.state.isMuted && (e = r.createElement(E, {
                a8n: "menu-bar-unmute",
                icon: "dnd",
                title: l10n.t("global_unmute"),
                onClick: this.onUnmute,
                key: "btn-dnd"
            }));
            var t = C("pane-list-user", {});
            return r.createElement("header", {
                className: "pane-header pane-list-header",
                onMouseDown: this.onMouseDown,
                onClickCapture: this.onClickCapture
            }, r.createElement("div", {
                className: t
            }, r.createElement(m, {
                id: Store.Conn.me,
                size: 40,
                onClick: this.onProfile
            })), r.createElement("div", {
                className: "pane-list-controls"
            }, r.createElement(b, {
                key: "chatlist-header"
            }, r.createElement(T, {
                transitionName: "btn"
            }, e, r.createElement(E, {
                a8n: "menu-bar-chat",
                icon: "chat",
                title: l10n.t("web_menuitem_new"),
                onClick: this.onNewChat
            }), r.createElement(E, {
                a8n: "menu-bar-menu",
                icon: "menu",
                title: l10n.t("menutitle_menu")
            }, r.createElement(x, null ))))))
        }
    });
    e.exports = k;
    var x = r.createClass({
        displayName: "ChatlistHeaderDropdown",
        getInitialState: function() {
            return {
                rememberMe: p.getRememberMe()
            }
        },
        onCreateGroup: function() {
            g.openDrawerLeft(r.createElement(c, null ))
        },
        onProfile: function() {
            g.openDrawerLeft(r.createElement(o, {
                id: Store.Conn.me
            }))
        },
        onDisconnect: function() {
            var e = Store.Msg.some(function(e) {
                return 0 === e.ack && e.local && e.isSentByMe
            });
            return e ? void g.openModal(r.createElement(a, {
                title: l10n.t("confirm_logout"),
                onOK: function() {
                    return i.logout()
                },
                okText: l10n.t("menuitem_logout"),
                onCancel: function() {
                    return g.closeModal()
                },
                cancelText: l10n.t("web_cancel")
            }, l10n.t("some_of_your_messages_are_still_sending"))) : i.logout()
        },
        onArchived: function() {
            g.openDrawerLeft(r.createElement(u, null ))
        },
        onSettings: function() {
            g.openDrawerLeft(r.createElement(l, null ))
        },
        onStarred: function() {
            g.openDrawerLeft(r.createElement(d, null ))
        },
        render: function() {
            var e = S.supportsFeature(S.F.GROUP_CREATE) ? r.createElement(f, {
                a8n: "mi-new-group menu-item",
                action: this.onCreateGroup,
                shortcut: "g"
            }, l10n.t("web_menuitem_groupchat")) : null
              , t = S.supportsFeature(S.F.STARRED) && S.supportsFeature(S.F.FULL_TEXT_SEARCH) ? r.createElement(f, {
                a8n: "mi-starred menu-item",
                action: this.onStarred
            }, l10n.t("menuitem_starred")) : null ;
            return r.createElement(h, {
                type: h.Type.DROPDOWN_MENU,
                flipOnRTL: !0,
                key: "ChatlistHeader",
                direction: {
                    x: h.Direction.X.LEFT
                }
            }, e, r.createElement(f, {
                a8n: "mi-profile-status menu-item",
                action: this.onProfile
            }, l10n.t("menuitem_profile_status")), r.createElement(f, {
                a8n: "mi-archived menu-item",
                action: this.onArchived
            }, l10n.t("menuitem_archived")), t, r.createElement(f, {
                a8n: "mi-setting menu-item",
                action: this.onSettings
            }, l10n.t("menuitem_settings")), r.createElement(f, {
                a8n: "mi-logout menu-item",
                action: this.onDisconnect,
                shortcut: "q"
            }, l10n.t("menuitem_logout")))
        }
    })
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1004)
      , o = n(135)
      , a = o.HotKeys
      , s = n(1e3)
      , c = r.createClass({
        displayName: "ParticipantList",
        propTypes: {
            contacts: r.PropTypes.array.isRequired,
            onDelete: r.PropTypes.func.isRequired,
            onFocusSearch: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return this.selection = new s(this.props.contacts,function(e) {
                return e.id
            }
            ),
            null
        },
        componentWillReceiveProps: function(e) {
            this.selection.init(e.contacts, !0)
        },
        focusLast: function() {
            _.size(this.props.contacts) && this.selection.setLast()
        },
        focusPrev: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = this.selection.prev();
            t > -1 && this.selection.setPrev()
        },
        focusNext: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = this.selection.next();
            this.selection.index === t ? (this.selection.unset(),
            this.props.onFocusSearch(e)) : this.selection.setNext()
        },
        deleteContact: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = _.find(this.props.contacts, this.selection.getVal());
            this.props.onDelete(e, t)
        },
        onParticipantClick: function(e, t) {
            this.selection.setVal(t)
        },
        render: function() {
            var e = this
              , t = this.props.contacts;
            if (!t)
                return null ;
            var n = _.size(this.props.contacts) ? _.map(this.props.contacts, function(t) {
                return r.createElement(i, {
                    contact: t,
                    active: e.selection,
                    onDelete: e.props.onDelete,
                    onClick: e.onParticipantClick,
                    type: i.Type.SMALL,
                    key: t.id
                })
            }) : null
              , o = {
                up: this.focusPrev,
                down: this.focusNext,
                backspace: this.deleteContact
            };
            o[l10n.LR("left", "right")] = this.focusPrev,
            o[l10n.LR("right", "left")] = this.focusNext;
            var s = r.createElement("ul", {
                ref: "list"
            }, n);
            return r.createElement(a, {
                handlers: o
            }, s)
        }
    });
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(133)
      , a = n(81)
      , s = n(992)
      , c = n(1100)
      , l = n(1139)
      , u = n(1020)
      , d = n(1138)
      , p = n(996)
      , h = n(136)
      , f = n(1127)
      , m = n(9)
      , g = n(101)
      , v = n(1043)
      , y = n(14)
      , E = n(1e3)
      , b = n(10)
      , S = n(139)
      , M = n(43)
      , C = n(893)
      , T = n(135)
      , w = T.HotKeys
      , k = 2
      , x = 100
      , N = r.createClass({
        displayName: "ChatlistPanel",
        mixins: [o, a, C, s, c],
        getInitialState: function() {
            var e = this;
            this.ftsResultPage = 0,
            this.fts = _.debounce(function() {
                e.pending = !1,
                e.setState({
                    ftsLoading: !0
                }, c.DD);
                var t = _.trim(e.searchText || "");
                v.multibyteLength(t) < k || (e._ftsPromise && e._ftsPromise.cancel(),
                e._ftsPromise = Store.Msg.search(t, ++e.ftsResultPage, x).checkpoint(e.rejectOnUnmount()).then(function(n) {
                    if (t === _.trim(e.searchText)) {
                        var r = e.ftsResultPage > 1 ? e.state.ftsResult.concat(n.messages) : n.messages;
                        e.setState({
                            ftsResult: r,
                            searching: !1
                        }, c.DD),
                        g.supportsFeature(g.F.FTS_PAGINATION) && !n.eof || (e.ftsResultPage = 0,
                        e.setState({
                            ftsLoading: !1
                        }, c.DD))
                    }
                })["catch"](y.Unmount, _.noop)["catch"](function() {
                    e.pending || e.setState({
                        searching: !1,
                        ftsLoading: !1
                    }, c.DD)
                }))
            }, 750),
            this.selection = new E([],function(e) {
                return e.id.toString()
            }
            ),
            this.throttledFilteredChats = _.throttle(function(t) {
                var n = e.getFilteredChats(t);
                e.setState({
                    chats: n
                }, c.DD, c.CD)
            }, 450, {
                leading: !1,
                trailing: !0
            }),
            this.throttledFilteredContacts = _.throttle(function(t) {
                var n = e.getFilteredContacts(t);
                e.setState({
                    contacts: n
                }, c.DD, c.CD)
            }, 450, {
                leading: !1,
                trailing: !0
            }),
            this.searchText = "";
            var t;
            return t = 0,
            {
                searching: !1,
                ftsResult: [],
                ftsLoading: !1,
                chats: this.getFilteredChats(),
                contacts: this.getFilteredContacts(),
                textsize: t
            }
        },
        componentWillMount: function() {
            var e = this;
            this.addObserver(Store.Chat, "sort remove change:archive", function() {
                e.searchText || (e.throttledFilteredChats.cancel(),
                e.throttledFilteredContacts.cancel(),
                e.setState({
                    chats: e.getFilteredChats(),
                    contacts: e.getFilteredContacts()
                }))
            })
        },
        componentDidMount: function() {
            var e = this;
            this.regCmd("focus_chat_search", this.onFocusSearch),
            this.regCmd("textsize_change", function(t) {
                e.setState({
                    textsize: t
                })
            })
        },
        componentDidUpdate: function() {
            this.shouldFTSSearch(this.refs.panel) && (this.fts(),
            this.pending = !0)
        },
        componentWillUnmount: function() {
            this.fts.cancel(),
            this._ftsPromise && this._ftsPromise.cancel(),
            this.throttledFilteredChats.cancel(),
            this.throttledFilteredContacts.cancel()
        },
        getFilteredContacts: function(e, t) {
            if (!e)
                return [];
            e = l10n.accentFold(_.trim(e));
            var n = Store.Contact.getFilteredContacts();
            return n.filter(function(n) {
                var r = n.searchMatch(e);
                if (!r)
                    return !1;
                var i = Store.Chat.get(n.id);
                return !(!t && i && i.isVisible)
            })
        },
        getFilteredChats: function(e) {
            return e = _.trim(e),
            e ? (e = l10n.accentFold(e),
            Store.Chat.filter(function(t) {
                return t.contact.searchMatch(e) && t.isVisible
            })) : Store.Chat.filter(function(e) {
                return !e.archive && e.isVisible
            })
        },
        fullTextSearch: function(e) {
            var t = _.trim(e);
            v.multibyteLength(t) >= k && g.supportsFeature(g.F.FULL_TEXT_SEARCH) ? (this.fts(),
            this.pending = !0,
            this.state.searching || this.setState({
                searching: !0
            }, c.DD)) : (this.fts.cancel(),
            this._ftsPromise && this._ftsPromise.cancel(),
            this.ftsResultPage = 0,
            this.pending = !1,
            (this.state.searching || this.state.ftsLoading) && this.setState({
                searching: !1,
                ftsLoading: !1
            }, c.DD))
        },
        shouldFTSSearch: function(e) {
            var t = this.state.ftsResult;
            if (!t || 0 === t.length || 0 === this.ftsResultPage || this.pending)
                return !1;
            var n = _.last(e.children);
            return e.scrollHeight < e.clientHeight + n.scrollHeight
        },
        onSearch: function(e) {
            if (!e)
                return void this.onStopSearch();
            var t = this.searchText;
            if (e !== t) {
                var n = {
                    searchText: e
                };
                this.fullTextSearch(e),
                this.throttledFilteredChats(e),
                this.throttledFilteredContacts(e),
                t && 0 === e.indexOf(t) ? this.ftsResultPage = 0 : n.ftsResult = [],
                this.searchText = e,
                this.setState(n, c.DD)
            }
        },
        onStopSearch: function() {
            this.fts.cancel(),
            this._ftsPromise && this._ftsPromise.cancel(),
            this.searchText = "",
            this.refs.search && this.refs.search.setState({
                searchText: this.searchText
            }),
            this.ftsResultPage = 0,
            this.throttledFilteredChats.cancel(),
            this.throttledFilteredContacts.cancel(),
            this.pending = !1,
            this.setState({
                ftsResult: [],
                ftsLoading: !1,
                chats: this.getFilteredChats(),
                contacts: this.getFilteredContacts(),
                searching: !1
            })
        },
        onFocusList: function(e) {
            e.repeat || this.refs.chatlist && this.refs.search.isAtEnd() && (e.preventDefault(),
            e.stopPropagation(),
            w.flashFocus = Date.now(),
            this.refs.chatlist.focusFirst())
        },
        onOpenFirst: function(e) {
            var t = this;
            e.preventDefault();
            var n = _.head(this.getFilteredChats(this.searchText)) || _.head(this.getFilteredContacts(this.searchText));
            n && Store.Chat.find(n.id).then(function(e) {
                t.onStopSearch(),
                w.flashFocus = Date.now(),
                m.openChat(e, void 0, !0)
            })
        },
        onFocusSearch: function(e) {
            var t = this;
            m.existsDrawerLeft(function(e) {
                e || (w.flashFocus = Date.now(),
                S.focus(t.refs.search))
            })
        },
        indicateFocus: function(e) {
            if (!(Date.now() - (w.flashFocus || 0) > 200)) {
                var t = i.findDOMNode(this.refs.input_hotkey);
                Velocity(t, "stop"),
                Velocity(t, {
                    backgroundColor: ["#fbfbfb", "#D9F3FF"]
                }, {
                    duration: 1600,
                    easing: [.19, .69, .01, .99]
                })
            }
        },
        onScroll: function(e) {
            this.handleScroll(e.target)
        },
        handleScroll: _.throttle(function(e) {
            e.scrollTop + b.SCROLL_FUDGE > e.scrollHeight - e.clientHeight && this.ftsResultPage > 0 && !this.pending && (this.fts(),
            this.pending = !0)
        }, 100),
        getEmptyChatlistState: function(e, t, n) {
            return e.length || t.length || n.length ? null : this.searchText ? this.state.searching ? r.createElement(p.Searching, null ) : r.createElement(p.Search, null ) : Store.Chat.some(function(e) {
                return e.isVisible
            }) ? r.createElement(p.AllArchived, null ) : r.createElement(p.ListChats, null )
        },
        render: function() {
            var e = this
              , t = this.state
              , n = t.chats
              , i = t.contacts
              , o = this.state.ftsResult
              , a = this.getEmptyChatlistState(n, i, o);
            if (!a) {
                var s = this.searchText ? _.trim(this.searchText) : null ;
                a = r.createElement(d, {
                    ref: "chatlist",
                    chats: n,
                    contacts: i,
                    isSearching: !!this.searchText,
                    searchText: s,
                    ftsResult: o,
                    selection: this.selection,
                    onFocusSearch: this.onFocusSearch,
                    onClick: this.onStopSearch
                })
            }
            var c, p = {
                down: this.onFocusList,
                enter: this.onOpenFirst
            }, m = this.state.ftsLoading && o.length ? r.createElement("div", {
                className: "more",
                style: {
                    alignSelf: "center"
                }
            }, r.createElement(h, {
                stroke: 6,
                size: 24
            })) : null , g = _.find(b.TEXTSIZE_CLASS_MAP, function(t) {
                return t.scale === e.state.textsize
            });
            g && (c = g.classname);
            var v = M("pane pane-list pane-one", c);
            return r.createElement("div", {
                id: "side",
                className: v
            }, r.createElement(l, {
                key: "ChatHeader"
            }), r.createElement(f, {
                key: "ButterBar"
            }), r.createElement(w, {
                handlers: p,
                onFocus: this.indicateFocus,
                ref: "input_hotkey",
                className: "search-container"
            }, r.createElement(u, {
                ref: "search",
                onSearch: this.onSearch,
                searching: this.state.searching
            })), r.createElement("div", {
                ref: "panel",
                className: "pane-body pane-list-body",
                onScroll: this.onScroll,
                id: "pane-side",
                "data-list-scroll-container": !0
            }, a, m))
        }
    });
    e.exports = N
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(436)
      , o = r(i)
      , a = n(2)
      , s = r(a)
      , c = n(52)
      , l = r(c)
      , u = n(36)
      , d = r(u)
      , p = n(44)
      , h = r(p)
      , f = n(208)
      , m = r(f)
      , g = n(207)
      , v = r(g)
      , y = n(433)
      , _ = r(y)
      , E = n(6)
      , b = n(37)
      , S = n(224)
      , M = {
        duration: 300,
        easing: [.1, .82, .25, 1]
    }
      , C = function(e, t) {
        return e.map(function(e, n) {
            return [t[n] === e, n]
        }).filter(function(e) {
            var t = (0,
            _["default"])(e, 1)
              , n = t[0];
            return !n
        }).map(function(e) {
            var t = (0,
            _["default"])(e, 2)
              , n = t[1];
            return n
        })
    }
      , T = function(e, t) {
        return C(e, t).filter(function(n) {
            return e[n] && !t[n]
        })
    }
      , w = function(e, t) {
        return C(e, t).filter(function(n) {
            return !e[n] && t[n]
        })
    }
      , k = function(e) {
        function t() {
            var e, n, r, i;
            (0,
            d["default"])(this, t);
            for (var o = arguments.length, a = Array(o), s = 0; s < o; s++)
                a[s] = arguments[s];
            return n = r = (0,
            m["default"])(this, (e = (0,
            l["default"])(t)).call.apply(e, [this].concat(a))),
            r.containerHeight = 0,
            r.childAnimations = [],
            r.state = {
                children: r.props.children
            },
            r.pendingRemoval = [],
            i = n,
            (0,
            m["default"])(r, i)
        }
        return (0,
        v["default"])(t, e),
        (0,
        h["default"])(t, [{
            key: "getHeightChange",
            value: function(e, t) {
                var n = this;
                return e.reduce(function(e, r) {
                    if (r < t)
                        return e;
                    var i = n.refs["animation-child-" + r];
                    return i ? e + b.findDOMNode(i).clientHeight : e
                }, 0)
            }
        }, {
            key: "animateElement",
            value: function(e, t, n, r) {
                var i = this;
                this.childAnimations[e] || (this.childAnimations[e] = s["default"].resolve()),
                this.childAnimations[e].cancel();
                var o = n > 0 ? [0, n] : [-n, 0];
                return this.childAnimations[e] = this.childAnimations[e].then(function() {
                    return S(t, {
                        translateY: o
                    }, M)
                }).then(function() {
                    return i.childAnimations[e] = s["default"].resolve()
                }).cancellable()["catch"](s["default"].CancellationError, function() {
                    S(t, "finish", !0),
                    t.style.transform = ""
                }).then(function() {
                    n >= 0 || (r.indexOf(e) === -1 ? t.style.transform = "" : t.style.opacity = "0")
                }),
                this.childAnimations[e]
            }
        }, {
            key: "transitionAffected",
            value: function(e, t) {
                if (!e)
                    return s["default"].resolve();
                for (var n = [], r = e.slice(-1), i = (0,
                _["default"])(r, 1), o = i[0], a = 0; a <= o; ++a) {
                    var c = this.refs["animation-child-" + a];
                    c && n.push(this.animateElement(a, b.findDOMNode(c), (t ? 1 : -1) * this.getHeightChange(e, a), e))
                }
                return s["default"].all(n)
            }
        }, {
            key: "notifyHeightChange",
            value: function(e, t) {
                e.length && this.props.onHeightChange && this.props.onHeightChange((t ? 1 : -1) * this.getHeightChange(e, 0))
            }
        }, {
            key: "componentWillReceiveProps",
            value: function(e) {
                var t, n = this, r = e.children, i = T(this.state.children, r);
                if (!i.length)
                    return this.setState({
                        children: r
                    });
                var a = i.filter(function(e) {
                    return n.pendingRemoval.indexOf(e) === -1
                });
                a.length && ((t = this.pendingRemoval).push.apply(t, (0,
                o["default"])(a)),
                this.notifyHeightChange(i, !1),
                this.transitionAffected(i, !1).then(function() {
                    n.pendingRemoval = n.pendingRemoval.filter(function(e) {
                        return a.indexOf(e) === -1
                    }),
                    n.setState({
                        children: r
                    })
                }))
            }
        }, {
            key: "componentDidUpdate",
            value: function(e, t) {
                var n = t.children
                  , r = w(n, this.state.children);
                r.length && (this.notifyHeightChange(r, !0),
                this.transitionAffected(r, !0))
            }
        }, {
            key: "componentDidMount",
            value: function() {
                var e = this
                  , t = this.state.children.reduce(function(t, n, r) {
                    var i = e.refs["animation-child-" + r];
                    if (!i)
                        return t;
                    var o = b.findDOMNode(i);
                    return o.style.transform = "translateY(0)",
                    t + o.clientHeight
                }, 0);
                this.props.onHeightChange(t, !0)
            }
        }, {
            key: "render",
            value: function() {
                var e = this.state.children
                  , t = E.Children.map(e, function(e, t) {
                    return e ? E.cloneElement(e, {
                        ref: "animation-child-" + t
                    }) : e
                });
                return E.createElement("div", null , t)
            }
        }]),
        t
    }(E.Component);
    e.exports = k
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(988)
      , o = n(987)
      , a = n(995)
      , s = r.createClass({
        displayName: "ArchiveMenuItem",
        mixins: [o],
        propTypes: {
            chat: r.PropTypes.instanceOf(i).isRequired,
            onArchive: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                archive: this.async("chat.archive")
            }
        },
        render: function() {
            var e = this.props.onArchive.bind(null , !this.state.archive);
            return r.createElement(a, {
                a8n: "mi-archive",
                action: e,
                shortcut: "a",
                key: "ArchiveMenuItem"
            }, this.state.archive ? l10n.t("unarchive_chat") : l10n.t("archive_chat"))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(892)
      , s = r(a)
      , c = n(6)
      , l = n(136)
      , u = n(43)
      , d = function(e) {
        var t = e.className
          , n = e.children
          , r = (0,
        s["default"])(e, ["className", "children"])
          , i = u("doc-state", t);
        return c.createElement("div", (0,
        o["default"])({
            className: i
        }, r), n)
    }
      , p = function(e) {
        var t = e.onClick;
        return c.createElement(d, {
            onClick: t || _.noop
        }, c.createElement("span", {
            className: "icon doc-state-icon icon-audio-download"
        }))
    }
      , h = function() {
        return c.createElement(d, null , c.createElement(l, {
            stroke: 3,
            size: 32
        }))
    }
      , f = function() {
        return c.createElement(d, null , c.createElement("span", {
            className: "icon doc-state-icon icon-audio-cancel-noborder"
        }, c.createElement(l, {
            stroke: 3,
            size: 32
        })))
    }
      , m = function() {
        return c.createElement(d, null , c.createElement("span", {
            className: "icon doc-state-icon icon-audio-upload"
        }))
    };
    e.exports = {
        Download: p,
        Pending: h,
        PendingCancel: f,
        Upload: m
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(891)
      , o = r(i)
      , a = n(6)
      , s = n(37)
      , c = n(134)
      , l = n(213)
      , u = a.createClass({
        displayName: "Draggable",
        mixins: [c],
        propTypes: {
            children: a.PropTypes.node.isRequired,
            start: a.PropTypes.shape({
                x: a.PropTypes.number,
                y: a.PropTypes.number
            }),
            scale: a.PropTypes.number,
            container: a.PropTypes.shape({
                width: a.PropTypes.number.isRequired,
                height: a.PropTypes.number.isRequired
            }),
            onStart: a.PropTypes.func,
            onDrag: a.PropTypes.func,
            onStop: a.PropTypes.func
        },
        getInitialState: function() {
            return {
                dragging: !1,
                x: 0,
                y: 0,
                offsetX: 0,
                offsetY: 0
            }
        },
        componentDidMount: function() {
            this.updateContainer()
        },
        componentWillReceiveProps: function(e) {
            e.scale !== this.props.scale || e.container.width !== this.props.container.width || e.container.height !== this.props.container.height ? this.updateContainer(e, !0) : this.updateContainer(e)
        },
        updateContainer: function(e, t) {
            e = e || this.props;
            var n = e.container;
            if (n && this.refs.draggable) {
                var r, i = s.findDOMNode(this.refs.draggable), o = this.state.x, a = this.state.y, c = i.width * e.scale, l = i.height * e.scale;
                this.props.scale !== e.scale && this.state.center ? (r = this.state.center,
                o = n.width / 2 - r.x * c,
                a = n.height / 2 - r.y * l) : r = {
                    x: (n.width / 2 - o) / c,
                    y: (n.height / 2 - a) / l
                },
                o > 0 ? o = 0 : o + c < n.width && (o = n.width - c),
                a > 0 ? a = 0 : a + l < n.height && (a = n.height - l),
                this.setState({
                    width: c,
                    height: l,
                    x: o,
                    y: a,
                    center: r
                }),
                this.props.onStop && t && e.onStop(o, a)
            }
        },
        handleMouseDown: function(e) {
            e.preventDefault(),
            this.setState({
                dragging: !0,
                offsetX: e.clientX - this.state.x,
                offsetY: e.clientY - this.state.y
            }),
            this.regNativeListener(window, "mousemove", this.handleMouseMove),
            this.regNativeListener(window, "mouseup", this.handleMouseUp),
            this.props.onStart && this.props.onStart()
        },
        handleMouseUp: function(e) {
            this.unregisterListeners(),
            this.setState({
                dragging: !1
            }),
            this.props.onStop && this.props.onStop(this.state.x, this.state.y)
        },
        handleMouseMove: function(e) {
            if (this.state.dragging) {
                var t = e.clientX - this.state.offsetX
                  , n = e.clientY - this.state.offsetY
                  , r = this.props.container;
                r && ((t > 0 || t + this.state.width < r.width) && (t = this.state.x),
                (n > 0 || n + this.state.height < r.height) && (n = this.state.y)),
                this.setState({
                    x: t,
                    y: n
                }),
                this.props.onDrag && this.props.onDrag(t, n)
            }
        },
        render: function() {
            var e = this.props.scale ? " scale(" + this.props.scale + ")" : ""
              , t = (0,
            o["default"])({}, l.prefix("transform"), "translate(" + this.state.x + "px, " + this.state.y + "px)" + e);
            this.state.dragging || (t[l.prefix("transition")] = "transform 200ms");
            var n = "draggable";
            return this.state.dragging && (n += " dragging"),
            a.cloneElement(a.Children.only(this.props.children), {
                style: t,
                draggable: !0,
                ref: "draggable",
                className: n,
                onMouseDown: this.handleMouseDown
            })
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(10)
      , o = i.ONE_BY_ONE_TRANS_GIF
      , a = n(432)
      , s = a.emojiMap
      , c = n(43);
    e.exports = function(e) {
        var t = e.emoji
          , n = e.size
          , i = void 0 === n ? "small" : n
          , a = e.className
          , l = s[t];
        if (!l)
            return null ;
        var u = "small" === i ? "emoji" : "emojik";
        return r.createElement("img", {
            alt: t,
            draggable: !1,
            src: o,
            className: c(u, "emoji" + l, a)
        })
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(891)
      , o = r(i)
      , a = n(52)
      , s = r(a)
      , c = n(36)
      , l = r(c)
      , u = n(44)
      , d = r(u)
      , p = n(208)
      , h = r(p)
      , f = n(207)
      , m = r(f)
      , g = n(6)
      , v = n(213)
      , y = n(43)
      , _ = function(e) {
        function t(e) {
            (0,
            l["default"])(this, t);
            var n = (0,
            h["default"])(this, (0,
            s["default"])(t).call(this, e));
            return n.state = {
                rendered: !1
            },
            n
        }
        return (0,
        m["default"])(t, e),
        (0,
        d["default"])(t, [{
            key: "componentDidMount",
            value: function() {
                this.setState({
                    rendered: !0
                })
            }
        }, {
            key: "render",
            value: function() {
                var e = this.props
                  , t = e.children
                  , n = e.rowNumber
                  , r = e.rowHeight
                  , i = e.zIndex
                  , a = e.className
                  , s = (0,
                o["default"])({
                    zIndex: i,
                    height: r
                }, v.prefix("transform"), "translate3d(0, " + r * n + "px, 0)");
                return a = y(a, {
                    "infinite-list-item": !0,
                    "infinite-list-item-keyframe": !this.state.rendered,
                    "infinite-list-item-transition": !0
                }),
                g.createElement("div", {
                    className: a,
                    style: s
                }, t)
            }
        }]),
        t
    }(g.Component);
    e.exports = _
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(988)
      , o = n(987)
      , a = n(995)
      , s = r.createClass({
        displayName: "MarkUnreadMenuItem",
        mixins: [o],
        propTypes: {
            chat: r.PropTypes.instanceOf(i).isRequired,
            onMarkUnread: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                unreadCount: this.async("chat.unreadCount")
            }
        },
        render: function() {
            var e = this.props.onMarkUnread.bind(null , !this.state.unreadCount);
            return r.createElement(a, {
                a8n: "mi-mark-as",
                action: e,
                shortcut: "r",
                key: "MarkUnreadMenuItem"
            }, this.state.unreadCount ? l10n.t("mark_read_chat") : l10n.t("mark_unread_chat"))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        return function(n) {
            e.some(function(e) {
                var r = (0,
                a["default"])(e, 2)
                  , i = r[0]
                  , o = r[1]
                  , s = o.call(i, n, t);
                return !!n.defaultPrevented || s === !0 && (n.preventDefault && n.preventDefault(),
                !0)
            })
        }
    }
    var o = n(433)
      , a = r(o)
      , s = n(54)
      , c = r(s);
    e.exports = function(e, t) {
        var n = e.reduce(function(e, t) {
            var n = t.handlers;
            return n ? ((0,
            c["default"])(n).forEach(function(r) {
                e[r] || (e[r] = []),
                e[r].push([t, n[r]])
            }),
            e) : e
        }, {});
        return (0,
        c["default"])(n).reduce(function(e, r) {
            return e[r] = i(n[r], t),
            e
        }, {})
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        return function() {
            for (var n = arguments.length, r = Array(n), i = 0; i < n; i++)
                r[i] = arguments[i];
            e.forEach(function(e) {
                var n = (0,
                a["default"])(e, 2)
                  , i = n[0]
                  , o = n[1];
                return o.call.apply(o, [i].concat(r, [t]))
            })
        }
    }
    var o = n(433)
      , a = r(o)
      , s = n(54)
      , c = r(s);
    e.exports = function(e, t) {
        var n = e.reduce(function(e, t) {
            var n = t.hooks;
            return n ? ((0,
            c["default"])(n).forEach(function(r) {
                e[r] || (e[r] = []),
                e[r].push([t, n[r]])
            }),
            e) : e
        }, {});
        return (0,
        c["default"])(n).reduce(function(e, r) {
            return e[r] = i(n[r], t),
            e
        }, {})
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        return function(n) {
            var r = e.some(function(e) {
                var r = (0,
                a["default"])(e, 2)
                  , i = r[0]
                  , o = r[1]
                  , s = o.call(i, n, t);
                return !!n.defaultPrevented || s === !0 && (n.preventDefault && n.preventDefault(),
                !0)
            });
            return !r
        }
    }
    var o = n(433)
      , a = r(o)
      , s = n(54)
      , c = r(s);
    e.exports = function(e, t) {
        var n = e.reduce(function(e, t) {
            var n = t.hotkeys;
            return n ? ((0,
            c["default"])(n).forEach(function(r) {
                e[r] || (e[r] = []),
                e[r].push([t, n[r]])
            }),
            e) : e
        }, {});
        return (0,
        c["default"])(n).reduce(function(e, r) {
            return e[r] = i(n[r], t),
            e
        }, {})
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        return e.msMatchesSelector ? e.msMatchesSelector(t) : e.webkitMatchesSelector ? e.webkitMatchesSelector(t) : e.matches(t)
    }
    function o(e, t) {
        for (var n = 0; n < t.length; ++n) {
            var r = t[n].serializers;
            if (r)
                for (var o = 0; o < r.length; ++o) {
                    var a = (0,
                    c["default"])(r[o], 2)
                      , s = a[0]
                      , l = a[1];
                    if (i(e, s))
                        return l
                }
        }
        return null
    }
    function a(e, t) {
        for (var n = [], r = e.cloneNode(!0), i = r.firstChild; i; ) {
            switch (i.nodeType) {
            case 1:
                var a = o(i, t);
                if (a) {
                    n.push(a(i));
                    break
                }
                switch (i.tagName) {
                case "P":
                case "BR":
                case "PRE":
                case "DIV":
                    n.push("\n")
                }
            case 3:
                n.push(i.nodeValue)
            }
            if (i.hasChildNodes())
                i = i.firstChild;
            else {
                for (; i && !i.nextSibling; )
                    if (i = i.parentNode,
                    i === e) {
                        i = null ;
                        break
                    }
                i && (i = i.nextSibling)
            }
        }
        return n.join("")
    }
    var s = n(433)
      , c = r(s);
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    function r(e, t) {
        return t.reduce(function(e, t) {
            var n = t.parsers;
            return n ? n.reduce(function(e, t) {
                return t(e)
            }, e) : e
        }, i.escape(e))
    }
    var i = n(31);
    e.exports = r
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(52)
      , s = r(a)
      , c = n(36)
      , l = r(c)
      , u = n(44)
      , d = r(u)
      , p = n(208)
      , h = r(p)
      , f = n(207)
      , m = r(f)
      , g = n(6)
      , v = function(e, t) {
        var n, r;
        return r = n = function(n) {
            function r() {
                return (0,
                l["default"])(this, r),
                (0,
                h["default"])(this, (0,
                s["default"])(r).apply(this, arguments))
            }
            return (0,
            m["default"])(r, n),
            (0,
            d["default"])(r, [{
                key: "render",
                value: function() {
                    return g.createElement(e, (0,
                    o["default"])({}, this.props, t))
                }
            }]),
            r
        }(g.Component),
        n.displayName = "Wrapper(" + (e.displayName || e.name) + ")",
        r
    };
    e.exports = v
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(208)
      , l = r(c)
      , u = n(207)
      , d = r(u)
      , p = n(1157)
      , h = n(1162)
      , f = n(1164)
      , m = n(1156)
      , g = n(1154)
      , v = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            l["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        d["default"])(t, e),
        t
    }(m([p, h]));
    v.Suggestions = g(f, {
        plugin: h
    }),
    e.exports = v
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e) {
        return {
            handlers: o(e, j),
            hotkeys: o(e, B)
        }
    }
    function o(e, t) {
        return t.reduce(function(t, n) {
            return Array.isArray(n) ? t[n[0]] = e[n[1]] : t[n] = e[n],
            t
        }, {})
    }
    function a(e) {
        return e.which === L && (e.getModifierState("Shift") || e.getModifierState("Alt") || e.getModifierState("Control"))
    }
    function s(e, t, n) {
        var r = {};
        return n.forEach(function(n) {
            return r[n] = e[n] !== t[n]
        }),
        r
    }
    var c = n(436)
      , l = r(c)
      , u = n(890)
      , d = r(u)
      , p = n(52)
      , h = r(p)
      , f = n(36)
      , m = r(f)
      , g = n(44)
      , v = r(g)
      , y = n(208)
      , _ = r(y)
      , E = n(207)
      , b = r(E)
      , S = n(1081)
      , M = n(895)
      , C = n(139)
      , T = n(1083)
      , w = n(6)
      , k = n(135)
      , x = k.HotKeys
      , N = n(1149)
      , P = n(1150)
      , D = n(1151)
      , O = n(43)
      , A = n(1152)
      , R = n(1082)
      , I = n(1153)
      , L = 13
      , F = function(e) {
        function t() {
            var e, n, r, i;
            (0,
            m["default"])(this, t);
            for (var o = arguments.length, a = Array(o), s = 0; s < o; s++)
                a[s] = arguments[s];
            return n = r = (0,
            _["default"])(this, (e = (0,
            h["default"])(t)).call.apply(e, [this].concat(a))),
            U.call(r),
            i = n,
            (0,
            _["default"])(r, i)
        }
        return (0,
        b["default"])(t, e),
        (0,
        v["default"])(t, [{
            key: "replaceSelection",
            value: function(e) {
                if (!this.props.readOnly) {
                    var t = this.refs.input;
                    this._hasFocus(t) || (C.focus(t),
                    this.selection && this.restoreSelection(this.selection));
                    var n = this.trimToFit(e);
                    if (n.length) {
                        this.props.multiline || (n = n.replace(/\r?\n/g, "")),
                        window.getSelection().getRangeAt(0).deleteContents();
                        var r = t.scrollTop
                          , i = t.scrollHeight;
                        document.execCommand("insertHTML", !1, I(n, this.plugins)),
                        this.onSelect();
                        var o = t.scrollHeight
                          , a = t.clientHeight;
                        o <= a || (t.scrollTop = (r || 0) + (o - i))
                    }
                }
            }
        }, {
            key: "restoreSelection",
            value: function(e) {
                var t = this.refs.input;
                if (t) {
                    var n = e.anchorIndex
                      , r = e.anchorOffset
                      , i = e.focusIndex
                      , o = e.focusOffset
                      , a = t.childNodes
                      , s = n === -1 ? t : a[n]
                      , c = i === -1 ? t : a[i];
                    if (s && c)
                        try {
                            var l = document.createRange();
                            l.setStart(s, r),
                            l.setEnd(c, o);
                            var u = window.getSelection();
                            u.removeAllRanges(),
                            u.addRange(l)
                        } catch (d) {
                            this.focus(!0)
                        }
                }
            }
        }, {
            key: "getSelection",
            value: function() {
                var e = this.refs.input;
                if (!e || document.activeElement !== e)
                    return null ;
                for (var t = window.getSelection(), n = t.anchorNode, r = t.anchorOffset, i = t.focusNode, o = t.focusOffset, a = e.childNodes, s = -1, c = -1, l = 0, u = void 0; (s < 0 || c < 0) && (u = a[l++]); )
                    n === u && (s = l - 1),
                    i === u && (c = l - 1);
                return {
                    anchorIndex: s,
                    anchorOffset: r,
                    focusIndex: c,
                    focusOffset: o
                }
            }
        }, {
            key: "trimToFit",
            value: function(e) {
                var t = this.props.maxLength;
                if (!t)
                    return e;
                var n = this.selectionLength
                  , r = this.length
                  , i = t + n - r;
                if (i <= 0)
                    return "";
                var o = R(String(e));
                return o.slice(0, i).join("")
            }
        }, {
            key: "render",
            value: function() {
                var e = this.props.placeholder
                  , t = this.state.value
                  , n = t.length ? "hidden" : "visible"
                  , r = I(t, this.plugins);
                return w.createElement(x, {
                    className: "input-emoji",
                    handlers: this.hotKeyMap
                }, w.createElement("div", {
                    className: "input-placeholder",
                    ref: "placeholder",
                    style: {
                        visibility: n
                    }
                }, e), w.createElement("div", (0,
                d["default"])({}, this.handlerMap, {
                    className: O(this.props.className),
                    contentEditable: !this.props.readOnly,
                    dangerouslySetInnerHTML: {
                        __html: r
                    },
                    "data-tab": this.props.readOnly ? null : 1,
                    dir: "auto",
                    ref: "input",
                    spellCheck: this.props.spellCheck
                })))
            }
        }, {
            key: "value",
            get: function() {
                return this.state.value
            }
        }, {
            key: "selectionLength",
            get: function() {
                if (this.props.readOnly)
                    return 0;
                var e = this.refs.input;
                this._hasFocus(e) || C.focus(e);
                var t = window.getSelection();
                return t.rangeCount ? R(A(t.getRangeAt(0).cloneContents(), this.plugins)).length : 0
            }
        }, {
            key: "length",
            get: function() {
                return R(this.state.value).length
            }
        }]),
        t
    }(w.Component)
      , U = function() {
        var e = this;
        this.__changeDueToReset = !1,
        this.__isMounted = !0,
        this.selection = this.props.initialSelection,
        this.state = {
            value: this.props.initialValue || ""
        },
        this.trigger = function(t) {
            var n = arguments.length <= 1 || void 0 === arguments[1] ? [] : arguments[1]
              , r = e.hookMap[t];
            r && r.apply(void 0, (0,
            l["default"])(n))
        }
        ,
        this._hasFocus = function() {
            var t = arguments.length <= 0 || void 0 === arguments[0] ? e.refs.input : arguments[0];
            if (!t)
                return !1;
            var n = document
              , r = n.activeElement;
            return !!r && (r === t || t.contains(r))
        }
        ,
        this.focus = function() {
            var t = !(arguments.length <= 0 || void 0 === arguments[0]) && arguments[0];
            return setTimeout(function() {
                if (!e.props.readOnly && e.__isMounted) {
                    var n = e.refs.input;
                    if (n) {
                        var r = e._hasFocus(n);
                        if (!r || t)
                            if (r || C.focus(n),
                            !t && e.selection)
                                e.restoreSelection(e.selection);
                            else {
                                var i = window.getSelection();
                                i && i.rangeCount && (i.selectAllChildren(n),
                                i.collapseToEnd())
                            }
                    }
                }
            }, 0)
        }
        ,
        this.reset = function() {
            e.__changeDueToReset = !0,
            e.selection = null ,
            e.setState({
                value: ""
            })
        }
        ,
        this.onSelect = function() {
            e.selection = e.getSelection(),
            e.props.onSelect && e.props.onSelect(e.selection)
        }
        ,
        this.shouldComponentUpdate = function(t, n) {
            var r = n.value
              , i = !r.length && !!e.state.value.length
              , o = !!r.length && !e.state.value.length;
            if (!o && !i)
                return !1;
            var a = o ? "hidden" : "visible";
            return e.refs.placeholder && e.refs.placeholder.setAttribute("style", "visibility: " + a),
            i && (e.refs.input.innerHTML = ""),
            e.__changeDueToReset && (e.__changeDueToReset = !1,
            e.refs.input && (e.refs.input.innerHTML = I(r, e.plugins))),
            !1
        }
        ,
        this.componentWillReceiveProps = function(t) {
            var n = s(e.props, t, ["readOnly"]);
            n.readOnly && e.refs.input.setAttribute("contentEditable", String(!t.readOnly))
        }
        ,
        this.componentWillUnmount = function() {
            return (e.__isMounted = !1) || void 0
        }
        ,
        this.onInput = function(t) {
            var n = A(e.refs.input, e.plugins)
              , r = "\n" === n ? "" : n;
            e.setState({
                value: r
            }, function() {
                e.trigger(T.CHANGE, [r]),
                e.props.onChange && e.props.onChange(r)
            })
        }
        ,
        this.onPaste = function(t) {
            t.preventDefault();
            var n = new M(t.clipboardData);
            if (n.hasFiles())
                return e.props.onFiles && e.props.onFiles(n);
            var r = n.getText();
            if (!r)
                return !0;
            if (R(r).length > e.props.maxLength) {
                var i = e.props.onMaxPasteExceeded;
                return i && i()
            }
            e.replaceSelection(r)
        }
        ,
        this.onBeforeInput = function(t) {
            if (e.props.readOnly)
                return !0;
            var n = e.props.maxLength;
            if (!n)
                return !1;
            var r = t.data.charCodeAt(0);
            if (8 === r || 127 === r)
                return !1;
            var i = e.selectionLength
              , o = e.length
              , a = n + i - o;
            return R(t.data).length > a
        }
        ,
        this.onKeyDown = function(t) {
            return !(!e.props.onKeyDown || !e.props.onKeyDown(t)) || t.which === L && ((!e.props.multiline || !a(t)) && (e.props.onEnter && e.props.onEnter(),
            !0))
        }
        ,
        this.componentDidMount = function() {
            e.refs.input.restoreFocus = e.focus,
            e.trigger(T.MOUNT)
        }
        ,
        this.onBlur = function(t) {
            return e.props.onBlur && e.props.onBlur(t)
        }
        ,
        this.onFocus = function(t) {
            e.props.onFocus && e.props.onFocus(t)
        }
        ,
        this.onTab = function(t) {
            return e.props.onTab && e.props.onTab(t)
        }
    };
    e.exports = function(e) {
        var t = function(t) {
            function n() {
                var t, r, o, a;
                (0,
                m["default"])(this, n);
                for (var s = arguments.length, c = Array(s), u = 0; u < s; u++)
                    c[u] = arguments[u];
                return r = o = (0,
                _["default"])(this, (t = (0,
                h["default"])(n)).call.apply(t, [this].concat(c))),
                o.plugins = [].concat((0,
                l["default"])(e.map(function(e) {
                    return e instanceof S && e.initialize(o),
                    e
                })), [i(o)]),
                o.handlerMap = N(o.plugins, o),
                o.hookMap = P(o.plugins, o),
                o.hotKeyMap = D(o.plugins, o),
                a = r,
                (0,
                _["default"])(o, a)
            }
            return (0,
            b["default"])(n, t),
            n
        }(F);
        return t
    }
    ;
    var j = ["onBeforeInput", "onBlur", "onFocus", "onInput", "onKeyDown", "onPaste", "onSelect"]
      , B = [["tab", "onTab"]]
}
, function(e, t, n) {
    "use strict";
    var r = n(43)
      , i = n(432)
      , o = i.emojiRegex
      , a = i.emojiMap
      , s = n(10)
      , c = s.ONE_BY_ONE_TRANS_GIF
      , l = o()
      , u = {
        serializers: [["img.emoji", function(e) {
            return e.getAttribute("alt")
        }
        ]],
        parsers: [function(e) {
            return e.replace("", "")
        }
        , function(e) {
            return e.replace(l, function(e, t) {
                var n = a[t];
                if (!n)
                    return "";
                var i = document.createElement("img");
                return i.setAttribute("alt", t),
                i.setAttribute("draggable", "false"),
                i.setAttribute("class", r("emoji", "emoji" + n)),
                i.setAttribute("src", c),
                i.outerHTML
            })
        }
        ],
        handlers: {
            onBeforeInput: function(e, t) {
                var n = e.data
                  , r = l.exec(n);
                return !!r && (t.replaceSelection(r[0]),
                !0)
            }
        }
    };
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(1030)
      , i = n(1031)
      , o = n(1032)
      , a = i.Direction;
    e.exports = function(e, t) {
        if (!o(e))
            return !1;
        var n = i(t, a.BACKWARD);
        if (!n || !n.getAttribute("data-mention-jid"))
            return !1;
        var s = r(t, n)
          , c = window.getSelection();
        c.removeAllRanges();
        var l = document.createRange();
        return l.setStart(t, s),
        l.setEnd(t, s),
        c.addRange(l),
        !0
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(1030)
      , i = n(1031)
      , o = n(1032)
      , a = i.Direction;
    e.exports = function(e, t) {
        if (!o(e))
            return !1;
        var n = i(t, a.FORWARD);
        if (!n || !n.getAttribute("data-mention-jid"))
            return !1;
        var s = r(t, n)
          , c = window.getSelection();
        c.removeAllRanges();
        var l = document.createRange();
        return l.setStart(t, s + 1),
        l.setEnd(t, s + 1),
        c.addRange(l),
        !0
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(1030)
      , i = n(1031)
      , o = n(1032)
      , a = i.Direction
      , s = n(53)
      , c = s.isGecko;
    e.exports = function(e, t) {
        if (!c || !o(e))
            return !1;
        var n = i(t, a.BACKWARD);
        if (!n || !n.getAttribute("data-mention-jid"))
            return !1;
        var s = r(t, n)
          , l = window.getSelection();
        l.removeAllRanges();
        var u = document.createRange();
        return u.setStart(t, s),
        u.setEnd(t, s + 1),
        l.addRange(u),
        !0
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(1030)
      , i = n(1031)
      , o = n(1032)
      , a = i.Direction;
    e.exports = function(e, t) {
        if (!o(e))
            return !1;
        var n = i(t, a.FORWARD);
        if (!n || !n.getAttribute("data-mention-jid"))
            return !1;
        var s = r(t, n)
          , c = window.getSelection();
        c.removeAllRanges();
        var l = document.createRange();
        return l.setStart(t, s),
        l.setEnd(t, s + 1),
        c.addRange(l),
        !0
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e) {
        if (e.hasChildNodes())
            for (; e.childNodes.length; )
                e.removeChild(e.childNodes[0])
    }
    function o(e, t) {
        if (!e.rangeCount)
            return null ;
        var n = e.getRangeAt(0);
        if (!n.collapsed)
            return null ;
        for (var r = 0; r < 5; ++r)
            e.modify("extend", "backward", "word");
        var i = D(F, e.toString()).pop();
        if (!i)
            return a(e, n);
        a(e, n);
        for (var o = i[0].length; o--; )
            e.modify("extend", "backward", "character");
        var c = C.findDOMNode(t.refs.input)
          , l = c.querySelectorAll("span[data-mention-jid]");
        return s(e, l) ? a(e, n) : {
            original: n,
            range: e.getRangeAt(0),
            match: i
        }
    }
    function a(e, t) {
        e.removeAllRanges(),
        e.addRange(t)
    }
    function s(e, t) {
        var n = t.length;
        if (!n)
            return 0;
        for (var r = 0, i = 0; i < n; ++i)
            e.containsNode(t[i], !0) && ++r;
        return r
    }
    var c = n(891)
      , l = r(c)
      , u = n(52)
      , d = r(u)
      , p = n(36)
      , h = r(p)
      , f = n(44)
      , m = r(f)
      , g = n(208)
      , v = r(g)
      , y = n(207)
      , _ = r(y)
      , E = n(1081)
      , b = n(1084)
      , S = n(101)
      , M = n(1083)
      , C = n(37)
      , T = n(1053)
      , w = T.dir
      , k = n(53)
      , x = k.isGecko
      , N = k.isTrident
      , P = n(1009)
      , D = P.matchAll
      , O = n(1160)
      , A = n(1161)
      , R = n(1159)
      , I = n(1158)
      , L = /\u200B((\d+)@c\.us)\u200B/g
      , F = /(?:\B|^)@((?:[^\s@]+ ?){1,3}(?:[^\s@]+)?)?$/g
      , U = {
        Enter: b.ENTER,
        Tab: b.TAB,
        ArrowUp: b.UP,
        ArrowDown: b.DOWN
    }
      , j = function(e) {
        function t() {
            var e, n, r, s, c;
            (0,
            h["default"])(this, t);
            for (var u = arguments.length, p = Array(u), f = 0; f < u; f++)
                p[f] = arguments[f];
            return r = s = (0,
            v["default"])(this, (e = (0,
            d["default"])(t)).call.apply(e, [this].concat(p))),
            s.serializers = [["span[data-mention-jid]", function(e) {
                return i(e),
                "" + e.getAttribute("data-mention-jid") + ""
            }
            ]],
            s.parsers = [function(e) {
                return e.replace(L, function(e, t, n) {
                    var r = window.Store.Contact.get(t);
                    if (!r)
                        return t;
                    var i = !r.isMyContact && r.notifyName ? r.notifyName.name : r.formattedName
                      , o = document.createElement("span");
                    return o.setAttribute("data-mention-jid", r.id),
                    o.setAttribute("dir", w(i) || "auto"),
                    o.appendChild(document.createTextNode("@" + i)),
                    o.outerHTML
                })
            }
            ],
            s.hooks = (n = {},
            (0,
            l["default"])(n, M.CHANGE, function(e, t) {
                var n = t.refs.input;
                if (x)
                    for (var r = n.querySelectorAll("[data-mention-jid]"), i = 0; i < r.length; ++i) {
                        var o = r[i].nextSibling;
                        o && o instanceof Element && "BR" === o.tagName && "_moz" === o.getAttribute("type") && o.remove()
                    }
            }),
            (0,
            l["default"])(n, M.MOUNT, function(e) {
                for (var t = e.refs.input, n = t.querySelectorAll("[data-mention-jid]"), r = 0; r < n.length; ++r)
                    n[r].setAttribute("contenteditable", "false")
            }),
            n),
            s._isComposing = !1,
            s.hotkeys = {
                tab: function(e, t) {
                    return s.handle(b.TAB, [e, t])
                }
            },
            s.handlers = {
                onKeyDown: function(e, t) {
                    if (!this._isComposing) {
                        var n = t.refs.input
                          , r = e.key;
                        if ("Backspace" === r && O(e, n) || "Delete" === r && A(e, n))
                            return !1;
                        if ("ArrowRight" === r && R(e, n) || "ArrowLeft" === r && I(e, n))
                            return !0
                    }
                    var i = U[e.key];
                    return !!i && this.handle(i, [e, t])
                },
                onBlur: function() {
                    return this.handle(b.INACTIVE),
                    !1
                },
                onSelect: function(e, t) {
                    var n = S.supportsFeature(S.F.MENTIONS_OUT);
                    if (N || this._isComposing || !n)
                        return !1;
                    if (t.value.indexOf("@") < 0)
                        return this.handle(b.INACTIVE);
                    var r = window.getSelection()
                      , i = o(r, t);
                    if (!i)
                        return this.handle(b.INACTIVE);
                    var s = i.original
                      , c = i.match;
                    return this.handle(b.SEARCH, [c[1] || ""]),
                    a(r, s),
                    !1
                },
                onCompositionStart: function() {
                    return this._isComposing = !0,
                    !1
                },
                onCompositionEnd: function() {
                    return this._isComposing = !1,
                    !1
                }
            },
            c = r,
            (0,
            v["default"])(s, c)
        }
        return (0,
        _["default"])(t, e),
        (0,
        m["default"])(t, [{
            key: "handleSelect",
            value: function(e, t) {
                if (o(window.getSelection(), this.ctx)) {
                    this.ctx.replaceSelection("" + e.id + " "),
                    this.handle(b.INACTIVE);
                    for (var n = this.ctx.refs.input, r = n.querySelectorAll("[data-mention-jid]"), i = 0; i < r.length; ++i)
                        r[i].setAttribute("contenteditable", "false")
                }
            }
        }]),
        t
    }(E);
    e.exports = new j
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(994)
      , m = n(989)
      , g = n(6)
      , v = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "render",
            value: function() {
                var e = this.props
                  , t = e.className
                  , n = e.contact
                  , r = n.id
                  , i = n.formattedName
                  , o = n.isMyContact
                  , a = n.notifyName
                  , s = e.onMouseDown
                  , c = e.onMouseOver
                  , l = e.onMouseUp
                  , u = e.term;
                return g.createElement("div", {
                    className: t,
                    onMouseDown: s,
                    onMouseUp: l,
                    onMouseOver: c
                }, g.createElement(f, {
                    id: r,
                    size: 32,
                    className: "mentions-result-image"
                }), g.createElement("div", {
                    className: "mentions-result-text-contact",
                    dir: "auto"
                }, g.createElement(m, {
                    text: i,
                    highlight: u ? [u] : null ,
                    highlightBounary: !0
                })), g.createElement("div", {
                    className: "mentions-result-text-pushname",
                    dir: "auto"
                }, !o && a ? g.createElement(m, {
                    text: a.name,
                    highlight: u ? [u] : null ,
                    classes: "emoji-text",
                    highlightBounary: !0
                }) : null ))
            }
        }]),
        t
    }(g.Component);
    e.exports = v
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        return function(n, r) {
            return !(!t.state.active || !t.state.results.length) && (e.call(t, n, r),
            !0)
        }
    }
    function o(e, t) {
        if (t.isMe)
            return !1;
        var n = [t.searchName || t.formattedName];
        return !t.isMyContact && t.notifyName && n.push(t.notifyName.name.toLowerCase()),
        n.some(function(t) {
            return a(e, t)
        })
    }
    function a(e, t) {
        var n = -1;
        do
            if (t.indexOf(e, n + 1) === n + 1)
                return !0;
        while ((n = t.indexOf(" ", n + 1)) !== -1);return !1
    }
    var s = n(52)
      , c = r(s)
      , l = n(36)
      , u = r(l)
      , d = n(44)
      , p = r(d)
      , h = n(208)
      , f = r(h)
      , m = n(207)
      , g = r(m)
      , v = n(997)
      , y = n(1084)
      , _ = n(6)
      , E = n(37)
      , b = n(1163)
      , S = n(209)
      , M = n(102)
      , C = n(43)
      , T = {
        active: !1,
        offset: 0,
        omitted: "",
        query: "",
        results: [],
        scrollTop: 0
    }
      , w = 52
      , k = function(e) {
        function t() {
            var e, n, r, o;
            (0,
            u["default"])(this, t);
            for (var a = arguments.length, s = Array(a), l = 0; l < a; l++)
                s[l] = arguments[l];
            return n = r = (0,
            f["default"])(this, (e = (0,
            c["default"])(t)).call.apply(e, [this].concat(s))),
            r.state = T,
            r.onEnter = i(function() {
                return r.handleSelect(r.state.offset)
            }, r),
            r.onInactive = i(function() {
                return r.setState(T)
            }, r),
            r.onSearch = function(e) {
                var t = r
                  , n = t.state.omitted;
                n && e.startsWith(n) || r.setState({
                    active: !0,
                    offset: 0,
                    omitted: null ,
                    query: e,
                    results: r.getResults(e)
                })
            }
            ,
            r.onEscape = function() {
                r.setState({
                    active: !1,
                    offset: 0,
                    omitted: r.state.query,
                    query: "",
                    results: []
                })
            }
            ,
            r.onUp = i(function() {
                var e = Math.max(r.state.offset - 1, 0);
                r.setOffset(e)
            }, r),
            r.onDown = i(function() {
                var e = r.state.results.length - 1
                  , t = Math.min(r.state.offset + 1, e);
                r.setOffset(t)
            }, r),
            o = n,
            (0,
            f["default"])(r, o)
        }
        return (0,
        g["default"])(t, e),
        (0,
        p["default"])(t, [{
            key: "componentWillMount",
            value: function() {
                var e = this.props.plugin;
                e.registerHandler(y.ENTER, this.onEnter),
                e.registerHandler(y.TAB, this.onEnter),
                e.registerHandler(y.SEARCH, this.onSearch),
                e.registerHandler(y.INACTIVE, this.onInactive),
                e.registerHandler(y.UP, this.onUp),
                e.registerHandler(y.DOWN, this.onDown)
            }
        }, {
            key: "componentWillUnmount",
            value: function() {
                var e = this.props.plugin;
                e.unregisterHandler(y.ENTER),
                e.unregisterHandler(y.TAB),
                e.unregisterHandler(y.SEARCH),
                e.unregisterHandler(y.INACTIVE),
                e.unregisterHandler(y.UP),
                e.unregisterHandler(y.DOWN)
            }
        }, {
            key: "handleSelect",
            value: function(e) {
                var t = this.state.results[e];
                if (t && t.id) {
                    var n = this.props.chat.assignedColor(t.id);
                    this.props.plugin.handleSelect(t, n)
                }
            }
        }, {
            key: "getResults",
            value: function(e) {
                var t = this.props.chat.groupMetadata.participants
                  , n = t.models.map(function(e) {
                    var t = e.contact;
                    return t
                })
                  , r = (e || "").toLowerCase()
                  , i = n.filter(function(e) {
                    return o(r, e)
                });
                return i
            }
        }, {
            key: "setOffset",
            value: function(e) {
                var t = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1]
                  , n = e * w
                  , r = n + w
                  , i = E.findDOMNode(this.refs.overflow)
                  , o = i.scrollTop
                  , a = o + i.clientHeight
                  , s = {
                    offset: e,
                    scrollTop: o
                };
                t || (o > n ? s.scrollTop = n : a < r && (s.scrollTop += r - a)),
                this.setState(s)
            }
        }, {
            key: "renderList",
            value: function(e, t, n) {
                var r = this;
                if (!e || !t.length)
                    return null ;
                var i = t.map(function(e, t) {
                    return _.createElement(b, {
                        key: e.id,
                        contact: e,
                        term: n,
                        ref: "mention-result-" + t,
                        className: C("mentions-result", {
                            selected: t === r.state.offset
                        }),
                        onMouseDown: function(e) {
                            return e.preventDefault()
                        },
                        onMouseUp: function() {
                            return r.handleSelect(t)
                        },
                        onMouseOver: function() {
                            return r.setOffset(t, !0)
                        }
                    })
                });
                return _.createElement(S, {
                    displayName: "MentionSuggestions",
                    escapable: !0,
                    requestDismiss: this.onEscape
                }, _.createElement("div", {
                    className: "mentions-overlay-container"
                }, _.createElement("div", {
                    className: "mentions-results-container",
                    "data-list-scroll-container": "true",
                    ref: "overflow"
                }, _.createElement(v, {
                    ref: "container",
                    data: i,
                    height: w,
                    scrollTop: this.state.scrollTop,
                    animate: !1
                }))))
            }
        }, {
            key: "render",
            value: function() {
                var e = this.state
                  , t = e.query
                  , n = e.results
                  , r = e.active;
                return _.createElement(M, {
                    component: "div",
                    className: "mentions-positioning-container",
                    transitionName: "slide-up"
                }, this.renderList(r, n, t))
            }
        }]),
        t
    }(_.Component);
    e.exports = k
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(14)
      , c = n(9)
      , l = n(995)
      , u = n(1214)
      , d = n(1014)
      , p = a.createClass({
        displayName: "TakePhotoMenuItem",
        propTypes: {
            onImageTake: a.PropTypes.func.isRequired
        },
        onCapture: function() {
            var e = this
              , t = new o["default"](function(n, r) {
                navigator.getUserMedia({
                    video: !0
                }, function(r) {
                    c.closeModal(),
                    n(r),
                    t.isPending() || c.openModal(a.createElement(u, {
                        stream: r,
                        onSend: e.props.onImageTake
                    }))
                }, function(e) {
                    var n = _.isString(e) ? e : e.name
                      , i = s.GUM[n] || s.GUM.GUMError;
                    r(new i),
                    t && !t.isPending() && c.closeModal()
                })
            }
            ).bind(this).timeout(1500, "waitForGUMTakePhotoTimeout").then(function(e) {
                c.openModal(a.createElement(u, {
                    stream: e,
                    onSend: this.props.onImageTake
                }))
            })["catch"](o["default"].TimeoutError, function(e) {
                c.openModal(a.createElement(d, {
                    title: "guide_desktop_camera_title",
                    desc: "guide_desktop_camera_description",
                    type: d.TYPE.GUIDE_ALLOW
                }))
            })["catch"](s.GUM.PermissionDeniedError, function() {
                c.openModal(a.createElement(d, {
                    title: "guide_desktop_camera_title",
                    desc: "guide_desktop_camera_fail_description",
                    type: d.TYPE.GUIDE_UNBLOCK
                }))
            })["catch"](s.GUM.GUMError, function() {
                c.openModal(a.createElement(d, {
                    title: "guide_desktop_camera_missing_title",
                    desc: "guide_desktop_camera_missing_description",
                    type: d.TYPE.GUIDE_NONE
                }))
            })
        },
        render: function() {
            return a.createElement(l, {
                action: this.onCapture,
                a8n: "mi-take-photo"
            }, l10n.t("take_photo"))
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(892)
      , s = r(a)
      , c = n(6)
      , l = n(9)
      , u = n(67)
      , d = c.createClass({
        displayName: "UIETooltip",
        propTypes: {
            tooltip: c.PropTypes.object.isRequired
        },
        componentDidMount: function() {
            var e = this
              , t = this.props.tooltip
              , n = t.menu
              , r = (0,
            s["default"])(t, ["menu"]);
            l.openTooltip(n, (0,
            o["default"])({}, r), this.context.uim, function(t) {
                return e.element = t
            })
        },
        componentWillUnmount: function() {
            l.closeTooltip(this.context.uim)
        },
        getElement: function() {
            return this.element
        },
        render: function() {
            return null
        }
    });
    d.contextTypes = {
        uim: c.PropTypes.instanceOf(u)
    },
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(81)
      , a = n(134)
      , s = n(133)
      , c = n(138)
      , l = n(1196)
      , u = n(1209)
      , d = n(14)
      , p = n(10)
      , h = n(69)
      , f = n(9)
      , m = void 0
      , g = r.createClass({
        displayName: "Conversation",
        mixins: [o, a, s, c],
        getInitialState: function() {
            return {
                chat: void 0,
                msgCollection: void 0,
                focusCtx: void 0
            }
        },
        componentWillMount: function() {
            this.regCmd("open_chat", this.handleOpenChat),
            this.regCmd("clear_chat", this.handleClearChat),
            this.regNativeListener(window, "focus", this.windowGainedFocus),
            this.regNativeListener(window, "blur", this.windowLostFocus)
        },
        componentDidMount: function() {
            var e = this.safeDebounce(this.windowResized, 100);
            this.regNativeListener(window, "resize", e),
            e()
        },
        windowResized: function() {
            m = i.findDOMNode(this).clientHeight
        },
        shouldComponentUpdate: function(e, t) {
            return t !== this.state || e.animate !== this.props.animate
        },
        componentDidUpdate: function(e, t) {
            var n = this.state.chat
              , r = t.chat;
            n && r !== n && (this.addObserver(n, "change:cmc:merge", this.msgCollectionChanged),
            r && this.removeObserver(r, "change:cmc:merge"))
        },
        msgCollectionChanged: function(e, t, n) {
            var r = this.state.msgCollection;
            r !== e && r !== t || this.setState({
                msgCollection: n
            })
        },
        windowGainedFocus: function() {
            h.markAvailable();
            var e = this.state.chat;
            e && e.isUser && e.presence.subscribe()["catch"](d.WapDrop, _.noop)
        },
        windowLostFocus: function() {
            h.markUnavailable(p.SEND_UNAVAILABLE_WAIT)
        },
        handleClearChat: function(e) {
            this.state.chat === e && this.setState({
                chat: void 0,
                msgCollection: void 0,
                focusCtx: void 0
            })
        },
        handleOpenChat: function(e, t, n, r, i) {
            if (r || this.state.chat !== e || t && this.state.msgCollection !== t.collection || !t && this.state.msgCollection !== this.state.chat.msgs || t && this.state.focusCtx && this.state.focusCtx.msg !== t.msg) {
                f.setUiBusy(!0);
                var o = function() {
                    n && f.focusChatTextInput(e),
                    f.setUiBusy(!1)
                };
                f.updateChatlistSelection(e),
                this.setState({
                    chat: e,
                    msgCollection: t ? t.collection : e.msgs,
                    focusCtx: i ? void 0 : t ? t : void 0
                }, o)
            } else
                n && this.state.chat === e && f.focusChatTextInput(e)
        },
        render: function() {
            var e = this.state
              , t = e.chat
              , n = e.msgCollection
              , i = e.focusCtx;
            return t ? r.createElement(l, {
                key: t.id,
                chat: t,
                msgCollection: n,
                height: m,
                focusCtx: i
            }) : r.createElement(u, {
                animate: this.props.animate
            })
        }
    });
    e.exports = g
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(10)
      , c = n(211)
      , l = n(987)
      , u = n(992)
      , d = n(138)
      , p = n(1090)
      , h = n(988)
      , f = n(1076)
      , m = n(1086)
      , g = n(994)
      , v = n(989)
      , y = n(1201)
      , E = n(1098)
      , b = n(1102)
      , S = n(9)
      , M = n(1014)
      , C = n(429)
      , T = n(14)
      , w = n(1029)
      , k = w.MenuBar
      , x = w.MenuBarItem
      , N = n(437)
      , P = n(995)
      , D = n(1085)
      , O = n(1040)
      , A = n(1051)
      , R = n(67)
      , I = a.createClass({
        displayName: "ConversationHeader",
        mixins: [l, u, d],
        propTypes: {
            chat: a.PropTypes.instanceOf(h).isRequired,
            onSelectMessages: a.PropTypes.func.isRequired,
            canAttach: a.PropTypes.bool.isRequired
        },
        statics: {
            ATTACH_MEDIA_ACTIVE: "attach_media_active",
            GROUP_CHAT_ACTIVE: "group_chat_active"
        },
        getInitialState: function() {
            return this.asyncState({
                img: "chat.ProfilePicThumb.img",
                formattedTitle: "chat.formattedTitle"
            }, {
                activeDropdown: void 0
            })
        },
        componentWillMount: function() {},
        onWindowFocus: function() {
            var e = this;
            this.setState({
                newlyFocused: !0
            }),
            this.safeDelay(function() {
                return e.setState({
                    newlyFocused: !1
                })
            }, 100)
        },
        onMouseDown: function(e) {},
        onDrag: function(e) {
            this.didDrag = !0
        },
        onClickCapture: function(e) {},
        onClick: function() {
            var e = this.props.chat;
            !e.isPSA && (e.isUser || e.isBroadcast || e.isGroup) && S.openDrawerRight(a.createElement(E, {
                chat: e
            }), "slide-left", this.context.uim)
        },
        checkForDrawerMid: function(e) {
            S.existsDrawerMid(function(t) {
                t && e.preventDefault()
            })
        },
        onChatSearch: function(e) {
            e.preventDefault(),
            S.openDrawerRight(a.createElement(b, {
                chat: this.props.chat
            }), "slide-left", this.context.uim)
        },
        onCaptureClick: function() {
            var e = this
              , t = this.props.chat
              , n = O.start("camera");
            o["default"].race([n, this.rejectOnUnmount()]).bind(this).checkpoint(this.rejectOnUnmount()).then(function(n) {
                S.openDrawerMid(a.createElement(y, {
                    chat: t,
                    stream: n
                }), "slide-up", e.context.uim)
            })["catch"](T.Unmount, function() {
                n.then(function(e) {
                    return O.stop(e)
                })["catch"](_.noop)
            })["catch"](T.GUM.PermissionDeniedError, function() {
                S.openModal(a.createElement(M, {
                    title: "guide_desktop_camera_title",
                    desc: "guide_desktop_camera_fail_description",
                    type: M.TYPE.GUIDE_UNBLOCK
                }))
            })["catch"](T.GUM.GUMError, function() {
                S.openModal(a.createElement(M, {
                    title: "guide_desktop_camera_missing_title",
                    desc: "guide_desktop_camera_missing_description",
                    type: M.TYPE.GUIDE_NONE
                }))
            })
        },
        render: function() {
            var e, t, r = this.props.chat;
            r.isUser ? (e = a.createElement(j, {
                chat: r,
                onSelectMessages: this.props.onSelectMessages
            }),
            t = a.createElement(m, {
                presence: r.presence,
                placeholder: l10n.t("click_here_for_user_info"),
                location: "title"
            })) : r.isBroadcast ? (e = a.createElement(U, {
                chat: r,
                onSelectMessages: this.props.onSelectMessages
            }),
            t = null ) : r.isGroup && (e = a.createElement(F, {
                chat: r,
                onSelectMessages: this.props.onSelectMessages
            }),
            t = a.createElement(f, {
                presence: r.presence,
                groupMetadata: r.groupMetadata,
                placeholder: l10n.t("click_here_for_group_info"),
                location: "title"
            }));
            var i = n(101)
              , o = i.supportsFeature(i.F.FTS_IN_CONV) ? a.createElement(x, {
                a8n: "search-button",
                icon: "search-alt",
                title: l10n.t("search"),
                onClick: this.onChatSearch
            }) : null
              , s = this.props.canAttach ? a.createElement(x, {
                a8n: "conversation-clip",
                icon: "clip",
                title: l10n.t("menutitle_attach"),
                transitionName: "menu",
                onClick: this.checkForDrawerMid
            }, a.createElement(L, {
                chat: r,
                onCaptureClick: this.onCaptureClick
            })) : null
              , c = "chat-avatar"
              , l = "chat-body"
              , u = "chat-title"
              , d = null ;
            return r.isPSA && (c += " chat-psa",
            l += " chat-psa",
            u += " chat-title-psa",
            d = a.createElement("span", {
                className: "icon-psa-verified"
            }),
            t = null ),
            a.createElement("header", {
                className: "pane-header pane-chat-header",
                onClickCapture: this.onClickCapture,
                onMouseDown: this.onMouseDown
            }, a.createElement("div", {
                className: c,
                onClick: this.onClick
            }, a.createElement(g, {
                id: r.id,
                size: 40
            })), a.createElement("div", {
                className: l,
                onClick: this.onClick
            }, a.createElement("div", {
                className: "chat-main"
            }, a.createElement("h2", {
                className: u,
                dir: "auto"
            }, a.createElement(v, {
                text: r.title(),
                titlify: !0,
                ellipsify: !0
            }), d)), t), a.createElement("div", {
                className: "pane-chat-controls"
            }, a.createElement(k, {
                key: "conversation-header"
            }, o, s, a.createElement(x, {
                a8n: "conversation-menu",
                icon: "menu",
                title: l10n.t("menutitle_menu"),
                onClick: this.checkForDrawerMid
            }, e))))
        }
    });
    I.contextTypes = {
        uim: a.PropTypes.instanceOf(R)
    };
    var L = a.createClass({
        displayName: "AttachMenuDropdown",
        mixins: [u],
        propTypes: {
            chat: a.PropTypes.instanceOf(h).isRequired
        },
        getInitialState: function() {
            return {
                canSendDocument: void 0
            }
        },
        componentWillMount: function() {
            var e = this;
            this.props.chat.shouldSendEncrypted("document").checkpoint(this.rejectOnUnmount()).then(function(t) {
                e.setState({
                    canSendDocument: t
                })
            })["catch"](T.CapabilityError, function() {
                e.setState({
                    canSendDocument: !1
                })
            })["catch"](T.Unmount, _.noop)
        },
        onDocumentPick: function(e) {
            if (e) {
                e.stopPropagation();
                var t = _.toArray(e.target.files);
                t.length && (e.target.value = "",
                this.state.canSendDocument === !1 ? this.showCantSendDocument() : S.attachMediaDrawer(this.props.chat, t))
            }
        },
        onMediaPick: function(e) {
            if (e) {
                e.stopPropagation();
                var t = _.toArray(e.target.files);
                t.length && (e.target.value = "",
                S.attachMediaDrawer(this.props.chat, t))
            }
        },
        onMediaClick: function(e) {
            e.preventDefault(),
            this.refs.mediaPicker.triggerInput()
        },
        onDocumentClick: function(e) {
            e.preventDefault(),
            this.state.canSendDocument === !1 ? this.showCantSendDocument() : this.refs.docPicker.triggerInput()
        },
        confirmContactSend: function(e) {
            var t = this
              , n = void 0;
            n = this.props.chat.isUser ? l10n.t("confirm_contact_send_chat", {
                name: e.formattedName,
                chat: this.props.chat.title()
            }) : this.props.chat.isGroup ? l10n.t("confirm_contact_send_group", {
                name: e.formattedName,
                chat: this.props.chat.title()
            }) : l10n.t("confirm_contact_send_broadcast", {
                name: e.formattedName
            }),
            S.openModal(a.createElement(C, {
                key: "contact_confirm",
                onOK: function() {
                    return t.sendContact(e)
                },
                onCancel: function() {
                    return S.closeModal()
                }
            }, n))
        },
        sendContact: function(e) {
            this.props.chat.sendContact(e),
            S.closeModal()
        },
        onContactClick: function(e) {
            e.preventDefault(),
            S.openModal(a.createElement(A, {
                key: "contacts",
                title: l10n.t("send_contact"),
                filter: Store.Contact.isFilteredContact,
                onCancel: function() {
                    return S.closeModal()
                },
                onSelect: this.confirmContactSend
            }))
        },
        showCantSendDocument: function(e) {
            var t;
            if (e instanceof T.InvalidMediaFileType)
                t = l10n.t("cannot_send_document_type_unsupported");
            else if (e instanceof T.MediaFileTooLarge)
                t = l10n.t("document_too_big", {
                    maxSize: s.MAX_MEDIA_UPLOAD_SIZE / 1024 / 1024 + "MB"
                });
            else {
                var n = this.props.chat;
                t = n.isUser ? l10n.t("cannot_send_document_to_contact_unsupported", {
                    contact: n.title()
                }) : l10n.t("cannot_send_document_to_group_unsupported", {
                    group: n.title()
                })
            }
            S.openModal(a.createElement(C, {
                key: "doc_cant_send",
                onOK: S.closeModal.bind(S)
            }, a.createElement(v, {
                text: t
            })))
        },
        onCaptureClick: function() {
            this.props.onCaptureClick()
        },
        render: function() {
            var e = a.createElement(D, {
                direction: "left",
                body: l10n.t("attach_capture")
            })
              , t = navigator.getUserMedia ? a.createElement(P, {
                tooltip: e,
                a8n: "mi-attach-camera",
                action: this.onCaptureClick
            }, a.createElement("button", {
                className: "menu-icons-item"
            }, a.createElement("div", {
                className: "icon-xl icon-camera"
            }))) : null
              , r = void 0
              , i = n(101);
            if (i.supportsFeature(i.F.ENC_DOC)) {
                var o = a.createElement(D, {
                    direction: "left",
                    body: l10n.t("attach_document")
                });
                r = a.createElement(P, {
                    tooltip: o,
                    ref: "docPicker",
                    a8n: "mi-attach-document",
                    action: this.onDocumentClick,
                    filePickerMimes: c.DOC_MIMES,
                    onFilePick: this.onDocumentPick
                }, a.createElement("button", {
                    className: "menu-icons-item"
                }, a.createElement("div", {
                    className: "icon-xl icon-document"
                })))
            }
            var l = a.createElement(D, {
                direction: "left",
                body: l10n.t("attach_media")
            })
              , u = a.createElement(P, {
                tooltip: l,
                ref: "mediaPicker",
                a8n: "mi-attach-media",
                filePickerMimes: [s.IMAGE_MIMES, s.VIDEO_MIMES].join(","),
                action: this.onMediaClick,
                onFilePick: this.onMediaPick
            }, a.createElement("button", {
                className: "menu-icons-item"
            }, a.createElement("div", {
                className: "icon-xl icon-image"
            })))
              , d = a.createElement(D, {
                direction: "left",
                body: l10n.t("attach_vcard")
            })
              , p = a.createElement(P, {
                tooltip: d,
                a8n: "mi-attach-contact",
                action: this.onContactClick
            }, a.createElement("button", {
                className: "menu-icons-item"
            }, a.createElement("div", {
                className: "icon-xl icon-contact"
            })));
            return a.createElement("div", null , a.createElement(N, {
                type: N.Type.MENU,
                key: "AttachMenuDropdown"
            }, u, t, r, p))
        }
    })
      , F = a.createClass({
        displayName: "GroupMenuDropdown",
        mixins: [l],
        propTypes: {
            chat: a.PropTypes.instanceOf(h).isRequired,
            onSelectMessages: a.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                isReadOnly: this.async("chat.isReadOnly")
            }
        },
        render: function() {
            var e = p.group(this.props.chat, this.props.onSelectMessages);
            return a.createElement(N, {
                type: N.Type.DROPDOWN_MENU,
                key: "GroupMenuDropdown",
                flipOnRTL: !0,
                direction: {
                    x: N.Direction.X.LEFT
                }
            }, e)
        }
    })
      , U = a.createClass({
        displayName: "BroadcastMenuDropdown",
        propTypes: {
            chat: a.PropTypes.instanceOf(h).isRequired,
            onSelectMessages: a.PropTypes.func.isRequired
        },
        render: function() {
            var e = p.broadcast(this.props.chat, this.props.onSelectMessages);
            return a.createElement(N, {
                type: N.Type.DROPDOWN_MENU,
                key: "BroadcastMenuDropdown",
                flipOnRTL: !0,
                direction: {
                    x: N.Direction.X.LEFT
                }
            }, e)
        }
    })
      , j = a.createClass({
        displayName: "ContactMenuDropdown",
        propTypes: {
            chat: a.PropTypes.instanceOf(h).isRequired,
            onSelectMessages: a.PropTypes.func.isRequired
        },
        render: function() {
            var e = p.contact(this.props.chat, this.props.onSelectMessages);
            return a.createElement(N, {
                type: N.Type.DROPDOWN_MENU,
                key: "ContactMenuDropdown",
                flipOnRTL: !0,
                direction: {
                    x: N.Direction.X.LEFT
                }
            }, e)
        }
    });
    e.exports = I
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(891)
      , o = r(i)
      , a = n(6)
      , s = n(37)
      , c = n(895)
      , l = n(10)
      , u = n(987)
      , d = n(133)
      , p = n(81)
      , h = n(138)
      , f = n(992)
      , m = n(1193)
      , g = n(1171)
      , v = n(9)
      , y = n(988)
      , E = n(1017)
      , b = n(134)
      , S = n(435)
      , M = n(43)
      , C = n(1090)
      , T = n(84)
      , w = n(1118)
      , k = n(986)
      , x = n(1188)
      , N = n(102)
      , P = n(1)
      , D = n(137)
      , O = n(1012)
      , A = n(209)
      , R = n(212)
      , I = n(139)
      , L = n(431)
      , F = n(14)
      , U = 3e3
      , j = 8.5
      , B = m.UpdateType
      , G = m.UpdateTypePriority
      , Y = a.createClass({
        displayName: "ConversationMsgs",
        mixins: [u, p, d, b, h, f],
        propTypes: {
            chat: a.PropTypes.instanceOf(y).isRequired,
            msgCollection: a.PropTypes.instanceOf(E).isRequired,
            selectable: a.PropTypes.bool,
            onMessageSelect: a.PropTypes.func.isRequired,
            onSelectMessages: a.PropTypes.func.isRequired,
            focusCtx: a.PropTypes.object,
            selectedMessages: a.PropTypes.objectOf(a.PropTypes.instanceOf(k))
        },
        getInitialState: function() {
            return this.rerender = this.safeDebounce(this._rerender, 100),
            this.handleScroll = _.throttle(this._handleScroll, 100),
            this.initialState(this.props)
        },
        componentWillMount: function() {
            var e = this;
            this._hideStickyDateMarkerTimer = new T(function() {
                return e.hideFloatingMarker()
            }
            )
        },
        componentDidMount: function() {
            var e = this
              , t = this.refs.messageList;
            !this._scrollInfo && t && t.scrollBottom(this.refs.scrollContainer, !0);
            var n = this.props
              , r = n.chat
              , i = n.msgCollection;
            if (this.regCmd("compose_height_change", this.composeHeightChange),
            this.attachMsgCollectionObservers(this.props, void 0),
            this.regNativeListener(window, "focus", this.windowGainedFocus),
            this.regNativeListener(window, "blur", this.windowLostFocus),
            this.regNativeListener(window, "resize", _.throttle(function() {
                e.updateMsgListInfo(),
                e.updateFloatingDateMarker()
            }, 100)),
            this.addObserver(r, "change:trusted"),
            this.regCmd("textsize_change", function(t) {
                e.setState({
                    textsize: t
                })
            }),
            r.isGroup ? this.addObserver(r.groupMetadata.participants, "change:contact.name change:contact.isMyContact", this.rerender) : r.isUser && this.addObserver(r.contact, "change:isMyContact", this.rerender),
            this.addObserver(i, "change:star", this.rerender),
            this.addObserver(r, "change:quotedMsg", this.onQuotedMsgChange),
            !this.props.focusCtx) {
                var o = s.findDOMNode(this.refs.scrollContainer);
                0 === o.scrollTop && this.loadEarlierMsgs()
            }
            this.updateMsgListInfo(),
            this.updateFloatingDateMarker(),
            r.sendSeen();
            var a = void 0
              , c = void 0
              , l = void 0;
            this.regCmd("panes_will_change", function(t) {
                if (e.msgListInfo && e.msgListInfo.visibleMsgOrder && e.msgListInfo.visibleMsgOrder.length && e.refs.messageList) {
                    var n = _.last(e.msgListInfo.visibleMsgOrder).toString();
                    l = s.findDOMNode(e.refs.messageList.refs[n]),
                    c = s.findDOMNode(e.refs.scrollContainer),
                    a = e.getMsgBottom(c, l)
                }
            }),
            this.regCmd("panes_did_change", function(t) {
                c && l && !_.isUndefined(a) && (e.setMsgBottom(c, l, a),
                l = void 0,
                c = void 0,
                a = void 0)
            })
        },
        getMsgBottom: function(e, t) {
            var n = e.scrollTop
              , r = e.scrollHeight
              , i = e.clientHeight
              , o = r - (n + i);
            return r - (t.offsetTop + t.clientHeight + o)
        },
        setMsgBottom: function(e, t, n) {
            var r = t.offsetTop
              , i = t.clientHeight
              , o = r + i + n - e.clientHeight;
            this.setScrollTop(e, o)
        },
        _rerender: function() {
            var e = this
              , t = s.findDOMNode(this.refs.scrollContainer)
              , n = t.scrollTop;
            this.setState({
                msgListKey: this.state.msgListKey + 1
            }, function() {
                e.setScrollTop(t, n)
            })
        },
        componentDidUpdate: function(e, t) {
            if (this.updateType = B.DEFAULT,
            this.updateMsgListInfo(),
            t.msgListKey === this.state.msgListKey) {
                var n = e.chat === this.props.chat;
                this.updateFloatingDateMarker(n)
            }
        },
        initialState: function(e) {
            var t = e.focusCtx
              , n = e.chat
              , r = e.msgCollection;
            this.updateType = B.DEFAULT,
            this.msgListInfo = {
                visibleMsgs: {},
                dateMarker: void 0
            },
            this.velocityScroll = 0;
            var i, o = t || this.getUnreadFocusCtx(e), a = o && o.msg, s = a && a.id;
            return i = 0,
            {
                msgListKey: 0,
                cursor: new w(r,s,n.isGroup ? l.RENDOR_CURSOR.GROUP_CONVERSATION : l.RENDOR_CURSOR.CONVERSATION),
                unreadCount: n.pendingSeenCount ? 0 : n.unreadCount,
                isNearBottom: !0,
                newUnread: 0,
                focusCtx: o,
                contextMenu: !1,
                textsize: i
            }
        },
        attachMsgCollectionObservers: function(e, t) {
            var n = this
              , r = e.chat
              , i = e.msgCollection
              , o = e.focusCtx;
            this.props.msgCollection && (this.removeObserver(this.props.chat, "change:unreadCount"),
            this.removeObserver(this.props.msgCollection, "change:last"),
            this.removeObserver(this.props.msgCollection, "remove", this.onMsgDelete),
            this.removeObserver(this.props.chat.msgs, "change:last")),
            i === r.msgs && this.addObserver(r, "change:unreadCount", this.onUnreadCount),
            this.addObserver(r.msgs, "change:last", this.onLastMsgChanged),
            this.addObserver(i, "remove", this.onMsgDelete),
            this.state.cursor.msgCollection = i;
            var s = o || this.getUnreadFocusCtx();
            this.setState({
                focusCtx: s
            });
            var c = function() {
                return s.key && (s.msg = Store.Msg.get(s.key)),
                s.msg ? (n.setUpdateType(B.KEEP_SCROLL_BOTTOM),
                void n.setState({
                    cursor: n.state.cursor.init(s.msg.id)
                }, n.scrollToMsg.bind(null , s))) : v.openChat(n.props.chat, void 0, !1, !0, !0)
            };
            s && i.loadAroundPromise ? i.loadAroundPromise.checkpoint(this.rejectOnUnmount()).then(c)["catch"](F.Unmount, _.noop)["catch"](F.E404, function() {
                v.openToast(a.createElement(L, {
                    msg: R.t("message_query_404"),
                    id: L.genId()
                })),
                c()
            })["catch"](c) : s && c()
        },
        scrollToMsg: function(e) {
            var t = this;
            if (this._scrollInfo && this.isMounted()) {
                var n = this._scrollInfo.msgNode
                  , r = this.refs.scrollContainer;
                if (n && r && r.contains(n)) {
                    var i = (n.clientHeight - r.clientHeight) / 2
                      , o = e.slideToMsg ? 300 : 0;
                    this.velocityScroll += 1,
                    Velocity(r, "stop"),
                    Velocity(n, "stop"),
                    Velocity(n, "scroll", {
                        duration: o,
                        container: r,
                        offset: i
                    }).then(function() {
                        t.velocityScroll -= 1,
                        t.isMounted() && t._scrollInfo.flashFn && t._scrollInfo.flashFn()
                    })
                }
            }
        },
        isMostRecentCMC: function() {
            return this.props.chat.msgs === this.props.msgCollection
        },
        componentWillReceiveProps: function(e) {
            var t = this;
            this.attachMsgCollectionObservers(e, this.props.focusCtx),
            this.jumpToBottomFlag && this.setState(this.initialState(e), function() {
                t.props.chat.sendSeen(),
                t.scrollToBottom(),
                t.jumpToBottomFlag = !1
            })
        },
        componentWillUnmount: function() {
            this._hideStickyDateMarkerTimer.cancel(),
            this.handleScroll.cancel(),
            this.maybeSendSeen() && (this.props.chat.markedUnread = !1)
        },
        loadEarlierMsgs: function() {
            var e = this
              , t = this.props
              , n = t.chat
              , r = t.msgCollection
              , i = this.state.cursor;
            if (i.start > 0)
                this.setUpdateType(B.KEEP_SCROLL_BOTTOM),
                this.setState({
                    cursor: i.loadBefore()
                });
            else {
                if (r.msgLoadState.noEarlierMsgs || r.msgLoadState.isLoadingEarlierMsgs || r.msgLoadState.isLoadingAroundMsgs)
                    return;
                n.loadEarlierMsgs(r).checkpoint(this.rejectOnUnmount()).then(function() {
                    e.setUpdateType(B.KEEP_SCROLL_BOTTOM),
                    e.setState({
                        cursor: i.loadBefore()
                    })
                })["catch"](F.Unmount, _.noop)["catch"](function(e) {
                    P.log("ConversationMsgs:loadEarlierMsgs failed")(),
                    P.log(e)()
                })
            }
        },
        loadRecentMsgs: function() {
            var e = this
              , t = this.props
              , n = t.chat
              , r = t.msgCollection
              , i = this.state.cursor;
            if (i.end < r.length)
                this.setUpdateType(B.KEEP_SCROLL_TOP),
                this.setState({
                    cursor: i.loadAfter()
                });
            else {
                if (r.msgLoadState.isLoadingRecentMsgs || r.msgLoadState.isLoadingAroundMsgs)
                    return;
                n.loadRecentMsgs(r).checkpoint(this.rejectOnUnmount()).then(function() {
                    e.setUpdateType(B.KEEP_SCROLL_TOP),
                    e.setState({
                        cursor: i.loadAfter()
                    })
                })["catch"](F.Unmount, _.noop)["catch"](function(e) {
                    P.log("ConversationMsgs:loadRecentMsgs failed")(),
                    P.log(e)()
                })
            }
        },
        composeHeightChange: function(e) {
            var t = this
              , n = s.findDOMNode(this.refs.scrollContainer);
            if (e) {
                if (e < 0 && n.scrollTop === n.scrollHeight - n.clientHeight)
                    return;
                this.setScrollTop(n, n.scrollTop + e)
            } else
                !function() {
                    var e = n.scrollHeight - (n.scrollTop + n.clientHeight);
                    Velocity(n, {
                        tween: 18
                    }, {
                        progress: function() {
                            t.setScrollTop(n, n.scrollHeight - e - n.clientHeight)
                        },
                        duration: 300
                    }, [.1, .82, .25, 1])
                }()
        },
        getScrollBottom: function() {
            var e = s.findDOMNode(this.refs.scrollContainer);
            return e.scrollHeight - (e.scrollTop + e.clientHeight)
        },
        setScrollBottom: function(e) {
            var t = s.findDOMNode(this.refs.scrollContainer);
            this.setScrollTop(t, t.scrollHeight - e - t.clientHeight)
        },
        onStickyDateMarkerUpdated: function(e) {
            var t = this.refs.stickyDateMarker;
            t && t.updateDateMarkerText(e)
        },
        hideFloatingMarker: function() {
            var e = this.refs.stickyDateMarker;
            e && e.hideStickyDateMarker(!0)
        },
        setScrollTop: function(e, t) {
            this.programmaticScroll = Date.now(),
            e.scrollTop = t
        },
        updateFloatingDateMarker: function() {
            var e = !(arguments.length <= 0 || void 0 === arguments[0]) && arguments[0]
              , t = this.msgListInfo.dateMarker;
            if (this.isMounted() && void 0 !== t) {
                var n = e || Date.now() - (this.programmaticScroll || 0) < 200;
                if (!n) {
                    var r = this.refs.stickyDateMarker;
                    r && r.hideStickyDateMarker(!1)
                }
                if (this.refs.messageList) {
                    var i = this.refs.messageList.refs;
                    if (t === -1)
                        this.onStickyDateMarkerUpdated();
                    else if (i) {
                        var o = i["dateMarker_" + t];
                        if (o) {
                            var a = o.props.timestamp
                              , s = D.relativeDateStr(a).toUpperCase();
                            this.onStickyDateMarkerUpdated(s)
                        }
                    }
                    if (i && t !== this.dateMarkerIdx) {
                        var c = i["dateMarker_" + this.dateMarkerIdx]
                          , l = i["dateMarker_" + t];
                        c && c.hide(!1),
                        l && l.hide(!0),
                        this.dateMarkerIdx = t
                    }
                    n || this._hideStickyDateMarkerTimer.debounce(U)
                }
            }
        },
        setUpdateType: function(e) {
            G[e] >= G[this.updateType] && (this.updateType = e)
        },
        nearBottom: function(e) {
            return e = e || s.findDOMNode(this.refs.scrollContainer),
            e.scrollTop + l.SCROLL_FUDGE > e.scrollHeight - e.clientHeight
        },
        getUnreadFocusCtx: function(e) {
            var t, n = e || this.props, r = n.chat, i = n.msgCollection, a = n.focusCtx;
            if ((!a || this.isMostRecentCMC()) && r.unreadCount) {
                var s = (t = {},
                (0,
                o["default"])(t, k.TYPE.CHAT, k.TYPE.CHAT),
                (0,
                o["default"])(t, k.TYPE.IMAGE, k.TYPE.IMAGE),
                (0,
                o["default"])(t, k.TYPE.VIDEO, k.TYPE.VIDEO),
                (0,
                o["default"])(t, k.TYPE.AUDIO, k.TYPE.AUDIO),
                (0,
                o["default"])(t, k.TYPE.VCARD, k.TYPE.VCARD),
                (0,
                o["default"])(t, k.TYPE.LOCATION, k.TYPE.LOCATION),
                (0,
                o["default"])(t, k.TYPE.PTT, k.TYPE.PTT),
                t)
                  , c = _(i.toArray()).filter(function(e) {
                    return !!s[e.type]
                }).reverse().take(r.unreadCount).value();
                if (c.length === r.unreadCount)
                    return c = _.last(c),
                    {
                        msg: c,
                        isUnreadDivider: !0,
                        highlightMsg: !1
                    }
            }
        },
        getMsgs: function() {
            var e = this.props.msgCollection
              , t = this.state.cursor;
            return e.toArray().slice(t.start, t.end)
        },
        updateMsgListInfo: function() {
            var e = this.refs.messageList;
            if (e) {
                for (var t = e.props.msgs, n = e.refs, r = {}, i = [], o = 0, a = t.length - 1; o < a; ) {
                    var c = Math.floor((o + a) / 2)
                      , u = n[t[c].id.toString()];
                    e.getMsgVisibility(u) === l.VISIBILITY.ABOVE ? o = c + 1 : a = c
                }
                for (var d = o; d < t.length; d++) {
                    var p = n[t[d].id.toString()];
                    if (e.getMsgVisibility(p) !== l.VISIBILITY.VISIBLE)
                        break;
                    r[t[d].id.toString()] = !0,
                    i.push(t[d].id)
                }
                var h = _.pickBy(n, function(e, t) {
                    return _.startsWith(t, "dateMarker_")
                })
                  , f = s.findDOMNode(this.refs.scrollContainer).scrollTop
                  , m = n.dateMarker_0 ? s.findDOMNode(n.dateMarker_0).offsetTop : void 0;
                if (o = 0,
                a = _.size(h) - 1,
                _.size(h) && m <= f + j)
                    for (; o < a; ) {
                        var g = Math.ceil((o + a) / 2)
                          , v = s.findDOMNode(n["dateMarker_" + g]);
                        if (!v)
                            return;
                        v.offsetTop > f + j ? a = g - 1 : o = g
                    }
                else
                    o = -1;
                this.msgListInfo.dateMarker = o,
                this.pauseHiddenGifs(this.msgListInfo.visibleMsgs, r),
                this.msgListInfo.visibleMsgs = r,
                this.msgListInfo.visibleMsgOrder = i
            }
        },
        isMsgVisible: function(e) {
            var t = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1];
            return !!this.msgListInfo.visibleMsgs[e.toString()] && (!!t || this.getMsgComponent(e))
        },
        getMsgComponent: function(e) {
            var t = this.refs.messageList;
            if (t) {
                var n = t.refs[e.toString()];
                if (n)
                    return n.refs.component && n.refs.component.refs.msg
            }
        },
        pauseHiddenGifs: function(e, t) {
            for (var n in e)
                if (!t[n]) {
                    var r = this.props.msgCollection.get(n);
                    if (r && r.isGif) {
                        var i = this.getMsgComponent(n);
                        i && i.pause()
                    }
                }
        },
        onScroll: function(e) {
            this.handleScroll(e.target, this.props.chat, this.nearBottom, this)
        },
        _handleScroll: function(e, t, n) {
            if (this.updateMsgListInfo(),
            !(this.velocityScroll > 0)) {
                0 === e.scrollTop && this.loadEarlierMsgs();
                var r = this.state
                  , i = r.isNearBottom
                  , o = r.cursor
                  , a = n(e);
                a ? (this.maybeSendSeen(!0),
                this.isMostRecentCMC() && i !== a && (this.setUpdateType(B.NONE),
                this.setState({
                    isNearBottom: a,
                    newUnread: 0
                })),
                (o.end < this.props.msgCollection.length || !this.isMostRecentCMC()) && this.loadRecentMsgs()) : i !== a && (this.setUpdateType(B.NONE),
                this.setState({
                    isNearBottom: a
                })),
                this.updateFloatingDateMarker()
            }
        },
        windowGainedFocus: function() {
            var e = this.props.chat;
            !this.clearUnreadTimer && e.isDirty() && (this.clearUnreadTimer = this.safeDelay(function() {
                delete this.clearUnreadTimer,
                this.maybeSendSeen()
            }, l.CLEAR_CHAT_DIRTY_WAIT))
        },
        windowLostFocus: function() {
            if (this.state.unreadCount && this.isMostRecentCMC()) {
                var e = this.props.chat;
                0 === e.unreadCount && (this.setUpdateType(B.KEEP_SCROLL_BOTTOM),
                this.setState({
                    unreadCount: 0,
                    focusCtx: void 0,
                    cursor: this.state.cursor.setKey()
                })),
                e.markedUnread = !1
            }
        },
        maybeSendSeen: function(e, t) {
            var n = this.props
              , r = n.chat
              , i = n.msgCollection
              , o = this.state.cursor;
            if (r.isDirty() && this.isMostRecentCMC() && o.end >= i.length && (_.isUndefined(t) && (t = document.hasFocus()),
            t && (_.isUndefined(e) && (e = this.nearBottom()),
            e)))
                return r.sendSeen(),
                !0
        },
        jumpToBottom: function() {
            this.isMostRecentCMC() && this.state.cursor.end >= this.props.msgCollection.length ? this.scrollToBottom() : (this.jumpToBottomFlag = !0,
            v.openChat(this.props.chat, void 0, !0, !0, !0))
        },
        scrollToBottom: function() {
            var e = s.findDOMNode(this.refs.scrollContainer);
            e && this.setScrollTop(e, e.scrollHeight)
        },
        onLastMsgChanged: function() {
            var e = this.props.msgCollection
              , t = this.state
              , n = t.cursor
              , r = t.focusCtx
              , i = e.last();
            if (!this.isMostRecentCMC())
                return void (i && i.isSentByMe && this.jumpToBottom());
            var o = {}
              , a = document.hasFocus()
              , s = this.nearBottom();
            this.setUpdateType(s ? B.SCROLL_BOTTOM : B.KEEP_SCROLL_TOP),
            a && s ? (this.setUpdateType(B.SCROLL_BOTTOM),
            o.unreadCount = 0,
            o.focusCtx = void 0,
            o.cursor = n.setKey()) : i && i.isSentByMe && (this.setUpdateType(B.SCROLL_BOTTOM),
            this.state.unreadCount && (o.unreadCount = 0,
            o.focusCtx = void 0,
            o.cursor = n.setKey()),
            this.jumpToBottom()),
            this.isMostRecentCMC() && (r && !o.hasOwnProperty("focusCtx") ? o.cursor = n.loadAfter(1) : o.cursor = n.loadBefore(1)),
            _.isEmpty(o) || this.setState(o)
        },
        onUnreadCount: function() {
            var e = this.props.chat
              , t = this.nearBottom()
              , n = document.hasFocus();
            this.maybeSendSeen(t, n);
            var r = {};
            if (e.unreadCount && !e.pendingSeenCount) {
                r.unreadCount = e.unreadCount;
                var i = this.getUnreadFocusCtx();
                i && (r.focusCtx = i)
            }
            t && 1 === r.unreadCount && 0 === this.state.unreadCount && this.setUpdateType(B.SCROLL_BOTTOM),
            (!t && this.isMostRecentCMC() || !e.pendingSeenCount && this.state.newUnread !== e.unreadCount) && (r.newUnread = e.unreadCount),
            _.isEmpty(r) || this.setState(r)
        },
        onMsgDelete: function(e, t, n) {
            this.state.cursor.onRemove(e),
            this.setState({})
        },
        onPageUpDown: function(e) {
            I.focus(s.findDOMNode(this.refs.scrollContainer))
        },
        onKeyPress: function(e) {
            e.metaKey || e.ctrlKey || (e.preventDefault(),
            "Enter" !== e.key || e.shiftKey ? v.pasteChatTextInput(this.props.chat, String.fromCharCode(e.charCode)) : v.enterChatTextInput(this.props.chat))
        },
        onContextMenu: function(e) {
            var t, n = this.props.chat, r = this.props.onSelectMessages;
            if (n.isUser)
                t = C.contact(n, r);
            else if (n.isGroup)
                t = C.group(n, r);
            else {
                if (!n.isBroadcast)
                    return;
                t = C.broadcast(n, r)
            }
            e.preventDefault(),
            e.stopPropagation(),
            e.persist(),
            this.setState({
                contextMenu: {
                    menu: t,
                    event: e
                }
            })
        },
        contextClose: function() {
            this.setState({
                contextMenu: !1
            })
        },
        onPaste: function(e) {
            e.preventDefault();
            var t = new c(e.clipboardData);
            if (!t.hasFiles())
                return void v.pasteChatTextInput(this.props.chat, t.getText());
            var n = _.filter(t.getFiles(), function(e) {
                var t = S.typeFromMimetype(e.type);
                return "image" === t || "video" === t
            });
            n.length && v.attachMediaDrawer(this.props.chat, n)
        },
        setScrollInfo: function(e, t) {
            this._scrollInfo = {
                msgNode: e,
                flashFn: t
            }
        },
        render: function() {
            var e, t = this, n = this.props, r = n.chat, i = n.msgCollection, o = n.selectable, s = n.onMessageSelect, c = this.state.focusCtx, u = M("pane-chat-msgs pane-chat-body lastTabIndex", {
                selectable: o
            }), d = this.isMostRecentCMC(), p = !!c, h = _.find(l.TEXTSIZE_CLASS_MAP, function(e) {
                return e.scale === t.state.textsize
            });
            h && (e = h.classname);
            var f = a.createElement(m, {
                key: "ml-" + r.id + "-" + this.state.msgListKey,
                ref: "messageList",
                updateType: this.updateType,
                unreadCount: this.state.unreadCount,
                selectable: o,
                onMessageSelect: s,
                msgs: this.getMsgs(),
                focusedMsgCtx: c,
                didRenderFocusedMsg: this.setScrollInfo,
                selectedMessages: this.props.selectedMessages,
                isMsgVisible: this.isMsgVisible
            })
              , v = a.createElement(g, {
                direction: "around",
                isMostRecentCMC: d,
                loadMoreMsgs: _.noop,
                msgCollection: i
            })
              , y = void 0;
            (this.state.cursor.start > 0 || !i.msgLoadState.noEarlierMsgs) && (y = a.createElement(g, {
                direction: "earlier",
                isMostRecentCMC: d,
                loadMoreMsgs: this.loadEarlierMsgs,
                msgCollection: i
            }));
            var E = void 0;
            (this.state.cursor.end < i.length || !d) && (E = a.createElement(g, {
                direction: "recent",
                isMostRecentCMC: d,
                loadMoreMsgs: this.loadRecentMsgs,
                msgCollection: i
            })),
            p && i.msgLoadState.isLoadingAroundMsgs ? (E = void 0,
            y = void 0,
            f = void 0) : v = void 0;
            var b = void 0
              , S = void 0
              , C = this.state
              , T = C.isNearBottom
              , w = C.newUnread;
            T || (w && r.unreadCount && (S = a.createElement("span", {
                className: "icon-meta unread-count",
                key: "icon-unread"
            }, R.n(this.state.newUnread))),
            b = a.createElement("div", {
                className: "incoming-msgs",
                onClick: this.jumpToBottom
            }, a.createElement(N, {
                transitionName: "pop"
            }, S), a.createElement("span", {
                className: "icon icon-down"
            })));
            var k = void 0;
            return this.state.contextMenu && (k = a.createElement(A, {
                displayName: "ConversationContextMenu",
                escapable: !0,
                popable: !0,
                requestDismiss: this.contextClose
            }, a.createElement(O, {
                contextMenu: this.state.contextMenu
            }))),
            a.createElement("div", {
                className: e
            }, a.createElement(x, {
                ref: "stickyDateMarker"
            }), a.createElement(N, {
                transitionName: "pop"
            }, b), a.createElement("div", {
                className: u,
                ref: "scrollContainer",
                onScroll: this.onScroll,
                onKeyPress: this.onKeyPress,
                onContextMenu: o ? null : this.onContextMenu,
                onPaste: this.onPaste,
                tabIndex: "0"
            }, a.createElement("div", {
                className: "pane-chat-empty"
            }), v, y, f, E), k)
        }
    });
    e.exports = Y
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = r.createClass({
        displayName: "LinkPreview",
        propTypes: {
            title: r.PropTypes.string,
            description: r.PropTypes.string,
            canonicalUrl: r.PropTypes.string,
            thumbnail: r.PropTypes.string,
            onOmit: r.PropTypes.func
        },
        render: function() {
            var e = this.props
              , t = e.title
              , n = e.description
              , i = e.canonicalUrl
              , o = e.thumbnail
              , a = o ? r.createElement("img", {
                className: "link-preview-media",
                src: "data:image/jpeg;base64," + o
            }) : null
              , s = this.props.onOmit ? r.createElement("div", {
                className: "btn-background"
            }, r.createElement("button", {
                className: "icon icon-x",
                onClick: this.props.onOmit
            })) : null ;
            return r.createElement("div", {
                className: "message-in link-preview-compose"
            }, r.createElement("div", {
                className: "link-preview-container"
            }, a, r.createElement("div", {
                className: "link-preview-body"
            }, r.createElement("div", {
                className: "link-preview-title",
                title: t
            }, t), r.createElement("div", {
                className: "link-preview-description",
                title: n
            }, n), r.createElement("div", {
                className: "link-preview-source ellipsify"
            }, i))), s)
        }
    });
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(136)
      , o = n(133)
      , a = n(1017)
      , s = r.createClass({
        displayName: "LoadMoreMessages",
        mixins: [o],
        propTypes: {
            direction: r.PropTypes.oneOf(["recent", "earlier", "around"]).isRequired,
            isMostRecentCMC: r.PropTypes.bool.isRequired,
            loadMoreMsgs: r.PropTypes.func.isRequired,
            msgCollection: r.PropTypes.instanceOf(a).isRequired
        },
        getInitialState: function() {
            return this.props.msgCollection.msgLoadState.toJSON()
        },
        componentWillMount: function() {
            this.attachObservers()
        },
        componentWillReceiveProps: function(e) {
            this.attachObservers(e)
        },
        attachObservers: function(e) {
            var t = this
              , n = this.props.msgCollection.msgLoadState;
            e && (this.removeObserver(n, "change"),
            n = e.msgCollection.msgLoadState),
            this.addObserver(n, "change", function() {
                t.setState(n.toJSON())
            })
        },
        loadMoreMsgs: function(e) {
            "earlier" === this.props.direction && this.state.isLoadingEarlierMsgs || "recent" === this.props.direction && this.state.isLoadingRecentMsgs || "around" === this.props.direction && this.state.isLoadingAroundMsgs || this.props.loadMoreMsgs()
        },
        render: function() {
            var e = this.props.direction;
            if ("earlier" === e && this.state.isLoadingEarlierMsgs || "recent" === e && this.state.isLoadingRecentMsgs || "around" === e && this.state.isLoadingAroundMsgs)
                return r.createElement("div", {
                    className: "more"
                }, r.createElement("div", {
                    className: "btn-more",
                    title: l10n.t("loading_messages")
                }, r.createElement(i, {
                    stroke: 6,
                    size: 24
                })));
            var t;
            return t = "earlier" === e ? l10n.t("load_earlier_messages") : "recent" === e ? l10n.t("load_recent_messages") : l10n.t("loading_messages"),
            r.createElement("div", {
                className: "more"
            }, r.createElement("div", {
                className: "btn-more",
                title: t,
                onClick: this.loadMoreMsgs
            }, r.createElement("span", {
                className: "icon icon-refresh"
            })))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(987)
      , a = n(134)
      , s = n(1028)
      , c = n(1049)
      , l = n(1002)
      , u = n(999)
      , d = n(9)
      , p = n(1015)
      , h = n(1016)
      , f = n(101)
      , m = n(137)
      , g = n(1039)
      , v = n(429)
      , y = r.createClass({
        displayName: "AudioVideo",
        mixins: [o, a],
        propTypes: {
            msg: r.PropTypes.instanceOf(i).isRequired,
            quotedMsg: r.PropTypes.element,
            isMsgVisible: r.PropTypes.func,
            displayAuthor: r.PropTypes.bool
        },
        getInitialState: function() {
            return {
                mediaState: this.async("msg.mediaState")
            }
        },
        showMediaMissing: function() {
            d.openModal(r.createElement(p, {
                msg: this.props.msg
            }))
        },
        downloadMedia: function() {
            this.props.msg.forceDownloadMedia()
        },
        cancelDownload: function() {
            this.props.msg.cancelDownload()
        },
        cancelUpload: function() {
            this.props.msg.cancelUpload()
        },
        resumeUpload: function() {
            this.props.msg.resumeUpload()
        },
        resumeRemoteUpload: function() {
            f.supportsFeature(f.F.MEDIA_RETRY) ? this.props.msg.resumeRemoteUpload() : d.openModal(r.createElement(h, {
                msg: this.props.msg
            }))
        },
        getZoomNode: function(e) {
            var t = this.props.isMsgVisible(e);
            if (t && t.getImgNode)
                return t.getImgNode()
        },
        downloadUnsupportedToDesktop: function(e) {
            var t = this;
            e && e.stopPropagation(),
            d.openModal(r.createElement(v, {
                onCancel: d.closeModal.bind(d),
                onOK: function() {
                    d.closeModal(),
                    g.initDownload(t.props.msg)
                },
                okText: l10n.t("web_button_download"),
                cancelText: l10n.t("web_cancel"),
                title: l10n.t("download_unsupported_media_title")
            }, l10n.t("download_unsupported_media_prompt")))
        },
        launchMediaViewer: function(e) {
            var t = this.props
              , n = t.msg
              , r = t.isMsgVisible;
            n.downloadMedia(),
            e && e.stopPropagation(),
            d.mediaViewerModal(n, r ? this.getZoomNode : _.noop)
        },
        stopEvent: function(e) {
            e.stopPropagation()
        },
        render: function() {
            var e = this.props.msg
              , t = e.type === i.TYPE.VIDEO
              , n = null
              , o = null ;
            switch (e.mediaState) {
            case i.MEDIA_STATE.RESOLVED:
            case i.MEDIA_STATE.INIT:
                n = r.createElement(s.Play, null ),
                o = this.launchMediaViewer;
                break;
            case i.MEDIA_STATE.NEED_POKE:
                n = r.createElement(s.Download, {
                    filesize: e.size
                }),
                o = this.downloadMedia;
                break;
            case i.MEDIA_STATE.UPLOADING:
                n = r.createElement(s.PendingCancel, null ),
                o = this.cancelUpload;
                break;
            case i.MEDIA_STATE.NEED_UPLOAD:
                n = r.createElement(s.Upload, {
                    filesize: e.size
                }),
                o = this.resumeUpload;
                break;
            case i.MEDIA_STATE.REMOTE_NEED_UPLOAD:
                n = r.createElement(s.Upload, {
                    filesize: e.size
                }),
                o = this.resumeRemoteUpload;
                break;
            case i.MEDIA_STATE.ERROR_MISSING:
                o = this.showMediaMissing;
                break;
            case i.MEDIA_STATE.ERROR_UNSUPPORTED:
                e.isUnsentMedia || (n = r.createElement(s.Download, {
                    filesize: e.size
                }),
                o = this.downloadUnsupportedToDesktop);
                break;
            default:
                n = r.createElement(s.Pending, null )
            }
            var a = null
              , d = m.durationStr(e.duration);
            d && (a = r.createElement("span", {
                className: "message-duration"
            }, t ? r.createElement("span", {
                className: "icon-s icon-msg-video-light"
            }) : r.createElement("span", {
                className: "icon-s icon-msg-audio-light"
            }), d));
            var p = void 0;
            if (t) {
                var h = {
                    backgroundImage: 'url("data:image/jpeg;base64,' + e.body + '")'
                };
                p = r.createElement("div", {
                    className: "image-thumb-body",
                    style: h
                })
            } else
                p = r.createElement("div", {
                    className: "image-audio"
                });
            var f = this.props.displayAuthor && u.shouldRender(e) ? r.createElement(u, {
                msg: e
            }) : null
              , g = t ? r.createElement("div", {
                className: "shade"
            }) : null
              , v = e.caption ? r.createElement(c, {
                msg: e
            }) : null
              , y = v ? "bubble-image bubble-video bubble-image-caption" : "bubble-image bubble-video";
            return r.createElement("div", {
                onClick: this.stopEvent
            }, r.createElement("div", {
                className: y
            }, f, this.props.quotedMsg, r.createElement("div", {
                className: "image-thumb",
                onClick: o
            }, n, p, g, a), v, r.createElement(l, {
                msg: this.props.msg
            })))
        }
    });
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    var r = n(986)
      , i = n(6)
      , o = n(1002)
      , a = n(999)
      , s = n(83)
      , c = n(43)
      , l = i.createClass({
        displayName: "Ciphertext",
        propTypes: {
            msg: i.PropTypes.instanceOf(r).isRequired,
            displayAuthor: i.PropTypes.bool
        },
        onLearnMore: function() {
            var e = "https://www.whatsapp.com/faq/general/26000015/";
            e = s.build(e, {
                lg: l10n.getLocale()
            }),
            window.open(e, "_blank")
        },
        render: function() {
            var e = this.props.msg
              , t = this.props.displayAuthor && a.shouldRender(e)
              , n = t ? i.createElement(a, {
                msg: e
            }) : null
              , r = c("bubble bubble-placeholder", {
                "has-author": t
            })
              , s = "message-text";
            return i.createElement("div", {
                className: r
            }, n, i.createElement("div", {
                className: "icon icon-ciphertext placeholder-icon"
            }), i.createElement("div", {
                className: s
            }, i.createElement("span", null , i.createElement("span", {
                className: "placeholder-msg"
            }, l10n.t("placeholder_msg")), i.createElement("span", {
                className: "placeholder-learn-more",
                onClick: this.onLearnMore
            }, l10n.t("learn_more")))), i.createElement(o, {
                msg: e
            }))
        }
    });
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1001)
      , o = n(989)
      , a = n(81)
      , s = n(43)
      , c = n(137)
      , l = n(0)
      , u = r.createClass({
        displayName: "DateMarker",
        mixins: [a],
        propTypes: {
            timestamp: r.PropTypes.number.isRequired
        },
        getInitialState: function() {
            return {
                hide: !1
            }
        },
        componentDidMount: function() {
            this.maybeRegMidnight()
        },
        componentDidUpdate: function() {
            this.maybeRegMidnight()
        },
        hide: function(e) {
            this.state.hide !== e && this.setState({
                hide: e
            })
        },
        rerender: function() {
            this.forceUpdate()
        },
        maybeRegMidnight: function() {
            this.unregCmd("midnight", this.rerender);
            var e = l().startOf("day").subtract(7, "day");
            this.props.timestamp >= e.unix() && this.regCmd("midnight", this.rerender)
        },
        render: function() {
            var e = c.relativeDateStr(this.props.timestamp).toUpperCase()
              , t = s("message-system-body", {
                "date-marker-floating": this.state.hide
            });
            return r.createElement("div", {
                className: "msg"
            }, r.createElement("div", {
                className: "message message-system"
            }, r.createElement("span", {
                className: t
            }, r.createElement(i, null , r.createElement(o, {
                direction: "auto",
                text: e
            })))))
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(987)
      , c = n(999)
      , l = n(1023)
      , u = n(1002)
      , d = n(986)
      , p = n(989)
      , h = n(43)
      , f = n(1015)
      , m = n(1016)
      , g = n(1144)
      , v = n(101)
      , y = n(9)
      , E = n(211).MIMETYPES
      , b = n(1039)
      , S = n(431)
      , M = _.pickBy(E, function(e) {
        return "document" === e.msgType
    })
      , C = a.createClass({
        displayName: "Doc",
        mixins: [s],
        propTypes: {
            msg: a.PropTypes.instanceOf(d).isRequired,
            quotedMsg: a.PropTypes.element,
            displayAuthor: a.PropTypes.bool
        },
        getInitialState: function() {
            return {
                mediaStage: this.async("msg.mediaData.mediaStage")
            }
        },
        showMediaMissing: function() {
            y.openModal(a.createElement(f, {
                msg: this.props.msg
            }))
        },
        downloadMedia: function(e) {
            var t = this;
            e && e.stopPropagation(),
            this.downloadToBlob().then(function() {
                b.initDownload(t.props.msg)
            })
        },
        downloadToBlob: function() {
            return this.props.msg.mediaData.mediaStage === l.STAGE.RESOLVED ? o["default"].resolve() : this.props.msg.forceDownloadMedia().then(this.displayToast)["catch"](_.noop)
        },
        displayToast: function() {
            if (this.props.msg.mediaData.mediaStage !== l.STAGE.RESOLVED)
                return o["default"].reject(this.props.msg.mediaData.mediaStage);
            var e = this.props.msg
              , t = e.mediaData
              , n = e.caption || t.filename || l10n.t("untitled_document")
              , r = {
                actionText: l10n.t("open_downloaded_document"),
                onAction: this.openDownloadedFile
            };
            return y.openToast(a.createElement(S, {
                msg: l10n.t("document_downloaded", {
                    name: n
                }),
                id: S.genId(),
                action: r
            })),
            o["default"].resolve()
        },
        cancelDownload: function() {
            this.props.msg.cancelDownload()
        },
        cancelUpload: function() {
            this.props.msg.cancelUpload()
        },
        resumeUpload: function() {
            this.props.msg.resumeUpload()
        },
        resumeRemoteUpload: function() {
            v.supportsFeature(v.F.MEDIA_RETRY) ? this.props.msg.resumeRemoteUpload() : y.openModal(a.createElement(m, {
                msg: this.props.msg
            }))
        },
        openDownloadedFile: function() {
            var e = this.props.msg.mediaData.renderableUrl;
            e && window.open(e, "_blank")
        },
        render: function() {
            var e, t = this.props, n = t.msg, r = t.displayAuthor, i = n.mediaData, o = h("bubble", "bubble-doc", {
                "bubble-broadcast": n.broadcast,
                "bubble-star": n.star
            }), s = r && c.shouldRender(n) ? a.createElement(c, {
                msg: n
            }) : null ;
            i.pageCount > 0 && (e = a.createElement("span", {
                className: "document-meta-value"
            }, l10n.t("web_conversations_most_recent_document", {
                count: i.pageCount,
                _plural: i.pageCount
            })));
            var d, f = i.size > 0 ? a.createElement("span", {
                className: "document-meta-value"
            }, l10n.filesize(i.size)) : null , m = "icon-doc";
            _.has(M, i.mimetype) && (d = a.createElement("span", {
                className: "document-meta-value"
            }, M[i.mimetype].ext),
            m = h(m, M[i.mimetype].icon));
            var v = n.body ? a.createElement("div", {
                className: "document-thumb",
                style: {
                    backgroundImage: 'url("data:image/jpeg;base64,' + i.preview + '")'
                }
            }) : null
              , y = n.caption || i.filename || l10n.t("untitled_document")
              , E = null
              , b = null ;
            switch (i.mediaStage) {
            case l.STAGE.RESOLVED:
                E = a.createElement(g.Download, {
                    onClick: this.downloadMedia
                }),
                b = this.openDownloadedFile;
                break;
            case l.STAGE.FETCHING:
                E = a.createElement(g.PendingCancel, null ),
                b = this.cancelDownload;
                break;
            case l.STAGE.NEED_POKE:
            case l.STAGE.INIT:
                E = a.createElement(g.Download, {
                    onClick: this.downloadMedia
                }),
                b = this.downloadToBlob;
                break;
            case l.STAGE.UPLOADING:
                E = a.createElement(g.PendingCancel, null ),
                b = this.cancelUpload;
                break;
            case l.STAGE.NEED_UPLOAD:
                E = a.createElement(g.Upload, null ),
                b = this.resumeUpload;
                break;
            case l.STAGE.REMOTE_NEED_UPLOAD:
                E = a.createElement(g.Upload, null ),
                b = this.resumeRemoteUpload;
                break;
            case l.STAGE.ERROR_MISSING:
                b = this.showMediaMissing;
                break;
            default:
                E = a.createElement(g.Pending, null )
            }
            return a.createElement("div", {
                className: o
            }, s, this.props.quotedMsg, a.createElement("div", {
                className: "document-container",
                onClick: b,
                title: l10n.t("web_download_document", {
                    name: y
                })
            }, v, a.createElement("div", {
                className: "document-body"
            }, a.createElement("div", {
                className: "document-icon"
            }, a.createElement("div", {
                className: m
            })), a.createElement("div", {
                className: "document-text"
            }, a.createElement(p, {
                text: y,
                ellipsify: !0,
                selectable: !1,
                dirMismatch: n.rtl !== l10n.isRTL(),
                direction: "auto"
            })), E)), a.createElement("div", {
                className: "document-meta"
            }, e, d, f), a.createElement(u, {
                msg: n
            }))
        }
    });
    e.exports = C
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1085)
      , o = n(135)
      , a = o.HotKeys
      , s = r.createClass({
        displayName: "FailedMsgIcon",
        propTypes: {
            onResend: r.PropTypes.func.isRequired,
            errMsg: r.PropTypes.string.isRequired
        },
        getInitialState: function() {
            return {
                hover: !1
            }
        },
        onMouseEnter: function() {
            this.setState({
                hover: !0
            })
        },
        onMouseLeave: function() {
            this.setState({
                hover: !1
            })
        },
        render: function() {
            var e = r.createElement("span", null , this.props.errMsg)
              , t = this.state.hover ? r.createElement(i, {
                direction: "left",
                body: e
            }) : null ;
            return r.createElement(a, {
                onMouseEnter: this.onMouseEnter,
                onMouseLeave: this.onMouseLeave,
                style: {
                    "float": "right"
                },
                className: "icon-error-container"
            }, r.createElement("button", {
                className: "error",
                onClick: this.props.onResend
            }, r.createElement("span", {
                className: "icon icon-error"
            })), t)
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(987)
      , a = n(138)
      , s = n(999)
      , c = n(1049)
      , l = n(43)
      , u = n(9)
      , d = n(429)
      , p = n(1016)
      , h = n(1023)
      , f = n(1028)
      , m = n(1002)
      , g = n(986)
      , v = n(1088)
      , y = n(101)
      , E = n(10)
      , b = 2.4
      , S = 330
      , M = S / b
      , C = 3
      , T = 6
      , w = r.createClass({
        displayName: "Gif",
        mixins: [o, a],
        propTypes: {
            msg: r.PropTypes.instanceOf(g).isRequired,
            quotedMsg: r.PropTypes.element,
            isMsgVisible: r.PropTypes.func,
            displayType: r.PropTypes.oneOf(_.values(E.DISP_TYPE)),
            displayAuthor: r.PropTypes.bool
        },
        getInitialState: function() {
            return this.playCount = 0,
            {
                mediaStage: this.async("msg.mediaData.mediaStage"),
                playing: !1
            }
        },
        componentDidMount: function() {
            this.props.msg.downloadMedia()
        },
        pause: function() {
            this.playCount = 0,
            this._pause()
        },
        play: function(e) {
            if (this.props.msg.mediaState === g.MEDIA_STATE.RESOLVED && this.refs.player) {
                e && e.stopPropagation(),
                this.setState({
                    playing: !0
                }),
                _.isUndefined(this.duration) && (this.duration = i.findDOMNode(this.refs.player).duration);
                var t = Math.ceil(T / this.duration);
                this.playCount = Math.max(t, C),
                this._play()
            }
        },
        _pause: function() {
            if (this.setState({
                playing: !1
            }),
            this.refs.player) {
                var e = i.findDOMNode(this.refs.player);
                e && (e.currentTime = 0,
                e.paused || e.pause())
            }
        },
        _play: function() {
            if (this.refs.player) {
                if (!this.playCount)
                    return this.pause();
                this.playCount -= 1;
                var e = i.findDOMNode(this.refs.player);
                e && e.paused && e.play()
            }
        },
        getStyle: function() {
            var e = this.props.msg.mediaData
              , t = e.thumbWidth || 1
              , n = e.thumbHeight || 1
              , r = void 0
              , i = void 0
              , o = this.aspect(t, n);
            o ? o < 1 / b ? (i = S,
            r = M) : o < 1 ? (i = S,
            r = t * i / n) : o < b ? (r = S,
            i = n * r / t) : (r = S,
            i = M) : (i = "100%",
            r = S);
            var a = e.renderableUrl ? e.fullWidth || t : t
              , s = e.renderableUrl ? e.fullHeight || n : n;
            return o ? a / s > r / i ? (a = a * i / s,
            s = i) : (s = s * r / a,
            a = r) : (a = S,
            s = "100%"),
            {
                bubbleWidth: r,
                bubbleHeight: i,
                contentWidth: a,
                contentHeight: s
            }
        },
        aspect: function(e, t) {
            if (e && t)
                return e / t
        },
        showMediaMissing: function() {
            u.openModal(r.createElement(d, {
                title: l10n.t("missing_photo_title"),
                onOK: u.closeModal.bind(u),
                okText: l10n.t("web_ok")
            }, l10n.t("missing_photo_text")))
        },
        getZoomNode: function(e) {
            var t = this.props.isMsgVisible(e);
            if (t && t.getImgNode)
                return t.getImgNode()
        },
        launchMediaViewer: function(e) {
            e && e.stopPropagation();
            var t = this.props
              , n = t.msg
              , r = t.isMsgVisible;
            u.mediaViewerModal(n, r ? this.getZoomNode : _.noop)
        },
        downloadMedia: function() {
            this.props.msg.forceDownloadMedia()
        },
        cancelDownload: function() {
            this.props.msg.cancelDownload()
        },
        cancelUpload: function() {
            this.props.msg.cancelUpload()
        },
        resumeUpload: function() {
            this.props.msg.resumeUpload()
        },
        resumeRemoteUpload: function() {
            y.supportsFeature(y.F.MEDIA_RETRY) ? this.props.msg.resumeRemoteUpload() : u.openModal(r.createElement(p, {
                msg: this.props.msg
            }))
        },
        onDragStart: function(e) {
            e.nativeEvent.dataTransfer.setData(E.DRAG_TYPE_LOCAL_IMAGE, !0)
        },
        stopEvent: function(e) {
            e.stopPropagation()
        },
        getImgNode: function() {
            if (this.refs.player)
                return i.findDOMNode(this.refs.player)
        },
        render: function() {
            var e = this.props.msg
              , t = e.mediaData
              , n = e.caption ? r.createElement(c, {
                msg: e
            }) : null
              , i = n ? null : r.createElement("div", {
                className: "shade"
            })
              , o = "data:image/jpeg;base64," + t.preview
              , a = null
              , u = null
              , d = null
              , p = null
              , g = this.getStyle()
              , y = g.bubbleWidth
              , _ = g.bubbleHeight
              , E = g.contentWidth
              , b = g.contentHeight
              , S = {
                width: y,
                height: _
            };
            switch (t.mediaStage) {
            case h.STAGE.RESOLVED:
                this.state.playing || (p = r.createElement("span", {
                    className: "image-gif-control",
                    onClick: this.play
                }, r.createElement("button", {
                    className: "icon icon-media-gif"
                }))),
                d = r.createElement(v, {
                    msg: e,
                    poster: o,
                    ref: "player",
                    className: "image-thumb-body",
                    width: E,
                    height: b,
                    onEnded: this._play,
                    muted: !0
                }, l10n.t("video_playback_not_supported")),
                u = this.launchMediaViewer;
                break;
            case h.STAGE.INIT:
                u = this.launchMediaViewer;
                break;
            case h.STAGE.FETCHING:
                a = r.createElement(f.PendingCancel, null ),
                u = this.cancelDownload;
                break;
            case h.STAGE.NEED_POKE:
                a = r.createElement(f.Download, {
                    filesize: t.size
                }),
                u = this.downloadMedia;
                break;
            case h.STAGE.UPLOADING:
                a = r.createElement(f.PendingCancel, null ),
                u = this.cancelUpload;
                break;
            case h.STAGE.NEED_UPLOAD:
                a = r.createElement(f.Upload, {
                    filesize: t.size
                }),
                u = this.resumeUpload;
                break;
            case h.STAGE.REMOTE_NEED_UPLOAD:
                a = r.createElement(f.Upload, {
                    filesize: t.size
                }),
                u = this.resumeRemoteUpload;
                break;
            case h.STAGE.ERROR_MISSING:
                u = this.showMediaMissing;
                break;
            default:
                a = r.createElement(f.Pending, null )
            }
            d || (d = r.createElement("div", {
                className: "image-thumb-body image-thumb-gif",
                style: {
                    backgroundImage: "url(" + o + ")"
                }
            }));
            var M = l("bubble-image", {
                "bubble-image-caption": e.caption,
                "bubble-broadcast": e.caption && e.broadcast,
                "bubble-star": e.caption && e.star
            })
              , C = this.props.displayAuthor && s.shouldRender(e) ? r.createElement(s, {
                msg: e
            }) : null ;
            return r.createElement("div", {
                className: M,
                onClick: this.stopEvent,
                style: {
                    width: S.width
                }
            }, C, this.props.quotedMsg, r.createElement("div", {
                className: "image-thumb",
                onClick: u,
                style: S
            }, p, a, d, i), n, r.createElement(m, {
                msg: this.props.msg
            }))
        }
    });
    e.exports = w
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1006)
      , o = n(441)
      , a = n(432)
      , s = a.emojiMap
      , c = a.getEmojiPath
      , l = n(133)
      , u = n(43)
      , d = {
        LARGE: "large",
        XLARGE: "xlarge"
    }
      , p = r.createClass({
        displayName: "LargeEmoji",
        mixins: [l],
        propTypes: {
            emoji: r.PropTypes.string.isRequired,
            emojiSize: r.PropTypes.oneOf(_.values(d))
        },
        statics: {
            EMOJI_SIZE: d
        },
        getInitialState: function() {
            return {
                assetLoaded: !1
            }
        },
        onAssetLoaded: function() {
            this.setState({
                assetLoaded: !0
            })
        },
        getDefaultProps: function() {
            return {
                emojiSize: d.LARGE
            }
        },
        render: function() {
            var e = s[this.props.emoji];
            if (!e)
                return null ;
            var t = c(e, this.props.emojiSize)[o.currentRes]
              , n = void 0;
            return n = this.state.assetLoaded ? u("large-emoji", "selectable-text") : u("emoji", "emoji" + e, "selectable-text"),
            r.createElement(i, {
                onLoad: this.onAssetLoaded,
                alt: this.props.emoji,
                src: t,
                className: n
            })
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(83)
      , a = n(893)
      , s = n(43)
      , c = {
        LINK: "link",
        GROUP_INVITE: "group_invite"
    }
      , l = r.createClass({
        displayName: "LinkPreview",
        mixins: [a],
        propTypes: {
            msg: r.PropTypes.instanceOf(i).isRequired,
            type: r.PropTypes.oneOf(_.values(c)).isRequired
        },
        getDefaultProps: function() {
            return {
                type: c.LINK
            }
        },
        render: function() {
            var e = this.props
              , t = e.msg
              , n = e.type
              , i = void 0;
            if (t.thumbnail) {
                var a = s({
                    "link-preview-media": n === c.LINK,
                    "group-invite-preview": n === c.GROUP_INVITE
                });
                i = r.createElement("img", {
                    className: a,
                    src: "data:image/jpeg;base64," + t.thumbnail
                })
            }
            var l = t.title ? r.createElement("div", {
                className: "link-preview-title",
                title: t.title
            }, t.title) : null
              , u = t.description ? r.createElement("div", {
                className: "link-preview-description",
                title: t.description
            }, t.description) : null
              , d = s("link-preview-body", {
                nothumb: !i
            })
              , p = n === c.LINK ? r.createElement("div", {
                className: "link-preview-source ellipsify"
            }, o.hostname(t.canonicalUrl || t.matchedText)) : null
              , h = function(e) {
                var n = document.createElement("a");
                n.href = t.matchedText,
                n.target = "_blank",
                document.body.appendChild(n),
                n.click(),
                document.body.removeChild(n)
            };
            return r.createElement("div", {
                className: "link-preview-container",
                onClick: h
            }, i, r.createElement("div", {
                className: d
            }, l, u, p))
        }
    });
    l.Type = c,
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(43)
      , a = {
        FRONT: "front",
        MID: "mid",
        END: "end",
        SINGLE: "single"
    }
      , s = r.createClass({
        displayName: "Menu",
        propTypes: {
            msg: r.PropTypes.instanceOf(i).isRequired,
            position: r.PropTypes.oneOf(_.values(a)).isRequired,
            onClick: r.PropTypes.func,
            isFocusedMsg: r.PropTypes.bool
        },
        click: function() {
            this.refs.context.click()
        },
        render: function() {
            var e = this.props
              , t = e.msg
              , n = e.position
              , s = e.onClick
              , c = t.isMedia
              , l = t.isSentByMe
              , u = t.isGroupMsg
              , d = t.type
              , p = !!t.quotedMsg
              , h = l ? "context-out" : "context-in"
              , f = t.type === i.TYPE.DOCUMENT && !t.body
              , m = t.type === i.TYPE.DOCUMENT && t.body
              , g = d === i.TYPE.LOCATION;
            c = c || m || g || p;
            var v;
            u && (v = !l && (n === a.FRONT || n === a.SINGLE),
            c = c && !v);
            var y = d === i.TYPE.CHAT && t.matchedText && t.matchedText.length && t.body.indexOf(t.matchedText) > -1 && !v && t.isTrusted()
              , _ = o("js-context-icon", c ? "context-icon-media" : "context-icon")
              , E = o(h, {
                context: !(c || y),
                "context-media": c,
                "context-media-document": m,
                "context-ptt": d === i.TYPE.PTT && !p,
                "context-ptt-author": d === i.TYPE.PTT && v && !p,
                "context-special": (y || f) && !v && !p,
                "context-doc": f && !v && !p
            });
            return r.createElement("div", {
                className: E
            }, r.createElement("div", {
                className: _,
                ref: "context",
                onClick: s
            }))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = n(986)
      , g = n(998)
      , v = n(1189)
      , y = n(1184)
      , _ = n(1173)
      , E = n(1183)
      , b = n(1172)
      , S = n(1192)
      , M = n(1092)
      , C = n(1185)
      , T = n(1175)
      , w = n(1177);
    n(992);
    var k = n(1191)
      , x = n(1)
      , N = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "render",
            value: function() {
                var e = this.props
                  , t = e.msg
                  , n = e.quotedMsg
                  , r = e.displayAuthor
                  , i = e.displayType
                  , o = e.isMsgVisible;
                switch (t.type) {
                case m.TYPE.CIPHERTEXT:
                    return f.createElement(_, {
                        msg: t,
                        ref: "msg",
                        displayAuthor: r
                    });
                case m.TYPE.CHAT:
                    return f.createElement(v, {
                        msg: t,
                        ref: "msg",
                        quotedMsg: n,
                        trusted: t.isTrusted(),
                        senderName: t.senderObj ? t.senderObj.name : void 0,
                        displayAuthor: r
                    });
                case m.TYPE.IMAGE:
                    return f.createElement(y, {
                        msg: t,
                        ref: "msg",
                        quotedMsg: n,
                        isMsgVisible: o,
                        displayAuthor: r
                    });
                case m.TYPE.GROUP_NOTIFICATION:
                case m.TYPE.GP2:
                case m.TYPE.BROADCAST_NOTIFICATION:
                case m.TYPE.NOTIFICATION:
                case m.TYPE.E2E_NOTIFICATION:
                case m.TYPE.CALL_LOG:
                    var a = t.body
                      , s = void 0
                      , c = void 0
                      , l = void 0;
                    switch (t.type) {
                    case m.TYPE.GP2:
                    case m.TYPE.GROUP_NOTIFICATION:
                        a = g.formatGroupNotification(t);
                        break;
                    case m.TYPE.BROADCAST_NOTIFICATION:
                        a = g.formatBroadcastNotification(t.subtype, t.body);
                        break;
                    case m.TYPE.E2E_NOTIFICATION:
                        a = g.formatE2ENotification(t),
                        s = t.subtype,
                        l = t.body,
                        c = t.id.remote;
                        break;
                    case m.TYPE.CALL_LOG:
                        a = g.formatCallLog(t, !0)
                    }
                    return f.createElement(E, {
                        text: a,
                        ref: "msg",
                        e2eSubtype: s,
                        participantJid: l,
                        chatId: c
                    });
                case m.TYPE.AUDIO:
                case m.TYPE.VIDEO:
                    return t.isGif ? f.createElement(w, {
                        msg: t,
                        ref: "msg",
                        quotedMsg: n,
                        isMsgVisible: o,
                        displayType: i,
                        displayAuthor: r
                    }) : f.createElement(b, {
                        msg: t,
                        ref: "msg",
                        quotedMsg: n,
                        isMsgVisible: o,
                        displayAuthor: r
                    });
                case m.TYPE.VCARD:
                    return f.createElement(S, {
                        msg: t,
                        ref: "msg",
                        quotedMsg: n,
                        displayAuthor: r
                    });
                case m.TYPE.LOCATION:
                    return f.createElement(M, {
                        msg: t,
                        ref: "msg",
                        quotedMsg: n,
                        displayAuthor: r
                    });
                case m.TYPE.PTT:
                    return f.createElement(C, {
                        msg: t,
                        quotedMsg: n,
                        displayAuthor: r,
                        ref: "msg"
                    });
                case m.TYPE.DOCUMENT:
                    return f.createElement(T, {
                        msg: t,
                        ref: "msg",
                        quotedMsg: n,
                        trusted: t.isTrusted(),
                        senderName: t.senderObj ? t.senderObj.name : null ,
                        displayAuthor: r
                    });
                case m.TYPE.UNKNOWN:
                    return f.createElement(k, {
                        msg: t,
                        displayAuthor: r
                    });
                default:
                    return x.log("messageList:render Unknown message type: " + t.type)(),
                    f.createElement(k, {
                        msg: t,
                        displayAuthor: r
                    })
                }
            }
        }]),
        t
    }(f.Component);
    e.exports = N
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1178)
      , o = r.createClass({
        displayName: "MultiEmoji",
        propTypes: {
            emojis: r.PropTypes.array.isRequired
        },
        render: function() {
            var e = this.props.emojis
              , t = _.size(e);
            if (0 === t)
                return null ;
            var n = 1 === t ? i.EMOJI_SIZE.XLARGE : i.EMOJI_SIZE.LARGE
              , o = e.map(function(e, t) {
                return r.createElement(i, {
                    emoji: e,
                    key: e + t,
                    emojiSize: n
                })
            });
            return r.createElement("span", null , o)
        }
    });
    e.exports = o
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1001)
      , o = n(989)
      , a = n(893)
      , s = n(9)
      , c = n(1224)
      , l = r.createClass({
        displayName: "Notification",
        mixins: [a],
        propTypes: {
            text: r.PropTypes.string.isRequired,
            e2eSubtype: r.PropTypes.string,
            participantJid: r.PropTypes.string,
            chatId: r.PropTypes.string
        },
        onSecurityClick: function() {
            s.openModal(r.createElement(c, {
                e2eSubtype: this.props.e2eSubtype,
                jid: this.props.participantJid,
                chatId: this.props.chatId
            }))
        },
        render: function() {
            var e = r.createElement(i, null , r.createElement(o, {
                direction: "auto",
                text: this.props.text
            }))
              , t = !!this.props.e2eSubtype
              , n = t ? r.createElement("button", {
                className: "message-system-e2e",
                onClick: this.onSecurityClick
            }, e) : r.createElement("span", {
                className: "message-system-body"
            }, e);
            return n
        }
    });
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    function r(e, t) {
        if (e && t) {
            var n = e / t
              , r = void 0;
            return r = n <= 1 ? S : n <= 2.4 ? t * (S / e) : S / 2.4,
            Math.round(r)
        }
    }
    function i(e, t) {
        var n = e && t ? Math.min(e, t) : t || r(1, 1);
        return {
            width: S,
            height: n
        }
    }
    function o(e, t) {
        return e && t && e < t ? {
            marginBottom: t - e + "px"
        } : null
    }
    function a(e, t) {
        return e && t && e > t ? {
            width: S
        } : (e || t) >= S ? {
            width: S
        } : {
            height: "100%"
        }
    }
    var s = n(6)
      , c = n(987)
      , l = n(999)
      , u = n(1049)
      , d = n(43)
      , p = n(9)
      , h = n(1015)
      , f = n(1016)
      , m = n(1023)
      , g = n(1028)
      , v = n(1002)
      , y = n(986)
      , E = n(101)
      , b = n(10)
      , S = 330
      , M = s.createClass({
        displayName: "Picture",
        mixins: [c],
        propTypes: {
            msg: s.PropTypes.instanceOf(y).isRequired,
            quotedMsg: s.PropTypes.element,
            isMsgVisible: s.PropTypes.func,
            displayAuthor: s.PropTypes.bool
        },
        getInitialState: function() {
            return {
                mediaStage: this.async("msg.mediaData.mediaStage")
            }
        },
        componentDidMount: function() {
            this.props.msg.downloadMedia()
        },
        showMediaMissing: function() {
            p.openModal(s.createElement(h, {
                msg: this.props.msg
            }))
        },
        getZoomNode: function(e) {
            var t = this.props.isMsgVisible(e);
            if (t && t.getImgNode)
                return t.getImgNode()
        },
        launchMediaViewer: function(e) {
            e && e.stopPropagation();
            var t = this.props
              , n = t.msg
              , r = t.isMsgVisible;
            p.mediaViewerModal(n, r ? this.getZoomNode : _.noop)
        },
        downloadMedia: function() {
            this.props.msg.forceDownloadMedia()
        },
        cancelDownload: function() {
            this.props.msg.cancelDownload()
        },
        cancelUpload: function() {
            this.props.msg.cancelUpload()
        },
        resumeUpload: function() {
            this.props.msg.resumeUpload()
        },
        resumeRemoteUpload: function() {
            E.supportsFeature(E.F.MEDIA_RETRY) ? this.props.msg.resumeRemoteUpload() : p.openModal(s.createElement(f, {
                msg: this.props.msg
            }))
        },
        onDragStart: function(e) {
            e.nativeEvent.dataTransfer.setData(b.DRAG_TYPE_LOCAL_IMAGE, !0)
        },
        stopEvent: function(e) {
            e.stopPropagation()
        },
        getImgNode: function() {
            return this.refs.img
        },
        render: function() {
            var e = this.props.msg
              , t = e.mediaData
              , n = e.caption ? null : s.createElement("div", {
                className: "shade"
            })
              , c = e.caption ? s.createElement(u, {
                msg: e
            }) : null
              , p = e.url || "data:image/jpeg;base64," + e.body
              , h = null
              , f = null ;
            switch (t.mediaStage) {
            case m.STAGE.RESOLVED:
                f = this.launchMediaViewer;
                break;
            case m.STAGE.FETCHING:
                h = s.createElement(g.PendingCancel, null ),
                f = this.cancelDownload;
                break;
            case m.STAGE.NEED_POKE:
                h = s.createElement(g.Download, {
                    filesize: t.size
                }),
                f = this.downloadMedia;
                break;
            case m.STAGE.UPLOADING:
                h = s.createElement(g.PendingCancel, null ),
                f = this.cancelUpload;
                break;
            case m.STAGE.NEED_UPLOAD:
                h = s.createElement(g.Upload, {
                    filesize: t.size
                }),
                f = this.resumeUpload;
                break;
            case m.STAGE.REMOTE_NEED_UPLOAD:
                h = s.createElement(g.Upload, {
                    filesize: t.size
                }),
                f = this.resumeRemoteUpload;
                break;
            case m.STAGE.ERROR_MISSING:
                f = this.showMediaMissing;
                break;
            default:
                h = s.createElement(g.Pending, null )
            }
            var y = d("bubble-image", {
                "bubble-image-caption": e.caption,
                "bubble-broadcast": e.caption && e.broadcast,
                "bubble-star": e.caption && e.star
            })
              , _ = d("image-thumb-body", {
                "image-thumb-lores": !e.url
            })
              , E = this.props.displayAuthor && l.shouldRender(e) ? s.createElement(l, {
                msg: e
            }) : null
              , b = r(e.fullWidth, e.fullHeight)
              , S = r(e.width, e.height)
              , M = i(b, S)
              , C = o(b, S)
              , T = a(b, S);
            return s.createElement("div", {
                className: y,
                onClick: this.stopEvent,
                style: C
            }, E, this.props.quotedMsg, s.createElement("div", {
                className: "image-thumb",
                onClick: f,
                style: M
            }, h, s.createElement("img", {
                src: p,
                onDragStart: this.onDragStart,
                className: _,
                style: T,
                ref: "img"
            }), n), c, s.createElement(v, {
                msg: e
            }))
        }
    });
    e.exports = M
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(10)
      , o = n(986)
      , a = n(987)
      , s = n(1002)
      , c = n(999)
      , l = n(1093)
      , u = n(1186)
      , d = n(1016)
      , p = n(9)
      , h = n(101)
      , f = n(1015)
      , m = n(136)
      , g = r.createClass({
        displayName: "PTT",
        mixins: [a],
        propTypes: {
            msg: r.PropTypes.instanceOf(o).isRequired,
            quotedMsg: r.PropTypes.element,
            displayAuthor: r.PropTypes.bool
        },
        getInitialState: function() {
            return this.asyncState({
                mediaState: "msg.mediaState",
                img: "msg.sender.ProfilePicThumb.img",
                ack: "msg.ack"
            }, {
                currentTime: 0,
                playing: !1,
                autoPlay: !1
            })
        },
        componentDidMount: function() {
            this.props.msg.downloadMedia()
        },
        showMediaMissing: function() {
            p.openModal(r.createElement(f, {
                msg: this.props.msg
            }))
        },
        downloadMedia: function() {
            this.props.msg.forceDownloadMedia()
        },
        cancelDownload: function() {
            this.props.msg.cancelDownload()
        },
        cancelUpload: function() {
            this.props.msg.cancelUpload()
        },
        resumeUpload: function() {
            this.props.msg.resumeUpload()
        },
        resumeRemoteUpload: function() {
            h.supportsFeature(h.F.MEDIA_RETRY) ? this.props.msg.resumeRemoteUpload() : p.openModal(r.createElement(d, {
                msg: this.props.msg
            }))
        },
        handleTimeUpdate: function(e) {
            this.setState({
                currentTime: e
            })
        },
        handlePlayingUpdate: function(e) {
            this.setState({
                autoPlay: !1,
                playing: e
            })
        },
        loader: function(e, t, n) {
            return n = n ? r.createElement(m, {
                stroke: 3,
                size: 38
            }) : null ,
            r.createElement("div", {
                className: "audio"
            }, r.createElement("div", {
                className: "audio-controls"
            }, r.createElement("button", {
                className: "btn-audio " + (t ? "icon " + t : ""),
                onClick: e
            }, n)), r.createElement("div", {
                className: "audio-body"
            }, r.createElement("input", {
                type: "range",
                className: "audio-track",
                min: 0,
                max: 100,
                value: 0,
                disabled: "disabled"
            })))
        },
        getStatusClass: function(e) {
            return e += " audio-state-default",
            this.state.ack === i.ACK_PLAYED && (e += " audio-state-played"),
            e
        },
        render: function() {
            var e = this.props.msg
              , t = this.getStatusClass("bubble bubble-attach bubble-audio")
              , n = "audio-status icon ";
            n += this.state.ack === i.ACK_PLAYED ? e.isSentByMe ? "icon-ptt-out-blue" : "icon-ptt-in-blue" : e.isSentByMe ? "icon-ptt-out-gray" : "icon-ptt-in-green";
            var a, d = r.createElement("span", {
                className: n,
                key: "status"
            }), p = this.state.playing ? this.state.currentTime : e.duration, h = r.createElement(l, {
                key: "image",
                className: this.props.quotedMsg ? "quoted-msg-bubble-ptt" : null ,
                thumb: this.state.img,
                type: e.type,
                shade: !1,
                duration: p
            }), f = e.isSentByMe ? [h, d] : null , m = e.isSentByMe ? null : [h, d], g = e.isSentByMe ? "text no-author" : "text";
            switch (e.mediaState) {
            case o.MEDIA_STATE.RESOLVED:
                a = r.createElement(u, {
                    msg: e,
                    autoPlay: this.state.autoPlay,
                    onPlayingUpdate: this.handlePlayingUpdate,
                    onTimeUpdate: this.handleTimeUpdate
                });
                break;
            case o.MEDIA_STATE.NEED_POKE:
                a = this.loader(this.downloadMedia, "icon-audio-download");
                break;
            case o.MEDIA_STATE.NEED_UPLOAD:
                a = this.loader(this.resumeUpload, "icon-audio-upload");
                break;
            case o.MEDIA_STATE.REMOTE_NEED_UPLOAD:
                a = this.loader(this.resumeRemoteUpload, "icon-audio-upload");
                break;
            case o.MEDIA_STATE.ERROR_MISSING:
                a = this.loader(this.showMediaMissing, "icon-audio-play");
                break;
            default:
                a = this.loader(null , null , !0)
            }
            var v = this.props.displayAuthor && c.shouldRender(e) ? r.createElement(c, {
                msg: e,
                className: this.props.quotedMsg ? "quoted-msg-bubble-ptt-author" : null
            }) : null ;
            return r.createElement("div", {
                className: t
            }, this.props.quotedMsg ? v : null , this.props.quotedMsg, r.createElement("div", {
                className: "wrapper"
            }, f, r.createElement("div", {
                className: "contents"
            }, this.props.quotedMsg ? null : v, r.createElement("div", {
                className: g
            }, a)), m, r.createElement(s, {
                msg: e
            })))
        }
    });
    e.exports = g
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(10)
      , a = n(986)
      , s = n(134)
      , c = n(1074)
      , l = r.createClass({
        displayName: "PTTPlayer",
        mixins: [s],
        propTypes: {
            msg: r.PropTypes.instanceOf(a).isRequired,
            autoPlay: r.PropTypes.bool.isRequired,
            onPlayingUpdate: r.PropTypes.func.isRequired,
            onTimeUpdate: r.PropTypes.func.isRequired
        },
        playing: !1,
        dragging: !1,
        getInitialState: function() {
            return {
                progress: 0
            }
        },
        onPlayClick: function() {
            var e = i.findDOMNode(this.refs.audio);
            this.playing ? e.pause() : e.play()
        },
        onPlaying: function() {
            this.playing = !0;
            var e = this.props.msg;
            !e.get("isSentByMe") && e.get("ack") < o.ACK_PLAYED && e.sendPlayed(),
            this.props.onPlayingUpdate && this.props.onPlayingUpdate(this.playing)
        },
        onPause: function() {
            this.playing = !1,
            this.props.onPlayingUpdate && this.props.onPlayingUpdate(this.playing)
        },
        onEnded: function() {
            var e = i.findDOMNode(this.refs.audio);
            e.currentTime = 0,
            e.load()
        },
        onTimeUpdate: function() {
            var e = i.findDOMNode(this.refs.audio)
              , t = 0;
            _.isFinite(e.duration) && (t = Math.round(100 * Math.min(1, e.currentTime / e.duration)),
            this.props.onTimeUpdate && this.props.onTimeUpdate(e.currentTime)),
            this.setState({
                progress: t
            })
        },
        componentDidMount: function() {
            var e = i.findDOMNode(this.refs.audio);
            this.regNativeListener(e, "playing", this.onPlaying),
            this.regNativeListener(e, "pause", this.onPause),
            this.regNativeListener(e, "ended", this.onEnded),
            this.regNativeListener(e, "timeupdate", this.onTimeUpdate),
            this.regNativeListener(e, "durationchange", this.onTimeUpdate),
            this.regNativeListener(e, "progress", this.onTimeUpdate)
        },
        onDrag: function(e) {
            var t = i.findDOMNode(this.refs.audio)
              , n = e.target.value;
            this.setState({
                progress: n
            }),
            t.duration && (t.currentTime = t.duration / 100 * n)
        },
        onPlayerError: function(e) {},
        render: function() {
            var e = "btn-audio icon ";
            e += this.playing ? "icon-audio-pause" : "icon-audio-play";
            var t = {
                width: this.state.progress - this.state.progress / 100 * 3 + "%"
            };
            return r.createElement("div", {
                className: "audio"
            }, r.createElement("div", {
                className: "audio-controls"
            }, r.createElement("button", {
                ref: "play_pause",
                className: e,
                onClick: this.onPlayClick
            })), r.createElement("div", {
                className: "audio-body"
            }, r.createElement("div", {
                className: "audio-track-container"
            }, r.createElement("span", {
                className: "audio-progress",
                style: t
            }), r.createElement("input", {
                type: "range",
                className: "audio-track",
                value: this.state.progress,
                onChange: this.onDrag,
                min: "0",
                max: "100"
            }))), r.createElement(c, {
                ref: "audio",
                msg: this.props.msg,
                preload: "auto",
                onError: this.onPlayerError,
                autoPlay: this.props.autoPlay
            }))
        }
    });
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(986)
      , o = n(987)
      , a = r.createClass({
        displayName: "Status",
        mixins: [o],
        propTypes: {
            msg: r.PropTypes.instanceOf(i).isRequired
        },
        getInitialState: function() {
            var e = this.props.msg;
            return {
                ack: e.ack < 3 ? this.async("msg.ack") : e.ack
            }
        },
        getStatus: function() {
            var e = this.props.msg
              , t = "icon"
              , n = e.ack;
            return t += n < 1 ? " icon-msg-time" : 1 === n ? " icon-msg-check" : 2 === n ? " icon-msg-dblcheck" : " icon-msg-dblcheck-ack",
            (e.isMedia && !e.caption || e.type === i.TYPE.LOCATION && !e.get("loc")) && (t += "-light"),
            t
        },
        render: function() {
            return r.createElement("span", {
                onClick: this.openInfoDrawer,
                className: this.getStatus()
            })
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1001)
      , o = n(989)
      , a = n(102)
      , s = r.createClass({
        displayName: "StickyDateMarker",
        proptypes: {},
        getInitialState: function() {
            return {
                date: null ,
                hide: !1
            }
        },
        updateDateMarkerText: function(e) {
            this.setState({
                date: e
            })
        },
        hideStickyDateMarker: function(e) {
            this.state.hide !== e && this.setState({
                hide: e
            })
        },
        render: function() {
            var e = void 0;
            return this.state.date && !this.state.hide && (e = r.createElement("div", {
                className: "msg sticky-date-marker-floating-container"
            }, r.createElement("div", {
                className: "sticky-date-marker-floating-wrapper"
            }, r.createElement("span", {
                className: "message-system-body"
            }, r.createElement(i, null , r.createElement(o, {
                direction: "auto",
                text: this.state.date
            })))))),
            r.createElement(a, {
                transitionName: "slide-down-date"
            }, e)
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(999)
      , o = n(1002)
      , a = n(1179)
      , s = n(1091)
      , c = n(986)
      , l = n(989)
      , u = n(43)
      , d = n(893)
      , p = n(442)
      , h = n(212)
      , f = n(1182)
      , m = n(432)
      , g = r.createClass({
        displayName: "Text",
        mixins: [d],
        propTypes: {
            msg: r.PropTypes.instanceOf(c).isRequired,
            quotedMsg: r.PropTypes.element,
            senderName: r.PropTypes.string,
            displayAuthor: r.PropTypes.bool,
            trusted: r.PropTypes.bool
        },
        render: function() {
            var e = this.props
              , t = e.msg
              , n = e.displayAuthor
              , c = e.trusted
              , d = n && i.shouldRender(t)
              , g = u("bubble", "bubble-text", {
                "bubble-broadcast": t.broadcast,
                "bubble-star": t.star,
                "has-author": d
            })
              , v = d ? r.createElement(i, {
                msg: t,
                className: this.props.quotedMsg ? "text-author-quoted-msg" : null
            }) : null
              , y = void 0
              , _ = void 0;
            if (c && t.linkPreview) {
                var E = p.parseInviteLink(t.matchedText);
                if (E) {
                    y = r.createElement(a, {
                        msg: t,
                        type: a.Type.GROUP_INVITE
                    });
                    var b = function(e) {
                        var n = document.createElement("a");
                        n.href = t.matchedText,
                        n.target = "_blank",
                        document.body.appendChild(n),
                        n.click(),
                        document.body.removeChild(n)
                    }
                      , S = t.isSentByMe ? h.t("group_invite_view") : h.t("group_invite_join");
                    _ = r.createElement("div", {
                        className: "bubble-actions"
                    }, r.createElement("div", {
                        className: "bubble-btn",
                        onClick: b,
                        title: S
                    }, S))
                } else
                    y = r.createElement(a, {
                        msg: t
                    })
            }
            var M = void 0
              , C = void 0
              , T = t.mentionMap()
              , w = m.getMatchedEmojis(t.body);
            return w ? (M = u("message-text", "large-emoji-text", {
                "heart-animation": "" === w[0],
                "one-emoji-text": 1 === w.length,
                "two-emoji-text": 2 === w.length,
                "three-emoji-text": 3 === w.length
            }),
            C = r.createElement(f, {
                emojis: w
            })) : (M = u("message-text"),
            C = r.createElement(l, {
                text: t.body,
                selectable: !0,
                dirMismatch: t.rtl !== h.isRTL(),
                direction: t.dir,
                linkify: c,
                mention: T,
                format: !0,
                wbr: 15
            })),
            r.createElement("div", {
                className: g
            }, v, this.props.quotedMsg, r.createElement("div", {
                className: M,
                "data-id": t.id
            }, y, r.createElement(s, {
                msg: t
            }), C), r.createElement(o, {
                msg: t
            }), _)
        }
    });
    e.exports = g
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1001)
      , o = r.createClass({
        displayName: "Unread",
        propTypes: {
            count: r.PropTypes.number.isRequired
        },
        render: function() {
            var e = l10n.t("unread_message_count", {
                count: l10n.n(this.props.count),
                _plural: this.props.count
            });
            return r.createElement("span", {
                className: "msg-unread-body"
            }, r.createElement(i, null , e))
        }
    });
    e.exports = o
}
, function(e, t, n) {
    "use strict";
    var r = n(986)
      , i = n(6)
      , o = n(1002)
      , a = n(999)
      , s = n(43)
      , c = i.createClass({
        displayName: "UnsupportedMsg",
        propTypes: {
            msg: i.PropTypes.instanceOf(r).isRequired,
            displayAuthor: i.PropTypes.bool
        },
        render: function() {
            var e = this.props.msg
              , t = this.props.displayAuthor && a.shouldRender(e)
              , n = t ? i.createElement(a, {
                msg: e
            }) : null
              , r = s("bubble bubble-placeholder", {
                "has-author": t
            })
              , c = "message-text";
            return i.createElement("div", {
                className: r
            }, n, i.createElement("div", {
                className: "icon icon-unknown placeholder-icon"
            }), i.createElement("div", {
                className: c
            }, i.createElement("span", null , i.createElement("span", {
                className: "placeholder-msg"
            }, l10n.t("unsupported_msg")))), i.createElement(o, {
                msg: e
            }))
        }
    });
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(999)
      , o = n(1002)
      , a = n(986)
      , s = n(43)
      , c = n(9)
      , l = n(1025)
      , u = n(989)
      , d = n(1094)
      , p = n(133)
      , h = n(1243)
      , f = n(1199)
      , m = r.createClass({
        displayName: "Vcard",
        mixins: [p],
        propTypes: {
            msg: r.PropTypes.instanceOf(a).isRequired,
            quotedMsg: r.PropTypes.element,
            displayAuthor: r.PropTypes.bool
        },
        onMessageClick: function() {
            var e = this.props.msg.getWAids();
            e.length > 1 ? c.openModal(r.createElement(h, {
                vCard: this.props.msg.vcard,
                onCancel: c.closeModal.bind(c),
                onSelect: this.openContactChat
            })) : this.openContactChat(_.first(e))
        },
        openContactChat: function(e) {
            Store.Chat.find(e).then(function(e) {
                c.openChat(e),
                c.closeModal()
            })
        },
        onAddToGroupClick: function() {
            var e = this.props.msg.getWAids();
            e.length > 1 ? c.openModal(r.createElement(h, {
                vCard: this.props.msg.vcard,
                onCancel: c.closeModal.bind(c),
                onSelect: this.addContactToGroup,
                iconClass: "icon icon-add-user"
            })) : this.addContactToGroup(_.first(e))
        },
        addContactToGroup: function(e) {
            Store.Contact.find(e).then(function(e) {
                c.openModal(r.createElement(f, {
                    contact: e
                }), "modal-flow")
            })
        },
        render: function() {
            var e = this.props.msg
              , t = e.getWAids()
              , n = void 0;
            this.props.quotedMsg && (n = "quoted-msg-bubble-vcard");
            var a = r.createElement(d, {
                className: "preview " + n,
                thumb: l.thumbnail(e.body),
                waid: e.getVCardThumbnailWAid()
            })
              , c = e.isSentByMe ? a : null
              , p = e.isSentByMe ? null : a
              , h = e.author ? "text" : "text no-author"
              , f = s(["bubble", "bubble-attach", "bubble-contact"], {
                "bubble-attach-caption": !!e.caption
            })
              , m = void 0;
            t.length > 0 && (m = r.createElement("div", {
                className: "bubble-actions"
            }, r.createElement("div", {
                className: "bubble-btn",
                onClick: this.onMessageClick,
                title: l10n.t("message_author", {
                    author: e.subtype
                })
            }, l10n.t("message")), r.createElement("div", {
                className: "bubble-btn",
                onClick: this.onAddToGroupClick,
                title: l10n.t("add_contact_to_group")
            }, l10n.t("add_contact_to_group"))));
            var g = this.props.displayAuthor && i.shouldRender(e) ? r.createElement(i, {
                msg: e
            }) : null
              , v = _.noop;
            return r.createElement("div", null , r.createElement("div", {
                className: f
            }, g, this.props.quotedMsg, r.createElement("div", {
                className: "wrapper"
            }, c, r.createElement("div", {
                className: "contents",
                style: {
                    cursor: "pointer"
                },
                onClick: v
            }, r.createElement("div", {
                className: h
            }, r.createElement(o, {
                msg: e,
                contextMenu: this.contextMenu
            })), r.createElement(u, {
                text: e.subtype,
                element: "div",
                classes: "button button-contact",
                selectable: !0,
                dirMismatch: e.rtl !== l10n.isRTL(),
                direction: e.dir,
                wbr: 15
            })), p), m))
        }
    });
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(986)
      , a = n(1174)
      , s = n(1190)
      , c = n(1034)
      , l = n(81)
      , u = n(43)
      , d = n(137)
      , p = n(1277)
      , h = n(10)
      , f = {
        KEEP_SCROLL_BOTTOM: "keep_scroll_bottom",
        KEEP_SCROLL_TOP: "keep_scroll_top",
        SCROLL_BOTTOM: "scroll_bottom",
        NONE: "none",
        DEFAULT: "default"
    }
      , m = {};
    m[f.KEEP_SCROLL_BOTTOM] = 2,
    m[f.KEEP_SCROLL_TOP] = 2,
    m[f.SCROLL_BOTTOM] = 2,
    m[f.NONE] = 1,
    m[f.DEFAULT] = 0;
    var g = r.createClass({
        displayName: "MessageList",
        mixins: [l],
        propTypes: {
            msgs: r.PropTypes.arrayOf(r.PropTypes.instanceOf(o)).isRequired,
            udpateType: r.PropTypes.oneOf(_.values(f)),
            unreadCount: r.PropTypes.number,
            selectable: r.PropTypes.bool,
            onMessageSelect: r.PropTypes.func.isRequired,
            focusedMsgCtx: r.PropTypes.object,
            didRenderFocusedMsg: r.PropTypes.func,
            selectedMessages: r.PropTypes.objectOf(r.PropTypes.instanceOf(o))
        },
        shouldComponentUpdate: function(e) {
            return e.updateType !== f.NONE
        },
        scrollBottom: function(e, t) {
            (t || this.shouldScrollBottom !== !1 && !this.props.focusedMsgCtx) && (e.scrollTop = e.scrollHeight)
        },
        componentWillUpdate: function(e, t) {
            var n = i.findDOMNode(this).parentNode
              , r = e.updateType;
            r === f.KEEP_SCROLL_BOTTOM ? this.shouldRestoreScroll = n.scrollHeight - n.scrollTop - n.clientHeight : r === f.KEEP_SCROLL_TOP && (this.shouldRestoreScroll = n.scrollTop)
        },
        componentDidUpdate: function(e, t) {
            var n = i.findDOMNode(this).parentNode;
            this.props.updateType === f.SCROLL_BOTTOM ? n.scrollTop = n.scrollHeight : _.isUndefined(this.shouldRestoreScroll) || (this.props.updateType === f.KEEP_SCROLL_BOTTOM ? n.scrollTop = n.scrollHeight - this.shouldRestoreScroll - n.clientHeight : n.scrollTop = this.shouldRestoreScroll,
            this.shouldRestoreScroll = void 0)
        },
        onCopy: function(e) {
            var t = window.getSelection();
            e.clipboardData.setData("text/plain", p.asPlainText(t)),
            e.stopPropagation(),
            e.preventDefault()
        },
        getMsgVisibility: function(e) {
            var t = i.findDOMNode(this).parentNode
              , n = t.scrollTop
              , r = n + t.clientHeight
              , o = i.findDOMNode(e);
            return o.offsetTop + o.clientHeight <= n ? h.VISIBILITY.ABOVE : o.offsetTop >= r ? h.VISIBILITY.BELOW : h.VISIBILITY.VISIBLE
        },
        render: function() {
            var e, t, n = [], i = this.props.msgs, l = this.props, p = l.focusedMsgCtx, f = l.unreadCount, m = l.selectedMessages, g = !1, v = void 0, y = 0;
            for (t = 0; t < i.length; t++)
                if (e = i[t]) {
                    var E = d.dayOfMsg(e);
                    0 !== t && v === E || (n.push(r.createElement(a, {
                        ref: "dateMarker_" + y,
                        key: "msg-" + e.id + "-date",
                        timestamp: e.t
                    })),
                    g = !1,
                    y += 1),
                    v = E,
                    f > 0 && p && p.isUnreadDivider && p.msg === e && (n.push(r.createElement("div", {
                        className: "msg-unread",
                        key: "msg-unread"
                    }, r.createElement(s, {
                        count: f
                    }))),
                    g = !1);
                    var b = _.matches({
                        from: e.from,
                        startOfDay: e.startOfDay
                    })
                      , S = _.matches({
                        author: e.author,
                        startOfDay: e.startOfDay
                    })
                      , M = e.isGroupMsg ? S : b
                      , C = c.Position.SINGLE
                      , T = i[t + 1];
                    (T && f && p && p.isUnreadDivider && p.msg === T || T && T.isNotification || T && E !== d.dayOfMsg(T)) && (T = !1),
                    e.isNotification ? C = c.Position.SINGLE : M(T) && !M(g) ? C = c.Position.FRONT : M(g) && M(T) ? C = c.Position.MID : M(g) && !M(T) && (C = c.Position.END);
                    var w = p && p.msg === e
                      , k = w && p.highlightMsg
                      , x = m && e.id in m
                      , N = e.type === o.TYPE.IMAGE || e.type === o.TYPE.VIDEO || e.type === o.TYPE.AUDIO;
                    n.push(r.createElement(c, {
                        key: "msg-" + e.id,
                        ref: e.id.toString(),
                        msg: e,
                        displayType: h.DISP_TYPE.CONVERSATION,
                        isMsgVisible: N ? this.props.isMsgVisible : _.noop,
                        selectable: this.props.selectable,
                        selected: x,
                        onMessageSelect: this.props.onMessageSelect,
                        position: C,
                        isFocusedMsg: w,
                        highlight: k,
                        didRenderFocusedMsg: this.props.didRenderFocusedMsg
                    })),
                    g = !e.isNotification && e
                }
            var P = u("message-list", {
                selectable: this.props.selectable
            });
            return r.createElement("div", {
                className: P,
                onCopy: this.onCopy
            }, n)
        }
    });
    g.UpdateType = f,
    g.UpdateTypePriority = m,
    e.exports = g
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(1)
      , c = n(9)
      , l = n(988)
      , u = n(992)
      , d = n(134)
      , p = n(138)
      , h = n(14)
      , f = n(1014)
      , m = n(1040)
      , g = n(1289)
      , v = n(0)
      , y = n(209)
      , E = n(102)
      , b = a.createClass({
        displayName: "PTT",
        mixins: [p, d, u],
        propTypes: {
            chat: a.PropTypes.instanceOf(l),
            onStateChange: a.PropTypes.func.isRequired
        },
        statics: {
            READY: "ready",
            DELAY: "delay",
            REC: "recording",
            PROCESSSING: "processsing",
            GUM_TIMEOUT: "ptt_gum_timeout",
            PERMISSION_DENIED: "permission_denied",
            NOT_SUPPORTED_ERROR: "not_supported_error",
            MANDATORY_UNSATISFIED_ERROR: "mandatory_unsatisfied_error",
            CANCEL: "cancel",
            SEND: "send"
        },
        getInitialState: function() {
            return {
                state: b.READY,
                active: void 0,
                elapsedTime: 0,
                startTime: 0
            }
        },
        componentDidMount: function() {
            this.regNativeListener(window, "blur", this.cancelRecording)
        },
        isRecording: function() {
            var e = this.state.state;
            return e === b.REC || e === b.DELAY || e === b.PROCESSSING
        },
        cancelRecording: function() {
            this.isRecording() && (this.state.state !== b.READY && this.props.onStateChange(b.READY),
            this.safeIsMounted() && this.setState({
                state: b.READY,
                active: void 0,
                elapsedTime: 0,
                startTime: 0
            }),
            this.clearSafeInterval(this.elapsedTimeInterval),
            delete this.elapsedTimeInterval,
            this.recorder && this.recorder.stop(),
            this.props.chat.markPaused())
        },
        startInterval: function() {
            var e = this;
            this.elapsedTimeInterval = this.safeInterval(function() {
                e.setState({
                    elapsedTime: e.state.elapsedTime + 1
                })
            }, 1e3),
            this.setState({
                elapsedTime: 0,
                startTime: Date.now()
            })
        },
        cancelPTTTimer: function() {
            this.pttTimer && (this.clearSafeTimeout(this.pttTimer),
            delete this.pttTimer)
        },
        onPTTReady: function() {
            delete this.pttTimer,
            this.state.state === b.DELAY && this.setState({
                state: b.REC
            })
        },
        onMouseOverSend: function() {
            this.setState({
                active: b.SEND
            })
        },
        onMouseOutSend: function() {
            this.setState({
                active: void 0
            })
        },
        onMouseOverCancel: function() {
            this.setState({
                active: b.CANCEL
            })
        },
        onMouseOutCancel: function() {
            this.setState({
                active: void 0
            })
        },
        onMouseUpCancel: function() {
            this.state.elapsedTime < 1 || (this.cancelPTTTimer(),
            this.cancelRecording())
        },
        onMouseUpSend: function() {
            var e = this;
            if (!(this.state.elapsedTime < 1)) {
                this.cancelPTTTimer();
                var t = this.props.chat;
                if (this.state.state === b.REC) {
                    this.setState({
                        state: b.PROCESSSING
                    }),
                    this.props.onStateChange(b.READY);
                    var n = t.regCancellablePromise(new o["default"](function(t, n) {
                        e.recorder.addEventListener("dataAvailable", function(e) {
                            t(e.detail)
                        })
                    }
                    ));
                    t.sendPTT(n, ~~this.recorder.duration, t.composeQuotedMsg),
                    t.composeQuotedMsg = null ,
                    n["catch"](o["default"].CancellationError, _.noop)["finally"](function(t) {
                        e.recorder.removeEventListener("dataAvailable"),
                        e.cancelRecording()
                    }),
                    this.recorder.stop()
                } else
                    this.cancelRecording(),
                    s.log("ptt:onMouseUpSend duration too short")()
            }
        },
        onMouseDown: function() {
            var e = this;
            if (this.state.state === b.READY) {
                var t = m.start("microphone");
                o["default"].race([t, this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(t) {
                    e.recorder = new g({
                        bitRate: 16e3,
                        encoderSampleRate: 16e3,
                        encoderApplication: 2048
                    }),
                    e.recorder.initStream(t),
                    e.recorder.start(),
                    e.props.chat.presence.update()["catch"](h.WapDrop, _.noop),
                    e.props.chat.markRecording(),
                    e.setState({
                        state: b.DELAY
                    }),
                    e.props.onStateChange(b.REC),
                    e.pttTimer = e.safeDelay(e.onPTTReady, 1500),
                    e.startInterval()
                })["catch"](h.Unmount, function() {
                    t.then(function(e) {
                        return m.stop(e)
                    })["catch"](_.noop)
                })["catch"](h.GUM.PermissionDeniedError, function() {
                    c.openModal(a.createElement(f, {
                        title: "guide_desktop_mic_title",
                        desc: "guide_desktop_mic_fail_description",
                        type: f.TYPE.GUIDE_UNBLOCK
                    }))
                })["catch"](h.GUM.GUMError, function() {
                    c.openModal(a.createElement(f, {
                        title: "guide_desktop_mic_missing_title",
                        desc: "guide_desktop_mic_missing_description",
                        type: f.TYPE.GUIDE_NONE
                    }))
                })["catch"](function(t) {
                    e.recorder && e.recorder.stop(),
                    s.error("PTT Recording Error")(t)
                })
            }
        },
        render: function() {
            var e = "btn-close btn-border ptt-close";
            this.state.active === b.CANCEL && (e += " is-hover");
            var t = "btn-border ptt-send";
            this.state.active === b.SEND && (t += " is-hover");
            var n = void 0;
            this.state.state !== b.DELAY && this.state.state !== b.REC || (n = a.createElement(y, {
                displayName: "PTT",
                popable: !0,
                escapable: !0,
                requestDismiss: this.cancelRecording
            }, a.createElement("div", {
                className: "ptt-recording",
                key: "recording"
            }, a.createElement("button", {
                className: e,
                onMouseOver: this.onMouseOverCancel,
                onMouseOut: this.onMouseOutCancel,
                onMouseUp: this.onMouseUpCancel
            }, a.createElement("span", {
                className: "icon icon-round-x btn-state-default"
            }), a.createElement("span", {
                className: "icon icon-round-x-inv btn-state-hover"
            })), a.createElement("div", {
                className: "ptt-counter"
            }, v.unix(this.state.elapsedTime).format("m:ss")), a.createElement("button", {
                className: t,
                onMouseOver: this.onMouseOverSend,
                onMouseOut: this.onMouseOutSend,
                onMouseUp: this.onMouseUpSend
            }, a.createElement("span", {
                className: "icon icon-round-send btn-state-default"
            }), a.createElement("span", {
                className: "icon icon-round-send-inv btn-state-hover"
            })))));
            var r = this.state.state === b.READY || this.state.state === b.PROCESSSING ? a.createElement("button", {
                className: "icon btn-icon icon-ptt",
                onMouseDown: this.onMouseDown,
                disabled: this.state.state === b.PROCESSSING,
                key: "button"
            }) : null
              , i = "ptt-container";
            return n && (i += " active"),
            a.createElement("div", {
                className: i
            }, a.createElement(E, {
                transitionName: "ptt"
            }, n || r))
        }
    });
    e.exports = b
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(988)
      , c = n(429)
      , l = n(9)
      , u = n(133)
      , d = n(46)
      , p = a.createClass({
        displayName: "Spam",
        mixins: [u],
        propTypes: {
            chat: a.PropTypes.instanceOf(s).isRequired
        },
        componentWillMount: function() {
            this.addObserver(Store.Blocklist, "add remove reset"),
            this.addObserver(this.props.chat, "change:trusted")
        },
        confirmReportGroupSpam: function() {
            l.openModal(a.createElement(c, {
                onOK: this.reportGroupSpam,
                okText: l10n.t("report_group_spam"),
                onCancel: l.closeModal.bind(l),
                cancelText: l10n.t("web_cancel")
            }, l10n.t("report_group_spam_ack")))
        },
        reportGroupSpam: function() {
            var e = this.props.chat
              , t = e.sendSpamReport(!0);
            if (!e.isReadOnly) {
                var n = e.sendExit()
                  , r = d.waitForBBEvent(e.msgs, "change:last", function(e) {
                    return e.isGroupLeave()
                });
                t = o["default"].all([t, n, r])
            }
            t.then(function() {
                return e.sendDelete()
            })["catch"](_.noop),
            l.closeModal()
        },
        confirmReportSpam: function() {
            l.openModal(a.createElement(c, {
                onOK: this.reportSpam,
                okText: l10n.t("report_spam"),
                onCancel: l.closeModal.bind(l),
                cancelText: l10n.t("web_cancel")
            }, l10n.t("report_spam_ack")))
        },
        reportSpam: function() {
            var e = this.props.chat;
            e.sendSpamReport().then(function() {
                return e.contact.setBlock(!0)
            }).then(function() {
                return e.sendDelete()
            })["catch"](_.noop),
            l.closeModal()
        },
        notSpam: function() {
            this.props.chat.sendNotSpam(!0)["catch"](_.noop)
        },
        confirmBlock: function() {
            l.openModal(a.createElement(c, {
                onOK: this.block,
                okText: l10n.t("block"),
                onCancel: l.closeModal.bind(l),
                cancelText: l10n.t("web_cancel")
            }, l10n.t("block_ack")))
        },
        block: function() {
            this.props.chat.contact.setBlock(!0)["catch"](_.noop),
            l.closeModal()
        },
        confirmUnblock: function() {
            l.openModal(a.createElement(c, {
                okText: l10n.t("unblock_button"),
                onOK: this.unblock,
                cancelText: l10n.t("web_cancel"),
                onCancel: l.closeModal.bind(l)
            }, l10n.t("unblock_confirmation", {
                contact: this.props.chat.contact.formattedName
            })))
        },
        unblock: function() {
            this.props.chat.contact.setBlock(!1)["catch"](_.noop),
            l.closeModal()
        },
        render: function() {
            var e = this.props.chat;
            if (e.isPSA || !e.isVisible || e.trusted)
                return null ;
            var t, n = [];
            if (e.isGroup)
                t = l10n.t("group_admin_not_a_contact"),
                n.push(a.createElement("button", {
                    className: "spam-button btn-plain",
                    key: "report_spam",
                    onClick: this.confirmReportGroupSpam
                }, l10n.t("report_group_spam")));
            else {
                t = l10n.t("sender_not_a_contact"),
                n.push(a.createElement("button", {
                    className: "spam-button btn-plain",
                    key: "report_spam",
                    onClick: this.confirmReportSpam
                }, l10n.t("report_spam")));
                var r = Store.Blocklist.get(e.id);
                r ? n.push(a.createElement("button", {
                    onClick: this.confirmUnblock,
                    key: "unblock",
                    className: "spam-button btn-plain"
                }, l10n.t("unblock_button"))) : n.push(a.createElement("button", {
                    onClick: this.confirmBlock,
                    key: "block",
                    className: "spam-button btn-plain"
                }, l10n.t("block")))
            }
            return n.push(a.createElement("button", {
                onClick: this.notSpam,
                key: "not_spam",
                className: "spam-button btn-plain"
            }, l10n.t("not_spam"))),
            a.createElement("div", {
                className: "spam"
            }, a.createElement("div", {
                className: "spam-text"
            }, t), a.createElement("div", {
                className: "spam-controls"
            }, n))
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(37)
      , c = n(135)
      , l = c.HotKeys
      , u = n(133)
      , d = n(81)
      , p = n(988)
      , h = n(1017)
      , f = n(1168)
      , m = n(1169)
      , g = n(1089)
      , v = n(1109)
      , y = n(9)
      , E = n(56)
      , b = n(102)
      , S = n(987)
      , M = n(10)
      , C = n(1137)
      , T = n(209)
      , w = a.createClass({
        displayName: "ConversationPanel",
        mixins: [u, S, d],
        propTypes: {
            chat: a.PropTypes.instanceOf(p).isRequired,
            msgCollection: a.PropTypes.instanceOf(h).isRequired,
            focusCtx: a.PropTypes.object
        },
        getInitialState: function() {
            var e = this.props.chat;
            return this.fillerHeight = e.fillerHeight || 0,
            {
                canCompose: e.canSend,
                selectable: !1,
                selectedMessages: {},
                wallpaperColor: this.async("chat.ChatPreference.wallpaperColor")
            }
        },
        componentWillMount: function() {
            var e = this.props.chat;
            e.fillerHeight = null ,
            this.addObserver(e, "change:canSend", this.onComposeState),
            this.openEvent = new E.WebcChatOpen({
                webcUnreadCount: e.unreadCount
            })
        },
        componentDidMount: function() {
            var e = this.props.chat;
            e.set({
                active: !0,
                viewed: !0
            }),
            this.openEvent && (this.openEvent.markWebcChatOpenT(),
            this.openEvent.commit(),
            delete this.openEvent),
            this.addObserver(Store.ChatPreference, "wallpaper_color_preview", this.onWallpaperColorPreview),
            this.regCmd("scroll_messages", this.scrollMessages)
        },
        componentWillUnmount: function() {
            this.props.chat.set("active", !1)
        },
        onComposeState: function() {
            var e = this.props.chat.canSend;
            this.state.canCompose !== e && this.setState({
                canCompose: e
            })
        },
        onComposeHeightChange: function(e, t) {
            var n = this
              , r = e.input
              , i = e.overlay
              , a = s.findDOMNode(this.refs.msgPanel);
            if (a && this.refs.msgs) {
                var c = this.refs.msgs.getScrollBottom();
                if (_.isNumber(r))
                    return void this.refs.msgs.composeHeightChange(r);
                if (t)
                    return this.fillerHeight = i,
                    void (this.refs.filler && (this.refs.filler.style.height = this.fillerHeight + "px",
                    this.refs.msgs.setScrollBottom(c)));
                this.fillerHeight += i,
                i < 0 && (this.refs.filler && (this.refs.filler.style.height = this.fillerHeight + "px"),
                this.refs.msgs && this.refs.msgs.setScrollBottom(c)),
                this.msgPanelAnimation || (this.msgPanelAnimation = o["default"].resolve()),
                this.msgPanelAnimation.cancel(),
                this.msgPanelAnimation = this.msgPanelAnimation.then(function() {
                    return Velocity(a, {
                        translateY: i > 0 ? [-i, 0] : [0, i]
                    }, {
                        duration: 300,
                        easing: [.1, .82, .25, 1]
                    })
                }).then(function() {
                    return n.msgPanelAnimation = null
                }).cancellable()["catch"](o["default"].CancellationError, function() {
                    Velocity(a, "finish", !0),
                    a.style.transform = ""
                }).then(function() {
                    n.isMounted() && (i > 0 && n.refs.filler && (n.refs.filler.style.height = n.fillerHeight + "px"),
                    a.style.transform = "",
                    n.refs.msgs && i > 0 && n.refs.msgs.setScrollBottom(c))
                })
            }
        },
        onWallpaperColorPreview: function(e) {
            e ? this.state.wallpaperColor !== e && this.setState({
                wallpaperColor: e
            }) : this.setState({
                wallpaperColor: Store.ChatPreference.get("defaultPreference").wallpaperColor
            })
        },
        onSelectMessages: function() {
            this.state.selectable || this.setState({
                selectable: !0
            })
        },
        onCancelSelection: function() {
            this.state.selectable && this.setState({
                selectable: !1,
                selectedMessages: {}
            })
        },
        onMessageSelect: function(e, t) {
            this.onSelectMessages();
            var n = _.clone(this.state.selectedMessages);
            t ? n[e.id] = e : delete n[e.id],
            this.setState({
                selectedMessages: n
            })
        },
        onPageUpDown: function(e) {
            this.refs.msgs.onPageUpDown(e)
        },
        scrollMessages: function() {
            var e = this.refs.msgs
              , t = e && e.refs.scrollContainer;
            if (t) {
                var n = _.last(e.msgListInfo.visibleMsgOrder);
                if (n) {
                    var r = s.findDOMNode(e.refs.messageList.refs[n.toString()]);
                    if (r) {
                        var i = 0;
                        1 === e.msgListInfo.visibleMsgOrder.length && (i = r.clientHeight),
                        Velocity(r, "stop"),
                        Velocity(t, "stop"),
                        Velocity(r, "scroll", {
                            duration: 300,
                            container: t,
                            offset: i
                        })
                    }
                }
            }
        },
        onDragStart: function(e) {
            this.state.canCompose && (this.blockDrop = !0)
        },
        onDragEnd: function(e) {
            this.state.canCompose && (this.blockDrop = !1)
        },
        onDragEnter: function(e) {
            this.state.canCompose && !this.blockDrop && (_.includes(e.dataTransfer.types, "Files") || _.includes(e.dataTransfer.types, "text/uri-list") || _.includes(e.dataTransfer.types, "text/html")) && (y.attachMediaDrawer(this.props.chat),
            e.stopPropagation(),
            e.preventDefault())
        },
        render: function() {
            var e, t, n, r = this.props, i = r.chat, o = r.msgCollection, s = r.focusCtx;
            if (this.state.selectable)
                t = a.createElement(T, {
                    displayName: "MultiSelect",
                    escapable: !0,
                    requestDismiss: this.onCancelSelection
                }, a.createElement(v, {
                    chat: i,
                    selectedMessages: _.values(this.state.selectedMessages),
                    onCancel: this.onCancelSelection
                })),
                e = a.createElement("footer", {
                    className: "pane-footer pane-chat-footer"
                }),
                n = a.createElement("div", {
                    ref: "filler",
                    className: "compose-filler"
                });
            else if (this.state.canCompose)
                e = a.createElement(g, {
                    chat: i,
                    ref: "composeBox",
                    onComposeHeightChange: this.onComposeHeightChange,
                    onPageUpDown: this.onPageUpDown
                }),
                n = a.createElement("div", {
                    ref: "filler",
                    style: {
                        height: this.fillerHeight + "px"
                    },
                    className: "compose-filler"
                });
            else {
                var c;
                c = i.isGroup ? l10n.t("web_cannot_send_not_a_group_participant") : i.isPSA ? l10n.t("web_psa_title") : l10n.t("web_cannot_send_to_blocked_contact_1", {
                    contact: i.contact.formattedName
                }),
                e = a.createElement("footer", {
                    className: "pane-footer pane-chat-footer"
                }, a.createElement("div", {
                    className: "block-message"
                }, c))
            }
            var u = {}
              , d = {};
            return this.state.wallpaperColor !== M.DEFAULT_CHAT_WALLPAPER && (u.background = this.state.wallpaperColor,
            u.transition = "background 0.3s ease",
            d.display = "none"),
            a.createElement(T, {
                displayName: "ConversationPanel",
                state: T.State.INACTIVE,
                requestFocus: this.requestFocus
            }, a.createElement(l, {
                id: "main",
                className: "pane pane-chat pane-two",
                onDragStart: this.onDragStart,
                onDragEnd: this.onDragEnd,
                onDragOver: this.onDragOver,
                onDragEnter: this.onDragEnter
            }, a.createElement("div", {
                className: "pane-chat-tile",
                style: d
            }), a.createElement(f, {
                chat: i,
                canAttach: this.state.canCompose,
                onSelectMessages: this.onSelectMessages
            }), a.createElement("div", {
                className: "pane-body pane-chat-tile-container",
                ref: "msgPanel",
                style: u
            }, a.createElement(m, {
                ref: "msgs",
                chat: i,
                selectable: this.state.selectable,
                onMessageSelect: this.onMessageSelect,
                msgCollection: o,
                onSelectMessages: this.onSelectMessages,
                focusCtx: s,
                selectedMessages: this.state.selectedMessages
            })), n, e, a.createElement(b, {
                transitionName: "slide-up"
            }, t), a.createElement(C, null )))
        }
    });
    e.exports = w
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(102)
      , o = n(81)
      , a = n(209)
      , s = n(43)
      , c = n(897)
      , l = n(31)
      , u = n(67)
      , d = {
        LEFT: "drawer-left",
        MID: "slide-up",
        RIGHT: "slide-left",
        NONE: "none"
    }
      , p = {
        LEFT: "left",
        MID: "mid",
        RIGHT: "right"
    }
      , h = function(e) {
        return d[e.toUpperCase()]
    }
      , f = r.createClass({
        displayName: "DrawerManager",
        mixins: [o],
        propTypes: {
            direction: r.PropTypes.oneOf(l.values(p)),
            onDrawerIn: r.PropTypes.func,
            onDrawerOut: r.PropTypes.func,
            onDrawerAnimationComplete: r.PropTypes.func
        },
        getChildContext: function() {
            var e = this.state.uim || this.context.uim;
            return {
                uim: e
            }
        },
        getInitialState: function() {
            return {
                drawer: void 0,
                drawerId: 0,
                transition: h(this.props.direction),
                uim: void 0
            }
        },
        componentWillMount: function() {
            this.regCmd("open_drawer_" + this.props.direction, this.openFlow),
            this.regCmd("exists_drawer_" + this.props.direction, this.existsFlow),
            this.regCmd("close_drawer_" + this.props.direction, this.closeFlow)
        },
        shouldComponentUpdate: function(e, t) {
            return c(this, e, t)
        },
        openFlow: function(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] ? h(this.props.direction) : arguments[1]
              , n = arguments[2];
            this.state.drawer ? t = d.NONE : this.props.onDrawerIn && this.props.onDrawerIn();
            var r = l.uniqueId("DrawerManager" + this.props.direction);
            this.setState({
                drawer: e,
                drawerId: r,
                transition: t,
                uim: n
            })
        },
        existsFlow: function(e) {
            e(!!this.state.drawer)
        },
        closeFlow: function(e) {
            this.state.drawerId === e && this.state.drawer && (this.props.onDrawerOut && this.props.onDrawerOut(),
            this.setState({
                drawer: void 0
            }))
        },
        render: function() {
            var e = this.props
              , t = e.onDrawerAnimationComplete
              , n = e.direction
              , o = this.state
              , c = o.drawer
              , u = o.drawerId
              , d = o.transition;
            c && (c = r.createElement(a, {
                displayName: "Drawer" + l.upperFirst(n),
                escapable: !0,
                key: u,
                requestDismiss: this.closeFlow.bind(null , u)
            }, c));
            var h = s("pane", {
                "pane-one": n === p.LEFT,
                "pane-two": n === p.MID,
                "pane-three": n === p.RIGHT
            });
            return r.createElement(i, {
                transitionName: d,
                className: h,
                onAnimationComplete: t
            }, c)
        }
    });
    f.contextTypes = {
        uim: r.PropTypes.instanceOf(u)
    },
    f.childContextTypes = {
        uim: r.PropTypes.instanceOf(u)
    },
    f.Dir = p,
    f.Transition = d,
    e.exports = f
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(81)
      , o = n(134)
      , a = n(138)
      , s = n(432)
      , c = n(1043)
      , l = n(53)
      , u = n(444)
      , d = n(139)
      , p = n(895)
      , h = r.createClass({
        displayName: "EmojiInput",
        mixins: [i, o, a],
        propTypes: {
            focusOnMount: r.PropTypes.bool,
            editable: r.PropTypes.bool,
            format: r.PropTypes.bool,
            value: r.PropTypes.string,
            selection: r.PropTypes.object,
            className: r.PropTypes.string,
            placeholder: r.PropTypes.string,
            onKeyPress: r.PropTypes.func,
            onEnter: r.PropTypes.func,
            onChange: r.PropTypes.func,
            onFocus: r.PropTypes.func,
            onBlur: r.PropTypes.func,
            onFiles: r.PropTypes.func,
            onMouseDown: r.PropTypes.func,
            onSelectionChange: r.PropTypes.func,
            maxLength: r.PropTypes.number,
            multiline: r.PropTypes.bool,
            spellCheck: r.PropTypes.bool,
            focusOnChange: r.PropTypes.bool
        },
        getDefaultProps: function() {
            return {
                editable: !0,
                format: !1,
                value: "",
                focusOnChange: !0
            }
        },
        getInitialState: function() {
            return this.value = this.props.value || "",
            this.selection = this.props.selection,
            null
        },
        componentWillMount: function() {
            this.debouncedSaveSelection = this.safeDebounce(this._saveSelection, 0)
        },
        componentWillReceiveProps: function(e) {
            if (e.value !== this.value && (this.setNewValue(e.value || "", !1),
            this.updateDOM(),
            this.props.focusOnChange && this.safeDefer(this.restoreFocus.bind(this, !0))),
            this.props.editable !== e.editable) {
                var t = this.refs.input;
                t.contentEditable = e.editable,
                e.editable && this._disableObjectResize()
            }
        },
        restoreFocus: function(e) {
            if (this.props.editable) {
                var t = this.refs.input;
                document.activeElement !== t && (d.focus(t),
                this.selection && !e ? this.restoreSelection(this.selection) : this._moveCursorToEnd(t),
                this.debouncedSaveSelection())
            }
        },
        _moveCursorToEnd: function(e) {
            if (e) {
                var t = window.getSelection();
                t && (t.selectAllChildren(e),
                t = window.getSelection(),
                t && t.rangeCount && t.collapseToEnd())
            }
        },
        componentDidMount: function() {
            this.props.focusOnMount && this.safeDefer(this.restoreFocus),
            this.props.editable && this._disableObjectResize(),
            this.refs.input.restoreFocus = this.restoreFocus,
            this.refs.input.pasteText = this.pasteText
        },
        componentWillUnmount: function() {
            this.refs.input.restoreFocus = null
        },
        _disableObjectResize: function() {
            l.isGecko && document.execCommand("enableObjectResizing", !1, !1)
        },
        limitLength: function(e) {
            var t = this.props.maxLength;
            if (!t)
                return e;
            e = e || "";
            var n = this.selectionLength()
              , r = n + t - c.multibyteLength(this.value);
            return r > 0 ? c.multibyteSubstr(e, 0, r) : ""
        },
        onMouseDown: function(e) {
            e.stopPropagation(),
            this.regNativeListener(window, "mouseup", this.onWindowMouseUp),
            this.props.onMouseDown && this.props.onMouseDown(e)
        },
        onWindowMouseUp: function() {
            this.unregNativeListener(window, "mouseup", this.onWindowMouseUp),
            this.debouncedSaveSelection()
        },
        onContextMenu: function(e) {
            e.stopPropagation()
        },
        onKeyUp: function(e) {
            if (l.isTrident && this.onInput(e),
            "Backspace" === e.key || "Delete" === e.key) {
                var t = this.refs.input;
                switch (t.innerHTML) {
                case "\n":
                case "\r\n":
                case "<br>":
                    t.innerHTML = "",
                    this.setNewValue("", !0, !0)
                }
            }
            this.debouncedSaveSelection()
        },
        onKeyPress: function(e) {
            if (l.isTrident && this.onInput(e),
            !this.props.onKeyPress || (this.props.onKeyPress(e),
            !e.defaultPrevented)) {
                var t = e.ctrlKey || e.shiftKey || e.altKey;
                if (!this.props.multiline && "Enter" === e.key || this.props.multiline && "Enter" === e.key && !t)
                    return e.preventDefault(),
                    void (this.props.onEnter && this.props.onEnter(e));
                var n = this.limitLength(u.ucs2.encode([e.charCode]));
                this.props.multiline && "Enter" === e.key && t && (this.replaceSelection("\n", !0),
                e.preventDefault()),
                n.length || e.preventDefault()
            }
        },
        onInput: function(e) {
            var t = this.refs.input;
            e = _.isBoolean(e) ? e : void 0,
            this.setNewValue(s.NodeToEmoji(t), !0, e)
        },
        setNewValue: function(e, t, n) {
            if (e !== this.value || n) {
                if (e && !this.value) {
                    var r = this.refs.placeholder;
                    r && (r.style.display = "none")
                } else if (this.value && !e) {
                    var i = this.refs.placeholder;
                    i && (i.style.display = "")
                }
                this.value = e,
                t && this.props.onChange && this.props.onChange({
                    target: {
                        value: e
                    }
                }),
                this.debouncedSaveSelection()
            }
        },
        updateDOM: function() {
            var e = s.emojiToHTML(_.escape(this.value))
              , t = this.refs.input;
            t.innerHTML !== e && (t.innerHTML = e)
        },
        selectionLength: function() {
            if (!this.props.editable)
                return 0;
            var e = this.refs.input;
            d.focus(e);
            var t = window.getSelection();
            if (t.rangeCount) {
                var n = t.getRangeAt(0);
                return c.multibyteLength(s.NodeToEmoji(n.cloneContents()))
            }
            return 0
        },
        _saveSelection: function() {
            var e = this.getSelection();
            _.isEqual(e, this.prevSelection) || (this.props.onSelectionChange && this.props.onSelectionChange(e),
            this.prevSelection = this.selection,
            this.selection = e)
        },
        isCollapsed: function() {
            if (this.isMounted()) {
                var e = this.refs.input;
                if (document.activeElement !== e)
                    return null ;
                var t = window.getSelection();
                return t.isCollapsed
            }
        },
        getCursor: function() {
            if (!this.isMounted())
                return -1;
            var e = this.refs.input;
            if (document.activeElement !== e)
                return null ;
            var t = window.getSelection()
              , n = t.anchorNode
              , r = t.anchorOffset
              , i = e.childNodes
              , o = 0;
            e === n && (n = i[r]);
            for (var a = 0; a < i.length; a++) {
                var s = i[a];
                if (s === n)
                    return o + r;
                s.nodeType === window.Node.ELEMENT_NODE && s.alt ? o += s.alt.length : s.nodeType === window.Node.TEXT_NODE && (o += s.length)
            }
            return o
        },
        isAtBeginning: function() {
            return this.isCollapsed() && 0 === this.getCursor()
        },
        isAtEnd: function() {
            return this.isCollapsed() && this.getCursor() === this.value.length
        },
        getSelection: function() {
            if (!this.isMounted())
                return null ;
            var e = this.refs.input;
            if (document.activeElement !== e)
                return null ;
            for (var t = window.getSelection(), n = t.anchorNode, r = t.anchorOffset, i = t.focusNode, o = t.focusOffset, a = e.childNodes, s = -1, c = -1, l = !1, u = !1, d = 0; d < a.length; d++) {
                var p = a[d];
                if (p === n && (s = d,
                l = !0),
                p === i && (c = d,
                u = !0),
                l && u)
                    break
            }
            return {
                anchor: {
                    index: s,
                    offset: r
                },
                focus: {
                    index: c,
                    offset: o
                }
            }
        },
        restoreSelection: function(e) {
            var t, n, r, i, o, a, s = this.refs.input, c = s.childNodes;
            e.anchor.index === -1 ? (t = s,
            r = e.anchor.offset,
            o = 0) : (t = c[e.anchor.index],
            r = e.anchor.index,
            o = e.anchor.offset),
            e.focus.index === -1 ? (n = s,
            i = e.focus.offset,
            a = 0) : (n = c[e.focus.index],
            i = e.focus.index,
            a = e.focus.offset);
            var u;
            u = r === i ? a >= o ? "forward" : "reverse" : r > i ? "reverse" : "forward";
            var d = window.getSelection();
            if (t && n)
                try {
                    var p = document.createRange();
                    return void (l.isTrident ? ("forward" === u ? (p.setStart(t, e.anchor.offset),
                    p.setEnd(n, e.focus.offset)) : (p.setStart(n, e.focus.offset),
                    p.setEnd(t, e.anchor.offset)),
                    d.removeAllRanges(),
                    d.addRange(p)) : (p.setStart(t, e.anchor.offset),
                    d.removeAllRanges(),
                    d.addRange(p),
                    d.extend(n, e.focus.offset)))
                } catch (h) {
                    this._moveCursorToEnd(s)
                }
            else
                this._moveCursorToEnd(s)
        },
        onCut: function(e) {
            l.isTrident && this.onInput(e)
        },
        onPaste: function(e) {
            if (!e.defaultPrevented) {
                e.preventDefault();
                var t = new p(e.clipboardData);
                if (t.hasFiles())
                    return e.stopPropagation(),
                    this.props.onFiles && this.props.onFiles(t);
                var n = l.isTrident ? "text" : "text/plain"
                  , r = e.clipboardData.getData(n);
                this.pasteText(r)
            }
        },
        pasteText: function(e) {
            e && (this.props.maxPaste && e.length > this.props.maxPaste ? this.props.onMaxPasteExceeded() : this.replaceSelection(e))
        },
        replaceSelection: function(e, t) {
            if (this.props.editable && (d.focus(this.refs.input),
            e = this.limitLength(e),
            0 !== e.length)) {
                this.props.multiline || (e = e.replace(/\n+/g, " ").replace(/(\r\n)+/g, " "));
                var n = window.getSelection()
                  , r = null ;
                n.getRangeAt && n.rangeCount && (r = n.getRangeAt(0),
                r.deleteContents());
                var i = this.refs.input
                  , o = i.scrollTop
                  , a = i.scrollHeight
                  , c = s.emojiToHTML(_.escape(e));
                l.isTrident ? r && this.replaceSelectionTrident(c, n, r) : t ? document.execCommand("insertText", !1, c) : document.execCommand("insertHTML", !1, c),
                this.onInput(!0),
                this.debouncedSaveSelection(),
                this.scrollToCursor(o, a)
            }
        },
        scrollToCursor: function(e, t) {
            var n = this.refs.input
              , r = n.scrollHeight
              , i = n.clientHeight;
            if (!(r <= i)) {
                var o = r - t;
                this.refs.input.scrollTop = (e || 0) + o
            }
        },
        replaceSelectionTrident: function(e, t, n) {
            var r = document.createElement("div");
            r.innerHTML = e;
            for (var i, o, a = document.createDocumentFragment(); i = r.firstChild; )
                o = a.appendChild(i);
            n.insertNode(a),
            o && (n = n.cloneRange(),
            n.setStartAfter(o),
            n.collapse(!0),
            t.removeAllRanges(),
            t.addRange(n))
        },
        shouldComponentUpdate: function() {
            return !1
        },
        render: function() {
            var e = s.emojiToHTML(_.escape(this.value))
              , t = this.props.className ? "input " + this.props.className : "input"
              , n = "input-emoji"
              , i = this.props.placeholder && !this.props.value ? r.createElement("div", {
                className: "input-placeholder",
                ref: "placeholder"
            }, this.props.placeholder) : null ;
            return r.createElement("div", {
                className: n
            }, i, r.createElement("div", {
                dangerouslySetInnerHTML: {
                    __html: e
                },
                dir: "auto",
                ref: "input",
                spellCheck: this.props.spellCheck,
                "data-tab": this.props.editable ? 1 : null ,
                contentEditable: this.props.editable,
                className: t,
                onInput: this.onInput,
                onPaste: this.onPaste,
                onCut: this.onCut,
                onKeyUp: this.onKeyUp,
                onKeyPress: this.onKeyPress,
                onMouseDown: this.onMouseDown,
                onContextMenu: this.onContextMenu,
                onFocus: this.props.onFocus,
                onBlur: this.props.onBlur
            }))
        }
    });
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(891)
      , o = r(i)
      , a = n(6)
      , s = n(1003)
      , c = n(429)
      , l = n(210)
      , u = n(989)
      , d = n(9)
      , p = n(1230)
      , h = a.createClass({
        displayName: "AddContactToGroupFlow",
        mixins: [s],
        propTypes: {
            contact: a.PropTypes.instanceOf(l).isRequired
        },
        getDefaultTransition: function() {
            var e;
            return e = {},
            (0,
            o["default"])(e, s.Dir.PUSH, s.Transition.NONE),
            (0,
            o["default"])(e, s.Dir.POP, s.Transition.NONE),
            e
        },
        filter: function(e) {
            var t = e.groupMetadata;
            return !(!e.isGroup || e.isGroup && !t.participants.iAmMember()) && (t.participants.get(this.props.contact.id) ? l10n.t("already_added_to_group") : !!t.participants.iAmAdmin() || l10n.t("chat_not_an_admin"))
        },
        componentWillMount: function() {
            this.push(a.createElement(p, {
                chats: Store.Chat.filter(function(e) {
                    return e.isGroup
                }),
                filter: this.filter,
                onCancel: this.pop,
                onGroup: this.confirmAddToGroup
            }))
        },
        confirmAddToGroup: function(e) {
            this.push(a.createElement(c, {
                onOK: this.addToGroup.bind(null , e),
                okText: l10n.t("add_group_participant"),
                onCancel: this.pop,
                cancelText: l10n.t("web_cancel")
            }, a.createElement(u, {
                text: l10n.t("confirm_add_group_participant", {
                    participant: this.props.contact.formattedName,
                    subject: e.contact.name
                })
            })))
        },
        addToGroup: function(e) {
            e.groupMetadata.participants.addParticipant(this.props.contact).then(function() {
                d.openChat(e)
            })["catch"](_.noop),
            this.endFlow()
        }
    });
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(891)
      , o = r(i)
      , a = n(6)
      , s = n(1003)
      , c = n(429)
      , l = n(1051)
      , u = n(988)
      , d = n(9)
      , p = n(989)
      , h = a.createClass({
        displayName: "AddGroupParticipantFlow",
        mixins: [s],
        propTypes: {
            chat: a.PropTypes.instanceOf(u).isRequired
        },
        getDefaultTransition: function() {
            var e;
            return e = {},
            (0,
            o["default"])(e, s.Dir.PUSH, s.Transition.NONE),
            (0,
            o["default"])(e, s.Dir.POP, s.Transition.NONE),
            e
        },
        componentWillMount: function() {
            this.push(a.createElement(l, {
                title: l10n.t("add_group_participant"),
                filter: this.contactFilter,
                onCancel: this._pop,
                onSelect: this.confirmAddParticipant
            }))
        },
        contactFilter: function(e) {
            var t = this.props.chat.groupMetadata;
            return !!Store.Contact.isFilteredContact(e) && (!t.participants.get(e.id) || l10n.t("already_added_to_group"))
        },
        confirmAddParticipant: function(e) {
            var t = this.onAddParticipant.bind(this, e)
              , n = l10n.t("confirm_add_group_participant", {
                participant: e.formattedName,
                subject: this.props.chat.contact.name
            });
            this.push(a.createElement(c, {
                onOK: t,
                okText: l10n.t("add_group_participant"),
                onCancel: this._pop,
                cancelText: l10n.t("web_cancel")
            }, a.createElement(p, {
                text: n
            })))
        },
        _pop: function() {
            this.pop()
        },
        onAddParticipant: function(e) {
            this.props.chat.groupMetadata.participants.addParticipant(e)["catch"](_.noop),
            d.closeModal()
        }
    });
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1003)
      , o = n(1101)
      , a = n(988)
      , s = n(1055)
      , c = r.createClass({
        displayName: "CaptureFlow",
        mixins: [i],
        propTypes: {
            chat: r.PropTypes.instanceOf(a).isRequired,
            stream: r.PropTypes.object.isRequired
        },
        componentWillMount: function() {
            this.push(r.createElement(o, {
                onBack: this.endFlow,
                caption: !0,
                onSend: this.sendMedia,
                stream: this.props.stream
            }))
        },
        sendMedia: function(e) {
            var t = e.file
              , n = e.caption
              , r = this.props.chat;
            s.prepFileForUpload(t).then(function(e) {
                n && (e.caption = n),
                r.sendMedia2([e], r.composeQuotedMsg),
                r.composeQuotedMsg = null
            }),
            this.endFlow()
        }
    });
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(891)
      , o = r(i)
      , a = n(6)
      , s = n(1228)
      , c = n(1003)
      , l = n(988)
      , u = a.createClass({
        displayName: "GroupInviteRevokeFlow",
        mixins: [c],
        propTypes: {
            chat: a.PropTypes.instanceOf(l).isRequired,
            onConfirm: a.PropTypes.func.isRequired
        },
        getDefaultTransition: function() {
            var e;
            return e = {},
            (0,
            o["default"])(e, c.Dir.PUSH, c.Transition.NONE),
            (0,
            o["default"])(e, c.Dir.POP, c.Transition.NONE),
            e
        },
        componentWillMount: function() {
            this.push(a.createElement(s, {
                chat: this.props.chat,
                onConfirm: this.props.onConfirm
            }))
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(10)
      , a = n(986)
      , s = n(9)
      , c = n(134)
      , l = n(992)
      , u = n(133)
      , d = n(1234)
      , p = n(1078)
      , h = n(136)
      , f = n(1)
      , m = n(101)
      , g = n(14)
      , v = n(43)
      , y = n(102)
      , E = r.createClass({
        displayName: "MediaViewerFlow",
        mixins: [c, l, u],
        propTypes: {
            msg: r.PropTypes.instanceOf(a).isRequired,
            getZoomNode: r.PropTypes.func
        },
        getInitialState: function() {
            this.zoomIn = !0;
            var e = this.props.msg;
            return this.mediaMsgs = e.chat.getMediaMsgs(e),
            {
                activeMsg: e,
                imgZoomed: !1
            }
        },
        componentWillMount: function() {
            this.regNativeListener(window, "keydown", this.onKeyDown)
        },
        componentDidMount: function() {
            var e = this;
            this.zoomIn = !1,
            this.addObserver(this.mediaMsgs, "remove reset", function(t, n, r) {
                if (e.mediaMsgs.indexOf(t) > -1 || e.state.activeMsg !== t)
                    return void e.forceUpdate();
                var i = r.index;
                0 === e.mediaMsgs.length ? e.endFlow() : e.mediaMsgs.length === i ? e.onSelectThumb(e.mediaMsgs.at(i - 1)) : e.onSelectThumb(e.mediaMsgs.at(i))
            }),
            this.addObserver(this.mediaMsgs, "query_media_after"),
            this.addObserver(this.mediaMsgs, "query_media_before", function() {
                var t = i.findDOMNode(e.refs.thumbs);
                t && (e.prevScrollWidth = t.scrollWidth,
                e.forceUpdate())
            }),
            this.scrollToActive(),
            Velocity(this.refs.thumbsContainer, {
                opacity: [1, 0],
                translateY: ["0%", "100%"]
            }, {
                duration: 300,
                delay: 100,
                easing: [.1, .82, .25, 1]
            })
        },
        componentDidUpdate: function(e, t) {
            if (t.activeMsg !== this.state.activeMsg)
                this.scrollToActive(!0);
            else {
                var n = i.findDOMNode(this.refs.thumbs);
                if (!n || !this.prevScrollWidth)
                    return;
                n.scrollLeft += n.scrollWidth - this.prevScrollWidth,
                this.prevScrollWidth = null
            }
        },
        onKeyDown: function(e) {
            37 === e.keyCode ? this.onPrev() : 39 === e.keyCode && this.onNext()
        },
        onScroll: function(e) {
            this.handleScroll(e.target)
        },
        handleScroll: _.throttle(function(e) {
            if (this.mediaMsgs.hasMediaBefore && e.scrollLeft < e.clientWidth) {
                var t = this.mediaMsgs.head();
                this.mediaMsgs.queryMedia(t.chat, t),
                this.forceUpdate()
            }
            if (this.mediaMsgs.hasMediaAfter && e.scrollLeft + o.SCROLL_FUDGE > e.scrollWidth - 2 * e.clientWidth) {
                var n = this.mediaMsgs.last();
                this.mediaMsgs.queryMedia(n.chat, n, "after"),
                this.forceUpdate()
            }
        }, 100),
        onNext: function(e) {
            var t = this;
            if (e && e.stopPropagation(),
            !this.state.imgZoomed) {
                var n = this.state.activeMsg
                  , r = this.mediaMsgs.getAfter(n);
                return r ? void this.onSelectThumb(r) : void (m.supportsFeature(m.F.MEDIA_GALLERY) && this.mediaMsgs.hasMediaAfter && (this._queryMediaAfter || (this._queryMediaAfter = this.mediaMsgs.queryMedia(n.chat, n, "after").checkpoint(this.rejectOnUnmount()).then(function(e) {
                    e.length > 0 && t.state.activeMsg === n && t.onNext()
                })["catch"](g.Unmount, _.noop)["catch"](function(e) {
                    f.error("query media msgs error: ", e)
                })["finally"](function() {
                    t._queryMediaAfter = null
                }))))
            }
        },
        onPrev: function(e) {
            var t = this;
            if (e && e.stopPropagation(),
            !this.state.imgZoomed) {
                var n = this.state.activeMsg
                  , r = this.mediaMsgs.getBefore(n);
                return r ? void this.onSelectThumb(r) : void (m.supportsFeature(m.F.MEDIA_GALLERY) && this.mediaMsgs.hasMediaBefore && (this._queryMediaBefore || (this._queryMediaBefore = this.mediaMsgs.queryMedia(n.chat, n, "before").checkpoint(this.rejectOnUnmount()).then(function(e) {
                    e.length > 0 && t.state.activeMsg === n && t.onPrev();
                })["catch"](g.Unmount, _.noop)["catch"](function(e) {
                    f.error("query media msgs error: ", e)
                })["finally"](function() {
                    t._queryMediaBefore = null
                }))))
            }
        },
        onImgZoomIn: function(e) {
            this.setState({
                imgZoomed: e
            })
        },
        endFlow: function() {
            s.closeModalMedia()
        },
        willEndFlow: function() {
            Velocity(this.refs.thumbsContainer, {
                opacity: [0, 1],
                translateY: ["100%", "0%"]
            }, {
                duration: 300,
                easing: [.1, .82, .25, 1]
            })
        },
        onSelectThumb: function(e, t) {
            m.supportsFeature(m.F.MEDIA_GALLERY) && this.mediaMsgs.loadMoreAroundIfNeeded(e),
            this.setState({
                activeMsg: e
            })
        },
        scrollToActive: function() {
            var e = !(arguments.length <= 0 || void 0 === arguments[0]) && arguments[0]
              , t = this.refs.thumbsContainer
              , n = i.findDOMNode(this.refs.thumbs)
              , r = i.findDOMNode(this.refs.activeThumb);
            if (t && n && r) {
                var o = r.clientWidth / 2 - t.clientWidth / 2;
                Velocity(n, "stop");
                var a = 0;
                e && (a = 300),
                Velocity(r, "scroll", {
                    duration: a,
                    container: n,
                    offset: o,
                    axis: "x",
                    easing: [.1, .82, .25, 1]
                })
            }
        },
        getThumbs: function() {
            var e = this
              , t = this.mediaMsgs.map(function(t) {
                var n = v("media-thumb", {
                    active: t === e.state.activeMsg
                });
                return r.createElement(p, {
                    classes: n,
                    msg: t,
                    ref: t === e.state.activeMsg ? "activeThumb" : null ,
                    key: "media-" + t.id.id,
                    onClick: e.onSelectThumb.bind(e, t)
                })
            });
            return t.push(r.createElement("div", {
                className: "media-thumb-spinner media-thumb",
                key: "spinner-right"
            }, this.mediaMsgs.queryMediaAfter ? r.createElement(h, {
                stroke: 6,
                size: 24
            }) : null )),
            t.unshift(r.createElement("div", {
                className: "media-thumb-spinner media-thumb",
                key: "spinner-left"
            }, this.mediaMsgs.queryMediaBefore ? r.createElement(h, {
                stroke: 6,
                size: 24
            }) : null )),
            t.push(r.createElement("div", {
                className: "media-thumb-padding",
                key: "padding-right"
            })),
            t.unshift(r.createElement("div", {
                className: "media-thumb-padding",
                key: "padding-left"
            })),
            t
        },
        render: function() {
            var e = this.mediaMsgs.last()
              , t = this.mediaMsgs.hasMediaAfter || this.state.activeMsg !== e ? this.onNext : null
              , n = this.mediaMsgs.head()
              , i = this.mediaMsgs.hasMediaBefore || this.state.activeMsg !== n ? this.onPrev : null
              , o = this.getThumbs()
              , a = m.supportsFeature(m.F.MEDIA_GALLERY) ? this.onScroll : null ;
            return r.createElement("div", {
                className: this.state.imgZoomed ? "img-zoomed-in" : null
            }, r.createElement("div", {
                className: "media-collection media-viewer-thumbs-container",
                ref: "thumbsContainer"
            }, r.createElement("div", {
                onScroll: a,
                style: {
                    width: "100%"
                },
                dir: "ltr"
            }, r.createElement(y, {
                className: "media-viewer-thumbs",
                ref: "thumbs",
                transitionName: "thumb-scale"
            }, o))), r.createElement(d, {
                msg: this.state.activeMsg,
                onBack: this.endFlow,
                onExitAnimation: this.willEndFlow,
                onNext: t,
                onPrev: i,
                onImgZoomIn: this.onImgZoomIn,
                getZoomNode: this.props.getZoomNode,
                zoomIn: this.zoomIn
            }))
        }
    });
    e.exports = E
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1003)
      , o = n(1217)
      , a = n(9)
      , s = r.createClass({
        displayName: "NewChatFlow",
        mixins: [i],
        componentWillMount: function() {
            this.push(r.createElement(o, {
                title: l10n.t("new_chat_flow_title"),
                onBack: this.endFlow,
                onClick: this.onClick
            }))
        },
        onClick: function(e, t) {
            Store.Chat.find(t.id).then(a.openChat.bind(a)),
            this.endFlow()
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1003)
      , o = n(1236)
      , a = n(1237)
      , s = r.createClass({
        displayName: "NewGroupFlow",
        mixins: [i],
        componentWillMount: function() {
            this.push(r.createElement(o, {
                onBack: this.endFlow,
                onContinue: this.groupParticipants
            }))
        },
        groupParticipants: function(e, t, n) {
            this.push(r.createElement(a, {
                subject: e,
                thumb: t,
                full: n,
                onBack: this.participantsBack,
                onContinue: _.once(this.createGroup)
            }))
        },
        createGroup: function(e, t, n, r) {
            Store.Chat.createGroup(e, t, n, r),
            this.endFlow()
        },
        participantsBack: function(e, t, n) {
            this.pop()
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1003)
      , o = n(1240)
      , a = n(1212)
      , s = n(1104)
      , c = n(1238)
      , l = n(1231)
      , u = n(1245)
      , d = n(24)
      , p = r.createClass({
        displayName: "SettingsFlow",
        mixins: [i],
        componentWillMount: function() {
            this.push(r.createElement(o, {
                profileId: Store.Conn.me,
                onWallpaper: this.showWallpaperDrawer,
                onBlocked: this.showBlockedDrawer,
                onProfile: this.showProfileDrawer,
                onNotifications: this.showNotifications,
                onHelp: this.showHelp,
                onClose: this._pop
            }))
        },
        showWallpaperDrawer: function() {
            this.push(r.createElement(u, {
                onClose: this._pop
            }))
        },
        showBlockedDrawer: function() {
            this.push(r.createElement(a, {
                onClose: this._pop
            }))
        },
        showProfileDrawer: function() {
            this.push(r.createElement(s, {
                id: Store.Conn.me,
                onClose: this._pop
            }))
        },
        showNotifications: function() {
            this.push(r.createElement(c, {
                onClose: this._pop
            }))
        },
        showHelp: function() {
            d.upload("help-page-opened"),
            this.push(r.createElement(l, {
                onClose: this._pop
            }))
        },
        _pop: function() {
            this.pop()
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t, n, r, i, o, a) {
        this.rank = e,
        this.gifId = ++j,
        this.url = t,
        this.previewUrl = n || t,
        this.nonVideoUrl = r,
        this.width = i,
        this.widthStr = i + "px",
        this.ratioStr = Math.ceil(100 * O / i) + "%",
        this.attribution = o,
        this.trending = a
    }
    function o(e) {
        switch (d()) {
        case "giphy":
            return a(e);
        case "tenor":
            return c(e);
        default:
            throw new Error("Unrecognized provider " + d())
        }
    }
    function a(e) {
        var t = !e
          , n = void 0;
        return n = t ? x.request("https://api.giphy.com/v1/gifs/trending", "GET", {
            api_key: N,
            limit: 100,
            rating: "pg-13"
        }, "json") : x.request("https://api.giphy.com/v1/gifs/search", "GET", {
            q: e,
            api_key: N,
            limit: 100,
            rating: "pg-13"
        }, "json"),
        n["catch"](function() {
            return null
        }).then(function(e) {
            return e && e.status < 300 && s(e.response, t)
        })
    }
    function s(e, t) {
        if (!e || !_.isArray(e.data))
            return [];
        for (var n = e.data, r = [], o = 0; o < n.length; o++) {
            var a = n[o];
            if (a && a.images) {
                var s = a.images.downsizedSmall
                  , c = a.images.fixed_height
                  , l = a.images.fixed_width
                  , u = void 0
                  , d = void 0;
                if (l && l.mp4) {
                    var p = parseInt(l.height, 10);
                    p === p && p < D && (u = l,
                    d = D * O / p)
                }
                if (c && c.mp4) {
                    var h = parseInt(l.width, 10);
                    h === h && h < D && (u = c,
                    d = h * O / D)
                }
                u && r.push(new i(r.length,s && s.url || u.mp4,u.mp4,u.webp || u.gif || void 0,Math.round(d),R,t))
            }
        }
        return r
    }
    function c(e) {
        var t = !e
          , n = l10n.lng().replace("-", "_")
          , r = void 0;
        return r = t ? x.request("https://api.tenor.co/v1/trending", "GET", {
            key: P,
            limit: 50,
            safesearch: "moderate",
            locale: n
        }, "json") : x.request("https://api.tenor.co/v1/search", "GET", {
            tag: e,
            key: P,
            limit: 50,
            safesearch: "moderate",
            locale: n
        }, "json"),
        r["catch"](function() {
            return null
        }).then(function(e) {
            return e && e.status < 300 && l(e.response)
        })
    }
    function l(e, t) {
        if (!e || !_.isArray(e.results))
            return [];
        for (var n = e.results, r = [], o = 0; o < n.length; o++) {
            var a = n[o];
            if (a && a.media && a.media[0]) {
                var s = a.media[0]
                  , c = s.tinymp4
                  , l = s.nanomp4
                  , u = s.tinygif;
                if (c) {
                    var d = (0,
                    h["default"])(c.dims, 2)
                      , p = d[0]
                      , f = d[1];
                    r.push(new i(r.length,c.url,l && l.url || void 0,u && u.url || void 0,Math.round(p * O / f),I,t))
                }
            }
        }
        return r
    }
    function u(e, t) {
        for (var n = [], r = .9 * t, i = e, o = null , a = .05; a < 1 && i.length; a += .05) {
            i.sort(function(e, t) {
                var n = e.rank - t.rank;
                return Math.abs(n) > 8 ? n : t.width - e.width
            });
            for (var s = (1 + a) * t, c = [], l = [], u = 0; u < i.length; u++) {
                for (var d = i[u], p = !1, h = Math.min(s - d.width, r), f = 0; !p && f < c.length; f++)
                    c[f] < h && (c[f] += d.width + A,
                    l[f].push(d),
                    p = !0);
                p || (c.push(d.width),
                l.push([d]))
            }
            if (1 === l.length) {
                i = [];
                var m = t - c[0] - A;
                o = {
                    gifs: l[0],
                    blankStr: m > 0 ? m + "px" : void 0
                }
            } else {
                i = [];
                for (var g = 0; g < l.length; g++)
                    c[g] > r ? n.push(l[g]) : i.push.apply(i, l[g])
            }
        }
        n.forEach(function(e) {
            return e.sort(function(e, t) {
                return e.rank - t.rank
            })
        }),
        n.sort(function(e, t) {
            return e[0].rank - t[0].rank
        });
        var v = n.map(function(e) {
            return {
                gifs: e,
                blankStr: void 0
            }
        });
        return o && v.push(o),
        v
    }
    function d() {
        switch (v.SHOW_GIF_SEARCH) {
        case "giphy":
            return R;
        case "tenor":
        default:
            return I
        }
    }
    var p = n(433)
      , h = r(p)
      , f = n(2)
      , m = r(f)
      , g = n(6)
      , v = n(10)
      , y = n(14)
      , E = n(56)
      , b = n(986)
      , S = n(141)
      , M = n(84)
      , C = n(992)
      , T = n(46)
      , w = n(1291)
      , k = n(53)
      , x = n(140)
      , N = "3o85xmWDYKgihhIKSA"
      , P = "DLAQBEYLJJIM"
      , D = 200
      , O = 150
      , A = 6
      , R = "giphy"
      , I = "tenor"
      , L = {
        giphy: "GIPHY",
        tenor: "Tenor"
    }
      , F = {
        giphy: E.GIF_SEARCH_PROVIDER.GIPHY,
        tenor: E.GIF_SEARCH_PROVIDER.TENOR
    }
      , U = {
        giphy: b.GIF_ATTRIBUTION.GIPHY,
        tenor: b.GIF_ATTRIBUTION.TENOR
    }
      , j = 0
      , B = new w(o,{
        maxCached: 6,
        maxAge: 36e4,
        shouldCache: function(e) {
            return !(!e || !e.length)
        }
    })
      , G = g.createClass({
        displayName: "GifPreview",
        mixins: [C],
        propTypes: {
            gif: g.PropTypes.instanceOf(i).isRequired,
            onSend: g.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return this._videoRef = null ,
            {
                animate: !1,
                show: !1
            }
        },
        setVideoRef: function(e) {
            this._videoRef = e,
            this.synchronizeVideo()
        },
        synchronizeVideo: function() {
            var e = this._videoRef;
            null !== e && (this.state.animate ? e.paused && e.play() : e.paused || (e.pause(),
            e.currentTime = 0))
        },
        setShouldAnimate: function(e) {
            this.state.animate === e && this.state.show || this.setState({
                animate: e,
                show: !0
            }, this.synchronizeVideo)
        },
        handleClick: function() {
            this.props.onSend(this.props.gif)
        },
        render: function() {
            var e = this.props.gif
              , t = null ;
            return this.state.show && (t = k.troublesWithLotsOfVideos && e.nonVideoUrl ? g.createElement("img", {
                className: "gif-search-gif",
                onClick: this.handleClick,
                src: e.nonVideoUrl
            }) : g.createElement("video", {
                className: "gif-search-gif",
                onClick: this.handleClick,
                controls: !1,
                autoPlay: this.state.animate,
                loop: !0,
                muted: !0,
                ref: this.setVideoRef,
                src: e.previewUrl
            })),
            g.createElement("div", {
                className: "gif-search-gif-wrapper",
                style: {
                    flexBasis: e.widthStr
                }
            }, g.createElement("div", {
                style: {
                    width: e.widthStr
                }
            }, g.createElement("div", {
                style: {
                    paddingBottom: e.ratioStr
                }
            }, t)))
        }
    })
      , Y = g.createClass({
        displayName: "GifSearch",
        mixins: [C],
        propTypes: {
            onGif: g.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return this._scrollTop = 0,
            this._animatingRow = null ,
            this._containerDom = null ,
            this._didSendGif = !1,
            {
                searchText: "",
                gifRows: [],
                width: 0
            }
        },
        shouldComponentUpdate: function(e, t) {
            return e.onGif !== this.props.onGif || t.gifRows !== this.state.gifRows
        },
        componentWillMount: function() {
            var e = this;
            this._searchTimer = new M(this.searchForAndSetGifs),
            this._animateTimer = new M(this.animateGif),
            this._onlineRestarter = m["default"].loop(function() {
                return T.waitForBBEvent(S, "change:online", function() {
                    return S.online
                }).then(function() {
                    return e.scheduleQuery()
                })
            }).cancellable(),
            this._onlineRestarter["catch"](m["default"].CancellationError, _.noop),
            this.searchForAndSetGifs(),
            new E.GifSearchSessionStarted({
                gifSearchProvider: F[d()]
            }).commit()
        },
        componentWillUnmount: function() {
            this._animateTimer.cancel(),
            this._searchTimer.cancel(),
            this._onlineRestarter.cancel(),
            this._didSendGif || new E.GifSearchCancelled({
                gifSearchProvider: F[d()]
            }).commit()
        },
        scheduleQuery: function() {
            this._searchTimer.debounceAndCap(200, 2e3)
        },
        onSearchInput: function(e) {
            this._searchText = e.target.value.trim(),
            this.scheduleQuery()
        },
        onScroll: function(e) {
            this._scrollTop = e.currentTarget.scrollTop,
            this._animateTimer.debounce(200)
        },
        onSend: function(e) {
            var t = F[e.attribution];
            new E.GifFromProviderSent({
                gifSearchProvider: t
            }).commit(),
            e.trending || new E.GifSearchResultTapped({
                gifSearchProvider: t,
                rank: e.rank
            }).commit(),
            this._didSendGif = !0,
            this.props.onGif(e.url, U[e.attribution])
        },
        setGifAnimating: function(e, t) {
            var n = this.refs[e];
            n && n.setShouldAnimate(t)
        },
        animateGif: function() {
            var e = this
              , t = this._animatingRow
              , n = Math.round(this._scrollTop / (O + A))
              , r = this.state.gifRows[n];
            if (r && r.gifs.length && r !== t) {
                if (this._animatingRow = r,
                t)
                    for (var i = 0; i < t.gifs.length; i++)
                        this.setGifAnimating(t.gifs[i].gifId, !1);
                for (var o = 0; o < r.gifs.length; o++)
                    this.setGifAnimating(r.gifs[o].gifId, !0)
            }
            [n + 1, n - 1].forEach(function(t) {
                if (e.state.gifRows[t])
                    for (var n = e.state.gifRows[t].gifs, r = 0; r < n.length; r++)
                        e.setGifAnimating(n[r].gifId, !1)
            })
        },
        searchForAndSetGifs: function() {
            var e = this
              , t = F[d()]
              , n = this._searchText
              , r = B.getOrRun(n);
            r = r.then(),
            this._pendingQuery = r,
            r.checkpoint(this.rejectOnUnmount()).then(function(i) {
                if (i && 0 === i.length && new E.GifSearchNoResults({
                    gifSearchProvider: t
                }).commit(),
                r === e._pendingQuery && (e._pendingQuery = null ,
                i)) {
                    n || new E.GifTrendingViewed({
                        gifSearchProvider: t
                    }).commit();
                    var o = e._containerDom.clientWidth;
                    o -= 2 * A,
                    e._resetScroll = !0,
                    e._animateTimer.debounce(0),
                    e.setState({
                        gifRows: u(i, o),
                        width: o
                    })
                }
            })["catch"](y.Unmount, m["default"].CancellationError, _.noop),
            n && setTimeout(function() {
                e.rejectOnUnmount().isPending() && n === e._searchText && new E.GifSearchPerformed({
                    gifSearchProvider: t
                }).commit()
            }, 500)
        },
        render: function() {
            function e(e) {
                s = e,
                null !== e && e.focus()
            }
            function t(e) {
                e.target !== s && (e.preventDefault(),
                s.focus()),
                e.stopPropagation()
            }
            var n = this
              , r = this.state.gifRows;
            this._gifPreviews = {};
            var i = r.map(function(e, t) {
                var r = e.gifs.map(function(e, t) {
                    return g.createElement(G, {
                        key: e.gifId,
                        ref: e.gifId,
                        gif: e,
                        display: !0,
                        onSend: n.onSend
                    })
                })
                  , i = null ;
                return e.blankStr && (i = g.createElement("div", {
                    className: "gif-search-blank",
                    style: {
                        flexBasis: e.blankStr
                    }
                })),
                g.createElement("div", {
                    key: t,
                    className: "gif-search-row"
                }, r, i)
            })
              , o = !!this._resetScroll
              , a = function(e) {
                n._containerDom = e,
                null !== e && o && (o = !1,
                e.scrollTop = 0)
            }
              , s = null
              , c = l10n.t("search_gifs", {
                service: L[d()]
            });
            return g.createElement("div", {
                className: "gif-search-container",
                ref: a,
                onScroll: this.onScroll,
                onMouseDown: t,
                onContextMenu: t
            }, g.createElement("div", {
                className: "gif-search-row"
            }, g.createElement("label", {
                className: "gif-search-row-input"
            }, g.createElement("div", {
                className: "input-container"
            }, g.createElement("input", {
                className: "input input-search",
                type: "text",
                dir: "auto",
                title: c,
                placeholder: c,
                ref: e,
                onMouseDown: function(e) {
                    e.stopPropagation()
                },
                onChange: this.onSearchInput
            })))), i)
        }
    });
    e.exports = Y
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(890)
      , o = r(i)
      , a = n(2)
      , s = r(a)
      , c = n(52)
      , l = r(c)
      , u = n(36)
      , d = r(u)
      , p = n(44)
      , h = r(p)
      , f = n(208)
      , m = r(f)
      , g = n(207)
      , v = r(g)
      , y = n(6)
      , _ = r(y)
      , E = n(14)
      , b = r(E)
      , S = n(31)
      , M = r(S);
    e.exports = function(e) {
        return function(t) {
            function n() {
                var e, t, r, i;
                (0,
                d["default"])(this, n);
                for (var o = arguments.length, a = Array(o), c = 0; c < o; c++)
                    a[c] = arguments[c];
                return t = r = (0,
                m["default"])(this, (e = (0,
                l["default"])(n)).call.apply(e, [this].concat(a))),
                r.isUnmounted = !1,
                r.rejectOnUnmount = function() {
                    return r.rejectPromise ? r.rejectPromise : (r.rejectPromise = new s["default"](function(e, t) {
                        r.rejector = t
                    }
                    ),
                    r.rejectPromise["catch"](M["default"].noop),
                    r.isUnmounted && r.rejector(new b["default"].Unmount),
                    r.rejectPromise)
                }
                ,
                i = t,
                (0,
                m["default"])(r, i)
            }
            return (0,
            v["default"])(n, t),
            (0,
            h["default"])(n, [{
                key: "componentWillUnmount",
                value: function() {
                    this.isUnmounted = !0,
                    this.rejectPromise && this.rejector(new b["default"].Unmount)
                }
            }, {
                key: "render",
                value: function() {
                    return _["default"].createElement(e, (0,
                    o["default"])({
                        rejectOnUnmount: this.rejectOnUnmount
                    }, this.props))
                }
            }]),
            n
        }(y.Component)
    }
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(434)
      , o = r.createClass({
        displayName: "IntroPanel",
        componentDidMount: function() {
            var e = this.refs.image
              , t = this.refs.text;
            this.props.animate ? (Velocity(e, {
                scale: [1, 0],
                opacity: [1, 0]
            }, {
                delay: 1340,
                duration: 180,
                easing: [.05, 1.02, 0, 1.01]
            }),
            Velocity(t, {
                translateY: [0, 80],
                opacity: [1, 0]
            }, {
                delay: 1300,
                duration: 140,
                easing: [.05, 1.02, 0, 1.01]
            })) : (e.style.opacity = 1,
            t.style.opacity = 1)
        },
        render: function() {
            return r.createElement("div", {
                className: "pane pane-intro pane-two"
            }, r.createElement("div", {
                className: "intro-body"
            }, r.createElement("div", {
                ref: "image",
                className: "intro-image"
            }), r.createElement("div", {
                ref: "text",
                className: "intro-text-container"
            }, r.createElement("h1", {
                "data-a8n": i.key("intro-title"),
                className: "intro-title"
            }, l10n.t("intro_title")), r.createElement("div", {
                "data-a8n": i.key("intro-text"),
                className: "intro-text"
            }, l10n.t("intro_connection")))))
        }
    });
    e.exports = o
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(9)
      , a = n(990)
      , s = n(993)
      , c = n(991)
      , l = n(997)
      , u = n(996)
      , d = n(1019)
      , p = n(133)
      , h = n(1e3)
      , f = n(139)
      , m = n(67)
      , g = n(135)
      , v = g.HotKeys
      , y = r.createClass({
        displayName: "ArchivedDrawer",
        mixins: [p],
        getInitialState: function() {
            this.selection = new h([],function(e) {
                return e.id
            }
            )
        },
        componentDidMount: function() {
            this.addObserver(Store.Chat, "change:archive add remove"),
            this.refs.list && f.focus(i.findDOMNode(this.refs.list))
        },
        onClick: function(e, t) {
            o.openChat(t),
            this.onClose()
        },
        onClose: function() {
            this.context.uim.uie.requestDismiss()
        },
        getList: function() {
            return Store.Chat.filter("archive")
        },
        onNextChat: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            this.selection.setNext()
        },
        onPrevChat: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            this.selection.setPrev()
        },
        render: function() {
            var e = this
              , t = void 0
              , n = this.getList();
            if (this.selection.init(n, !0),
            n.length > 0) {
                var i = n.map(function(t) {
                    return r.createElement(d, {
                        chat: t,
                        mode: d.Mode.LAST,
                        key: t.id,
                        active: e.selection,
                        onClick: e.onClick
                    })
                })
                  , o = {
                    down: this.onNextChat,
                    up: this.onPrevChat
                };
                t = r.createElement(v, {
                    handlers: o,
                    ref: "list",
                    className: "drawer-section-main chatlist",
                    "data-list-scroll-container": !0
                }, r.createElement(l, {
                    data: i,
                    height: l.DEFAULT_HEIGHT,
                    extraItems: 4
                }))
            } else
                t = r.createElement(u.Archived, null );
            return r.createElement(a, {
                id: "blocked",
                onCancel: this.onClose
            }, r.createElement(s, {
                title: l10n.t("archived_flow_title"),
                onBack: this.onClose,
                type: s.Type.LARGE
            }), r.createElement(c, null , t))
        }
    });
    y.contextTypes = {
        uim: r.PropTypes.instanceOf(m)
    },
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(14)
      , a = n(986)
      , s = n(1106)
      , c = n(134)
      , l = n(138)
      , u = n(992)
      , d = n(133)
      , p = n(10)
      , h = n(9)
      , f = n(1111)
      , m = n(43)
      , g = n(1011)
      , v = n(135)
      , y = v.HotKeys
      , E = n(895)
      , b = n(990)
      , S = n(993)
      , M = n(991)
      , C = n(1044)
      , T = n(1125)
      , w = n(1123)
      , k = n(1126)
      , x = n(1124)
      , N = n(988)
      , P = n(139)
      , D = n(435)
      , O = n(136)
      , A = n(431)
      , R = n(102)
      , I = n(998)
      , L = a.TYPE
      , F = L.IMAGE
      , U = L.VIDEO
      , j = L.DOCUMENT
      , B = L.AUDIO
      , G = n(211)
      , Y = _.pickBy(G.MIMETYPES, function(e) {
        return e.msgType === j
    })
      , H = function(e) {
        return 150 + 15 * e
    }
      , z = 400
      , W = s.STATE.PROCESSING
      , q = r.createClass({
        displayName: "AttachMediaDrawer",
        mixins: [c, l, u, d],
        propTypes: {
            chat: r.PropTypes.instanceOf(N),
            files: r.PropTypes.array,
            mediaCollection: r.PropTypes.object.isRequired,
            onBack: r.PropTypes.func.isRequired,
            onSendMedia: r.PropTypes.func.isRequired,
            onDropText: r.PropTypes.func.isRequired
        },
        getDefaultProps: function() {
            return {
                isDragging: !1
            }
        },
        getInitialState: function() {
            return this.transition = "media-scale",
            {
                activeMedia: null
            }
        },
        componentWillMount: function() {
            this.regNativeListener(window, "keydown", this.onKeyDown),
            this.regNativeListener(window, "drop", this.onWindowDrop)
        },
        componentDidMount: function() {
            this.addObserver(this.props.mediaCollection, "add remove reset"),
            this.addObserver(this.props.mediaCollection, "change:state", this.onProcessComplete),
            this.addObserver(this.props.mediaCollection, "max_upload_limit", this.showIgnoredToast)
        },
        componentWillUpdate: function(e, t) {
            var n = t.activeMedia
              , r = this.state.activeMedia;
            return r && n && r !== n ? void (this.props.mediaCollection.indexOf(n) > this.props.mediaCollection.indexOf(r) ? this.transition = "media-slide-forward" : this.transition = "media-slide-back") : void (this.transition = "media-scale")
        },
        componentDidUpdate: function(e, t) {
            !t.activeMedia && this.state.activeMedia && this.refs.emojiInput ? this.refs.emojiInput.restoreFocus() : !i.findDOMNode(this).contains(document.activeElement) && this.refs.sendButton && P.focus(this.refs.sendButton)
        },
        onProcessComplete: function() {
            if (!this.props.mediaCollection.some({
                state: W
            })) {
                var e = this.props.mediaCollection.getValidMedias()
                  , t = this.props.mediaCollection.uiProcessMsgs()
                  , n = t.activeMedia
                  , i = t.errorMsgs;
                i && e.length > 0 && h.openToast(r.createElement(A, {
                    msg: i,
                    id: A.genId()
                })),
                n ? this.setState({
                    activeMedia: n
                }) : this.forceUpdate()
            }
        },
        showIgnoredToast: function(e) {
            if (e > 0) {
                var t = l10n.t("too_many_files_uploaded", {
                    number: e,
                    _plural: e,
                    max: p.MAX_FILES
                });
                h.openToast(r.createElement(A, {
                    msg: t,
                    id: A.genId()
                }))
            }
        },
        onDragStart: function(e) {
            this.blockDrop = !0
        },
        onDragEnd: function(e) {
            this.blockDrop = !1
        },
        onDragOver: function(e) {
            this.state.isDragging || this.blockDrop || this.setState({
                isDragging: !0
            })
        },
        onWindowDrop: function(e) {
            _.isEmpty(this.props.files) && _.isEmpty(this.props.mediaCollection) && this.props.onBack()
        },
        onDrop: function(e) {
            this.blockDrop || (this.setState({
                isDragging: !1
            }),
            this.onFilePick(e))
        },
        onDragLeave: function(e) {
            this.props.mediaCollection.length || this.props.onBack(),
            this.setState({
                isDragging: !1
            })
        },
        onKeyDown: function(e) {
            if (this.state.activeMedia && !e.repeat)
                if (37 === e.keyCode) {
                    var t = this.state.activeMedia
                      , n = this.refs.emojiInput && this.refs.emojiInput.refs.inputLine;
                    (t && !t.media.caption || n && (n.isAtBeginning() || !n.getCursor())) && this.onPrev()
                } else if (39 === e.keyCode) {
                    var r = this.state.activeMedia
                      , i = this.refs.emojiInput && this.refs.emojiInput.refs.inputLine;
                    (r && !r.media.caption || i && (i.isAtEnd() || !i.getCursor())) && this.onNext()
                } else
                    13 === e.keyCode && this.onSend()
        },
        onNext: function() {
            var e = this.props.mediaCollection.getAfter(this.state.activeMedia);
            e && this.setState({
                activeMedia: e
            })
        },
        onPrev: function() {
            var e = this.props.mediaCollection.getBefore(this.state.activeMedia);
            e && this.setState({
                activeMedia: e
            })
        },
        onSelectThumb: function(e, t) {
            e !== this.state.activeMedia && this.setState({
                activeMedia: e
            })
        },
        onSend: function(e) {
            this.props.onSendMedia(_.map(this.props.mediaCollection.getValidMedias(), function(e) {
                var t = e.media
                  , n = t.caption;
                return n && (n = _.trim(t.caption)),
                n && (n = I.emojify(n)),
                n && (t.caption = n),
                t
            })),
            e && e.preventDefault()
        },
        onAddFileClick: function(e) {
            var t = this.refs.input;
            t.click()
        },
        onFilePick: function(e) {
            var t = this;
            f.getFiles(e).then(function(e) {
                return t.props.mediaCollection.processFiles(e, t.props.chat)
            }).checkpoint(this.rejectOnUnmount())["catch"](o.Unmount, _.noop)["catch"](o.MediaDragDropError, function(e) {
                if (t.props.mediaCollection.length)
                    throw e;
                t.props.onDropText(e.src)
            }),
            e.target.value = ""
        },
        onRemoveThumb: function(e, t) {
            t.stopPropagation(),
            t.preventDefault();
            var n = this.props.mediaCollection.getBefore(e) || this.props.mediaCollection.getAfter(e);
            this.props.mediaCollection.remove(e),
            this.setState({
                activeMedia: n
            })
        },
        onCaptionChange: function(e) {
            var t = this.state.activeMedia;
            t.media.caption = e.target.value,
            this.setState({
                media: t
            })
        },
        onPaste: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = new E(e.clipboardData);
            t.hasFiles() && this.onFiles(t)
        },
        onFiles: function(e) {
            var t = _.filter(e.getFiles(), function(e) {
                var t = D.typeFromMimetype(e.type);
                return "image" === t || "video" === t
            });
            this.props.mediaCollection.processFiles(t, this.props.chat)
        },
        getMedia: function() {
            var e = void 0
              , t = void 0
              , n = this.state.activeMedia;
            switch (n.media.msgType) {
            case F:
            case U:
                var i = void 0;
                n.media.width && n.media.height && (i = {
                    width: n.media.width,
                    height: n.media.height
                }),
                e = r.createElement(T, {
                    mimeType: n.media.mimetype,
                    url: n.preview,
                    isGif: !!n.media.isGif,
                    size: i
                }),
                t = r.createElement("div", {
                    className: "media-caption"
                }, r.createElement(g, {
                    ref: "emojiInput",
                    editable: !0,
                    value: n.media.caption,
                    placeholder: l10n.t("add_a_caption"),
                    maxLength: p.MAX_CAPTION_LENGTH,
                    showRemaining: !0,
                    onEnter: this.onSend,
                    onChange: this.onCaptionChange,
                    onFiles: this.onFiles,
                    supportsEmoji: !0
                }));
                break;
            case B:
                e = r.createElement(w, {
                    mimeType: n.media.mimetype,
                    url: n.preview
                });
                break;
            case j:
                switch (G.previewType(n.media.mimetype)) {
                case "pdf":
                    e = r.createElement(k, {
                        preview: n.media.documentPreview,
                        mimeType: n.media.mimetype,
                        filename: n.media.filename
                    });
                    break;
                case "msoffice":
                    e = r.createElement(x, {
                        preview: n.media.documentPreview,
                        mimeType: n.media.mimetype,
                        filename: n.media.filename
                    });
                    break;
                default:
                    e = r.createElement(C, {
                        mimeType: n.media.mimetype,
                        filename: n.media.filename
                    })
                }
            }
            return r.createElement("div", {
                className: "media-body-container",
                key: n.id
            }, e, t)
        },
        getThumbs: function(e) {
            var t = this;
            return e.map(function(e, n) {
                var i = m("media-thumb", "stagger-delay", {
                    active: e === t.state.activeMedia
                })
                  , o = t.props.mediaCollection.indexOf(t.state.activeMedia)
                  , a = Math.max(t.props.mediaCollection.length - o - 1, 1)
                  , s = H(n) / a * Math.max(0, n - o) + "ms";
                return r.createElement(V, {
                    className: i,
                    key: "media-" + e.id,
                    media: e,
                    onClick: t.onSelectThumb.bind(null , e),
                    onClose: t.onRemoveThumb.bind(null , e),
                    staggerDelay: s
                })
            })
        },
        render: function() {
            var e = void 0
              , t = void 0
              , n = void 0
              , i = 0
              , o = this.props.mediaCollection.getValidMedias();
            o.length > p.MAX_FILES && (o = o.slice(0, p.MAX_FILES)),
            this.props.mediaCollection.some({
                state: W
            }) ? e = r.createElement(O, {
                key: "processing"
            }) : this.state.activeMedia ? e = this.getMedia() : 0 === o.length && this.props.mediaCollection.errorMsgs && (e = r.createElement("div", {
                className: "invalid-media-container",
                key: "pending"
            }, r.createElement("div", {
                className: "invalid-media"
            }, this.props.mediaCollection.errorMsgs))),
            o.length > 0 && (t = this.getThumbs(o),
            i = 1 === o.length ? z : z + H(o.length),
            n = r.createElement("div", {
                className: "drawer-controls",
                tabIndex: "-1",
                ref: "sendButton",
                onKeyPress: function(e) {
                    return e.preventDefault()
                }
            }, r.createElement("button", {
                className: "btn btn-round btn-l",
                onClick: this.onSend
            }, r.createElement("span", {
                className: "icon icon-send-light"
            }))));
            var a = this.state.isDragging ? r.createElement("div", {
                key: "container",
                className: "drag-drop"
            }, r.createElement("div", {
                className: "stitching"
            }, l10n.t("drag_media_here"))) : null
              , s = o.length < p.MAX_FILES ? r.createElement("div", {
                key: "media-more",
                className: "media-thumb btn-add-media",
                onClick: this.onAddFileClick
            }, r.createElement("button", {
                className: "btn-fill"
            }, r.createElement("span", {
                className: "icon icon-add-alt"
            }), l10n.t("add_media"))) : null
              , c = {
                enter: this.onSend
            };
            return r.createElement(b, {
                key: "attach-image-modal",
                ref: "container",
                position: "right",
                id: "media",
                variant: "noheader",
                onDrop: this.onDrop,
                onDragOver: this.onDragOver,
                onDragLeave: this.onDragLeave
            }, r.createElement(S, {
                title: l10n.t("web_preview_msg"),
                type: S.Type.OFFSET,
                onCancel: this.props.onBack
            }), r.createElement(M, {
                onDragStart: this.onDragStart,
                onPaste: this.onPaste,
                onDragEnd: this.onDragEnd
            }, a, r.createElement("div", {
                className: "media-body"
            }, r.createElement(R, {
                transitionName: this.transition
            }, e)), r.createElement(R, {
                transitionName: "thumb-scale",
                className: "media-collection"
            }, t, s), r.createElement(y, {
                handlers: c
            }, r.createElement(R, {
                transitionName: "btn",
                delay: i
            }, n)), r.createElement("input", {
                ref: "input",
                type: "file",
                accept: p.IMAGE_MIMES + "," + p.VIDEO_MIMES,
                style: {
                    display: "none"
                },
                onChange: this.onFilePick,
                multiple: !0
            })))
        }
    })
      , V = r.createClass({
        displayName: "AttachMediaThumb",
        propTypes: {
            media: r.PropTypes.instanceOf(s).isRequired,
            className: r.PropTypes.string,
            onClick: r.PropTypes.func,
            onClose: r.PropTypes.func
        },
        render: function() {
            var e = this.props
              , t = e.media
              , i = e.className
              , o = e.onClick
              , a = e.onClose
              , s = void 0
              , c = void 0
              , l = void 0;
            switch (t.media.msgType) {
            case F:
                l = {
                    backgroundImage: "url(" + t.preview + ")"
                },
                s = r.createElement("div", {
                    className: "media-thumb-body",
                    style: l
                });
                break;
            case U:
                l = {
                    backgroundImage: "url(" + t.url + ")"
                },
                s = r.createElement("div", {
                    className: "media-thumb-body",
                    style: l
                });
                break;
            case B:
                s = r.createElement("div", {
                    className: "attach-media-audio-thumb"
                });
                break;
            case j:
                var u = n(1);
                if (u.log("media is", t)(),
                t.media.documentPreview && t.media.documentPreview.thumbUrl) {
                    var d = {
                        backgroundImage: "url(" + t.media.documentPreview.thumbUrl + ")"
                    };
                    Y[t.media.mimetype] && (c = Y[t.media.mimetype].icon),
                    c = m(c, "icon-doc", "icon-doc-thumb-filetype"),
                    s = r.createElement("div", {
                        className: "media-thumb-body",
                        style: d
                    }, r.createElement("div", {
                        className: c
                    }));
                    break
                }
                Y[t.media.mimetype] && (c = Y[t.media.mimetype].icon);
            default:
                c = m(c, "icon-doc"),
                s = r.createElement("div", {
                    className: "media-thumb-body"
                }, r.createElement("div", {
                    className: c
                }))
            }
            return r.createElement("div", {
                className: i,
                onClick: o
            }, r.createElement("span", {
                className: "btn-delete icon icon-x-alt-light",
                onClick: a
            }), s)
        }
    });
    e.exports = q
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(9)
      , o = n(990)
      , a = n(993)
      , s = n(991)
      , c = n(997)
      , l = n(996)
      , u = n(1004)
      , d = n(429)
      , p = n(133)
      , h = n(1051)
      , f = r.createClass({
        displayName: "BlockedDrawer",
        mixins: [p],
        propTypes: {
            onClose: r.PropTypes.func
        },
        componentWillMount: function() {
            this.addObserver(Store.Blocklist, "add remove")
        },
        onBlockConfirm: function(e) {
            e.setBlock(!0)["catch"](_.noop),
            i.closeModal()
        },
        onBlock: function(e) {
            var t = function(e) {
                return !!Store.Contact.isFilteredContact(e) && (!Store.Blocklist.get(e.id) || l10n.t("participant_already_blocked"))
            };
            i.openModal(r.createElement(h, {
                title: l10n.t("add_blocked_title"),
                filter: t,
                onCancel: i.closeModal.bind(i),
                onSelect: _.once(this.onBlockConfirm)
            }))
        },
        onUnblockConfirm: function(e) {
            e.setBlock(!1)["catch"](_.noop),
            i.closeModal()
        },
        onUnblockCancel: function() {
            i.closeModal()
        },
        onUnblock: function(e, t) {
            i.openModal(r.createElement(d, {
                okText: l10n.t("unblock_button"),
                onOK: this.onUnblockConfirm.bind(this, t),
                cancelText: l10n.t("web_cancel"),
                onCancel: this.onUnblockCancel
            }, l10n.t("unblock_confirmation", {
                contact: t.formattedName
            })))
        },
        render: function() {
            var e = this
              , t = void 0
              , n = void 0;
            if (Store.Blocklist.length > 0) {
                var i = Store.Blocklist.map(function(t) {
                    return r.createElement(u, {
                        contact: t.contact,
                        key: t.contact.id,
                        onClick: e.onUnblock,
                        onDelete: e.onUnblock
                    })
                });
                t = r.createElement("div", {
                    className: "drawer-section-main chatlist",
                    "data-list-scroll-container": !0
                }, r.createElement(c, {
                    data: i,
                    height: c.DEFAULT_HEIGHT,
                    extraItems: 4
                })),
                n = r.createElement("div", {
                    className: "hint"
                }, l10n.t("add_blocked_description"))
            } else
                t = r.createElement(l.Blocked, null );
            return r.createElement(o, {
                id: "blocked",
                onCancel: this.props.onClose
            }, r.createElement(a, {
                title: l10n.t("blocked_flow_title"),
                onBack: this.props.onClose,
                type: a.Type.LARGE
            }), r.createElement(s, null , r.createElement("div", {
                className: "list-action",
                onClick: this.onBlock
            }, r.createElement("div", {
                className: "list-action-icon"
            }, r.createElement("span", {
                className: "icon icon-add-user"
            })), r.createElement("div", {
                className: "list-action-body"
            }, l10n.t("add_blocked_title"))), t, n))
        }
    });
    e.exports = f
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(987)
      , o = n(133)
      , a = n(9)
      , s = n(988)
      , c = n(137)
      , l = n(1052)
      , u = n(997)
      , d = n(1004)
      , p = n(990)
      , h = n(991)
      , f = n(1008)
      , m = n(1013)
      , g = n(994)
      , v = n(1026)
      , y = n(67)
      , _ = r.createClass({
        displayName: "BroadcastInfoDrawer",
        mixins: [i, o],
        propTypes: {
            chat: r.PropTypes.instanceOf(s).isRequired
        },
        getInitialState: function() {
            return {
                everyoneEncrypted: this.async("chat.contact.plaintextDisabled")
            }
        },
        componentWillMount: function() {
            var e = this.props.chat.groupMetadata;
            this.addObserver(e.participants, "add remove sort reset")
        },
        onParticipantClick: function(e, t) {
            Store.Conn.me !== t.id && Store.Chat.find(t.id).then(function(e) {
                a.openChat(e)
            })
        },
        onClose: function() {
            this.props.onClose ? this.props.onClose() : this.context.uim.uie.requestDismiss()
        },
        onDelete: function() {
            a.deleteOrExitChat(this.props.chat)
        },
        onViewPicture: function(e) {
            var t = e.target
              , n = function(e) {
                e(t)
            };
            a.openModalMedia(r.createElement(l, {
                contact: this.props.chat.contact,
                animateBorderRadius: !0,
                getZoomNode: n
            }), "profile-viewer")
        },
        render: function() {
            var e = this.props.chat
              , t = e.groupMetadata
              , n = this.onParticipantClick
              , i = t.participants.map(function(e) {
                var t = Store.Contact.get(e.id) || Store.Contact.add({
                    id: e.id
                });
                return r.createElement(d, {
                    contact: t,
                    admin: !!e.isAdmin,
                    onClick: n,
                    key: e.id
                })
            })
              , o = null ;
            if (this.props.onMediaGallery) {
                var a = r.createElement("span", {
                    className: "icon icon-chevron-right-alt"
                });
                o = r.createElement(f, {
                    title: l10n.t("media"),
                    titleOnClick: this.props.onMediaGallery,
                    subtitle: a,
                    classes: "animate-enter2",
                    noContainer: !0
                }, r.createElement(v, {
                    chat: e
                }))
            }
            var s, l = null , y = i.length ? r.createElement(f, {
                classes: "animate-enter1 well-simple-body",
                title: l10n.t("web_recipients_title"),
                subtitle: l10n.n(i.length),
                "data-list-scroll-offset": !0
            }, r.createElement("div", {
                className: "drawer-section-body chatlist"
            }, r.createElement(u, {
                data: i,
                height: 72,
                extraItems: 4
            }))) : null ;
            e.canDelete() && (s = r.createElement("div", {
                className: "drawer-section chatlist list-icons animate-enter2 well-simple"
            }, r.createElement(m, {
                iconClass: "icon-delete-danger",
                a8n: "li-delete-broadcast",
                className: "danger first",
                onClick: this.onDelete
            }, l10n.t("web_delete_list"))));
            var _;
            e.groupMetadata.creation ? (_ = c.timeStr(e.groupMetadata.creation),
            _ = r.createElement("div", {
                className: "header-secondary"
            }, l10n.t("web_group_creation_time", {
                when: _
            }))) : _ = null ;
            var E = null
              , b = null ;
            return (l || E) && (b = r.createElement(f, {
                classes: "well-simple animate-enter2"
            }, l, E)),
            r.createElement(p, {
                key: "contact-info-modal",
                id: "info",
                variant: "panel",
                onCancel: this.onClose
            }, r.createElement("header", {
                className: "pane-header"
            }, r.createElement("div", {
                className: "header-close"
            }, r.createElement("button", {
                onClick: this.onClose
            }, r.createElement("span", {
                className: "icon icon-x"
            }))), r.createElement("div", {
                className: "header-body"
            }, r.createElement("div", {
                className: "header-main"
            }, r.createElement("div", {
                className: "header-title"
            }, l10n.t("broadcast_list_info")), _))), r.createElement(h, {
                expands: !!i.length,
                "data-list-scroll-container": !0
            }, r.createElement(f, {
                classes: "drawer-scale drawer-section-photo"
            }, r.createElement(g, {
                id: e.id,
                size: g.Size.LARGE,
                onClick: this.onViewPicture
            })), o, b, y, s))
        }
    });
    _.contextTypes = {
        uim: r.PropTypes.instanceOf(y)
    },
    e.exports = _
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(1036)
      , o = n(1101)
      , a = n(9)
      , s = r.createClass({
        displayName: "CaptureModal",
        propTypes: {
            onSend: r.PropTypes.func.isRequired,
            stream: r.PropTypes.object.isRequired
        },
        onCancel: function() {
            a.closeModal()
        },
        onSend: function(e) {
            this.props.onSend(e.file),
            this.onCancel()
        },
        render: function() {
            return r.createElement(i, {
                type: i.BOX
            }, r.createElement(o, {
                onBack: this.onCancel,
                caption: !1,
                onSend: this.onSend,
                stream: this.props.stream,
                noContainer: !0
            }))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = n(37)
      , g = n(224)
      , v = n(31)
      , y = window.Store
      , _ = n(1036)
      , E = n(9)
      , b = n(990)
      , S = n(993)
      , M = n(991)
      , C = n(1020)
      , T = n(1019)
      , w = (n(988),
    n(1004))
      , k = (n(210),
    n(997))
      , x = n(996)
      , N = n(1033)
      , P = n(1e3)
      , D = n(139)
      , O = n(212)
      , A = n(101)
      , R = n(135)
      , I = R.HotKeys
      , L = function(e) {
        function t() {
            (0,
            s["default"])(this, t);
            var e = (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments));
            return e.state = {
                searchText: ""
            },
            e.filteredData = null ,
            e
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "componentWillMount",
            value: function() {
                this.selection = new P(this.getData(),function(e) {
                    return e.id
                }
                )
            }
        }, {
            key: "getFrequentContacts",
            value: function() {
                var e = this.state.searchText;
                return e || !A.supportsFeature(A.F.FREQUENT_CONTACTS) ? [] : y.Contact.frequentContacts(null , this.props.excludeChat)
            }
        }, {
            key: "getFilteredChats",
            value: function() {
                var e = this.state.searchText;
                return e ? (e = O.accentFold(e),
                y.Chat.filter(function(t) {
                    return t.canSend && t.isVisible && t.contact.searchMatch(e)
                })) : y.Chat.filter(function(e) {
                    return e.canSend && e.isVisible
                })
            }
        }, {
            key: "getFilteredContacts",
            value: function() {
                var e = y.Contact.getFilteredContacts()
                  , t = this.state.searchText;
                return t ? (t = O.accentFold(t),
                e.filter(function(e) {
                    return e.searchMatch(t)
                })) : e
            }
        }, {
            key: "getFilteredData",
            value: function() {
                if (this.filteredData)
                    return this.filteredData;
                var e = {}
                  , t = this.getFrequentContacts();
                v.forEach(t, function(t) {
                    e[t.id] = !0
                });
                var n = []
                  , r = this.getFilteredChats();
                v.forEach(r, function(t) {
                    e[t.id] || (e[t.id] = !0,
                    n.push(t))
                });
                var i = []
                  , o = this.getFilteredContacts();
                return v.forEach(o, function(t) {
                    e[t.id] || i.push(t)
                }),
                this.filteredData = {
                    frequentContactsData: t,
                    chatsData: n,
                    contactsData: i
                }
            }
        }, {
            key: "getFilteredItems",
            value: function() {
                var e = this
                  , t = []
                  , n = this.getFilteredData()
                  , r = n.frequentContactsData
                  , i = n.chatsData
                  , o = n.contactsData;
                return r.length && t.push(f.createElement(N, {
                    key: "frequent-contacts-header",
                    header: O.t("web_frequent_contacts")
                })),
                v.forEach(r, function(n) {
                    t.push(n.isGroup ? f.createElement(T, {
                        active: e.selection,
                        chat: y.Chat.get(n.id),
                        mode: T.Mode.INFO,
                        noContext: !0,
                        onClick: e.forwardToChat.bind(e),
                        key: n.id
                    }) : f.createElement(w, {
                        active: e.selection,
                        contact: n,
                        onClick: e.forwardToContact.bind(e),
                        secondary: n.isBlocked() ? O.t("confirm_unblock_contact_and_forward_text") : null ,
                        key: n.id
                    }))
                }),
                i.length && t.push(f.createElement(N, {
                    key: "chat-header",
                    header: O.t("web_recent_chats")
                })),
                v.forEach(i, function(n) {
                    t.push(n.isGroup ? f.createElement(T, {
                        active: e.selection,
                        chat: n,
                        mode: T.Mode.INFO,
                        noContext: !0,
                        onClick: e.forwardToChat.bind(e),
                        key: n.id
                    }) : f.createElement(w, {
                        active: e.selection,
                        contact: n.contact,
                        onClick: e.forwardToContact.bind(e),
                        secondary: n.contact.isBlocked() ? O.t("confirm_unblock_contact_and_forward_text") : null ,
                        key: n.id
                    }))
                }),
                o.length && t.length && t.push(f.createElement(N, {
                    key: "contact-header",
                    header: O.t("web_other_contacts")
                })),
                v.forEach(o, function(n) {
                    t.push(f.createElement(w, {
                        active: e.selection,
                        contact: n,
                        onClick: e.forwardToContact.bind(e),
                        secondary: n.isBlocked() ? O.t("confirm_unblock_contact_and_forward_text") : null ,
                        key: n.id
                    }))
                }),
                t
            }
        }, {
            key: "getData",
            value: function() {
                var e = this.getFilteredData()
                  , t = e.frequentContactsData
                  , n = e.chatsData
                  , r = e.contactsData;
                return v.concat(t, n, r)
            }
        }, {
            key: "getList",
            value: function() {
                var e = this.getFilteredItems();
                return 0 === e.length ? null : f.createElement(k, {
                    data: e,
                    ref: "list",
                    height: 72,
                    extraItems: 4
                })
            }
        }, {
            key: "forwardToContact",
            value: function(e, t) {
                y.Chat.find(t.id).then(this.forwardToChat.bind(this, e))
            }
        }, {
            key: "forwardToChat",
            value: function(e, t) {
                this.props.onChat(t)
            }
        }, {
            key: "onSearch",
            value: function(e) {
                this.filteredData = null ,
                this.setState({
                    searchText: e
                })
            }
        }, {
            key: "onStopSearch",
            value: function() {
                this.filteredData = null ,
                this.setState({
                    searchText: ""
                })
            }
        }, {
            key: "onCancel",
            value: function() {
                E.closeModal()
            }
        }, {
            key: "onSelectFirst",
            value: function(e) {
                e.preventDefault(),
                e.stopPropagation();
                var t = v.head(this.getData());
                t && this.forwardToContact(e, t)
            }
        }, {
            key: "onFocusList",
            value: function(e) {
                e.preventDefault(),
                e.stopPropagation(),
                I.flashFocus = Date.now(),
                this.selection.setFirst()
            }
        }, {
            key: "indicateSearchFocus",
            value: function(e) {
                if (this.selection.unset(),
                !(Date.now() - (I.flashFocus || 0) > 200)) {
                    var t = m.findDOMNode(this.refs.search);
                    g(t, "stop"),
                    g(t, {
                        backgroundColor: ["#fbfbfb", "#D9F3FF"]
                    }, {
                        duration: 1600,
                        easing: [.19, .69, .01, .99]
                    })
                }
            }
        }, {
            key: "onListFocus",
            value: function(e) {
                e.target === m.findDOMNode(this.refs.list) && (this.selection.index < 0 ? this.selection.setFirst() : this.selection.reset())
            }
        }, {
            key: "onNext",
            value: function(e) {
                e.preventDefault(),
                e.stopPropagation(),
                this.selection.setNext()
            }
        }, {
            key: "onPrev",
            value: function(e) {
                e.stopPropagation(),
                e.preventDefault();
                var t = this.selection.prev();
                t > -1 ? this.selection.setPrev() : (this.selection.unset(),
                I.flashFocus = Date.now(),
                D.focus(this.refs.search))
            }
        }, {
            key: "render",
            value: function() {
                var e = this.getList();
                this.selection.init(this.getData()),
                e || (e = this.state.searchText ? f.createElement(x.Search, null ) : f.createElement(x.ListChats, null ));
                var t = {
                    down: this.onFocusList.bind(this),
                    enter: this.onSelectFirst.bind(this)
                }
                  , n = {
                    down: this.onNext.bind(this),
                    up: this.onPrev.bind(this)
                };
                return f.createElement(_, {
                    type: _.TOWER
                }, f.createElement(b, {
                    key: "chat-modal",
                    onCancel: this.onCancel
                }, f.createElement(S, {
                    title: this.props.title,
                    type: S.Type.POPUP,
                    onCancel: this.onCancel
                }), f.createElement(I, {
                    handlers: t,
                    onFocus: this.indicateSearchFocus.bind(this)
                }, f.createElement(C, {
                    ref: "search",
                    onSearch: this.onSearch.bind(this),
                    placeholder: O.t("search")
                })), f.createElement(M, {
                    "data-list-scroll-container": !0
                }, f.createElement(I, {
                    handlers: n,
                    onFocus: this.onListFocus.bind(this),
                    className: "column",
                    ref: "list"
                }, f.createElement("div", {
                    className: "chatlist column"
                }, e)))))
            }
        }]),
        t
    }(f.Component);
    e.exports = L
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(434)
      , o = n(988)
      , a = n(9)
      , s = n(101)
      , c = n(1021)
      , l = n(989)
      , u = n(429)
      , d = r.createClass({
        displayName: "ClearChatPopup",
        propTypes: {
            onCancel: r.PropTypes.func,
            onDeleteOrExit: r.PropTypes.func,
            chat: r.PropTypes.instanceOf(o).isRequired
        },
        getInitialState: function() {
            return {
                keepStarred: !0
            }
        },
        getText: function() {
            var e = this.props.chat;
            switch (e.kind) {
            case o.KIND.GROUP:
                return l10n.t("clear_chat_group", {
                    name: e.title()
                });
            case o.KIND.CHAT:
                return l10n.t("clear_chat_chat", {
                    name: e.title()
                });
            case o.KIND.BROADCAST:
                return l10n.t("clear_chat_broadcast");
            default:
                return ""
            }
        },
        onCancel: function() {
            a.closeModal()
        },
        onClear: function() {
            var e = this.props.chat;
            e.pendingAction++,
            e.sendClear(s.supportsFeature(s.F.STARRED) && s.supportsFeature(s.F.CHAT_CLEAR_STARRED) && this.state.keepStarred)["finally"](function() {
                e.pendingAction--
            }),
            a.closeModal()
        },
        onToggleStarred: function() {
            this.setState({
                keepStarred: !this.state.keepStarred
            })
        },
        render: function() {
            var e = void 0;
            return s.supportsFeature(s.F.STARRED) && s.supportsFeature(s.F.CHAT_CLEAR_STARRED) && (e = r.createElement("div", {
                className: "controls-section",
                onClick: this.onToggleStarred
            }, r.createElement("div", {
                "data-a8n": i.key("menu-icon-clear-chat"),
                className: "control"
            }, r.createElement(c, {
                onChange: this.onToggleStarred,
                checked: this.state.keepStarred
            })), r.createElement("div", {
                className: "label"
            }, l10n.t("keep_starred")))),
            r.createElement(u, {
                title: l10n.t("are_you_sure"),
                onOK: this.onClear,
                okText: l10n.t("clear_button"),
                onCancel: this.onCancel
            }, r.createElement("div", null , r.createElement(l, {
                text: this.getText()
            }), e))
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(991)
      , s = n(1073)
      , c = n(1020)
      , l = n(996)
      , u = n(138)
      , d = n(139)
      , p = n(135)
      , h = p.HotKeys
      , f = r.createClass({
        displayName: "ContactDrawer",
        mixins: [u],
        propTypes: {
            onBack: r.PropTypes.func.isRequired,
            onClick: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                searchText: "",
                cancelSearch: !1,
                active: !1
            }
        },
        componentDidMount: function() {
            var e = this;
            this.safeDefer(function() {
                e.setState({
                    active: !0
                })
            })
        },
        getFilteredContacts: function() {
            var e = Store.Contact.getFilteredContacts()
              , t = this.state.searchText;
            return t ? (t = l10n.accentFold(t),
            e.filter(function(e) {
                return e.searchMatch(t)
            })) : e
        },
        onSearch: function(e) {
            this.setState({
                searchText: e
            })
        },
        onFocusList: function(e) {
            this.refs.list && (e.preventDefault(),
            e.stopPropagation(),
            h.flashFocus = Date.now(),
            this.refs.list.focusFirst())
        },
        onSelectFirst: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = _.head(this.getFilteredContacts());
            t && (h.flashFocus = Date.now(),
            this.props.onClick(e, t))
        },
        onFocusSearch: function(e) {
            h.flashFocus = Date.now(),
            d.focus(this.refs.search)
        },
        render: function() {
            var e = void 0;
            if (this.state.active) {
                var t = this.getFilteredContacts();
                e = 0 === t.length ? r.createElement(l.SearchContacts, null ) : r.createElement(s, {
                    ref: "list",
                    contacts: t,
                    onFocusSearch: this.onFocusSearch,
                    onClick: this.props.onClick
                })
            } else
                e = null ;
            var n = {
                down: this.onFocusList,
                enter: this.onSelectFirst
            };
            return r.createElement(i, {
                key: "contact-modal",
                onCancel: this.props.onBack
            }, r.createElement(o, {
                title: this.props.title,
                type: o.Type.LARGE,
                onBack: this.props.onBack
            }), r.createElement(h, {
                handlers: n
            }, r.createElement(c, {
                ref: "search",
                isSearching: !this.state.cancelSearch,
                onSearch: this.onSearch,
                placeholder: l10n.t("search_contacts")
            })), r.createElement(a, {
                "data-list-scroll-container": !0
            }, e))
        }
    });
    e.exports = f
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(987)
      , o = n(138)
      , a = n(992)
      , s = n(133)
      , c = n(9)
      , l = n(997)
      , u = n(1)
      , d = n(1052)
      , p = n(429)
      , h = n(1019)
      , f = n(1026)
      , m = n(990)
      , g = n(991)
      , v = n(1013)
      , y = n(1008)
      , E = n(994)
      , b = n(1077)
      , S = n(989)
      , M = n(1048)
      , C = n(14)
      , T = n(210)
      , w = n(23)
      , k = n(101)
      , x = n(67)
      , N = n(1080)
      , P = r.createClass({
        displayName: "ContactInfoDrawer",
        mixins: [i, o, a, s],
        propTypes: {
            contact: r.PropTypes.instanceOf(T).isRequired,
            onVerification: r.PropTypes.func
        },
        getInitialState: function() {
            return this.asyncState({
                status: "contact.Status.status",
                encryptionStatus: "contact.plaintextDisabled"
            }, {
                commonGroups: void 0,
                contactIsBlocked: !!Store.Blocklist.get(this.props.contact.id)
            })
        },
        componentDidMount: function() {
            this.safeDelay(function() {
                var e = this;
                this.props.contact.findCommonGroups().checkpoint(this.rejectOnUnmount()).then(function(t) {
                    e.setState({
                        commonGroups: t
                    }),
                    e.addObserver(Store.GroupMetadata, "group_participant_change", e.commonGroupsUpdate)
                })["catch"](C.Unmount, _.noop)["catch"](C.WapDrop, _.noop)["catch"](_.noop)
            }, 300),
            this.addObserver(Store.Blocklist, "add remove reset sync", this.onBlocklistChange),
            k.supportsFeature(k.F.QUERY_IDENTITY) && this.props.contact.queryIdentity()["catch"](function(e) {
                u.error("contactInfoDrawer:queryIdentity error: " + e)()
            })
        },
        onBlocklistChange: function(e) {
            this.state.contactIsBlocked !== !!Store.Blocklist.get(this.props.contact.id) && this.setState({
                contactIsBlocked: !!Store.Blocklist.get(this.props.contact.id)
            })
        },
        commonGroupsUpdate: function(e) {
            var t = this.state.commonGroups
              , n = this.props.contact.updateCommonGroups(t, e);
            n && this.setState({
                commonGroups: n
            })
        },
        onDeleteChat: function() {
            var e = Store.Chat.get(this.props.contact.id);
            c.deleteOrExitChat(e)
        },
        onBlockContact: function() {
            c.openModal(r.createElement(p, {
                title: l10n.t("block"),
                onOK: this.blockContact,
                okText: l10n.t("block"),
                onCancel: c.closeModal.bind(c),
                cancelText: l10n.t("web_cancel")
            }, l10n.t("block_confirmation", {
                contact: this.props.contact.formattedName
            })))
        },
        onUnblockContact: function() {
            c.openModal(r.createElement(p, {
                okText: l10n.t("unblock_button"),
                onOK: this.unblockContact,
                cancelText: l10n.t("web_cancel"),
                onCancel: c.closeModal.bind(c)
            }, l10n.t("unblock_confirmation", {
                contact: this.props.contact.formattedName
            })))
        },
        blockContact: function() {
            this.props.contact.setBlock(!0),
            c.closeModal()
        },
        unblockContact: function() {
            this.props.contact.setBlock(!1),
            c.closeModal()
        },
        onClose: function() {
            this.props.onClose ? this.props.onClose() : this.context.uim.uie.requestDismiss()
        },
        parseSelection: function(e) {
            for (var t, n, r = "", i = 0; i < e.rangeCount; i++)
                for (n = document.createTreeWalker(e.getRangeAt(i).cloneContents(), window.NodeFilter.SHOW_ALL); n.nextNode(); )
                    t = n.currentNode,
                    t instanceof HTMLImageElement ? r += t.alt : t.nodeType === Node.TEXT_NODE && (r += t.nodeValue ? t.nodeValue : "");
            return r
        },
        onCopyPhone: function(e) {
            var t = this.parseSelection(window.getSelection())
              , n = ""
              , r = ""
              , i = "" + n + r + n;
            if (_.startsWith(t, i)) {
                var o = t.match(new RegExp("^" + i + "(.*?)" + i));
                o && o.length > 1 && (t = _.last(o))
            }
            t = t.replace(new RegExp("" + i), ""),
            e.clipboardData.setData("text/plain", t),
            e.stopPropagation(),
            e.preventDefault()
        },
        onViewPicture: function(e) {
            if (this.canViewPicture) {
                var t = e.target
                  , n = function(e) {
                    e(t)
                };
                c.openModalMedia(r.createElement(d, {
                    contact: this.props.contact,
                    animateBorderRadius: !0,
                    getZoomNode: n
                }), "profile-viewer")
            }
        },
        onDetailImageLoad: function(e) {
            this.canViewPicture = !0
        },
        onClick: function(e, t) {
            c.openChat(t),
            this.onClose()
        },
        render: function() {
            var e, t, n = this, i = this.props.contact, o = this.state.commonGroups;
            o = _.compact(_.values(o)),
            _.isArray(o) && o.length && (e = o.map(function(e) {
                return r.createElement(h, {
                    chat: e,
                    mode: h.Mode.INFO,
                    onClick: n.onClick,
                    key: e.id
                })
            }),
            e = r.createElement(y, {
                classes: "animate-enter well-simple-body",
                title: l10n.t("web_groups_participation_you_and_name"),
                subtitle: l10n.n(o.length),
                "data-list-scroll-offset": !0,
                noContainer: !0
            }, r.createElement("div", {
                className: "drawer-section-body chatlist"
            }, r.createElement(l, {
                data: e,
                height: 72,
                extraItems: 4
            }))));
            var a = Store.Chat.get(i.id);
            _.isArray(o) && a && a.canDelete() && (t = r.createElement("div", {
                className: "drawer-section chatlist list-icons animate-enter2 well-simple"
            }, r.createElement(v, {
                iconClass: "icon-delete-danger",
                className: "danger first",
                a8n: "li-delete-chat",
                onClick: this.onDeleteChat
            }, l10n.t("delete_chat"))));
            var s = null ;
            this.props.contact.canBlock() && (s = this.state.contactIsBlocked ? r.createElement("div", {
                className: "drawer-section chatlist list-icons animate-enter2 well-simple"
            }, r.createElement(v, {
                className: "success first",
                a8n: "li-unblock",
                iconClass: "icon-settings-blocked-success",
                onClick: this.onUnblockContact
            }, l10n.t("unblock_contact"))) : r.createElement("div", {
                className: "drawer-section chatlist list-icons animate-enter2 well-simple"
            }, r.createElement(v, {
                className: "first",
                a8n: "li-block",
                iconClass: "icon-settings-blocked",
                onClick: this.onBlockContact
            }, l10n.t("block_contact"))));
            var c = null ;
            if (this.props.onMediaGallery && a) {
                var u = r.createElement("span", {
                    className: "icon icon-chevron-right-alt"
                });
                c = r.createElement(y, {
                    title: l10n.t("media"),
                    titleOnClick: this.props.onMediaGallery,
                    subtitle: u,
                    classes: "animate-enter2",
                    noContainer: !0
                }, r.createElement(f, {
                    chat: a
                }))
            }
            var d = null
              , p = a && a.mute.canMute() ? r.createElement(N, {
                chat: a
            }) : null
              , C = null
              , T = null
              , k = null ;
            (p || C || T) && (k = r.createElement(y, {
                classes: "well-simple animate-enter2"
            }, p, C, T));
            var x = r.createElement(M, {
                classes: "row-drawer-item"
            }, r.createElement(S, {
                classes: "title",
                selectable: !0,
                direction: "auto",
                text: this.state.status
            }))
              , P = r.createElement(M, {
                classes: "row-drawer-item last"
            }, r.createElement(b, {
                className: "selectable-text title",
                onCopy: this.onCopyPhone,
                dir: "auto"
            }, w.formattedUser(i.id)))
              , D = null ;
            return D = r.createElement(y, {
                classes: "animate-enter2 well-simple-body",
                title: l10n.t("contact_info_status_phone")
            }, x, P),
            r.createElement(m, {
                key: "contact-info-modal",
                id: "info",
                variant: "panel",
                onCancel: this.onClose
            }, r.createElement("header", {
                className: "pane-header"
            }, r.createElement("div", {
                className: "header-close"
            }, r.createElement("button", {
                onClick: this.onClose
            }, r.createElement("span", {
                className: "icon icon-x"
            }))), r.createElement("div", {
                className: "header-body"
            }, r.createElement("div", {
                className: "header-main"
            }, r.createElement("div", {
                className: "header-title"
            }, l10n.t("web_contact_info"))))), r.createElement(g, {
                "data-list-scroll-container": !0
            }, r.createElement(y, {
                classes: "drawer-scale drawer-section-photo"
            }, r.createElement(E, {
                id: i.id,
                size: E.Size.LARGE,
                loader: !0,
                onLoad: this.onDetailImageLoad,
                onClick: this.onViewPicture,
                quality: E.Quality.HIGH
            })), c, k, D, d, e, s, t))
        }
    });
    P.contextTypes = {
        uim: r.PropTypes.instanceOf(x)
    },
    e.exports = P
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(9)
      , o = n(987)
      , a = n(133)
      , s = n(992)
      , c = n(990)
      , l = n(993)
      , u = n(991)
      , d = n(1008)
      , p = n(1129)
      , h = n(1034)
      , f = n(136)
      , m = n(431)
      , g = n(986)
      , v = n(14)
      , y = n(43)
      , E = n(10)
      , b = n(67)
      , S = r.createClass({
        displayName: "ContactMsgInfoDrawer",
        mixins: [o, a, s],
        propTypes: {
            msg: r.PropTypes.instanceOf(g)
        },
        getInitialState: function() {
            return {
                msgInfo: void 0,
                star: this.async("msg.star")
            }
        },
        componentWillMount: function() {
            var e = this;
            Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t) {
                e.setState({
                    msgInfo: t
                }),
                e.addObserver(t, "change:playedRemaining change:readRemaining change:deliveryRemaining")
            })["catch"](v.Unmount, _.noop)["catch"](function() {
                e.setState({
                    unimplemented: !0
                }),
                i.openToast(r.createElement(m, {
                    msg: l10n.t("msg_info_failed"),
                    id: m.genId("msg_info_failed")
                }))
            })
        },
        componentDidMount: function() {
            if (this.props.msg.type === g.TYPE.IMAGE && (this.refs.scrollable.scrollTop = this.refs.scrollable.scrollHeight),
            this.props.msg.isGif) {
                var e = this.getMsgComponent();
                e.play()
            }
        },
        isMsgVisible: function(e) {
            var t = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1];
            return e === this.props.msg.id && (!!t || this.getMsgComponent())
        },
        getMsgComponent: function() {
            var e = this.refs.wrapper;
            if (e)
                return e.refs.component && e.refs.component.refs.msg
        },
        onClose: function() {
            this.context.uim.uie.requestDismiss()
        },
        render: function() {
            var e = this.props.msg
              , t = this.state
              , n = t.msgInfo
              , i = t.star
              , o = t.unimplemented
              , a = void 0
              , s = void 0;
            if (n) {
                var m = []
                  , v = void 0
                  , _ = void 0
                  , b = void 0;
                n.isPTT && (s = l10n.t("message_info_seen"),
                v = n.played.head(),
                _ = v && v.t,
                b = r.createElement("span", {
                    className: "icon icon-status icon-status-ptt-blue"
                }),
                m.push(r.createElement(p, {
                    title: l10n.t("message_info_played"),
                    t: _,
                    icon: b,
                    key: "played"
                }))),
                v = n.read.head(),
                _ = v && v.t,
                b = r.createElement("span", {
                    className: "icon icon-status icon-status-dblcheck-ack"
                }),
                s = s || l10n.t("message_info_read"),
                m.push(r.createElement(p, {
                    title: s,
                    t: _,
                    icon: b,
                    key: "read"
                })),
                v = n.delivery.head(),
                _ = v && v.t,
                b = r.createElement("span", {
                    className: "icon icon-status icon-status-dblcheck"
                }),
                m.push(r.createElement(p, {
                    title: l10n.t("message_info_delivered"),
                    t: _,
                    icon: b,
                    key: "delivery"
                })),
                a = r.createElement(d, {
                    classes: "drawer-section-info well animate-enter"
                }, m)
            }
            var S = void 0;
            n || o || (S = r.createElement(d, {
                classes: "drawer-section-spinner",
                key: "spinner"
            }, r.createElement(f, {
                size: 50,
                stroke: 4
            })));
            var M = y("pane-preview-wrapper", "pane-preview-wrapper-bg", {
                "pane-preview-resize": e.type === g.TYPE.PTT || e.type === g.TYPE.IMAGE || e.type === g.TYPE.LOCATION || e.type === g.TYPE.VCARD || e.isGif
            });
            return r.createElement(c, {
                key: "message-info-modal",
                id: "info",
                variant: "panel",
                onCancel: this.onClose
            }, r.createElement(l, {
                title: l10n.t("message_info"),
                type: l.Type.SMALL,
                onCancel: this.onClose
            }), r.createElement("div", {
                className: M,
                ref: "scrollable"
            }, r.createElement("div", {
                className: "pane-preview"
            }, r.createElement("div", {
                className: "pane-chat-tile"
            }), r.createElement(h, {
                msg: e,
                key: "star-" + i.toString(),
                ref: "wrapper",
                displayType: E.DISP_TYPE.MSG_INFO,
                isMsgVisible: this.isMsgVisible,
                position: h.Position.END
            }))), r.createElement(u, {
                classes: "drawer-body-msg-info"
            }, S, a))
        }
    });
    S.contextTypes = {
        uim: r.PropTypes.instanceOf(b)
    },
    e.exports = S
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(434)
      , o = n(1)
      , a = n(988)
      , s = n(9)
      , c = n(987)
      , l = n(989)
      , u = r.createClass({
        displayName: "DeleteChatPopup",
        mixins: [c],
        propTypes: {
            onCancel: r.PropTypes.func,
            onDeleteOrExit: r.PropTypes.func,
            chat: r.PropTypes.instanceOf(a).isRequired
        },
        getInitialState: function() {
            return {
                isReadOnly: this.async("chat.isReadOnly")
            }
        },
        getText: function() {
            var e = this.props.chat
              , t = e.title();
            return e.isGroup ? this.state.isReadOnly ? l10n.t("web_delete_group_dialog_title", {
                groupName: t
            }) : l10n.t("web_exit_group_dialog_title", {
                groupName: t
            }) : e.isUser ? l10n.t("delete_chat_dialog_title", {
                name: t
            }) : e.isBroadcast ? l10n.t("delete_list_dialog_title") : void 0
        },
        getButton: function() {
            var e = this.props.chat;
            return e.isGroup ? this.state.isReadOnly ? l10n.t("web_delete") : l10n.t("web_exit") : e.isUser || e.isBroadcast ? l10n.t("web_delete") : void 0
        },
        onCancel: function() {
            s.closeModal(),
            _.isFunction(this.props.onCancel) && this.props.onCancel()
        },
        onDelete: function() {
            var e, t = this.props.chat;
            t.isGroup ? e = this.state.isReadOnly ? t.sendDelete() : t.sendExit() : t.isUser || t.isBroadcast ? e = t.sendDelete() : o.error("deleteChatPopup:onDelete Unsupported chat type")(),
            _.isFunction(this.props.onDeleteOrExit) && e && this.props.onDeleteOrExit(e),
            s.closeModal()
        },
        render: function() {
            return r.createElement("div", {
                className: "backdrop"
            }, r.createElement("div", {
                className: "popup-container"
            }, r.createElement("div", {
                className: "popup"
            }, r.createElement("div", {
                className: "popup-body"
            }, r.createElement("div", {
                className: "popup-title"
            }, l10n.t("are_you_sure")), r.createElement("div", {
                className: "popup-contents"
            }, r.createElement(l, {
                text: this.getText()
            }))), r.createElement("div", {
                className: "popup-controls"
            }, r.createElement("button", {
                "data-a8n": i.key("cancel-btn"),
                className: "btn-plain popup-controls-item",
                onClick: this.onCancel
            }, l10n.t("web_cancel")), r.createElement("button", {
                "data-a8n": i.key("delete-btn"),
                className: "btn-plain btn-default popup-controls-item",
                onClick: this.onDelete
            }, this.getButton())))))
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(434)
      , o = n(1)
      , a = n(9)
      , s = n(1021)
      , c = n(431)
      , l = n(43)
      , u = n(0)
      , d = {
        title: 0,
        hour: 1,
        day: 24,
        week: 168
    }
      , p = r.createClass({
        displayName: "DoNotDisturbSettings",
        getInitialState: function() {
            return {
                notifications: Store.Mute.getGlobalNotifications(),
                sounds: Store.Mute.getGlobalSounds(),
                previews: Store.Mute.getGlobalPreviews(),
                dnd: d.title
            }
        },
        componentWillUnmount: function() {
            this.state.dnd !== d.title && a.openToast(r.createElement(c, {
                msg: this.globalMuteDurationLabel(this.state.dnd),
                id: c.genId()
            }))
        },
        globalMuteDurationLabel: function(e) {
            switch (this.state.dnd) {
            case 1:
                return l10n.t("global_muted_1hour");
            case 24:
                return l10n.t("global_muted_1day");
            case 168:
                return l10n.t("global_muted_1week");
            default:
                return o.log("DoNotDisturbSettings:globalMuteDurationLabel non standard global mute duration:" + e)(),
                l10n.t("global_muted")
            }
        },
        onSounds: function() {
            var e = !this.state.sounds;
            this.setState({
                sounds: e
            }),
            Store.Mute.setGlobalSounds(e)
        },
        onNotifications: function() {
            var e = !this.state.notifications;
            this.setState({
                notifications: e
            }),
            Store.Mute.setGlobalNotifications(e)
        },
        onPreviews: function() {
            var e = !this.state.previews;
            this.setState({
                previews: e
            }),
            Store.Mute.setGlobalPreviews(e)
        },
        onDND: function(e) {
            var t = parseInt(e.target.value, 10);
            if (0 === t)
                return this.setState({
                    dnd: d.title
                }),
                void Store.Mute.globalMute().unmute();
            this.setState({
                dnd: t
            });
            var n = u().unix() + 60 * e.target.value * 60;
            Store.Mute.globalMute().mute(n)
        },
        onClose: function(e) {
            a.closeModal()
        },
        render: function() {
            var e = [];
            if (window.Notification) {
                e.push(r.createElement("div", {
                    className: "controls-section",
                    onClick: this.onNotifications,
                    key: 0
                }, r.createElement("div", {
                    "data-a8n": i.key("menu-icon-notifications"),
                    className: "control"
                }, r.createElement(s, {
                    onChange: this.onNotifications,
                    checked: this.state.notifications
                })), r.createElement("div", {
                    className: "label"
                }, l10n.t("option_desktop_notifications"))));
                var t = l("controls-section", {
                    disabled: !this.state.notifications
                });
                e.push(r.createElement("div", {
                    className: t,
                    onClick: this.onPreviews,
                    key: 1
                }, r.createElement("div", {
                    "data-a8n": i.key("menu-icon-notifications"),
                    className: "control"
                }, r.createElement(s, {
                    onChange: this.onPreviews,
                    checked: this.state.previews
                })), r.createElement("div", {
                    className: "label"
                }, l10n.t("option_msg_previews"), r.createElement("div", {
                    className: "hint"
                }, l10n.t("option_msg_previews_hint_text")))))
            }
            return r.createElement("div", {
                className: "controls-container drawer-section"
            }, r.createElement("div", {
                className: "controls-section",
                onClick: this.onSounds
            }, r.createElement("div", {
                "data-a8n": i.key("menu-icon-notifications"),
                className: "control"
            }, r.createElement(s, {
                onChange: this.onSounds,
                checked: this.state.sounds
            })), r.createElement("div", {
                className: "label"
            }, l10n.t("option_sounds"))), e, r.createElement("div", {
                className: "controls-section controls-section-wide"
            }, r.createElement("div", {
                className: "select"
            }, r.createElement("select", {
                value: this.state.dnd,
                onChange: this.onDND
            }, r.createElement("option", {
                value: d.title,
                disabled: this.state.state === d.title
            }, l10n.t("option_select_mute")), r.createElement("option", {
                value: d.hour,
                disabled: this.state.state === d.hour
            }, l10n.t("mute_1hour")), r.createElement("option", {
                value: d.day,
                disabled: this.state.state === d.day
            }, l10n.t("mute_1day")), r.createElement("option", {
                value: d.week,
                disabled: this.state.state === d.week
            }, l10n.t("mute_1week"))))))
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(43)
      , o = r.createClass({
        displayName: "DrawerItem",
        propTypes: {
            title: r.PropTypes.node,
            icon: r.PropTypes.node,
            classes: r.PropTypes.string,
            onClick: r.PropTypes.func
        },
        render: function() {
            var e = this.props
              , t = e.onClick
              , n = e.title
              , o = e.icon
              , a = e.classes
              , s = e.children
              , c = i("drawer-button", a, {
                clickable: t
            })
              , l = i("contents", {
                "drawer-button-row": o
            })
              , u = i({
                "col-main": o
            })
              , d = i({
                "col-side": o
            });
            return r.createElement("div", {
                className: c,
                onClick: t
            }, r.createElement("div", {
                className: l
            }, r.createElement("div", {
                className: u
            }, r.createElement("div", {
                className: "primary"
            }, n), r.createElement("div", {
                className: "secondary"
            }, s)), r.createElement("div", {
                className: d
            }, o)))
        }
    });
    e.exports = o
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(43)
      , o = r.createClass({
        displayName: "DrawerSectionFooter",
        propTypes: {
            children: r.PropTypes.node.isRequired,
            separator: r.PropTypes.bool
        },
        getDefaultProps: function() {
            return {
                separator: !1
            }
        },
        render: function() {
            var e = i("drawer-section-footer", {
                separator: this.props.separator
            });
            return r.createElement("div", {
                className: e
            }, r.createElement("div", {
                className: "col-main"
            }, this.props.children))
        }
    });
    e.exports = o
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(9)
      , o = n(10)
      , a = n(83)
      , s = n(23)
      , c = n(429)
      , l = n(67)
      , u = r.createClass({
        displayName: "E2EInfoModal",
        propTypes: {
            e2eSubtype: r.PropTypes.string.isRequired,
            jid: r.PropTypes.string,
            chatId: r.PropTypes.string,
            unencryptedContact: r.PropTypes.string
        },
        onLearnMore: function() {
            var e;
            switch (this.props.e2eSubtype) {
            case "info_encrypted":
            case "info_unencrypted":
                e = o.E2E_FAQ_LINK;
                break;
            case "identity":
                e = o.CODE_CHANGE_FAQ_LINK;
                break;
            case "encrypt":
            default:
                e = o.SECURITY_LINK
            }
            var t = a.build(e, {
                lg: Store.Conn.lg,
                lc: Store.Conn.lc
            });
            window.open(t, "_blank")
        },
        onVerificationClick: function() {
            i.closeModal(),
            i.verificationDrawer(this.props.jid)
        },
        render: function() {
            var e, t = null , n = null , o = i.closeModal.bind(i), a = l10n.t("web_ok");
            switch (this.props.e2eSubtype) {
            case "info_encrypted":
                s.isGroup(this.props.chatId) ? e = l10n.t("web_group_info_encrypted_description") : s.isBroadcast(this.props.chatId) && (e = l10n.t("web_broadcast_info_encrypted_description"));
                break;
            case "info_unencrypted":
                e = s.isGroup(this.props.chatId) ? l10n.t("web_group_info_unencrypted_description") : s.isBroadcast(this.props.chatId) ? l10n.t("web_broadcast_info_unencrypted_description") : l10n.t("web_contact_info_unencrypted_description", {
                    contact: this.props.unencryptedContact
                });
                break;
            case "identity":
                var l = Store.Contact.get(this.props.jid)
                  , u = l ? l.formattedName : "";
                e = l10n.t("web_security_code_change_description", {
                    name: u
                }),
                t = o,
                n = a,
                o = this.onVerificationClick,
                a = l10n.t("web_verify_button");
                break;
            case "encrypt":
            default:
                e = s.isGroup(this.props.chatId) ? l10n.t("web_group_encryption_state_change_description") : s.isBroadcast(this.props.chatId) ? l10n.t("web_broadcast_encryption_state_change_description") : l10n.t("web_individual_chat_encryption_state_change_description")
            }
            var d = r.createElement("span", {
                className: "action",
                onClick: this.onLearnMore
            }, l10n.t("learn_more"));
            return r.createElement(c, {
                onOK: o,
                okText: a,
                onCancel: t,
                cancelText: n
            }, e, "", d)
        }
    });
    u.contextTypes = {
        uim: r.PropTypes.instanceOf(l)
    },
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(987)
      , o = n(133)
      , a = n(9)
      , s = n(988)
      , c = n(137)
      , l = n(997)
      , u = n(1004)
      , d = n(1026)
      , p = n(990)
      , h = n(991)
      , f = n(1008)
      , m = n(1013)
      , g = n(1046)
      , v = n(989)
      , y = n(995)
      , _ = n(429)
      , E = n(1200)
      , b = n(431)
      , S = n(998)
      , M = n(1011)
      , C = n(1012)
      , T = n(209)
      , w = n(67)
      , k = n(1080)
      , x = n(10)
      , N = b.genId("max_participant_toast")
      , P = r.createClass({
        displayName: "GroupInfoDrawer",
        mixins: [i, o],
        propTypes: {
            chat: r.PropTypes.instanceOf(s).isRequired
        },
        getInitialState: function() {
            return {
                imgFull: this.async("chat.ProfilePicThumb.imgFull"),
                name: this.async("chat.contact.name") || "",
                isReadOnly: this.async("chat.isReadOnly"),
                pendingSubject: !1,
                pendingPhoto: !1,
                everyoneEncrypted: this.async("chat.contact.plaintextDisabled"),
                contextMenu: !1
            }
        },
        componentWillMount: function() {
            var e = this.props.chat.groupMetadata;
            this.addObserver(e.participants, "add remove reset sort change:isAdmin")
        },
        onImageSet: function(e, t) {
            var n = Store.ProfilePicThumb.get(this.props.chat.id);
            this.setState({
                pendingPhoto: !0
            });
            var r;
            r = e && t ? n.setPicture(e, t) : n.deletePicture(),
            r.bind(this).then(function() {
                this.isMounted() && this.setState({
                    pendingPhoto: !1
                })
            })
        },
        onParticipantClick: function(e, t) {
            Store.Conn.me !== t.id && Store.Chat.find(t.id).then(function(e) {
                a.openChat(e)
            })
        },
        menuEnabled: function(e) {
            var t = this.props.chat.groupMetadata.participants
              , n = t.get(e.id);
            return n && (t.canPromote(n) || t.canRemove(n) || t.canVerifyIdentity(n))
        },
        onParticipantMenu: function(e, t) {
            var n = this.props.chat.groupMetadata.participants
              , i = n.get(t.id);
            if (this.menuEnabled(t)) {
                var o = [];
                if (n.canPromote(i)) {
                    var a = this.confirmParticipantPromote.bind(this, i);
                    o.push(r.createElement(y, {
                        a8n: "mi-grp-promote-admin",
                        key: "promote",
                        action: a
                    }, l10n.t("menuitem_make_group_admin")))
                }
                if (n.canRemove(i)) {
                    var s = this.confirmParticipantRemove.bind(this, i);
                    o.push(r.createElement(y, {
                        a8n: "mi-grp-remove-participant",
                        key: "remove",
                        action: s,
                        shortcut: "d"
                    }, l10n.t("menuitem_remove")))
                }
                e.event && e.event.persist(),
                this.setState({
                    contextMenu: {
                        contactId: t.id,
                        menu: o,
                        anchor: e.anchor,
                        event: e.event
                    }
                })
            }
        },
        contextClose: function() {
            this.setState({
                contextMenu: !1
            })
        },
        confirmParticipantRemove: function(e) {
            var t = this.onParticipantRemove.bind(this, e)
              , n = l10n.t("confirm_remove_group_participant", {
                participant: e.contact.formattedName,
                subject: this.props.chat.contact.name
            });
            a.openModal(r.createElement(_, {
                onOK: t,
                okText: l10n.t("remove"),
                onCancel: a.closeModal.bind(a),
                cancelText: l10n.t("web_cancel")
            }, r.createElement(v, {
                text: n
            })))
        },
        onParticipantRemove: function(e) {
            e.contact.pendingAction++,
            this.props.chat.groupMetadata.participants.removeParticipant(e).then(function() {
                e.contact.pendingAction--
            }),
            a.closeModal()
        },
        confirmParticipantPromote: function(e) {
            var t = this.onParticipantPromote.bind(this, e)
              , n = l10n.t("confirm_promote_group_participant", {
                participant: e.contact.formattedName,
                subject: this.props.chat.contact.name
            });
            a.openModal(r.createElement(_, {
                onOK: t,
                okText: l10n.t("menuitem_make_group_admin"),
                onCancel: a.closeModal.bind(a),
                cancelText: l10n.t("web_cancel")
            }, r.createElement(v, {
                text: n
            })))
        },
        onParticipantPromote: function(e) {
            e.contact.pendingAction++,
            this.props.chat.groupMetadata.participants.promoteParticipant(e).then(function() {
                e.contact.pendingAction--
            }),
            a.closeModal()
        },
        onVerifyIdentity: function(e) {
            this.props.onVerification(e.contact)
        },
        openAddGroupParticipantFlow: function() {
            if (this.props.chat.groupMetadata.participants.length >= x.MAX_GROUP_SIZE) {
                var e = l10n.t("action_group_create_failed_participant", {
                    max: x.MAX_GROUP_SIZE
                });
                a.openToast(r.createElement(b, {
                    msg: e,
                    id: N
                }))
            } else {
                var t = r.createElement(E, {
                    chat: this.props.chat
                });
                a.openModal(t, "modal-flow")
            }
        },
        onClose: function() {
            this.props.onClose ? this.props.onClose() : this.context.uim.uie.requestDismiss()
        },
        onExitOrDeleteGroup: function() {
            a.deleteOrExitChat(this.props.chat)
        },
        onSubjectChange: function(e) {
            this.setState({
                name: e.target.value
            })
        },
        validateSubject: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? "" : arguments[0];
            return !!e.trim()
        },
        onSetSubjectError: function() {
            a.openModal(r.createElement(_, {
                onOK: a.closeModal.bind(a),
                okText: l10n.t("web_ok")
            }, l10n.t("action_group_subject_empty")))
        },
        onSetSubject: function(e) {
            var t = this.props.chat
              , n = t.groupMetadata;
            if (n.canSetSubject()) {
                var r = S.emojify(this.state.name);
                if (r === t.contact.name)
                    return this.setState({
                        name: r
                    });
                this.setState({
                    pendingSubject: !0
                }),
                t.setSubject(r).bind(this)["finally"](function() {
                    this.isMounted() && this.setState({
                        name: t.contact.name,
                        pendingSubject: !1
                    })
                })
            }
        },
        onCancelSubject: function() {
            this.setState({
                name: this.props.chat.contact.name
            })
        },
        render: function() {
            var e, t, n = this.props.chat, i = n.groupMetadata, o = this, a = i.participants.map(function(e) {
                var t = e.contact
                  , n = o.state.contextMenu && t.id === o.state.contextMenu.contactId;
                return r.createElement(u, {
                    contact: t,
                    key: e.id,
                    admin: !!e.isAdmin,
                    onClick: o.onParticipantClick,
                    contextEnabled: o.menuEnabled.bind(o, t),
                    contextMenu: n,
                    onContext: o.onParticipantMenu,
                    showNotifyName: !0
                })
            });
            n.canDelete() && (t = r.createElement("div", {
                className: "drawer-section chatlist list-icons animate-enter2 well-simple"
            }, r.createElement(m, {
                iconClass: "icon-exit",
                a8n: "li-delete-group",
                className: "danger first",
                onClick: this.onExitOrDeleteGroup
            }, n.isReadOnly ? l10n.t("web_delete_group") : l10n.t("web_exit_group")))),
            i.participants.canAdd() && (e = r.createElement("div", {
                className: "list-action list-action-alt",
                title: l10n.t("add_group_participant"),
                onClick: this.openAddGroupParticipantFlow
            }, r.createElement("div", {
                className: "list-action-icon"
            }, r.createElement("span", {
                className: "icon icon-add-user-light"
            })), r.createElement("div", {
                className: "list-action-body ellipsify"
            }, l10n.t("add_group_participant"))));
            var s = void 0;
            i.participants.iAmAdmin() && this.props.onGroupInviteLink && (s = r.createElement("div", {
                className: "list-action list-action-alt",
                title: l10n.t("group_invite_link"),
                onClick: this.props.onGroupInviteLink
            }, r.createElement("div", {
                className: "list-action-icon"
            }, r.createElement("span", {
                className: "icon icon-link"
            })), r.createElement("div", {
                className: "list-action-body ellipsify"
            }, l10n.t("group_invite_link"))));
            var v = a.length ? r.createElement(f, {
                title: l10n.t("web_participants_title"),
                subtitle: l10n.t("web_participants_count", {
                    count: a.length,
                    max: x.MAX_GROUP_SIZE
                }),
                "data-list-scroll-offset": !0,
                classes: "animate-enter2 well-simple-body",
                ref: "container",
                noContainer: !0
            }, e, s, r.createElement("div", {
                className: "drawer-section-body chatlist"
            }, r.createElement(l, {
                data: a,
                height: l.DEFAULT_HEIGHT,
                extraItems: 4
            }))) : null
              , y = null ;
            if (this.props.onMediaGallery) {
                var _ = r.createElement("span", {
                    className: "icon icon-chevron-right-alt"
                });
                y = r.createElement(f, {
                    title: l10n.t("media"),
                    titleOnClick: this.props.onMediaGallery,
                    subtitle: _,
                    classes: "animate-enter2",
                    noContainer: !0
                }, r.createElement(d, {
                    chat: n
                }))
            }
            var E = r.createElement(f, {
                title: l10n.t("subject"),
                classes: "animate-enter1 well-input"
            }, r.createElement(M, {
                value: this.state.name,
                editable: i.canSetSubject(),
                pending: this.state.pendingSubject,
                showRemaining: !0,
                validate: this.validateSubject,
                maxLength: x.MAX_SUBJECT_LENGTH,
                onChange: this.onSubjectChange,
                onSave: this.onSetSubject,
                onError: this.onSetSubjectError,
                onCancel: this.onCancelSubject,
                supportsEmoji: !0,
                lockable: !0,
                lowProfile: !0
            }))
              , b = n.contact.profilePicThumb
              , S = n.isReadOnly || !b.canDelete() && !b.canSet() ? g.Type.NO_EDIT : g.Type.GROUP
              , w = r.createElement(g, {
                type: S,
                id: n.contact.id,
                pending: this.state.pendingPhoto,
                startImage: this.state.imgFull,
                onImageSet: this.onImageSet
            })
              , N = null ;
            n.groupMetadata.creation && (N = r.createElement("div", {
                className: "header-secondary"
            }, l10n.t("web_group_creation_time", {
                when: c.relativeDateAndTimeStr(n.groupMetadata.creation)
            })));
            var P = null
              , D = n && n.mute.canMute() ? r.createElement(k, {
                chat: n
            }) : null
              , O = null
              , A = void 0;
            this.state.contextMenu && (A = r.createElement(T, {
                displayName: "ChatContextMenu",
                escapable: !0,
                popable: !0,
                requestDismiss: this.contextClose
            }, r.createElement(C, {
                contextMenu: this.state.contextMenu
            })));
            var R = null ;
            return (D || O || P) && (R = r.createElement(f, {
                classes: "well-simple animate-enter2"
            }, D, O, P)),
            r.createElement(p, {
                key: "contact-info-modal",
                id: "info",
                variant: "panel",
                onCancel: this.onClose
            }, r.createElement("header", {
                className: "pane-header"
            }, r.createElement("div", {
                className: "header-close"
            }, r.createElement("button", {
                onClick: this.onClose
            }, r.createElement("span", {
                className: "icon icon-x"
            }))), r.createElement("div", {
                className: "header-body"
            }, r.createElement("div", {
                className: "header-main"
            }, r.createElement("div", {
                className: "header-title"
            }, l10n.t("web_group_info"))), N)), r.createElement(h, {
                "data-list-scroll-container": !0
            }, r.createElement(f, {
                classes: "drawer-scale drawer-section-photo"
            }, w), E, y, R, v, t), A)
        }
    });
    P.contextTypes = {
        uim: r.PropTypes.instanceOf(w)
    },
    e.exports = P
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(988)
      , c = n(990)
      , l = n(993)
      , u = n(991)
      , d = n(136)
      , p = n(992)
      , h = n(14)
      , f = n(133)
      , m = n(994)
      , g = n(989)
      , v = n(1013)
      , y = n(1202)
      , E = n(1035)
      , b = n(9)
      , S = n(431)
      , M = {
        LOADING: 0,
        REVOKING: 1,
        SUCCESS: 2
    }
      , C = a.createClass({
        displayName: "GroupInviteLinkDrawer",
        mixins: [p, f],
        propTypes: {
            chat: a.PropTypes.instanceOf(s).isRequired,
            onBack: a.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                state: M.LOADING
            }
        },
        getErrorMessageFromStatusCode: function(e) {
            switch (e) {
            case 401:
                return l10n.t("group_invite_query_401");
            case 403:
                return l10n.t("group_invite_query_403");
            case 404:
                return l10n.t("group_invite_query_404");
            default:
                return l10n.t("group_invite_query_406")
            }
        },
        handleLoadingStatusCode: function(e) {
            if (200 === e)
                this.setState({
                    state: M.SUCCESS
                });
            else {
                var t = this.getErrorMessageFromStatusCode(e);
                this.props.onBack(),
                b.openToast(a.createElement(S, {
                    msg: t,
                    id: S.genId()
                }))
            }
        },
        componentWillMount: function() {
            this.addObserver(this.props.chat.groupMetadata, "change:inviteCode"),
            this.props.chat.groupMetadata.groupInviteCode().checkpoint(this.rejectOnUnmount).then(this.handleLoadingStatusCode)["catch"](h.Unmount, _.noop)
        },
        onRevokeGroupInvite: function() {
            b.openModal(a.createElement(y, {
                chat: this.props.chat,
                onConfirm: this.onConfirmRevokeGroupInvite
            }), "modal-flow")
        },
        handleRevokingStatusCode: function(e) {
            if (200 === e)
                b.openToast(a.createElement(S, {
                    msg: l10n.t("group_invite_revoke_success"),
                    id: S.genId()
                })),
                this.setState({
                    state: M.SUCCESS
                });
            else {
                var t = this.getErrorMessageFromStatusCode(e);
                this.props.onBack(),
                b.openToast(a.createElement(S, {
                    msg: t,
                    id: S.genId()
                }))
            }
        },
        onConfirmRevokeGroupInvite: function() {
            var e = this;
            this.setState({
                state: M.REVOKING
            }),
            o["default"].props({
                _: o["default"].delay(500),
                status: this.props.chat.groupMetadata.revokeGroupInvite()
            }).checkpoint(this.rejectOnUnmount).then(function(t) {
                var n = t.status;
                e.handleRevokingStatusCode(n)
            })["catch"](h.Unmount, _.noop)
        },
        onSendGroupInviteLink: function() {
            var e = this.props.chat.createMessageFromText(this.props.chat.groupMetadata.groupInviteLink);
            b.openModal(a.createElement(E, {
                msgs: [e],
                isGroupInviteForward: !0
            }), "modal-flow")
        },
        onClickGroupInviteLink: function(e) {
            e.preventDefault(),
            this.onSendGroupInviteLink()
        },
        onCopyLink: function() {
            window.getSelection().removeAllRanges();
            var e = document.querySelector("#group-invite-link-anchor")
              , t = document.createRange();
            t.selectNode(e),
            window.getSelection().addRange(t);
            var n = void 0;
            try {
                n = document.execCommand("copy"),
                window.getSelection().removeAllRanges()
            } catch (r) {
                n = !1
            }
            n ? b.openToast(a.createElement(S, {
                msg: l10n.t("group_invite_link_copy_success"),
                id: S.genId()
            })) : b.openToast(a.createElement(S, {
                msg: l10n.t("group_invite_link_copy_failed"),
                id: S.genId()
            }))
        },
        renderDrawerBody: function() {
            var e = this.props.chat.groupMetadata
              , t = void 0;
            if (this.state.state === M.LOADING)
                t = a.createElement("div", {
                    className: "group-invite-loading-container"
                }, a.createElement(d, {
                    className: "group-invite-spinner",
                    size: 55,
                    stroke: 3
                }), a.createElement("span", null , l10n.t("group_invite_check_link")));
            else if (this.state.state === M.REVOKING)
                t = a.createElement("div", {
                    className: "group-invite-loading-container"
                }, a.createElement(d, {
                    className: "group-invite-spinner",
                    size: 55,
                    stroke: 3
                }), a.createElement("span", null , l10n.t("group_invite_revoke_in_progress", {
                    groupName: this.props.chat.contact.name
                })));
            else {
                var n = e.groupInviteLink
                  , r = null ;
                document.queryCommandSupported("copy") && (r = a.createElement(v, {
                    iconClass: "icon-copy",
                    a8n: "li-copy-link",
                    onClick: this.onCopyLink
                }, l10n.t("group_invite_drawer_copy_link"))),
                t = a.createElement(u, {
                    wide: !0
                }, a.createElement("div", {
                    className: "chatlist list-identity list-invite"
                }, a.createElement("div", {
                    className: "chat chat-idle",
                    "data-ignore-capture": "any"
                }, a.createElement("div", {
                    className: "chat-avatar"
                }, a.createElement(m, {
                    id: this.props.chat.id,
                    size: 82,
                    quality: m.Quality.HIGH
                })), a.createElement("div", {
                    className: "chat-body"
                }, a.createElement("div", {
                    className: "chat-main"
                }, a.createElement("div", {
                    className: "chat-title"
                }, a.createElement("span", {
                    className: "emojitext ellipsify",
                    dir: "auto"
                }, a.createElement(g, {
                    text: this.props.chat.contact.name,
                    direction: "auto"
                })))), a.createElement("div", {
                    className: "chat-status"
                }, a.createElement("a", {
                    id: "group-invite-link-anchor",
                    href: n,
                    onClick: this.onClickGroupInviteLink
                }, n))))), a.createElement("div", {
                    className: "controls-container drawer-section"
                }, a.createElement("div", {
                    className: "controls-section"
                }, l10n.t("group_invite_link_description"))), a.createElement("div", {
                    className: "chatlist list-icons list-actions"
                }, a.createElement(v, {
                    iconClass: "icon-share",
                    a8n: "li-share-link",
                    onClick: this.onSendGroupInviteLink
                }, l10n.t("group_invite_drawer_send_link")), r, a.createElement(v, {
                    iconClass: "icon-revoke",
                    a8n: "li-revoke-link",
                    onClick: this.onRevokeGroupInvite
                }, l10n.t("group_invite_drawer_revoke_link"))))
            }
            return t
        },
        render: function() {
            return a.createElement(c, {
                id: "invite",
                onCancel: this.props.onBack
            }, a.createElement(l, {
                title: l10n.t("group_invite_link"),
                onBack: this.props.onBack,
                type: l.Type.SMALL
            }), this.renderDrawerBody())
        }
    });
    e.exports = C
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(892)
      , s = r(a)
      , c = n(6)
      , l = n(429)
      , u = n(136)
      , d = n(994)
      , p = n(1006)
      , h = n(992)
      , f = n(9)
      , m = n(14)
      , g = n(10)
      , v = n(45)
      , y = n(1037)
      , E = {
        LOADING: 0,
        SUCCESS: 1,
        ACCEPT_ERROR: 2,
        QUERY_ERROR: 3
    }
      , b = c.createClass({
        displayName: "GroupInviteModal",
        mixins: [h],
        props: {
            groupCode: c.PropTypes.string.isRequired
        },
        getInitialState: function() {
            return {
                state: E.LOADING,
                status: void 0,
                groupMetadata: void 0
            }
        },
        componentWillMount: function() {
            var e = this;
            v.groupInviteInfo(this.props.groupCode).checkpoint(this.rejectOnUnmount).then(function(t) {
                var n = t.status
                  , r = (0,
                s["default"])(t, ["status"]);
                if (200 === n) {
                    var i = new y(r);
                    Store.Contact.gadd(r.id),
                    e.setState({
                        status: n,
                        groupMetadata: i,
                        state: E.SUCCESS
                    })
                } else
                    e.setState({
                        status: n,
                        state: E.QUERY_ERROR
                    })
            })["catch"](m.Unmount, _.noop)
        },
        onViewGroup: function() {
            f.openChat(Store.Chat.get(this.state.groupMetadata.id)),
            f.closeModal()
        },
        onJoinGroup: function() {
            var e = this;
            v.acceptGroupInvite(this.props.groupCode).then(function(e) {
                var t = e.status
                  , n = e.gid;
                return 200 === t ? Store.Chat.find(n) : o["default"].reject(t)
            }).then(function(e) {
                f.openChat(e),
                f.closeModal()
            }).checkpoint(this.rejectOnUnmount)["catch"](m.Unmount, _.noop)["catch"](function(t) {
                e.setState({
                    state: E.ACCEPT_ERROR,
                    status: t
                })
            })
        },
        onCancel: function() {
            f.closeModal()
        },
        render: function() {
            var e = this.state
              , t = e.state
              , n = e.status
              , r = e.groupMetadata
              , i = {
                cancelText: l10n.t("group_invite_cancel"),
                onCancel: this.onCancel
            }
              , o = void 0;
            if (t === E.LOADING)
                o = c.createElement("div", {
                    className: "group-invite-loading-container"
                }, c.createElement(u, {
                    className: "group-invite-spinner",
                    size: 55,
                    stroke: 3
                }), c.createElement("span", null , l10n.t("group_invite_check_link")));
            else if (t === E.SUCCESS) {
                var a = r.participants.map(function(e) {
                    return c.createElement("div", {
                        key: e.id,
                        className: "participant-wrapper"
                    }, c.createElement(d, {
                        className: "participant-image",
                        size: 50,
                        id: e.id
                    }), c.createElement("span", {
                        className: "participant-text"
                    }, e.contact.formattedName))
                })
                  , s = Store.Contact.gadd(r.owner).formattedName
                  , h = "" + g.GROUP_INVITE_URL + this.props.groupCode;
                o = c.createElement("div", {
                    className: "group-invite-modal"
                }, c.createElement("div", {
                    className: "metadata-container"
                }, c.createElement("div", {
                    className: "metadata-icon"
                }, c.createElement("div", {
                    className: "icon-group-default"
                }), c.createElement(p, {
                    src: h
                })), c.createElement("div", {
                    className: "metadata-text"
                }, c.createElement("span", {
                    className: "metadata-title"
                }, r.subject), c.createElement("span", {
                    className: "metadata-subtitle"
                }, l10n.t("group_invite_created_by", {
                    participant: s
                })))), c.createElement("span", {
                    className: "participants-title"
                }, l10n.t("group_invite_participants", {
                    count: a.length,
                    _plural: a.length
                })), c.createElement("div", {
                    className: "participants-container"
                }, a));
                var f = Store.Chat.get(r.id)
                  , m = !!f && !f.isReadOnly;
                i.onOK = m ? this.onViewGroup : this.onJoinGroup,
                i.okText = m ? l10n.t("group_invite_view") : l10n.t("group_invite_join")
            } else {
                var v = void 0;
                if (t === E.QUERY_ERROR)
                    switch (n) {
                    case 401:
                        v = l10n.t("group_invite_query_401");
                        break;
                    case 403:
                        v = l10n.t("group_invite_query_403");
                        break;
                    case 404:
                        v = l10n.t("group_invite_query_404");
                        break;
                    case 406:
                        v = l10n.t("group_invite_query_406");
                        break;
                    case 410:
                        v = l10n.t("group_invite_query_410");
                        break;
                    default:
                        v = l10n.t("group_invite_query_500")
                    }
                else if (t === E.ACCEPT_ERROR)
                    switch (n) {
                    case 401:
                        v = l10n.t("group_invite_accept_401");
                        break;
                    case 404:
                        v = l10n.t("group_invite_accept_404");
                        break;
                    case 410:
                        v = l10n.t("group_invite_accept_410");
                        break;
                    case 419:
                        v = l10n.t("group_invite_accept_419");
                        break;
                    default:
                        v = l10n.t("group_invite_accept_500")
                    }
                i.cancelText = l10n.t("web_ok"),
                o = c.createElement("div", null , v)
            }
            return c.createElement(l, i, o)
        }
    });
    e.exports = b
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(429)
      , o = n(988)
      , a = n(9)
      , s = r.createClass({
        displayName: "GroupInviteRevokeModal",
        propTypes: {
            chat: r.PropTypes.instanceOf(o).isRequired,
            onConfirm: r.PropTypes.func.isRequired
        },
        onCancel: function() {
            a.closeModal()
        },
        onOK: function() {
            this.props.onConfirm(),
            a.closeModal()
        },
        render: function() {
            return r.createElement(i, {
                title: l10n.t("group_invite_drawer_revoke_link"),
                onOK: this.onOK,
                okText: l10n.t("group_invite_drawer_revoke_link"),
                onCancel: this.onCancel,
                cancelText: l10n.t("web_cancel")
            }, r.createElement("div", {
                className: "textfield-static"
            }, l10n.t("group_invite_revoke_confirmation_text", {
                groupName: this.props.chat.contact.name
            })))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(9)
      , o = n(987)
      , a = n(133)
      , s = n(992)
      , c = n(990)
      , l = n(993)
      , u = n(991)
      , d = n(1008)
      , p = n(1223)
      , h = n(1131)
      , f = n(1034)
      , m = n(136)
      , g = n(431)
      , v = n(986)
      , y = n(1281)
      , E = n(14)
      , b = n(43)
      , S = n(67)
      , M = n(10)
      , C = r.createClass({
        displayName: "GroupMsgInfoDrawer",
        mixins: [o, a, s],
        propTypes: {
            msg: r.PropTypes.instanceOf(v)
        },
        getInitialState: function() {
            return {
                msgInfo: void 0,
                star: this.async("msg.star")
            }
        },
        componentWillMount: function() {
            var e = this;
            Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t) {
                e.setState({
                    msgInfo: t
                }),
                e.addObserver(t.played, "add remove"),
                e.addObserver(t.read, "add remove"),
                e.addObserver(t.delivery, "add remove"),
                e.addObserver(t, "change:playedRemaining change:readRemaining change:deliveryRemaining")
            })["catch"](E.Unmount, _.noop)["catch"](function() {
                e.setState({
                    unimplemented: !0
                }),
                i.openToast(r.createElement(g, {
                    msg: l10n.t("msg_info_failed"),
                    id: g.genId("msg_info_failed")
                }))
            })
        },
        getAnimateEnterClass: function(e) {
            return "animate-enter" + (e === -1 ? "" : e)
        },
        componentDidMount: function() {
            if (this.props.msg.type === v.TYPE.IMAGE && (this.refs.scrollable.scrollTop = this.refs.scrollable.scrollHeight),
            this.props.msg.isGif) {
                var e = this.getMsgComponent();
                e.play()
            }
        },
        isMsgVisible: function(e) {
            var t = !(arguments.length <= 1 || void 0 === arguments[1]) && arguments[1];
            return e === this.props.msg.id && (!!t || this.getMsgComponent())
        },
        getMsgComponent: function() {
            var e = this.refs.wrapper;
            if (e)
                return e.refs.component && e.refs.component.refs.msg
        },
        onClose: function() {
            this.context.uim.uie.requestDismiss()
        },
        render: function() {
            var e, t = this.props.msg, n = this.state, i = n.msgInfo, o = n.star, a = n.unimplemented, s = -1, g = 24, _ = 26, E = void 0, S = void 0;
            if (i && i.isPTT) {
                var C = r.createElement("span", {
                    className: "icon icon-status icon-status-ptt-blue"
                })
                  , T = i.played.map(function(e) {
                    return r.createElement(h, {
                        participant: e,
                        key: e.id
                    })
                })
                  , w = T.length > 0 ? r.createElement("div", {
                    className: "chatlist chatlist-plain"
                }, T) : null
                  , k = i.playedRemaining > 0 ? r.createElement(p, null , l10n.t("message_info_remaining", {
                    count: i.playedRemaining,
                    _plural: i.playedRemaining
                })) : null
                  , x = b(this.getAnimateEnterClass(s), "well-simple-body");
                S = l10n.t("message_info_seen_by"),
                e = k ? g + _ : g,
                I = y.minHeight(T, e),
                E = r.createElement(d, {
                    classes: x,
                    key: "played-section",
                    style: I,
                    title: l10n.t("message_info_played_by"),
                    subtitle: C,
                    footer: k
                }, w)
            }
            var N = void 0;
            if (i && (i.read.length > 0 || i.playedRemaining > 0)) {
                var P = r.createElement("span", {
                    className: "icon icon-status icon-status-dblcheck-ack"
                })
                  , D = i.read.map(function(e) {
                    return r.createElement(h, {
                        participant: e,
                        key: e.id
                    })
                })
                  , O = D.length > 0 ? r.createElement("div", {
                    className: "chatlist chatlist-plain"
                }, D) : null
                  , A = i.readRemaining > 0 ? r.createElement(p, null , l10n.t("message_info_remaining", {
                    count: i.readRemaining,
                    _plural: i.readRemaining
                })) : null
                  , R = b(this.getAnimateEnterClass(s), "well-simple-body");
                S = S || l10n.t("message_info_read_by"),
                e = A ? g + _ : g;
                var I = y.minHeight(D, e);
                N = r.createElement(d, {
                    classes: R,
                    key: "read-section",
                    title: S,
                    style: I,
                    subtitle: P,
                    footer: A
                }, O)
            }
            var L = void 0;
            if (i && (i.delivery.length > 0 || i.deliveryRemaining > 0)) {
                var F = r.createElement("span", {
                    className: "icon icon-status icon-status-dblcheck"
                })
                  , U = i.delivery.map(function(e) {
                    return r.createElement(h, {
                        participant: e,
                        key: e.id
                    })
                })
                  , j = U.length > 0 ? r.createElement("div", {
                    className: "chatlist chatlist-plain"
                }, U) : null
                  , B = i.deliveryRemaining > 0 ? r.createElement(p, null , l10n.t("message_info_remaining", {
                    count: i.deliveryRemaining,
                    _plural: i.deliveryRemaining
                })) : null
                  , G = b(this.getAnimateEnterClass(s), "well-simple-body");
                e = B ? g + _ : g,
                I = y.minHeight(U, e),
                L = r.createElement(d, {
                    classes: G,
                    key: "delivered-section",
                    style: I,
                    title: l10n.t("message_info_delivered_to"),
                    subtitle: F,
                    footer: B
                }, j)
            }
            var Y = void 0;
            i || a || (Y = r.createElement(d, {
                classes: "drawer-section-spinner",
                key: "spinner"
            }, r.createElement(m, {
                size: 50,
                stroke: 4
            })));
            var H = b("pane-preview-wrapper", "pane-preview-wrapper-bg", {
                "pane-preview-resize": t.type === v.TYPE.PTT || t.type === v.TYPE.IMAGE || t.type === v.TYPE.LOCATION || t.type === v.TYPE.VCARD || t.isGif
            });
            return r.createElement(c, {
                key: "message-info-modal",
                id: "info",
                variant: "panel",
                onCancel: this.onClose
            }, r.createElement(l, {
                title: l10n.t("message_info"),
                type: l.Type.SMALL,
                onCancel: this.onClose
            }), r.createElement("div", {
                className: H,
                ref: "scrollable"
            }, r.createElement("div", {
                className: "pane-preview"
            }, r.createElement("div", {
                className: "pane-chat-tile"
            }), r.createElement(f, {
                msg: t,
                key: "star-" + o.toString(),
                ref: "wrapper",
                displayType: M.DISP_TYPE.MSG_INFO,
                isMsgVisible: this.isMsgVisible,
                position: f.Position.END
            }))), r.createElement(u, {
                classes: "drawer-body-msg-info"
            }, Y, E, N, L))
        }
    });
    C.contextTypes = {
        uim: r.PropTypes.instanceOf(S)
    },
    e.exports = C
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(1103)
      , c = n(988)
      , l = n(1019)
      , u = n(1e3)
      , d = n(996)
      , p = a.createClass({
        displayName: "GroupsModal",
        propTypes: {
            chats: a.PropTypes.arrayOf(a.PropTypes.instanceOf(c)),
            filter: a.PropTypes.func,
            onCancel: a.PropTypes.func.isRequired,
            onGroup: a.PropTypes.func.isRequired
        },
        getDefaultProps: function() {
            return {
                filter: function() {
                    return !0
                }
            }
        },
        getInitialState: function() {
            return this.selection = new u,
            {
                loading: !0,
                searchFilter: void 0
            }
        },
        componentWillMount: function() {
            var e = this
              , t = this.props.chats;
            o["default"].delay(300).then(function() {
                return o["default"].all(_.map(_.filter(t, function(e) {
                    return e.groupMetadata.stale
                }), function(e) {
                    return e.groupMetadata.update()["catch"](_.noop)
                }))
            }).then(function() {
                return e.setState({
                    loading: !1
                })
            })
        },
        onSelect: function(e, t) {
            var n = t.props.chat;
            this.props.filter(n) === !0 && this.props.onGroup(t.props.chat)
        },
        onSearch: function(e) {
            this.setState({
                searchFilter: e
            })
        },
        render: function() {
            var e = this
              , t = this.props
              , n = t.chats
              , r = t.onGroup
              , i = t.filter
              , o = t.onCancel
              , c = void 0;
            return this.state.loading ? c = a.createElement(d.Loading, null ) : !function() {
                var t = l10n.accentFold(e.state.searchFilter)
                  , o = n.filter(function(e) {
                    return i(e) && (!t || t && e.contact.searchMatch(t))
                });
                o.length ? (e.selection.init(_.map(o.filter(function(e) {
                    return i(e) === !0
                }), "id")),
                c = o.map(function(t) {
                    var n = void 0
                      , o = void 0;
                    return _.isString(i(t)) && (n = a.createElement("div", {
                        className: "chat-status ellipsify",
                        title: i(t)
                    }, i(t)),
                    o = "member"),
                    a.createElement(l, {
                        chat: t,
                        mode: l.Mode.INFO,
                        active: e.selection,
                        secondary: n,
                        noContext: !0,
                        className: o,
                        onClick: _.isString(i(t)) ? void 0 : r.bind(null , t),
                        key: t.id
                    })
                })) : c = a.createElement(d.SearchGroups, null )
            }(),
            a.createElement(s, {
                title: l10n.t("web_groups"),
                selection: this.selection,
                onSearch: this.onSearch,
                searchPlaceholder: l10n.t("search_groups"),
                onSelect: this.onSelect,
                onCancel: o
            }, c)
        }
    });
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(991)
      , s = n(1013)
      , c = n(1239)
      , l = n(9)
      , u = n(217)
      , d = n(83)
      , p = "animated-doodle"
      , h = n(1294)
      , f = {
        "class": ".animated-doodle",
        low: {
            "default": h
        },
        high: {
            "default": h
        }
    }
      , m = r.createClass({
        displayName: "HelpDrawer",
        propTypes: {
            onClose: r.PropTypes.func.isRequired
        },
        componentWillMount: function() {
            u.isAssetLoaded(p) || u.loadAsset(f, p)
        },
        onTOS: function() {
            var e = "https://www.whatsapp.com/legal/";
            e = d.build(e, {
                lg: l10n.getLocale()
            }),
            window.open(e, "_blank")
        },
        onFAQ: function() {
            var e = "http://www.whatsapp.com/faq/web";
            e = e = d.build(e, {
                lg: l10n.getLocale()
            }),
            window.open(e, "_blank")
        },
        onContactUs: function() {
            l.openModal(r.createElement(c, null ))
        },
        render: function() {
            return r.createElement(i, {
                onCancel: this.onBack,
                id: "help"
            }, r.createElement(o, {
                a8n: "drawer-title-help",
                title: l10n.t("help_drawer_title"),
                onBack: this.props.onClose,
                type: o.Type.LARGE
            }), r.createElement(a, {
                wide: !0
            }, r.createElement("div", {
                className: "controls-section animated-doodle"
            }), r.createElement("div", {
                className: "chatlist list-icons list-actions"
            }, r.createElement(s, {
                className: "drawer-list-item",
                a8n: "li-faq",
                onClick: this.onFAQ
            }, l10n.t("web_settings_faq")), r.createElement(s, {
                className: "drawer-list-item",
                a8n: "li-contact-us",
                onClick: this.onContactUs
            }, l10n.t("send_logs_title")), r.createElement(s, {
                className: "drawer-list-item",
                a8n: "li-tos",
                onClick: this.onTOS
            }, l10n.t("terms_and_privacy_link")))))
        }
    });
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = (n(988),
    n(986),
    n(1026))
      , g = n(1134)
      , v = n(1130)
      , y = n(209)
      , _ = n(990)
      , E = n(993)
      , b = n(991)
      , S = n(1109)
      , M = n(102)
      , C = n(212)
      , T = n(101)
      , w = n(31)
      , k = n(43)
      , x = {
        MEDIA: "media",
        LINKS: "links",
        DOCS: "docs"
    }
      , N = function(e) {
        function t() {
            (0,
            s["default"])(this, t);
            var e = (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments));
            return e.onSelectMessages = function() {
                e.state.selectable || e.setState({
                    selectable: !0
                })
            }
            ,
            e.onCancelSelection = function() {
                e.state.selectable && e.setState({
                    selectable: !1,
                    selectedMessages: {}
                })
            }
            ,
            e.onMessageSelect = function(t, n) {
                e.onSelectMessages();
                var r = w.clone(e.state.selectedMessages);
                n ? r[t.id] = t : delete r[t.id],
                e.setState({
                    selectedMessages: r
                })
            }
            ,
            e.state = {
                selected: x.MEDIA,
                direction: null ,
                selectable: !1,
                selectedMessages: {}
            },
            e
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "onSelectTab",
            value: function(e) {
                var t = w.values(x).indexOf(this.state.selected)
                  , n = w.values(x).indexOf(e)
                  , r = n > t ? "right" : "left";
                this.setState({
                    selected: e,
                    direction: r
                })
            }
        }, {
            key: "getTabs",
            value: function() {
                var e = this;
                if (!T.supportsFeature(T.F.LINK_DOC_GALLERY))
                    return null ;
                var t = [{
                    tab: x.MEDIA,
                    title: C.t("media")
                }, {
                    tab: x.LINKS,
                    title: C.t("links")
                }, {
                    tab: x.DOCS,
                    title: C.t("docs")
                }].map(function(t) {
                    var n = k("menu-item", {
                        active: e.state.selected === t.tab
                    });
                    return f.createElement("button", {
                        className: n,
                        onClick: e.onSelectTab.bind(e, t.tab),
                        key: t.tab,
                        title: t.title
                    }, t.title)
                });
                return f.createElement("div", {
                    className: "menu-tabs menu-tabs-lists",
                    "data-active-tab": this.state.selected
                }, t)
            }
        }, {
            key: "getContent",
            value: function() {
                var e = this.props.chat;
                if (!T.supportsFeature(T.F.LINK_DOC_GALLERY))
                    return f.createElement(m, {
                        chat: e,
                        selectable: this.state.selectable,
                        onMessageSelect: this.onMessageSelect,
                        selectedMessages: this.state.selectedMessages,
                        fullCollection: !0
                    });
                var t = void 0;
                switch (this.state.selected) {
                case x.MEDIA:
                    t = f.createElement(m, {
                        chat: e,
                        selectable: this.state.selectable,
                        onMessageSelect: this.onMessageSelect,
                        selectedMessages: this.state.selectedMessages,
                        fullCollection: !0
                    });
                    break;
                case x.LINKS:
                    t = f.createElement(g, {
                        chat: e,
                        selectable: this.state.selectable,
                        onMessageSelect: this.onMessageSelect,
                        selectedMessages: this.state.selectedMessages
                    });
                    break;
                case x.DOCS:
                    t = f.createElement(v, {
                        chat: e,
                        selectable: this.state.selectable,
                        onMessageSelect: this.onMessageSelect,
                        selectedMessages: this.state.selectedMessages
                    })
                }
                return t
            }
        }, {
            key: "render",
            value: function() {
                var e = this.props.chat
                  , t = this.getTabs()
                  , n = this.getContent()
                  , r = this.state.selectable ? f.createElement(y, {
                    displayName: "MediaMultiSelect",
                    escapable: !0,
                    requestDismiss: this.onCancelSelection
                }, f.createElement(S, {
                    chat: e,
                    noSortOnForward: !0,
                    selectedMessages: w.values(this.state.selectedMessages),
                    onCancel: this.onCancelSelection
                })) : null
                  , i = "right" === this.state.direction ? "slide-forward" : "slide-back";
                return f.createElement(_, {
                    id: "multimedia-gallery",
                    onCancel: this.props.onBack
                }, f.createElement(E, {
                    title: " ",
                    onBack: this.props.onBack,
                    type: E.Type.LARGE
                }), r, t, f.createElement(b, {
                    "data-list-scroll-container": !0
                }, f.createElement(M, {
                    transitionName: i,
                    className: "column"
                }, f.createElement("div", {
                    className: "multimedia-gallery",
                    key: this.state.selected
                }, f.createElement("div", {
                    className: "column"
                }, n)))))
            }
        }]),
        t
    }(f.Component);
    e.exports = N
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(987)
      , o = n(137)
      , a = n(43)
      , s = n(994)
      , c = n(989)
      , l = n(101)
      , u = n(986)
      , d = r.createClass({
        displayName: "MediaPanelHeader",
        propTypes: {
            msg: r.PropTypes.instanceOf(u).isRequired,
            onGoToMsgClick: r.PropTypes.func.isRequired,
            onUnstarClick: r.PropTypes.func.isRequired,
            onStarClick: r.PropTypes.func.isRequired,
            openForwardFlow: r.PropTypes.func.isRequired,
            onDownloadClick: r.PropTypes.func.isRequired,
            onClose: r.PropTypes.func.isRequired
        },
        mixins: [i],
        getInitialState: function() {
            return {
                url: this.async("msg.url")
            }
        },
        getMenuBtns: function() {
            var e = this.props.msg
              , t = null
              , n = null
              , i = null
              , o = null
              , s = "menu-item menu-item-hover";
            if (t = r.createElement("div", {
                className: s,
                onClick: this.props.onGoToMsgClick
            }, r.createElement("span", {
                className: "icon icon-bubble",
                title: l10n.t("go_to_message")
            })),
            l.supportsFeature(l.F.STARRED)) {
                var c = void 0
                  , u = void 0
                  , d = void 0;
                e.star ? (c = this.props.onUnstarClick,
                u = "icon icon-unstar-btn",
                d = l10n.t("unstar_message")) : (c = this.props.onStarClick,
                u = "icon icon-star-btn",
                d = l10n.t("star_message")),
                n = r.createElement("div", {
                    className: s,
                    onClick: c
                }, r.createElement("span", {
                    className: u,
                    title: d
                }))
            }
            return i = r.createElement("div", {
                className: s,
                onClick: this.props.openForwardFlow
            }, r.createElement("span", {
                className: "icon btn-media-forward icon-forward",
                title: l10n.t("forward")
            })),
            o = r.createElement("div", {
                className: a(s, {
                    disabled: !e.url
                }),
                onClick: this.props.onDownloadClick
            }, r.createElement("a", {
                className: "icon icon-download",
                title: l10n.t("web_button_download")
            })),
            {
                btnGoToMsg: t,
                btnStar: n,
                btnForward: i,
                btnDownload: o
            }
        },
        render: function() {
            var e = this.props.msg
              , t = e.displayName(!0, !0);
            e.isGroupMsg && (t += " @ " + e.chat.title());
            var n = this.getMenuBtns()
              , i = n.btnGoToMsg
              , l = n.btnStar
              , u = n.btnForward
              , d = n.btnDownload
              , p = a("media-panel-header", {});
            return r.createElement("div", {
                className: p
            }, r.createElement("div", {
                className: "chat media-chat"
            }, r.createElement("div", {
                className: "chat-avatar"
            }, r.createElement(s, {
                id: e.sender,
                size: 40
            })), r.createElement("div", {
                className: "chat-body"
            }, r.createElement("div", {
                className: "chat-main"
            }, r.createElement(c, {
                ellipsify: !0,
                text: t
            })), r.createElement("div", {
                className: "chat-secondary"
            }, r.createElement("div", {
                className: "chat-status ellipsify"
            }, o.relativeDateAndTimeStr(e.t))))), r.createElement("div", {
                className: "menu menu-horizontal media-panel-tools"
            }, i, l, u, d, r.createElement("div", {
                className: "menu-item menu-item-hover"
            }, r.createElement("button", {
                className: "icon icon-x-viewer",
                title: l10n.t("web_close"),
                onClick: this.props.onClose
            }))))
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(37)
      , o = n(986)
      , a = n(987)
      , s = n(134)
      , c = n(989)
      , l = n(1006)
      , u = n(1088)
      , d = n(1074)
      , p = n(1007)
      , h = n(1028)
      , f = n(9)
      , m = n(1035)
      , g = n(429)
      , v = n(1233)
      , y = n(1039)
      , E = n(101)
      , b = n(1113)
      , S = n(43)
      , M = n(209)
      , C = 500
      , T = 2
      , w = r.createClass({
        displayName: "MediaViewerModal",
        mixins: [a],
        propTypes: {
            msg: r.PropTypes.instanceOf(o).isRequired,
            zoomIn: r.PropTypes.bool,
            getZoomNode: r.PropTypes.func,
            onBack: r.PropTypes.func.isRequired,
            onExitAnimation: r.PropTypes.func,
            onNext: r.PropTypes.func,
            onPrev: r.PropTypes.func,
            onImgZoomIn: r.PropTypes.func
        },
        getDefaultProps: function() {
            return {
                getZoomNode: _.noop
            }
        },
        getInitialState: function() {
            return {
                star: this.async("msg.star"),
                mediaState: this.async("msg.mediaState"),
                imgZoomed: !1
            }
        },
        componentWillMount: function() {
            if (this.props.msg.mediaState === o.MEDIA_STATE.RESOLVED && this.props.zoomIn) {
                var e = this.props.getZoomNode(this.props.msg.id);
                this.setState({
                    zoomElement: e
                }),
                this.style = {
                    opacity: 0
                }
            }
        },
        componentDidMount: function() {
            this.style = {}
        },
        onImageLoad: function(e) {
            var t = this.state.zoomElement;
            t && e && this.props.zoomIn && !this.zoomed && (this.animateZoom(t, e),
            this.zoomed = !0)
        },
        animateZoom: function(e, t) {
            var n = this
              , r = t.getBoundingClientRect()
              , o = e.getBoundingClientRect()
              , a = o.top - r.top
              , s = o.left - r.left
              , c = e.clientWidth / t.clientWidth
              , l = (t.clientHeight - e.clientHeight) / 2
              , u = (t.clientWidth - e.clientWidth) / 2;
            a -= l,
            s -= u,
            Velocity(t, {
                opacity: 0,
                translateX: s,
                translateY: a,
                scale: c
            }, {
                duration: 0
            }).then(function() {
                Velocity(t, {
                    opacity: [1, 0],
                    translateX: [0, s],
                    translateY: [0, a],
                    scale: [1, c]
                }, {
                    duration: C,
                    easing: [.1, .82, .25, 1]
                });
                var e = i.findDOMNode(n.refs.caption);
                e && Velocity(e, {
                    opacity: [1, 0]
                }, {
                    duration: C
                })
            })
        },
        openForwardFlow: function(e) {
            e.stopPropagation();
            var t = this.props.msg;
            t.isUnsentMedia ? f.openModal(r.createElement(g, {
                title: l10n.t("err_unsent_forward_title"),
                onOK: f.closeModal.bind(f),
                okText: l10n.t("web_ok")
            }, l10n.t("err_unsent_forward_text"))) : f.openModal(r.createElement(m, {
                msgs: [this.props.msg]
            }), "modal-flow")
        },
        onScroll: function(e) {
            Math.abs(e.deltaY) > 7 && this.onClose()
        },
        onImgZoomIn: function(e) {
            if (e && this.refs.media) {
                var t = this.refs.media;
                this.listenToMouseMove = t.heightOveflow > 0 || t.widthOveflow > 0
            }
            this.setState({
                imgZoomed: e
            }),
            this.props.onImgZoomIn(e)
        },
        onZoomOut: function() {
            this.refs.media && this.state.imgZoomed && this.refs.media.onImageClick()
        },
        onMouseMove: function(e) {
            this.handleMouseMove(e.pageX, e.pageY)
        },
        handleMouseMove: _.throttle(function(e, t) {
            var n = this.refs.media && this.refs.media.refs.image
              , r = i.findDOMNode(n);
            if (r) {
                var o = r.parentNode
                  , a = o.parentNode
                  , s = this.refs.media.getTranslatePosition(a, e, t)
                  , c = s.translateX
                  , l = s.translateY;
                Velocity(o, "stop"),
                Velocity(o, {
                    translateX: c,
                    translateY: l,
                    scale: T
                }, {
                    duration: 0
                })
            }
        }, 42),
        onDownloadClick: function(e) {
            e.stopPropagation(),
            y.initDownload(this.props.msg)
        },
        onStarClick: function(e) {
            e.stopPropagation(),
            this.props.msg.chat.sendStarMsgs([this.props.msg], !0)
        },
        onUnstarClick: function(e) {
            e.stopPropagation(),
            this.props.msg.chat.sendStarMsgs([this.props.msg], !1)
        },
        onGoToMsgClick: function(e) {
            e.stopPropagation(),
            this.onClose();
            var t = this.props.msg;
            f.openChat(t.chat, t.chat.getSearchContext(t), !1),
            f.focusShowMsg(t.id)
        },
        getMenuBtns: function() {
            var e = this.props.msg
              , t = null
              , n = null
              , i = null
              , o = null
              , a = S("menu-item menu-item-hover", {
                disabled: !e.url
            });
            if (t = r.createElement("div", {
                className: "menu-item menu-item-hover",
                onClick: this.onGoToMsgClick
            }, r.createElement("span", {
                className: "icon icon-bubble",
                title: l10n.t("go_to_message")
            })),
            E.supportsFeature(E.F.STARRED)) {
                var s = void 0
                  , c = void 0
                  , l = void 0;
                e.star ? (s = this.onUnstarClick,
                c = "icon icon-unstar-btn",
                l = l10n.t("unstar_message")) : (s = this.onStarClick,
                c = "icon icon-star-btn",
                l = l10n.t("star_message")),
                n = r.createElement("div", {
                    className: a,
                    onClick: s
                }, r.createElement("span", {
                    className: c,
                    title: l
                }))
            }
            return i = r.createElement("div", {
                className: a,
                onClick: this.openForwardFlow
            }, r.createElement("span", {
                className: "icon btn-media-forward icon-forward",
                title: l10n.t("forward")
            })),
            o = r.createElement("div", {
                className: a,
                onClick: this.onDownloadClick
            }, r.createElement("a", {
                className: "icon icon-download",
                title: l10n.t("web_button_download")
            })),
            {
                btnGoToMsg: t,
                btnStar: n,
                btnForward: i,
                btnDownload: o
            }
        },
        onClose: function() {
            var e = this;
            if (!this.closing) {
                this.closing = !0,
                _.isFunction(this.props.onExitAnimation) && this.props.onExitAnimation();
                var t = this.props.getZoomNode(this.props.msg.id);
                if (!t)
                    return this.props.onBack();
                var n = this.refs.media
                  , r = void 0;
                if (n && n.refs) {
                    var a = this.props.msg.type;
                    a === o.TYPE.IMAGE ? r = n.refs.image : this.props.msg.isGif && (r = n.refs.player)
                }
                if (!r)
                    return this.props.onBack();
                r = i.findDOMNode(r);
                var s = r.getBoundingClientRect()
                  , c = t.getBoundingClientRect()
                  , l = c.top - s.top
                  , u = c.left - s.left
                  , d = t.clientWidth / r.clientWidth
                  , p = (r.clientHeight - t.clientHeight) / 2
                  , h = (r.clientWidth - t.clientWidth) / 2;
                l -= p,
                u -= h,
                Velocity(r, {
                    translateX: [u, 0],
                    translateY: [l, 0],
                    scale: [d, 1]
                }, {
                    duration: 200,
                    easing: [.1, .82, .25, 1]
                }).then(function() {
                    e.props.onBack()
                });
                var f = i.findDOMNode(this.refs.caption);
                f && Velocity(f, {
                    opacity: [0, 1]
                }, {
                    duration: 200,
                    easing: [.1, .82, .25, 1]
                })
            }
        },
        render: function() {
            var e, t = this.props.msg;
            switch (t.type) {
            case "image":
                e = r.createElement(k, {
                    msg: t,
                    key: t.id,
                    style: this.style,
                    onLoad: this.onImageLoad,
                    onImgZoomIn: this.onImgZoomIn,
                    ref: "media"
                });
                break;
            case "video":
                e = r.createElement(x, {
                    msg: t,
                    key: t.id,
                    onLoad: t.isGif ? this.onImageLoad : _.noop,
                    ref: "media"
                });
                break;
            case "audio":
                e = r.createElement(P, {
                    msg: t,
                    key: t.id
                })
            }
            var n = S("media-caption", {
                "caption-hidden": this.props.zoomIn && (t.isGif || "image" === t.type)
            })
              , i = void 0;
            if (t.caption) {
                var o = t.mentionMap();
                i = r.createElement(c, {
                    ref: "caption",
                    classes: n,
                    linkify: !0,
                    format: !0,
                    mention: o,
                    text: t.caption
                })
            }
            var a = S("media", {
                "media-with-caption": !!i
            })
              , s = r.createElement("span", {
                className: "icon icon-chevron-right icon-l",
                title: l10n.t("next_button")
            })
              , l = S("btn btn-round btn-media-next", {
                "disabled-btn": !this.props.onNext
            })
              , u = r.createElement("button", {
                className: l,
                onClick: this.props.onNext || function(e) {
                    return e.stopPropagation()
                }
            }, s)
              , d = r.createElement("span", {
                className: "icon icon-chevron-left icon-l",
                title: l10n.t("previous_button")
            })
              , p = S("btn btn-round btn-media-prev", {
                "disabled-btn": !this.props.onPrev
            })
              , h = r.createElement("button", {
                className: p,
                onClick: this.props.onPrev || function(e) {
                    return e.stopPropagation()
                }
            }, d)
              , f = S("media-viewer", {
                "media-viewer-animate": this.props.zoomIn,
                "cursor-zoom-out": this.state.imgZoomed
            })
              , m = this.state.imgZoomed ? null : this.onScroll
              , g = this.state.imgZoomed ? null : this.onClose
              , y = this.state.imgZoomed && this.listenToMouseMove ? this.onMouseMove : null
              , E = this.state.imgZoomed ? this.onZoomOut : null ;
            return r.createElement(M, {
                displayName: "MediaViewer",
                escapable: !0,
                requestDismiss: this.onClose
            }, r.createElement("div", {
                className: f,
                onClick: E,
                onMouseMove: y
            }, r.createElement(v, {
                msg: this.props.msg,
                onGoToMsgClick: this.onGoToMsgClick,
                onUnstarClick: this.onUnstarClick,
                onStarClick: this.onStarClick,
                openForwardFlow: this.openForwardFlow,
                onDownloadClick: this.onDownloadClick,
                onClose: this.onClose
            }), r.createElement("div", {
                className: "media-content",
                dir: "ltr",
                ref: "container",
                onWheel: m,
                onClick: g
            }, h, r.createElement("div", {
                className: a
            }, r.createElement(D, {
                msg: t
            }), e, i), u)))
        }
    })
      , k = r.createClass({
        displayName: "MediaImage",
        mixins: [a, s],
        propTypes: {
            msg: r.PropTypes.instanceOf(o).isRequired,
            style: r.PropTypes.object,
            onLoad: r.PropTypes.func,
            onImgZoomIn: r.PropTypes.func
        },
        getInitialState: function() {
            return {
                mediaState: this.async("msg.mediaState"),
                zoomIn: null
            }
        },
        componentDidMount: function() {
            this.props.msg.forceDownloadMedia()
        },
        onImageClick: function(e) {
            if (e && e.stopPropagation(),
            this.state.zoomIn)
                return this.props.onImgZoomIn(!1),
                void this.setState({
                    zoomIn: null
                });
            var t = i.findDOMNode(this.refs.image)
              , n = t.parentNode
              , r = n.parentNode;
            this.heightOveflow = n.clientHeight * T - r.clientHeight,
            this.widthOveflow = n.clientWidth * T - r.clientWidth;
            var o = this.getTranslatePosition(r, e.pageX, e.pageY)
              , a = o.translateX
              , s = o.translateY;
            this.props.onImgZoomIn(!0),
            this.setState({
                zoomIn: {
                    factor: T,
                    translateX: a,
                    translateY: s
                }
            })
        },
        getTranslatePosition: function(e, t, n) {
            var r = window.innerWidth / 2 - t
              , i = window.innerHeight / 2 - n
              , o = this.widthOveflow > 0 ? 1.5 * r * this.widthOveflow / e.clientWidth : 0
              , a = this.heightOveflow > 0 ? 1.5 * i * this.heightOveflow / e.clientHeight : 0;
            return {
                translateX: o,
                translateY: a
            }
        },
        render: function() {
            var e = this
              , t = this.props.msg
              , n = this.state.zoomIn
              , i = S("media-viewer-img", {
                "cursor-zoom-in": !n
            });
            if (t.mediaState === o.MEDIA_STATE.RESOLVED) {
                var a = {
                    width: t.fullWidth,
                    height: t.fullHeight
                }
                  , s = r.createElement(l, {
                    src: t.url,
                    ref: "image",
                    onClick: this.onImageClick,
                    style: this.props.style,
                    className: i
                });
                return n && (s = r.createElement(M, {
                    displayName: "ZoomInImage",
                    ref: "image",
                    escapable: !0,
                    requestDismiss: function() {
                        return e.onImageClick()
                    }
                }, s)),
                r.createElement(p, {
                    type: p.TYPES.ZOOM_IN,
                    size: a,
                    zoomIn: this.state.zoomIn,
                    onObjectLoad: this.props.onLoad
                }, s)
            }
            return r.createElement(N, {
                msg: t
            })
        }
    })
      , x = r.createClass({
        displayName: "MediaVideo",
        mixins: [a, s],
        propTypes: {
            msg: r.PropTypes.instanceOf(o).isRequired,
            style: r.PropTypes.object,
            onLoad: r.PropTypes.func
        },
        getInitialState: function() {
            return {
                played: !1,
                mediaState: this.async("msg.mediaState"),
                size: {
                    width: 0,
                    height: 0
                }
            }
        },
        componentWillMount: function() {
            this.updateSize()
        },
        componentWillReceiveProps: function() {
            this.updateSize()
        },
        componentDidMount: function() {
            var e = this.props.msg;
            e.forceDownloadMedia()
        },
        updateSize: function() {
            var e = this.props.msg;
            e.mediaState === o.MEDIA_STATE.RESOLVED && e.fullWidth && e.fullHeight && this.setState({
                size: this.getSize()
            })
        },
        onPlayerError: function(e) {},
        onPlayerClick: function(e) {
            e.stopPropagation();
            var t = i.findDOMNode(this.refs.player);
            e.clientY > t.clientHeight + t.offsetTop - 44 || (t.paused ? t.play() : t.pause())
        },
        onResize: function(e) {
            this.setState({
                size: e
            })
        },
        stopPropagation: function(e) {
            e.stopPropagation()
        },
        getSize: function() {
            var e = this.props.msg
              , t = 330;
            return !e.isGif || e.fullWidth >= t ? {
                width: e.fullWidth,
                height: e.fullHeight
            } : {
                width: t,
                height: e.fullHeight * t / e.fullWidth
            }
        },
        render: function() {
            var e = this.props.msg
              , t = "media-viewer-img"
              , n = e.mediaState === o.MEDIA_STATE.RESOLVED;
            return n ? r.createElement(p, {
                type: p.TYPES.SCALE_DOWN,
                size: this.state.size,
                onObjectLoad: this.props.onLoad,
                style: this.props.style
            }, r.createElement(u, {
                msg: e,
                ref: "player",
                className: t,
                onError: this.onPlayerError,
                onClick: e.isGif ? this.stopPropagation : this.onPlayerClick,
                autoPlay: !0,
                controls: !e.isGif,
                loop: e.isGif,
                onResize: this.onResize
            }, l10n.t("video_playback_not_supported"))) : r.createElement(N, {
                msg: e
            })
        }
    })
      , N = r.createClass({
        displayName: "BlurredImage",
        stopPropagation: function(e) {
            e.stopPropagation()
        },
        render: function() {
            var e = this.props.msg
              , t = "data:image/jpeg;base64," + e.body
              , n = b.boundHeightWidth(10 * e.height, 10 * e.width, 500, 500)
              , i = {
                width: n.width,
                height: n.height
            };
            return r.createElement("div", {
                className: "media-viewer-blur-crop",
                style: i,
                onClick: this.stopPropagation
            }, r.createElement("img", {
                className: "media-viewer-blur-img",
                src: t
            }))
        }
    })
      , P = r.createClass({
        displayName: "MediaAudio",
        mixins: [a],
        propTypes: {
            msg: r.PropTypes.instanceOf(o).isRequired
        },
        getInitialState: function() {
            return {
                mediaState: this.async("msg.mediaState")
            }
        },
        render: function() {
            var e = this.props.msg;
            return e.mediaState === o.MEDIA_STATE.RESOLVED ? r.createElement(d, {
                msg: e,
                className: "media-viewer-img media-viewer-audio",
                autoPlay: !0,
                controls: !0
            }, l10n.t("audio_playback_not_supported")) : r.createElement("div", {
                className: "image-audio"
            })
        }
    })
      , D = r.createClass({
        displayName: "MediaState",
        mixins: [a],
        propTypes: {
            msg: r.PropTypes.instanceOf(o).isRequired
        },
        getInitialState: function() {
            return {
                mediaState: this.async("msg.mediaState")
            }
        },
        onUnsupportedDownloadClick: function(e) {
            var t = this;
            e.stopPropagation(),
            f.openModal(r.createElement(g, {
                onCancel: f.closeModal.bind(f),
                onOK: function() {
                    f.closeModal(),
                    y.initDownload(t.props.msg)
                },
                okText: l10n.t("web_button_download"),
                cancelText: l10n.t("web_cancel"),
                title: l10n.t("download_unsupported_media_title")
            }, l10n.t("download_unsupported_media_prompt")))
        },
        downloadMedia: function(e) {
            e.stopPropagation(),
            this.props.msg.forceDownloadMedia()
        },
        stopPropagation: function(e) {
            e.stopPropagation()
        },
        render: function() {
            var e = this.props.msg
              , t = null ;
            if (e.local)
                return null ;
            switch (e.mediaState) {
            case o.MEDIA_STATE.RESOLVED:
            case o.MEDIA_STATE.ERROR_MISSING:
                return null ;
            case o.MEDIA_STATE.ERROR_UNSUPPORTED:
                return t = this.onUnsupportedDownloadClick,
                r.createElement(h.Download, {
                    filesize: e.size,
                    onClick: t
                });
            case o.MEDIA_STATE.NEED_POKE:
                return t = this.downloadMedia,
                r.createElement(h.Download, {
                    filesize: e.size,
                    onClick: t
                });
            default:
                return t = this.stopPropagation,
                r.createElement("div", {
                    onClick: t
                }, r.createElement(h.Pending, null ))
            }
        }
    });
    e.exports = w
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(988)
      , o = n(9)
      , a = n(989)
      , s = n(0)
      , c = function() {
        return [{
            label: l10n.t("web_mute_8hours"),
            duration: 8
        }, {
            label: l10n.t("web_mute_1week"),
            duration: 168
        }, {
            label: l10n.t("web_mute_1year"),
            duration: 8760
        }]
    }
      , l = r.createClass({
        displayName: "MutePopup",
        propTypes: {
            onCancel: r.PropTypes.func,
            onMute: r.PropTypes.func.isRequired,
            chat: r.PropTypes.instanceOf(i).isRequired
        },
        getInitialState: function() {
            return {
                mute: 8
            }
        },
        onChange: function(e) {
            this.setState({
                mute: parseInt(e.target.value, 10)
            })
        },
        onMute: function(e) {
            e.stopPropagation(),
            o.closeModal(),
            this.props.onMute(3600 * this.state.mute + s().unix(), !0)
        },
        render: function() {
            var e = this.props.onCancel || function() {
                o.closeModal()
            }
              , t = this.state.mute
              , n = this
              , i = c().map(function(e) {
                var i = e.duration;
                return r.createElement("li", {
                    key: "mute-" + i
                }, r.createElement("label", null , r.createElement("input", {
                    type: "radio",
                    name: "duration",
                    value: e.duration,
                    checked: t === i,
                    onChange: n.onChange
                }), e.label))
            });
            return r.createElement("div", {
                className: "backdrop"
            }, r.createElement("div", {
                className: "popup-container"
            }, r.createElement("div", {
                className: "popup"
            }, r.createElement("div", {
                className: "popup-body"
            }, r.createElement("div", {
                className: "popup-title",
                dir: "auto"
            }, r.createElement(a, {
                text: l10n.t("mute_time", {
                    name: this.props.chat.title()
                })
            })), r.createElement("div", {
                className: "popup-contents"
            }, r.createElement("form", {
                ref: "form"
            }, r.createElement("ol", {
                className: "choices"
            }, i)))), r.createElement("div", {
                className: "popup-controls"
            }, r.createElement("button", {
                className: "btn-plain popup-controls-item",
                onClick: e
            }, l10n.t("web_cancel")), r.createElement("button", {
                className: "btn-plain btn-default popup-controls-item",
                onClick: this.onMute
            }, l10n.t("web_menuitem_mute"))))))
        }
    });
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(991)
      , s = n(1011)
      , c = n(1046)
      , l = n(102)
      , u = n(998)
      , d = r.createClass({
        displayName: "NewGroupDrawer",
        propTypes: {
            thumb: r.PropTypes.string,
            full: r.PropTypes.string,
            subject: r.PropTypes.string,
            onBack: r.PropTypes.func.isRequired,
            onContinue: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                text: this.props.subject || "",
                thumb: this.props.thumb,
                full: this.props.full,
                emojiActive: !1
            }
        },
        componentDidMount: function() {
            this.refs.emojiInput.restoreFocus()
        },
        preventBlur: function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            this.refs.emojiInput.restoreFocus()
        },
        onImageSet: function(e, t) {
            this.setState({
                thumb: e,
                full: t
            })
        },
        onContinue: function() {
            var e = u.emojify(this.state.text.trim())
              , t = this.refs.photoPicker;
            if (t.state.isEditing) {
                var n = this;
                t.cropImage().then(function(t) {
                    n.props.onContinue(e, t.thumb, t.full)
                })
            } else
                this.props.onContinue(e, this.state.thumb, this.state.full)
        },
        onInputChange: function(e) {
            var t = e.target.value;
            this.setState({
                text: t
            })
        },
        render: function() {
            var e = this.state.text.trim().length > 0
              , t = e ? r.createElement("div", {
                className: "drawer-section drawer-controls"
            }, r.createElement("button", {
                className: "btn btn-round",
                onClick: this.onContinue
            }, r.createElement("span", {
                className: "icon icon-forward-light icon-l"
            }))) : null ;
            return r.createElement(i, {
                id: "new-group",
                onCancel: this.props.onBack
            }, r.createElement(o, {
                title: l10n.t("new_group_flow_title"),
                type: o.Type.LARGE,
                onBack: this.props.onBack
            }), r.createElement(a, {
                wide: !0
            }, r.createElement("div", {
                className: "drawer-section"
            }, r.createElement(c, {
                type: c.Type.GROUP,
                startImage: this.state.full,
                onImageSet: this.onImageSet,
                ref: "photoPicker"
            })), r.createElement("div", {
                className: "drawer-section",
                onMouseDown: this.preventBlur
            }, r.createElement(s, {
                ref: "emojiInput",
                value: this.state.text,
                maxLength: 25,
                showRemaining: !0,
                onChange: this.onInputChange,
                placeholder: l10n.t("group_subject"),
                onEnter: e ? this.onContinue : _.noop,
                supportsEmoji: !0
            })), r.createElement(l, {
                transitionName: "btn"
            }, t)))
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(991)
      , s = n(1073)
      , c = n(1140)
      , l = n(133)
      , u = n(10)
      , d = n(9)
      , p = n(431)
      , h = n(139)
      , f = n(102)
      , m = n(135)
      , g = m.HotKeys
      , v = p.genId("max_participant_toast")
      , y = r.createClass({
        displayName: "NewGroupParticipantsDrawer",
        mixins: [l],
        propTypes: {
            thumb: r.PropTypes.string,
            full: r.PropTypes.string,
            subject: r.PropTypes.string.isRequired,
            onBack: r.PropTypes.func.isRequired,
            onContinue: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            var e = this;
            return this.props.uimContext && (this.props.uimContext.uimClose = function() {
                e.onBack()
            }
            ),
            {
                searchText: "",
                participants: [],
                shouldFocus: !0
            }
        },
        getFilteredContacts: function() {
            var e = Store.Contact.getFilteredContacts();
            e = _.difference(e, this.state.participants);
            var t = this.state.searchText;
            return t ? (t = l10n.accentFold(t),
            e.filter(function(e) {
                return e.searchMatch(t)
            })) : e
        },
        componentDidMount: function() {
            this.focus()
        },
        componentDidUpdate: function() {
            this.adjustInput()
        },
        onKeyDown: function(e) {
            if ("Backspace" !== e.key || this.state.searchText || _.isEmpty(this.state.participants))
                "Enter" === e.key && _.size(this.state.participants) && this.onContinue();
            else {
                e.preventDefault();
                var t = this.state.participants;
                this.setState({
                    participants: t.slice(0, t.length - 1),
                    shouldFocus: !0
                })
            }
        },
        onInput: function(e) {
            this.setState({
                searchText: e.target.value
            })
        },
        adjustInput: function() {
            var e = this.refs.input.offsetParent.offsetWidth - 10
              , t = this.refs.sizer.offsetWidth
              , n = t > e ? e : t;
            this.refs.input.style.width = n + "px";
            var r;
            r = e - this.refs.input.offsetLeft - n > 0 ? e - this.refs.input.offsetLeft : e,
            this.refs.input.style.width = r + "px",
            this.state.shouldFocus && this.focus()
        },
        onReset: function() {
            this.setState({
                searchText: "",
                shouldFocus: !0
            })
        },
        focus: function() {
            h.focus(this.refs.input)
        },
        onBack: function() {
            var e = this.props;
            e.onBack(e.subject, e.thumb, e.full)
        },
        onContinue: function() {
            var e = this.props;
            e.onContinue(e.subject, e.thumb, e.full, this.state.participants)
        },
        onDelete: function(e, t) {
            var n = _.without(this.state.participants, t);
            this.setState({
                participants: n,
                shouldFocus: !n.length
            })
        },
        onContactClick: function(e, t) {
            var n = this.state.participants;
            if (_.includes(n, t))
                this.setState({
                    participants: _.without(n, t),
                    shouldFocus: !0
                });
            else if (n.length >= u.MAX_GROUP_SIZE) {
                var i = l10n.t("action_group_create_failed_participant", {
                    max: u.MAX_GROUP_SIZE
                });
                d.openToast(r.createElement(p, {
                    msg: i,
                    id: v
                }))
            } else
                this.setState({
                    participants: n.concat(t),
                    searchText: "",
                    shouldFocus: !0
                })
        },
        onFocusList: function(e) {
            this.refs.list && (e.preventDefault(),
            e.stopPropagation(),
            g.flashFocus = Date.now(),
            this.refs.list.focusFirst())
        },
        onFocusParticipants: function(e) {
            e.repeat || 0 !== this.refs.input.selectionStart || this.refs.participantList && (e.preventDefault(),
            e.stopPropagation(),
            g.flashFocus = null ,
            this.refs.participantList.focusLast())
        },
        onSelectFirst: function(e) {
            e.preventDefault(),
            e.stopPropagation();
            var t = _.head(this.getFilteredContacts());
            t && this.onContactClick(e, t)
        },
        onFocusSearch: function(e) {
            g.flashFocus = Date.now(),
            h.focus(this.refs.input)
        },
        render: function() {
            var e = _.size(this.state.participants) ? r.createElement("button", {
                className: "btn btn-round",
                onClick: this.onContinue
            }, r.createElement("span", {
                className: "icon icon-checkmark-light"
            })) : null
              , t = _.size(this.state.participants) ? " " : l10n.t("group_participant_hint")
              , n = {
                down: this.onFocusList,
                enter: this.state.searchText ? this.onSelectFirst : _.size(this.state.participants) ? this.onContinue : _.noop,
                up: this.onFocusParticipants
            };
            return n[l10n.LR("left", "right")] = this.onFocusParticipants,
            r.createElement(i, {
                id: "new-group",
                onCancel: this.onBack
            }, r.createElement(o, {
                title: l10n.t("add_group_participants_title"),
                type: o.Type.LARGE,
                onBack: this.onBack
            }), r.createElement(a, null , r.createElement("div", {
                className: "drawer-section new-group-search"
            }, r.createElement("div", {
                className: "input-clear input-ext"
            }, r.createElement(g, {
                handlers: n,
                className: "input input-line"
            }, r.createElement("div", {
                className: "list-names list-deletable new-group-preview"
            }, r.createElement("div", {
                className: "new-group-participants",
                "data-list-scroll-container": !0
            }, r.createElement(c, {
                ref: "participantList",
                contacts: this.state.participants,
                onDelete: this.onDelete,
                onFocusSearch: this.onFocusSearch
            }))), r.createElement("input", {
                className: "inputarea",
                ref: "input",
                placeholder: t,
                onKeyDown: this.onKeyDown,
                onChange: this.onInput,
                value: this.state.searchText
            }), r.createElement("span", {
                className: "inputarea-sizer",
                ref: "sizer"
            }, this.state.searchText)))), r.createElement("div", {
                className: "new-group-contacts",
                "data-list-scroll-container": !0
            }, r.createElement(s, {
                ref: "list",
                contacts: this.getFilteredContacts(),
                onFocusSearch: this.onFocusSearch,
                onClick: this.onContactClick
            })), r.createElement(f, {
                transitionName: "btn",
                className: "drawer-section drawer-controls"
            }, e)))
        }
    });
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(991)
      , s = n(1221)
      , c = r.createClass({
        displayName: "NotificationsDrawer",
        propTypes: {
            onClose: r.PropTypes.func.isRequired
        },
        render: function() {
            return r.createElement(i, {
                onCancel: this.onBack,
                id: "notifications"
            }, r.createElement(o, {
                a8n: "drawer-title-notifications",
                title: l10n.t("notifications_drawer_title"),
                onBack: this.props.onClose,
                type: o.Type.LARGE
            }), r.createElement(a, {
                wide: !0
            }, r.createElement(s, {
                key: "notifications"
            })))
        }
    });
    e.exports = c
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(138)
      , o = n(429)
      , a = n(9)
      , s = n(1054)
      , c = n(446)
      , l = n(24)
      , u = n(1011)
      , d = n(431)
      , p = n(135)
      , h = p.HotKeys
      , f = 320
      , m = 50
      , g = 10
      , v = 500
      , y = r.createClass({
        displayName: "SendLogsPopup",
        mixins: [i],
        getInitialState: function() {
            return {
                email: "",
                emailError: void 0,
                confirmEmail: "",
                confirmEmailError: void 0,
                subject: l10n.t("send_logs_default_subject"),
                subjectError: void 0,
                description: "",
                descriptionError: void 0
            }
        },
        componentDidMount: function() {
            this.refs.emailAddr.restoreFocus()
        },
        onSend: function() {
            var e = {}
              , t = this.state.email.trim()
              , n = this.state.confirmEmail.trim();
            if (this.validateEmail(t) || (e.emailError = l10n.t("send_logs_email_invalid")),
            this.validateConfirmEmail(n) || (e.confirmEmailError = l10n.t("send_logs_email_nomatch")),
            this.validateDescription() || (e.descriptionError = l10n.t("send_logs_too_short")),
            this.validateSubject() || (e.subjectError = l10n.t("send_logs_subject_error")),
            _.isEmpty(e)) {
                this.setState({
                    email: t,
                    confirmEmail: n,
                    emailError: void 0,
                    confirmEmailError: void 0,
                    descriptionError: void 0,
                    subjectError: void 0
                });
                var i = Store.Conn.me ? c.format(Store.Conn.me.split("@")[0]) : null
                  , o = this.state.subject.trim() || l10n.t("send_logs_default_subject");
                l.uploadUserReport(i, t, o, this.state.description),
                a.closeModal(),
                a.openToast(r.createElement(d, {
                    msg: l10n.t("send_logs_sent"),
                    id: d.genId()
                }))
            } else
                e.email = t,
                e.confirmEmail = n,
                this.setState(e)
        },
        onCancel: function() {
            a.closeModal()
        },
        onSubjectChange: function(e) {
            var t = {
                subject: e.target.value
            };
            this.state.subjectError && this.validateSubject(t.subject) && (t.subjectError = void 0),
            this.setState(t)
        },
        onSubjectBlur: function() {
            var e = void 0;
            this.validateSubject() || (e = l10n.t("send_logs_subject_error")),
            this.state.subjectError !== e && this.setState({
                subjectError: e
            })
        },
        onDescriptionChange: function(e) {
            var t = {
                description: e.target.value
            };
            this.state.descriptionError && this.validateDescription(t.description) && (t.descriptionError = void 0),
            this.setState(t)
        },
        onDescriptionBlur: function() {
            var e = void 0;
            !this.state.description && !this.state.descriptionError || this.validateDescription() || (e = l10n.t("send_logs_too_short")),
            this.state.descriptionError !== e && this.setState({
                descriptionError: e
            })
        },
        onEmailChange: function(e) {
            var t = {
                email: e.target.value
            };
            this.state.emailError && this.validateEmail(t.email) && (t.emailError = void 0),
            this.setState(t)
        },
        onEmailBlur: function() {
            var e = void 0
              , t = this.state.email.trim()
              , n = {};
            !this.state.email && !this.state.emailError || this.validateEmail(t) || (e = l10n.t("send_logs_email_invalid")),
            this.state.emailError !== e && (n.emailError = e),
            this.state.email !== t && (n.email = t),
            _.isEmpty(n) || this.setState(n)
        },
        onConfirmEmailChange: function(e) {
            var t = {
                confirmEmail: e.target.value
            };
            this.state.confirmEmailError && this.validateConfirmEmail(t.confirmEmail) && (t.confirmEmailError = void 0),
            this.setState(t)
        },
        onConfirmEmailBlur: function() {
            var e = void 0
              , t = this.state.confirmEmail.trim()
              , n = {};
            !this.state.confirmEmail && !this.state.confirmEmailError || this.validateConfirmEmail(t) || (e = l10n.t("send_logs_email_nomatch")),
            this.state.confirmEmailError !== e && (n.confirmEmailError = e),
            this.state.confirmEmail !== t && (n.confirmEmail = t),
            _.isEmpty(n) || this.setState(n)
        },
        validateEmail: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? this.state.email : arguments[0];
            return s.validateEmail(e)
        },
        validateConfirmEmail: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? this.state.confirmEmail : arguments[0];
            return this.state.email === e
        },
        validateDescription: function() {
            var e = arguments.length <= 0 || void 0 === arguments[0] ? this.state.description : arguments[0];
            return e.length > g
        },
        validateSubject: function() {
            arguments.length <= 0 || void 0 === arguments[0] ? this.state.subject : arguments[0];
            return !0
        },
        stopPropagation: function(e) {
            e.stopPropagation()
        },
        render: function() {
            var e = {
                enter: this.stopPropagation
            };
            return r.createElement(o, {
                title: l10n.t("send_logs_title"),
                okText: l10n.t("send_logs_confirm"),
                onOK: this.onSend,
                onCancel: this.onCancel
            }, r.createElement(h, {
                handlers: e
            }, r.createElement(u, {
                className: "send-logs-input",
                ref: "emailAddr",
                value: this.state.email,
                error: this.state.emailError,
                maxLength: f,
                onChange: this.onEmailChange,
                onBlur: this.onEmailBlur,
                placeholder: l10n.t("send_logs_email_address")
            }), r.createElement(u, {
                className: "send-logs-input",
                editable: !0,
                value: this.state.confirmEmail,
                error: this.state.confirmEmailError,
                maxLength: f,
                onChange: this.onConfirmEmailChange,
                onBlur: this.onConfirmEmailBlur,
                placeholder: l10n.t("send_logs_email_confirm")
            }), r.createElement(u, {
                className: "send-logs-input",
                value: this.state.subject,
                error: this.state.subjectError,
                maxLength: m,
                onChange: this.onSubjectChange,
                onBlur: this.onSubjectBlur,
                placeholder: l10n.t("send_logs_email_subject")
            }), r.createElement(u, {
                className: "send-logs-input",
                value: this.state.description,
                error: this.state.descriptionError,
                maxLength: v,
                onChange: this.onDescriptionChange,
                onBlur: this.onDescriptionBlur,
                placeholder: l10n.t("describe_logs"),
                multiline: !0
            })))
        }
    });
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(991)
      , s = n(1013)
      , c = n(994)
      , l = n(989)
      , u = n(987)
      , d = r.createClass({
        displayName: "SettingsDrawer",
        mixins: [u],
        propTypes: {
            profileId: r.PropTypes.string.isRequired,
            onClose: r.PropTypes.func.isRequired,
            onBlocked: r.PropTypes.func.isRequired,
            onProfile: r.PropTypes.func.isRequired,
            onHelp: r.PropTypes.func.isRequired,
            onNotifications: r.PropTypes.func.isRequired
        },
        getInitialState: function() {
            return {
                status: this.async("profileId.Status.status") || l10n.t("contact_status_loading")
            }
        },
        render: function() {
            var e = r.createElement("div", {
                className: "chat",
                onClick: this.props.onProfile,
                "data-ignore-capture": "any"
            }, r.createElement("div", {
                className: "chat-avatar"
            }, r.createElement(c, {
                id: Store.Conn.me,
                size: 82,
                quality: c.Quality.HIGH
            })), r.createElement("div", {
                className: "chat-body"
            }, r.createElement("div", {
                className: "chat-main"
            }, r.createElement("div", {
                className: "chat-title"
            }, r.createElement("span", {
                className: "emojitext ellipsify",
                dir: "auto"
            }, r.createElement(l, {
                text: Store.Conn.pushname,
                direction: "auto"
            })))), r.createElement("div", {
                className: "chat-status"
            }, r.createElement("span", {
                className: "emojitext ellipsify",
                dir: "auto"
            }, r.createElement(l, {
                text: this.state.status,
                direction: "auto"
            })))));
            return r.createElement(i, {
                id: "settings",
                onCancel: this.props.onClose
            }, r.createElement(o, {
                title: l10n.t("settings_flow_title"),
                onBack: this.props.onClose,
                type: o.Type.LARGE
            }), r.createElement(a, null , r.createElement("div", {
                className: "chatlist list-identity"
            }, e), r.createElement("div", {
                className: "chatlist list-icons list-actions"
            }, r.createElement(s, {
                a8n: "li-notifications",
                iconClass: "icon-settings-notifications",
                onClick: this.props.onNotifications
            }, l10n.t("menuitem_notifications")), r.createElement(s, {
                a8n: "li-chat_wallpaper",
                iconClass: "icon-settings-wallpaper",
                onClick: this.props.onWallpaper
            }, l10n.t("menuitem_wallpaper")), r.createElement(s, {
                a8n: "li-blocked",
                iconClass: "icon-settings-blocked",
                onClick: this.props.onBlocked
            }, l10n.t("menuitem_blocked")), r.createElement(s, {
                a8n: "li-help",
                iconClass: "icon-settings-help",
                onClick: this.props.onHelp
            }, l10n.t("menuitem_help")))))
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(133)
      , o = n(9)
      , a = n(12)
      , s = r.createClass({
        displayName: "TermsOfServiceModal",
        mixins: [i],
        componentDidMount: function() {
            this.addObserver(Store.Conn, "change:tos", this.close)
        },
        close: function() {
            0 === Store.Conn.tos && o.closeModal()
        },
        logout: function() {
            o.closeModal(),
            a.logout()
        },
        render: function() {
            var e, t = null ;
            switch (Store.Conn.tos) {
            default:
            case 1:
                e = l10n.t("web_terms_of_service_1"),
                t = r.createElement("div", {
                    className: "popup-controls"
                }, r.createElement("button", {
                    className: "btn-plain btn-default popup-controls-item",
                    onClick: o.closeModal.bind(o)
                }, l10n.t("ok_got_it")));
                break;
            case 2:
                e = l10n.t("web_terms_of_service_2"),
                t = r.createElement("div", {
                    className: "popup-controls"
                }, r.createElement("button", {
                    className: "btn-plain popup-controls-item",
                    onClick: this.logout
                }, l10n.t("menuitem_logout")))
            }
            return r.createElement("div", {
                className: "backdrop"
            }, r.createElement("div", {
                className: "popup-container"
            }, r.createElement("div", {
                className: "popup"
            }, r.createElement("div", {
                className: "popup-body"
            }, r.createElement("div", {
                className: "popup-contents"
            }, e)), t)))
        }
    });
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(988)
      , o = n(986)
      , a = n(9)
      , s = n(989)
      , c = n(429)
      , l = r.createClass({
        displayName: "UnstarAllPopup",
        propTypes: {
            chat: r.PropTypes.instanceOf(i),
            msgs: r.PropTypes.arrayOf(r.PropTypes.instanceOf(o))
        },
        onCancel: function() {
            a.closeModal()
        },
        onUnstar: function() {
            var e = this.props.chat
              , t = this.props.msgs;
            e && e.pendingAction++,
            Store.Chat.unstarAllMessages(t, e)["finally"](function() {
                e && e.pendingAction--
            }),
            a.closeModal()
        },
        render: function() {
            return r.createElement(c, {
                title: l10n.t("are_you_sure"),
                onOK: this.onUnstar,
                okText: l10n.t("unstar_all_button"),
                onCancel: this.onCancel
            }, r.createElement("div", null , r.createElement(s, {
                text: l10n.t("unstar_all_confirm")
            })))
        }
    });
    e.exports = l
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(6)
      , m = n(1036)
      , g = n(990)
      , v = n(993)
      , y = n(991)
      , _ = n(1222)
      , E = n(23)
      , b = n(1025)
      , S = window._
      , M = window.l10n
      , C = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "renderContacts",
            value: function() {
                var e = this
                  , t = S.filter(this.props.vCard.TEL, function(e) {
                    return e.properties.waid
                });
                return t.map(function(t) {
                    var n = E.numberToWid(S.first(t.properties.waid));
                    return f.createElement(_, {
                        title: E.formattedUser(n),
                        onClick: function() {
                            return e.onSelect(n)
                        },
                        icon: f.createElement("span", {
                            className: e.props.iconClass
                        }),
                        key: "vCard-" + t.index
                    }, b.getType(t))
                })
            }
        }, {
            key: "onSelect",
            value: function(e) {
                this.props.onSelect(e)
            }
        }, {
            key: "render",
            value: function() {
                return f.createElement(m, {
                    type: m.BOX
                }, f.createElement(g, null , f.createElement(v, {
                    onCancel: this.props.onCancel,
                    type: v.Type.POPUP,
                    title: M.t("choose_phone_number")
                }), f.createElement(y, null , f.createElement("div", {
                    className: "chatlist column"
                }, f.createElement("div", {
                    className: "drawer-item-container-compact"
                }, this.renderContacts())))))
            }
        }]),
        t
    }(f.Component);
    C.defaultProps = {
        iconClass: "icon icon-chat",
        onCancel: S.noop,
        onSelect: S.noop
    },
    e.exports = C
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        var n = new Uint8Array(e)
          , r = new Uint8Array(t)
          , i = n.length
          , o = r.length;
        if (i !== o)
            return !1;
        for (var a = 0; a < i; a++)
            if (n[a] !== r[a])
                return !1;
        return !0
    }
    var o = n(2)
      , a = r(o)
      , s = n(6)
      , c = n(37)
      , l = n(987)
      , u = n(9)
      , d = n(1275).CombinedFingerprint
      , p = n(10)
      , h = n(210)
      , f = n(990)
      , m = n(1008)
      , g = n(991)
      , v = n(14)
      , y = n(1014)
      , E = n(1)
      , b = n(1040)
      , S = n(992)
      , M = n(983)
      , C = n(445)
      , T = n(136)
      , w = n(138)
      , k = n(1087)
      , x = n(67)
      , N = s.createClass({
        displayName: "VerificationFilePicker",
        propTypes: {
            mime: s.PropTypes.string.isRequired,
            onPick: s.PropTypes.func.isRequired
        },
        stopPropagation: function(e) {
            e.stopPropagation()
        },
        render: function() {
            return s.createElement("input", {
                accept: this.props.mime,
                type: "file",
                style: {
                    display: "none"
                },
                onChange: this.props.onPick,
                onClick: this.stopPropagation
            })
        }
    })
      , P = s.createClass({
        displayName: "VerificationQRCode",
        propTypes: {
            binary: s.PropTypes.object,
            contact: s.PropTypes.instanceOf(h).isRequired,
            visible: s.PropTypes.bool
        },
        getDefaultProps: function() {
            return {
                binary: null
            }
        },
        getInitialState: function() {
            return {
                hover: !1,
                currentQRBinary: null ,
                currentQRDataURL: null
            }
        },
        componentDidMount: function() {
            this.props.binary && this.generateQRCode()
        },
        componentDidUpdate: function(e, t) {
            this.generateQRCode()
        },
        shouldComponentUpdate: function(e, t) {
            return !(this.compareBinary(e.binary, this.props.binary) && this.compareBinary(t.currentQRBinary, this.state.currentQRBinary) && e.visible === this.props.visible && t.hover === this.state.hover && t.currentQRDataURL === this.state.currentQRDataURL)
        },
        onMouseOver: function(e) {
            this.state.hover || this.setState({
                hover: !0
            })
        },
        onMouseEnter: function(e) {
            this.state.hover || this.setState({
                hover: !0
            })
        },
        onMouseLeave: function(e) {
            this.state.hover && this.setState({
                hover: !1
            })
        },
        fingerprintsMatched: function(e, t) {
            return i(e.publicKey, t.publicKey) && i(e.identifier, t.identifier)
        },
        compareBinary: function(e, t) {
            if (!e && !t)
                return !0;
            var n = d.parse(e)
              , r = d.parse(t);
            if (!n && !r)
                return !0;
            if (!(n.version || r.version || n.localFingerprint || r.localFingerprint || n.remoteFingerprint || r.remoteFingerprint))
                return !0;
            if (n.version !== r.version)
                return !1;
            var i = this.fingerprintsMatched(n.localFingerprint, r.localFingerprint)
              , o = this.fingerprintsMatched(n.remoteFingerprint, r.remoteFingerprint);
            return i && o
        },
        generateQRCode: function() {
            var e = c.findDOMNode(this.refs.QRCodeContainer)
              , t = this.props.binary;
            if (!e || !t)
                return void this.setState({
                    currentQRBinary: null ,
                    currentQRDataURL: null
                });
            if (!this.compareBinary(this.state.currentQRBinary, t)) {
                this.qr && delete this.qr,
                this.qr = new C(e,{
                    text: t,
                    width: p.QR_EDGE / 2,
                    height: p.QR_EDGE / 2,
                    correctLevel: C.CorrectLevel.L
                }),
                this.setState({
                    currentQRBinary: t
                });
                var n = e.getElementsByTagName("canvas")[0];
                if (!n)
                    return void this.setState({
                        currentQRDataURL: null
                    });
                var r = n.toDataURL("image/png");
                this.setState({
                    currentQRDataURL: r
                })
            }
        },
        render: function() {
            var e = null ;
            if (this.props.visible) {
                var t = null ;
                if (this.state.hover && this.state.currentQRDataURL) {
                    var n = this.props.contact.formattedUser
                      , r = Store.Contact.get(Store.Conn.me).formattedUser
                      , i = "Verification Code between " + r + " and " + n + ".png";
                    t = s.createElement("a", {
                        href: this.state.currentQRDataURL,
                        download: i
                    }, s.createElement("div", {
                        className: "avatar-overlay",
                        key: "avatar-overlay"
                    }, s.createElement("div", {
                        className: "avatar-overlay-text"
                    }, l10n.t("web_verify_download_code"))))
                }
                e = s.createElement("div", {
                    onMouseOver: this.onMouseOver,
                    onMouseEnter: this.onMouseEnter,
                    onMouseLeave: this.onMouseLeave
                }, t, s.createElement("div", {
                    className: "verification-circle",
                    ref: "QRCodeContainer"
                }))
            }
            return e
        }
    })
      , D = s.createClass({
        displayName: "VerificationSpinner",
        propTypes: {
            visible: s.PropTypes.bool
        },
        render: function() {
            var e = null ;
            return this.props.visible && (e = s.createElement("div", {
                className: "verification-circle"
            }, s.createElement("div", {
                className: "spinner"
            }, s.createElement(T, {
                size: 40,
                stroke: 4
            })))),
            e
        }
    })
      , O = s.createClass({
        displayName: "VerificationCircle",
        propTypes: {
            binary: s.PropTypes.object,
            contact: s.PropTypes.instanceOf(h).isRequired,
            visible: s.PropTypes.bool
        },
        render: function() {
            var e = null ;
            return this.props.visible && (e = s.createElement("div", {
                className: "verification-circle-container"
            }, s.createElement(P, {
                visible: !!this.props.binary,
                binary: this.props.binary,
                contact: this.props.contact
            }), s.createElement(D, {
                visible: !this.props.binary
            }))),
            e
        }
    })
      , A = s.createClass({
        displayName: "VerificationString",
        NUM_ROWS: 3,
        NUM_BLOCKS_PER_ROW: 4,
        NUM_DIGITS_PER_BLOCK: 5,
        propTypes: {
            string: s.PropTypes.string
        },
        getDefaultProps: function() {
            return {
                string: null
            }
        },
        shouldComponentUpdate: function(e, t) {
            return e.string !== this.props.string
        },
        numDigitsInVerificationString: function() {
            return this.NUM_ROWS * this.NUM_BLOCKS_PER_ROW * this.NUM_DIGITS_PER_BLOCK
        },
        render: function() {
            if (!this.props.string)
                return s.createElement("div", null , l10n.t("loading"));
            var e = this.props.string;
            if (e.length !== this.numDigitsInVerificationString())
                return E.error("verificationString:render this.props.stringshould be " + this.numDigitsInVerificationString() + " characters long instead of " + e.length + ".")(),
                s.createElement("div", null , l10n.t("web_verify_string_error"));
            for (var t = [], n = 0; n < this.NUM_ROWS; n++) {
                for (var r = [], i = 0; i < this.NUM_BLOCKS_PER_ROW; i++) {
                    for (var o = [], a = 0; a < this.NUM_DIGITS_PER_BLOCK; a++) {
                        var c = e.charAt(n * this.NUM_DIGITS_PER_BLOCK * this.NUM_BLOCKS_PER_ROW + i * this.NUM_DIGITS_PER_BLOCK + a);
                        o.push(s.createElement("span", {
                            className: "digit",
                            key: a
                        }, c))
                    }
                    r.push(s.createElement("span", {
                        className: "block",
                        key: i
                    }, o, " "))
                }
                t.push(s.createElement("div", {
                    className: "row",
                    key: n
                }, r))
            }
            return s.createElement("div", {
                className: "textfield-static selectable-text"
            }, t)
        }
    })
      , R = s.createClass({
        displayName: "VerificationCheckmark",
        propTypes: {
            visible: s.PropTypes.bool
        },
        render: function() {
            var e = null ;
            return this.props.visible && (e = s.createElement("div", {
                className: "verification-checkmark-container"
            }, s.createElement("div", {
                className: "verification-checkmark"
            }, " "))),
            e
        }
    })
      , I = s.createClass({
        displayName: "VerificationError",
        propTypes: {
            visible: s.PropTypes.bool
        },
        render: function() {
            var e = null ;
            return this.props.visible && (e = s.createElement("div", {
                className: "verification-error-container"
            }, s.createElement("div", {
                className: "verification-error"
            }, "!"))),
            e
        }
    })
      , L = s.createClass({
        displayName: "VerificationBanner",
        propTypes: {
            children: s.PropTypes.node.isRequired
        },
        render: function() {
            return s.createElement("div", {
                className: "error-banner"
            }, this.props.children)
        }
    })
      , F = s.createClass({
        displayName: "VerificationWebcam",
        CAPTURE_INTERVAL: 200,
        propTypes: {
            stream: s.PropTypes.object.isRequired,
            onCapture: s.PropTypes.func.isRequired,
            onClose: s.PropTypes.func.isRequired
        },
        mixins: [w],
        getInitialState: function() {
            return {
                videoURL: window.URL.createObjectURL(this.props.stream)
            }
        },
        componentDidMount: function() {
            window.addEventListener("resize", this.adjustOverlayPosition)
        },
        componentWillUnmount: function() {
            if (this.clearSafeInterval(this.captureInterval),
            this.state.videoURL) {
                var e = this.props.stream;
                b.stop(e),
                window.URL.revokeObjectURL(this.state.videoURL)
            }
        },
        onVideoLoaded: function(e) {
            this.captureInterval || (this.adjustOverlayPosition(),
            this.captureInterval = this.safeInterval(this.capture, this.CAPTURE_INTERVAL))
        },
        capture: function() {
            var e = this;
            if (this.refs.verificationVideo) {
                var t = document.createElement("canvas")
                  , n = c.findDOMNode(this.refs.verificationVideo);
                t.width = n.videoWidth / 2,
                t.height = n.videoHeight / 2;
                var r = t.getContext("2d");
                r.drawImage(n, t.width / 2, t.height / 2, t.width, t.height, 0, 0, t.width, t.height),
                t.toBlob(function(t) {
                    var n = window.URL.createObjectURL(t);
                    E.log(n),
                    e.props.onCapture(n)
                }, "image/jpeg", 1)
            }
        },
        adjustOverlayPosition: function() {
            var e = c.findDOMNode(this.refs.verificationVideo)
              , t = c.findDOMNode(this.refs.verificationOverlay);
            if (e && t) {
                var n = e.offsetHeight
                  , r = e.offsetWidth
                  , i = r / 3
                  , o = i
                  , a = (r - i) / 2
                  , s = (n - o) / 2;
                t.style.width = i + "px",
                t.style.height = o + "px",
                t.style.margin = s + "px " + a + "px"
            }
        },
        render: function() {
            var e = null ;
            return this.state.videoURL && (e = s.createElement("div", {
                className: "webcam"
            }, s.createElement(k, {
                autoPlay: !0,
                ref: "verificationVideo",
                onPlay: this.onVideoLoaded,
                src: this.state.videoURL
            }), s.createElement("div", {
                className: "overlay",
                ref: "verificationOverlay"
            }), s.createElement("button", {
                onClick: this.props.onClose
            }, s.createElement("span", {
                className: "icon icon-x-alt"
            })))),
            e
        }
    })
      , U = s.createClass({
        displayName: "VerificationDrawer",
        ICON_DELAY: 3e3,
        BANNER_DELAY: 5e3,
        HINT_DELAY: 7e3,
        ERROR_TYPE: {
            CORRECT: 0,
            PUBLIC_KEY_MISMATCHED: 1,
            REMOTE_MISMATCHED: 2,
            LOCAL_MISMATCHED: 3,
            BOTH_MISMATCHED: 4,
            INVALID_QR_CODE: 5
        },
        mixins: [l, S, w],
        propTypes: {
            contact: s.PropTypes.instanceOf(h).isRequired,
            isFirstLevel: s.PropTypes.bool
        },
        getInitialState: function() {
            return this.asyncState({
                binary: "contact.verificationBinary",
                string: "contact.verificationString"
            }, {
                circleVisible: !0,
                checkmarkVisible: !1,
                errorIconVisible: !1,
                webcamVisible: !1,
                bannerVisible: !1,
                bannerText: null ,
                stream: null ,
                isDragging: !1
            })
        },
        componentDidUpdate: function(e, t) {
            (t.binary && !this.state.binary || t.string && !this.state.string) && this.props.contact.queryIdentity()["catch"](function(e) {
                E.error("VerificationDrawer:queryIdentity error: " + e)()
            })
        },
        componentWillMount: function() {
            this.props.contact.queryIdentity()["catch"](function(e) {
                E.error("verificationDrawer:queryIdentity error: " + e)()
            })
        },
        onDragStart: function() {
            this.blockDrop = !0
        },
        onDragEnd: function() {
            this.blockDrop = !1
        },
        onDragOver: function() {
            this.state.isDragging || this.blockDrop || this.setState({
                isDragging: !0
            })
        },
        onDrop: function(e) {
            this.blockDrop || (this.setState({
                isDragging: !1
            }),
            this.state.binary && this.state.string && this.onUploadSelect(e))
        },
        onDragLeave: function(e) {
            this.setState({
                isDragging: !1
            })
        },
        showWebcamStream: function(e) {
            this.setState({
                webcamVisible: !0,
                circleVisible: !0,
                checkmarkVisible: !1,
                errorIconVisible: !1,
                stream: e
            }),
            this.hintTimer && (this.clearSafeTimeout(this.hintTimer),
            delete this.hintTimer),
            this.hintTimer = this.safeDelay(this.showWebcamHint, this.HINT_DELAY)
        },
        showWebcamHint: function() {
            this.state.webcamVisible && !this.state.bannerVisible && this.showBanner(l10n.t("web_verify_webcam_hint"))
        },
        onWebcamOpen: function(e) {
            var t = this
              , n = b.start("camera");
            a["default"].race([n, this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(e) {
                return t.showWebcamStream(e)
            })["catch"](v.Unmount, function() {
                n.then(function(e) {
                    return b.stop(e)
                })["catch"](_.noop)
            })["catch"](v.GUM.PermissionDeniedError, function() {
                u.openModal(s.createElement(y, {
                    title: "guide_desktop_camera_title",
                    desc: "guide_desktop_camera_fail_description",
                    type: y.TYPE.GUIDE_UNBLOCK
                }))
            })["catch"](v.GUM.GUMError, function() {
                u.openModal(s.createElement(y, {
                    title: "guide_desktop_camera_missing_title",
                    desc: "guide_desktop_camera_missing_description",
                    type: y.TYPE.GUIDE_NONE
                }))
            })
        },
        onWebcamClose: function(e) {
            this.setState({
                webcamVisible: !1,
                bannerVisible: !1,
                stream: null
            })
        },
        onWebcamCapture: function(e) {
            this.verifyImage(e, !0)
        },
        onUploadClick: function() {
            c.findDOMNode(this.refs.verificationFilePicker).click()
        },
        onUploadSelect: function(e) {
            e.stopPropagation();
            var t = e.target.files || e.dataTransfer.files;
            if (t && t[0]) {
                var n = t[0]
                  , r = URL.createObjectURL(n);
                this.verifyImage(r, !1);
                var i = c.findDOMNode(this.refs.verificationFilePickerForm);
                i && i.reset()
            }
        },
        componentWillUnmount: function() {
            clearTimeout(this.iconTimer),
            clearTimeout(this.bannerTimer),
            clearTimeout(this.hintTimer)
        },
        onClose: function(e) {
            this.props.onClose ? this.props.onClose() : this.context.uim.uie.requestDismiss()
        },
        getErrorBannerText: function(e) {
            var t = void 0
              , n = this.props.contact.formattedShortName;
            switch (e) {
            case this.ERROR_TYPE.REMOTE_MISMATCHED:
                t = l10n.t("web_verify_error_remote_mismatched", {
                    contact: n
                });
                break;
            case this.ERROR_TYPE.LOCAL_MISMATCHED:
            case this.ERROR_TYPE.BOTH_MISMATCHED:
                t = l10n.t("web_verify_error_local_mismatched", {
                    contact: n
                });
                break;
            case this.ERROR_TYPE.INVALID_QR_CODE:
            default:
                t = l10n.t("web_verify_error_invalid_upload")
            }
            return t
        },
        showCheckmark: function() {
            this.onWebcamClose(),
            this.setState({
                circleVisible: !1,
                checkmarkVisible: !0,
                errorIconVisible: !1,
                bannerVisible: !1
            }),
            this.iconTimer && (this.clearSafeTimeout(this.iconTimer),
            delete this.iconTimer),
            this.iconTimer = this.safeDelay(this.hideCheckmark, this.ICON_DELAY)
        },
        showErrorIcon: function() {
            this.onWebcamClose(),
            this.setState({
                circleVisible: !1,
                checkmarkVisible: !1,
                errorIconVisible: !0,
                bannerVisible: !1
            }),
            this.iconTimer && (this.clearSafeTimeout(this.iconTimer),
            delete this.iconTimer),
            this.iconTimer = this.safeDelay(this.hideError, this.ICON_DELAY)
        },
        showErrorBanner: function(e) {
            var t = this.getErrorBannerText(e);
            this.showBanner(t)
        },
        showBanner: function(e) {
            this.setState({
                circleVisible: !0,
                checkmarkVisible: !1,
                errorIconVisible: !1,
                bannerVisible: !0,
                bannerText: e
            }),
            this.bannerTimer && (this.clearSafeTimeout(this.bannerTimer),
            delete this.bannerTimer),
            this.bannerTimer = this.safeDelay(this.hideBanner, this.BANNER_DELAY)
        },
        hideCheckmark: function() {
            this.state.errorIconVisible || this.setState({
                circleVisible: !0
            }),
            this.setState({
                checkmarkVisible: !1
            })
        },
        hideError: function() {
            this.state.checkmarkVisible || this.setState({
                circleVisible: !0
            }),
            this.setState({
                errorIconVisible: !1
            })
        },
        hideBanner: function() {
            this.setState({
                bannerVisible: !1
            })
        },
        validateFingerprint: function(e) {
            if (!e || 0 === !e.version || !e.localFingerprint || !e.remoteFingerprint)
                return this.ERROR_TYPE.INVALID_QR_CODE;
            var t = d.parse(this.state.binary)
              , n = i(e.remoteFingerprint.identifier, t.localFingerprint.identifier)
              , r = i(e.localFingerprint.identifier, t.remoteFingerprint.identifier);
            if (!n && !r)
                return this.ERROR_TYPE.BOTH_MISMATCHED;
            if (!n)
                return this.ERROR_TYPE.REMOTE_MISMATCHED;
            if (!r)
                return this.ERROR_TYPE.LOCAL_MISMATCHED;
            var o = i(e.remoteFingerprint.publicKey, t.localFingerprint.publicKey)
              , a = i(e.localFingerprint.publicKey, t.remoteFingerprint.publicKey);
            return o && a ? this.ERROR_TYPE.CORRECT : this.ERROR_TYPE.PUBLIC_KEY_MISMATCHED
        },
        decodeQRCode: function(e) {
            return new a["default"](function(t, n) {
                M.callback = function(e, r) {
                    if (r)
                        n(r);
                    else if (e.length < 1)
                        n("QR decoder did not return decoded binary");
                    else {
                        var i = new Uint8Array(e[0]);
                        t(i)
                    }
                }
                ,
                M.decode(e)
            }
            )
        },
        verifyImage: function(e, t) {
            var n = this;
            this.decodeQRCode(e).then(d.parse).then(function(e) {
                var r = n.validateFingerprint(e);
                r ? t && r === n.ERROR_TYPE.INVALID_QR_CODE || (n.setState({
                    errorType: r
                }),
                r === n.ERROR_TYPE.PUBLIC_KEY_MISMATCHED ? n.showErrorIcon() : n.showErrorBanner(r)) : n.showCheckmark()
            })["catch"](function(e) {
                t || (n.setState({
                    errorType: n.ERROR_TYPE.INVALID_QR_CODE
                }),
                n.showErrorBanner(n.ERROR_TYPE.INVALID_QR_CODE))
            })["finally"](function() {
                window.URL.revokeObjectURL(e)
            })
        },
        render: function() {
            var e = null
              , t = null
              , n = null ;
            this.state.binary && (navigator.getUserMedia && (e = s.createElement(m, {
                classes: "animate-enter2"
            }, s.createElement("button", {
                className: "btn btn-info",
                onClick: this.state.webcamVisible ? this.onWebcamClose : this.onWebcamOpen
            }, this.state.webcamVisible ? l10n.t("web_verify_webcam_close_button") : l10n.t("web_verify_webcam_open_button")))),
            t = s.createElement(m, {
                classes: "animate-enter2"
            }, s.createElement("button", {
                className: "btn btn-info",
                onClick: this.onUploadClick
            }, l10n.t("web_verify_upload_button")), s.createElement("p", {
                className: "drag-and-drop-explanation"
            }, this.state.isDragging ? l10n.t("web_verify_drag_and_drop_dragging") : null )),
            n = s.createElement("form", {
                ref: "verificationFilePickerForm"
            }, s.createElement(N, {
                mime: "image/*",
                onPick: this.onUploadSelect,
                ref: "verificationFilePicker"
            })));
            var r = null ;
            this.state.webcamVisible && (r = s.createElement(F, {
                stream: this.state.stream,
                onCapture: this.onWebcamCapture,
                onClose: this.onWebcamClose
            }));
            var i = null ;
            this.state.bannerVisible && (i = s.createElement(L, null , this.state.bannerText));
            var o = "icon icon-";
            return o += this.props.isFirstLevel ? "x" : "back",
            s.createElement(f, {
                id: "verification",
                onDrop: this.onDrop,
                onDragOver: this.onDragOver,
                onDragLeave: this.onDragLeave,
                onCancel: this.onClose
            }, s.createElement("header", {
                className: "pane-header"
            }, s.createElement("div", {
                className: "header-close"
            }, s.createElement("button", {
                onClick: this.onClose
            }, s.createElement("span", {
                className: o
            }))), s.createElement("div", {
                className: "header-body"
            }, s.createElement("div", {
                className: "header-main"
            }, s.createElement("div", {
                className: "header-title"
            }, l10n.t("web_verify_title"))), s.createElement("div", {
                className: "header-secondary"
            }, l10n.t("web_you"), ", ", this.props.contact.formattedUser))), r, i, s.createElement(g, {
                classes: this.state.webcamVisible ? "webcam-visible" : null ,
                info: !0,
                onDragStart: this.onDragStart,
                onDragEnd: this.onDragEnd
            }, s.createElement(m, {
                classes: "drawer-scale drawer-section-photo"
            }, s.createElement(O, {
                binary: this.state.binary,
                contact: this.props.contact,
                visible: this.state.circleVisible
            }), s.createElement(R, {
                visible: this.state.checkmarkVisible
            }), s.createElement(I, {
                visible: this.state.errorIconVisible
            })), s.createElement(m, {
                classes: "animate-enter2"
            }, s.createElement("div", {
                className: "verification-string"
            }, s.createElement(A, {
                string: this.state.string
            }))), s.createElement(m, {
                classes: "animate-enter2"
            }, s.createElement("p", {
                className: "verification-explanation"
            }, s.createElement("span", null , l10n.t("web_verify_explanation"), ""), s.createElement("a", {
                target: "_blank",
                href: p.E2E_FAQ_LINK
            }, l10n.t("learn_more")))), e, t, n))
        }
    });
    U.contextTypes = {
        uim: s.PropTypes.instanceOf(x)
    },
    e.exports = U
}
, function(e, t, n) {
    "use strict";
    var r = n(6)
      , i = n(990)
      , o = n(993)
      , a = n(991)
      , s = n(987)
      , c = n(9)
      , l = n(431)
      , u = n(10)
      , d = r.createClass({
        displayName: "ColorCanvas",
        propTypes: {
            colorHex: r.PropTypes.string.isRequired,
            isSelected: r.PropTypes.bool.isRequired,
            isDefault: r.PropTypes.bool.isRequired
        },
        getInitialState: function() {
            return {
                hover: !1
            }
        },
        onClick: function(e) {
            var t = this.encodeColor(this.props.colorHex);
            t !== Store.ChatPreference.get("defaultPreference").wallpaperColor && (Store.ChatPreference.get("defaultPreference").set("wallpaperColor", t),
            c.openToast(r.createElement(l, {
                msg: l10n.t("wallpaper_color_set"),
                id: l.genId()
            })))
        },
        onMouseOver: function(e) {
            this.state.hover || (this.setState({
                hover: !0
            }),
            Store.ChatPreference.trigger("wallpaper_color_preview", this.encodeColor(this.props.colorHex)))
        },
        onMouseEnter: function(e) {
            this.state.hover || (this.setState({
                hover: !0
            }),
            Store.ChatPreference.trigger("wallpaper_color_preview", this.encodeColor(this.props.colorHex)))
        },
        onMouseLeave: function(e) {
            this.state.hover && (this.setState({
                hover: !1
            }),
            Store.ChatPreference.trigger("wallpaper_color_preview"))
        },
        encodeColor: function(e) {
            return "#ede9e4" === e ? u.DEFAULT_CHAT_WALLPAPER : e
        },
        render: function() {
            var e = "wallpaper-color-canvas";
            this.state.hover && (e += " canvas-hover"),
            this.props.isSelected && (e += " canvas-active");
            var t = this.props.isDefault ? r.createElement("span", {
                className: "wallpaper-default-title"
            }, l10n.t("default_wallpaper")) : null ;
            return r.createElement("span", {
                className: e,
                style: {
                    backgroundColor: this.props.colorHex
                },
                onMouseOver: this.onMouseOver,
                onMouseEnter: this.onMouseEnter,
                onMouseLeave: this.onMouseLeave,
                onClick: this.onClick
            }, t)
        }
    })
      , p = r.createClass({
        displayName: "ColorGrid",
        mixins: [s],
        propTypes: {
            id: r.PropTypes.string.isRequired,
            colors: r.PropTypes.array.isRequired
        },
        getInitialState: function() {
            return {
                wallpaperColor: this.async("id.ChatPreference.wallpaperColor")
            }
        },
        render: function() {
            for (var e = !0, t = this.state.wallpaperColor, n = this.props.colors.map(function(n) {
                var i = !1
                  , o = !1;
                return (t === n || t === u.DEFAULT_CHAT_WALLPAPER && e) && (i = !0),
                e && (o = !0,
                e = !1),
                r.createElement(d, {
                    colorHex: n,
                    isSelected: i,
                    isDefault: o,
                    key: n
                })
            }), i = 0; i < 2; i++)
                n.push(r.createElement("div", {
                    key: "emptyEl" + i,
                    className: "wallpaper-color-empty"
                }));
            return r.createElement("div", {
                className: "wallpaper-color-grid"
            }, n)
        }
    })
      , h = r.createClass({
        displayName: "WallpaperDrawer",
        propTypes: {
            onClose: r.PropTypes.func
        },
        render: function() {
            var e = r.createElement(p, {
                colors: u.WALLPAPER_COLOR,
                id: "defaultPreference"
            });
            return r.createElement(i, {
                id: "wallpaper",
                onCancel: this.props.onClose
            }, r.createElement(o, {
                title: l10n.t("wallpaper_flow_title"),
                onBack: this.props.onClose,
                type: o.Type.LARGE
            }), r.createElement(a, null , e))
        }
    });
    e.exports = h
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(430)
      , s = n(1106)
      , c = n(435)
      , l = n(10)
      , u = n(14)
      , d = s.STATE
      , p = d.READY
      , h = d.ERROR
      , f = c.FILETYPE
      , m = f.IMAGE
      , g = f.VIDEO
      , v = f.DOCUMENT
      , y = f.AUDIO
      , _ = 1
      , E = a.extend({
        model: s,
        initialize: function() {
            this.errorMsgs = null ,
            this.ignored = 0,
            a.prototype.initialize.call(this)
        },
        removeSingleton: function(e, t) {
            e.preview && window.URL.revokeObjectURL(e.preview),
            e.original && e.original.preview && window.URL.revokeObjectURL(e.original.preview)
        },
        remove: function(e, t) {
            var n = this;
            Array.isArray(e) ? e.forEach(function(e) {
                return n.removeSingleton(e, t)
            }) : this.removeSingleton(e, t),
            a.prototype.remove.call(this, e, t)
        },
        "delete": function() {
            var e = this;
            this.models.forEach(function(t) {
                return e.removeSingleton(t)
            }),
            a.prototype["delete"].call(this)
        },
        contains: function(e) {
            return this.indexOf(e) > -1
        },
        getValidMedias: function() {
            return this.filter({
                state: p
            })
        },
        getAfter: function(e) {
            var t = this.getValidMedias()
              , n = t.indexOf(e);
            return n < 0 || n === t.length - 1 ? null : t[n + 1]
        },
        getBefore: function(e) {
            var t = this.getValidMedias()
              , n = t.indexOf(e);
            return n <= 0 ? null : t[n - 1]
        },
        processFiles: function(e, t) {
            var n = this
              , r = this.getValidMedias().length
              , i = e.length + r > l.MAX_FILES ? Math.max(l.MAX_FILES - r, 0) : e.length
              , a = e.length - i;
            0 === i ? a && this.trigger("max_upload_limit", a) : this.ignore(a);
            var c = e.slice(0, i).map(function(e) {
                var r = _++
                  , i = new s({
                    id: r,
                    file: e,
                    chat: t,
                    uiProcessed: !1
                });
                return n.add(i)
            });
            return o["default"].map(c, function(e) {
                return e.processPromise
            })
        },
        ignore: function(e) {
            e > 0 && (this.ignored += e)
        },
        uiProcessMsgs: function() {
            var e = []
              , t = void 0
              , n = void 0
              , r = 0
              , i = 0
              , o = 0
              , a = 0
              , s = 0
              , c = !1
              , d = l.MAX_MEDIA_UPLOAD_SIZE / 1024 / 1024;
            if (this.forEach(function(e) {
                if (!e.uiProcessed && (e.uiProcessed = !0,
                t || e.state !== p || (t = e),
                e.state === h))
                    if (e.exception instanceof u.MediaFileTooLarge)
                        switch (e.getFileType()) {
                        case m:
                            r += 1;
                            break;
                        case g:
                            i += 1;
                            break;
                        case y:
                            o += 1;
                            break;
                        case v:
                            a += 1
                        }
                    else
                        e.exception instanceof u.MediaFileFailedLoad ? c = !0 : s += 1
            }),
            r > 0 && e.push(l10n.t("image_too_big", {
                number: r,
                _plural: r,
                maxSize: d + "MB"
            })),
            i > 0 && e.push(l10n.t("video_too_big", {
                number: i,
                _plural: i,
                maxSize: d + "MB"
            })),
            o > 0 && e.push(l10n.t("audio_too_big", {
                number: o,
                _plural: o,
                maxSize: d + "MB"
            })),
            a > 0 && e.push(l10n.t("document_too_big", {
                number: a,
                _plural: a,
                maxSize: d + "MB"
            })),
            s > 0 && e.push(l10n.t("files_not_supported", {
                number: s,
                _plural: s
            })),
            c && (e = [],
            e.push(l10n.t("media_failed_load"))),
            e.length > 1) {
                e = [];
                var f = r + i + o + a + s;
                0 === s ? e.push(l10n.t("files_too_big", {
                    number: f,
                    _plural: f,
                    maxSize: d + "MB"
                })) : e.push(l10n.t("files_not_added", {
                    number: f,
                    _plural: f
                }))
            }
            return this.errorMsgs = e.join(" "),
            this.ignore(this.getValidMedias().length - l.MAX_FILES),
            n = this.ignored,
            this.ignored = 0,
            n && this.trigger("max_upload_limit", n),
            {
                activeMedia: t,
                errorMsgs: this.errorMsgs
            }
        }
    });
    e.exports = E
}
, function(e, t, n) {
    "use strict";
    var r = n(82)
      , i = n(210)
      , o = r.extend({
        Collection: "Blocklist",
        children: {
            contact: i
        },
        props: {
            id: "string"
        },
        initialize: function() {
            this.contact = Store.Contact.gadd({
                id: this.id
            }),
            this.listenTo(this.contact, "all", this._getCachedEventBubblingHandler("contact"))
        }
    });
    e.exports = o
}
, function(e, t, n) {
    "use strict";
    var r = n(430)
      , i = n(1247)
      , o = r.extend({
        model: i,
        handle: function(e) {
            var t = e.shift()
              , n = t.blocklist
              , r = _.map(n, function(e) {
                return {
                    id: e
                }
            });
            this.set(r)
        }
    });
    e.exports = new o
}
, function(e, t, n) {
    "use strict";
    var r = n(1)
      , i = n(82)
      , o = n(9)
      , a = i.extend({
        Collection: "Call",
        props: {
            id: "string",
            type: "string",
            from: "string"
        },
        initialize: function() {
            this.listenToAndRun(this, "change:type", this.updateNotification)
        },
        updateNotification: function() {
            r.log("call:" + this.type + " id:" + this.id + " from:" + this.from)(),
            "offer" === this.type || "offer_video" === this.type ? o.alertCall(this.id, this.from, "offer_video" === this.type) : o.cancelCall(this.id)
        }
    });
    e.exports = a
}
, function(e, t, n) {
    "use strict";
    var r = n(430)
      , i = n(1249)
      , o = n(218)
      , a = r.extend({
        model: i,
        handle: function(e) {
            var t = e.shift();
            switch (t.type) {
            case "offer":
            case "offer_video":
            case "accept":
            case "reject":
            case "terminate":
                o.tosShowCallNotification && this.add(t, {
                    merge: !0
                })
            }
        }
    });
    e.exports = new a
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(21)
      , o = r(i)
      , a = n(2)
      , s = r(a)
      , c = n(6)
      , l = n(10)
      , u = n(1)
      , d = n(430)
      , p = n(988)
      , h = n(45)
      , f = n(46)
      , m = n(55)
      , g = n(9)
      , v = n(14)
      , y = n(68).ActionToast
      , E = n(68).ActionType
      , b = n(23)
      , S = n(12)
      , M = d.extend({
        model: p,
        comparator: function(e, t) {
            return e.t ? t.t ? "" + e.t + e.id > "" + t.t + t.id ? -1 : 1 : -1 : 1
        },
        initialize: function() {
            var e = this;
            d.prototype.initialize.call(this),
            this.notSpam = {},
            this.promises = {
                sendUnstarAll: null
            },
            this.listenTo(this, "change:t change:isVisible", this.sort),
            this.listenTo(S, "change:stream", function() {
                S.stream === S.STREAM.RESUMING && e.forEach(function(e) {
                    e.pendingMsgs = !1
                })
            })
        },
        active: function C() {
            var C = _.head(this.filter("active"));
            return C ? C.id : void 0
        },
        _find: function(e) {
            return s["default"].resolve({
                id: e,
                createdLocally: !0
            })
        },
        _findQuery: function(e) {
            var t = this;
            return h.chatFindQuery(!!e.retry).then(function(e) {
                return "preempted" === e ? s["default"].reject("chats preempted") : (Store.Conn.platform === Store.Conn.PLATFORMS.IPHONE && (_.isEmpty(e) ? Store.Msg.trigger(l.COLLECTION_HAS_SYNCED) : setTimeout(function() {
                    Store.Msg.trigger(l.COLLECTION_HAS_SYNCED)
                }, 2500)),
                t.trigger(l.COLLECTION_HAS_SYNCED),
                s["default"].resolve(e))
            })
        },
        handle: function(e) {
            var t = e.shift()
              , n = this;
            if (_.isArray(t)) {
                var r = []
                  , i = [];
                t.forEach(function(e) {
                    if ("c.us" === e.id)
                        i.push(e);
                    else {
                        var t = !!n.get(e.id)
                          , a = ["delete", "clear", "archive", "unarchive", "star", "unstar", "spam", "modify_tag"].indexOf(e.type) > -1;
                        a ? t && a ? i.push(e) : u.log("Model:chat:handle received junk chat record: " + (0,
                        o["default"])(e))() : r.push(e)
                    }
                });
                var a = _.findIndex(r, function(e) {
                    return b.isPSA(e.id)
                });
                a > -1 && (r[a].name = l10n.t("whatsapp_psa_contact_name")),
                n.add(r, {
                    merge: !0
                }),
                i.forEach(function(e) {
                    var t = e.type;
                    if ("c.us" === e.id)
                        switch (t) {
                        case "clear":
                            u.log("Model:chat:handle:clear:all before:" + e.before + " kind:" + e.kind)(),
                            n.forEach(function(t) {
                                "number" == typeof e.before ? t.deleteMsgsOlderThan(e.before, e.star, e.kind) : t.deleteMsgs(e.star, e.kind)
                            });
                            break;
                        case "delete":
                            u.log("Model:chat:handle:delete:all")(),
                            n.forEach(function(e) {
                                e["delete"]()
                            });
                            break;
                        case "archive":
                            u.log("Model:chat:handle:archive:all")(),
                            n.forEach(function(e) {
                                e.archive = !0
                            });
                            break;
                        case "unarchive":
                            u.log("Model:chat:handle:unarchive:all")(),
                            n.forEach(function(e) {
                                e.archive = !1
                            });
                            break;
                        case "unstar":
                            u.log("Model:chat:handle:unstar:all")(),
                            Store.StarredMsg["delete"](),
                            n.forEach(function(e) {
                                e.unstarAll()
                            });
                            break;
                        default:
                            u.error("Model:chat:handle unknown " + (0,
                            o["default"])(e), e)()
                        }
                    else {
                        var r = n.get(e.id);
                        if (!r)
                            return;
                        switch (t) {
                        case "clear":
                        case "star":
                        case "unstar":
                            if (e.keys) {
                                for (var i = e.keys.length, a = "star" === t, s = [], c = [], l = [], d = !1, p = 0; p < i; p++) {
                                    var h, f, g, v, y, E = e.keys[p];
                                    _.isArray(E) ? (h = E[0],
                                    f = E[1],
                                    g = E[2],
                                    v = new m({
                                        fromMe: f,
                                        remote: e.id,
                                        id: h,
                                        participant: g
                                    }),
                                    y = Store.Msg.get(v),
                                    y ? "clear" === t ? y["delete"]() : (y.star = a,
                                    a && l.push(y)) : a && (d = !0)) : _.isObject(E) && "star" === t && (v = E.id,
                                    y = Store.Msg.get(E.id),
                                    y ? (y.star = !0,
                                    l.push(y)) : c.push(E)),
                                    s.push(v.toString())
                                }
                                "star" !== t && "unstar" !== t || Store.StarredMsg.process(a, c, l, d),
                                u.log("model:Chat:handle:messages:" + [t, e.id, s.join(), e.modifyTag].join())()
                            } else
                                "clear" === t ? ("number" == typeof e.before ? r.deleteMsgsOlderThan(e.before, e.star, e.kind) : r.deleteMsgs(e.star, e.kind),
                                u.log("model:Chat:handle cleared chat:" + [e.id, e.before, e.modifyTag, e.kind].join())()) : "unstar" === t && (r.unstarAll(),
                                u.log("model:Chat:handle unstarred chat: " + e.id)());
                            isNaN(e.modifyTag) || (r.modifyTag = e.modifyTag);
                            break;
                        case "delete":
                            r["delete"](),
                            u.log("model:Chat:handle deleted chat for " + e.id)();
                            break;
                        case "archive":
                            r.archive = !0;
                            break;
                        case "unarchive":
                            r.archive = !1;
                            break;
                        case "spam":
                            r.notSpam = e.notSpam;
                            break;
                        case "modify_tag":
                            r.modifyTag = e.modifyTag
                        }
                    }
                })
            } else if ("leave" === t.cmd)
                t.gids.forEach(function(e) {
                    var t = n.get(e);
                    t && t.exit()
                });
            else if ("preempt" === t.cmd)
                Store.Chat.add(t.response, {
                    merge: !0
                }),
                Store.Conn.platform === Store.Conn.PLATFORMS.IPHONE && (_.isEmpty(t.response) ? Store.Msg.trigger(l.COLLECTION_HAS_SYNCED) : setTimeout(function() {
                    Store.Msg.trigger(l.COLLECTION_HAS_SYNCED)
                }, 2500)),
                this.trigger(l.COLLECTION_HAS_SYNCED);
            else if ("action" === t.cmd) {
                var s = t.id
                  , c = t.data;
                if ("create" === c[0] || "introduce" === c[0]) {
                    var d = c[1]
                      , p = c[2]
                      , h = _.map(p.admins, function(e) {
                        return {
                            id: e,
                            isAdmin: !0
                        }
                    }).concat(_.map(p.regulars, function(e) {
                        return {
                            id: e,
                            isAdmin: !1
                        }
                    }));
                    Store.GroupMetadata.add({
                        id: s,
                        creation: p.creation,
                        owner: d,
                        participants: h,
                        stale: !1
                    }, {
                        merge: !0
                    }),
                    Store.Contact.add({
                        id: s,
                        name: p.subject
                    }, {
                        merge: !0
                    });
                    var f = Store.Chat.get(s);
                    if (!f)
                        return;
                    var v = f.msgs.last();
                    if (!v)
                        return;
                    "gp2" === v.type && "add" === v.subtype && _.head(v.recipients) === Store.Conn.me && g.alertNewMsg(v)
                } else {
                    var y = Store.Chat.get(t.id);
                    y ? y.handleGroupAction.apply(y, t.data) : u.error("model:chat: unknown chat for action " + (0,
                    o["default"])(t))()
                }
            } else
                u.error("model:chat: unknown payload: " + (0,
                o["default"])(t))()
        },
        createGroup: function(e, t, n, r, i) {
            var o = this
              , a = _.map(r, "id")
              , s = h.createGroup(e, a)
              , l = new E(l10n.t("action_group_creating"));
            i = i || y.genId();
            var d = s.then(function(e) {
                return 200 === e.status ? new E(l10n.t("action_group_created")) : 406 === e.status ? new E(l10n.t("action_group_create_failed") + " " + l10n.t("action_group_create_failed_406")) : void 0
            })["catch"](function(a) {
                return u.error("models:chatCollection:createGroup dropped")(a),
                new E(l10n.t("action_group_create_failed"),l10n.t("action_try_again"),o.createGroup.bind(o, e, t, n, r, i))
            });
            return g.openToast(c.createElement(y, {
                id: i,
                initialAction: l,
                pendingAction: d
            })),
            s.then(function(e) {
                if (200 === e.status && e.gid && Store.Chat.find(e.gid).then(function(e) {
                    g.openChat(e)
                }),
                200 === e.status && !e._duplicate && t && n) {
                    var r = Store.ProfilePicThumb.gadd(e.gid);
                    return r.setPicture(t, n)
                }
                200 === e.status && e._duplicate && u.error("createGroup failed to set picture.")()
            })
        },
        sync: function() {
            return this.findQuery({})["catch"](v.WapDrop, _.noop),
            s["default"].all([f.waitForBBEvent(this, l.COLLECTION_HAS_SYNCED), Store.Msg._hasSynced()])
        },
        resyncMessages: function() {
            u.log("ChatStore:resyncMessages")();
            var e = Store.Chat.filter(function(e) {
                return e.isVisible
            })
              , t = e.map(function(e) {
                var t = e.id
                  , n = {
                    wid: t,
                    archive: e.archive,
                    mute: e.mute.expiration,
                    active: e.active,
                    isReadOnly: e.isReadOnly,
                    modifyTag: e.modifyTag,
                    unreadCount: e.unreadCount,
                    notSpam: e.notSpam
                }
                  , r = e.lastReceivedKey;
                if (r) {
                    var i = r;
                    n.id = i.id,
                    n.fromMe = i.fromMe.toString(),
                    n.participant = i.participant
                }
                return n
            });
            return h.resyncMessages(t).then(function(e) {
                return e.status >= 400 ? (u.error("ChatStore:resyncMessages resume error " + e.status)(),
                s["default"].reject(new Error("ChatStore:resyncMessages resume error " + e.status))) : (u.log("ChatStore:resyncMessages resume success")(),
                e.checksum && Store.Contact.resyncContacts(e.checksum),
                e.data.forEach(function(e) {
                    if (e.disableUnreadAnchor = !1,
                    "delete" !== e.type && !b.isPSA(e.id)) {
                        var t = Store.Contact.get(e.id);
                        t ? e.name && (t.name = e.name) : Store.Contact.add({
                            id: e.id,
                            name: e.name
                        })
                    }
                    var n = Store.Chat.get(e.id);
                    if (!n)
                        return void Store.Chat.add(e);
                    if ("clear" === e.type) {
                        n.set({
                            t: e.t,
                            unreadCount: e.unreadCount,
                            createdLocally: !1,
                            archive: e.archive,
                            isReadOnly: e.isReadOnly,
                            modifyTag: e.modifyTag,
                            msgs: [],
                            notSpam: e.notSpam,
                            unreadMsgAnchor: void 0,
                            disableUnreadAnchor: e.disableUnreadAnchor,
                            pendingMsgs: e.pendingMsgs
                        }),
                        n.mute.setMute(e.muteExpiration);
                        var r = [];
                        n.msgs.forEach(function(e) {
                            r.push(e)
                        }),
                        _.each(r, function(e) {
                            e["delete"]()
                        }),
                        u.log("model:chat:resume: cleared chat for " + e.id)()
                    } else
                        "delete" === e.type ? (n["delete"](),
                        u.log("model:chat:resume: deleted chat for " + e.id)()) : (n.set(e, {
                            merge: !0
                        }),
                        n.mute.setMute(e.muteExpiration))
                }),
                s["default"].resolve())
            })["catch"](v.WapDrop, function(e) {
                return u.error("ChatStore:resyncMessages resume dropped")(),
                s["default"].reject(e)
            })
        },
        unstarAllMessages: function(e, t) {
            var n = this
              , r = t ? t.promises : this.promises
              , i = t ? t.id : void 0;
            if (r.sendUnstarAll)
                return r.sendUnstarAll;
            r.sendUnstarAll = h.sendUnstarAll(i);
            var o = new E(l10n.t("action_message_unstarring_all"))
              , a = r.sendUnstarAll.then(function(e) {
                return 200 === e.status ? new E(l10n.t("action_message_unstarred_all")) : e.status >= 400 ? new E(l10n.t("action_message_unstar_all_failed")) : void 0
            })["catch"](function(r) {
                return u.error("models:chat:sendUnstarAll dropped")(r),
                new E(l10n.t("action_message_unstar_all_failed"),l10n.t("action_try_again"),function() {
                    return n.unstarAllMessages(e, t)
                }
                )
            });
            return g.openToast(c.createElement(y, {
                id: y.genId(),
                initialAction: o,
                pendingAction: a
            })),
            r.sendUnstarAll.then(function(n) {
                200 === n.status && (_.forEach(e, function(e) {
                    e.set("star", !1)
                }),
                t ? Store.StarredMsg.remove(e) : Store.StarredMsg.reset())
            })["finally"](function() {
                r.sendUnstarAll = null
            })
        }
    });
    e.exports = new M
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(430)
      , s = n(986)
      , c = n(10)
      , l = n(14)
      , u = a.extend({
        model: s,
        initialize: function() {
            var e = this;
            a.prototype.initialize.call(this),
            this.hasDocBefore = !0,
            this.listenTo(Store.Msg, "remove", function(t) {
                t.isDoc && e.remove(t)
            })
        },
        queryDocs: function(e, t) {
            var n = this;
            if (t)
                return this.queryDocBefore ? this.queryDocBefore : (this.queryDocBefore = Store.Msg.queryMedia(t.id.remote, c.MEDIA_QUERY_LIMIT, "before", t.id, "document").then(function(e) {
                    return (!e || e.length < c.MEDIA_QUERY_LIMIT) && (n.hasDocBefore = !1),
                    n.add(e.filter(function(e) {
                        return e.isDoc
                    }), {
                        at: 0
                    }),
                    {
                        length: e.length
                    }
                })["catch"](l.WapDrop, _.noop)["finally"](function() {
                    n.queryDocBefore = null ,
                    n.trigger("query_doc_before")
                }),
                this.trigger("query_doc_before"),
                this.queryDocBefore);
            var r = e.msgs.models;
            if (0 === this.length) {
                if (!r || 0 === r.length)
                    return new o["default"](function(e) {
                        e({
                            eof: !0
                        })
                    }
                    );
                this.add(r.filter(function(e) {
                    return e.isDoc
                }), {
                    at: 0
                })
            }
            if (this.length <= 2 * c.MEDIA_QUERY_LIMIT) {
                var i = 0 === this.length ? _.head(r) : this.head();
                return this.queryDocs(e, i)
            }
            return new o["default"](function(e) {
                e({
                    eof: !1
                })
            }
            )
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(430)
      , s = n(986)
      , c = n(10)
      , l = n(14)
      , u = a.extend({
        model: s,
        initialize: function() {
            var e = this;
            a.prototype.initialize.call(this),
            this.hasLinkBefore = !0,
            this.listenTo(Store.Msg, "remove", function(t) {
                t.isLink && e.remove(t)
            })
        },
        queryLinks: function(e, t) {
            var n = this;
            if (t)
                return this.queryLinkBefore ? this.queryLinkBefore : (this.queryLinkBefore = Store.Msg.queryMedia(t.id.remote, c.MEDIA_QUERY_LIMIT, "before", t.id, "url").then(function(e) {
                    return (!e || e.length < c.MEDIA_QUERY_LIMIT) && (n.hasLinkBefore = !1),
                    n.add(e.filter(function(e) {
                        return e.isLink
                    }), {
                        at: 0
                    }),
                    {
                        length: e.length
                    }
                })["catch"](l.WapDrop, _.noop)["finally"](function() {
                    n.queryLinkBefore = null ,
                    n.trigger("query_link_before")
                }),
                this.trigger("query_link_before"),
                this.queryLinkBefore);
            var r = e.msgs.models;
            if (0 === this.length) {
                if (!r || 0 === r.length)
                    return new o["default"](function(e) {
                        e({
                            eof: !0
                        })
                    }
                    );
                this.add(r.filter(function(e) {
                    return e.isLink
                }), {
                    at: 0
                })
            }
            if (this.length <= 2 * c.MEDIA_QUERY_LIMIT) {
                var i = 0 === this.length ? _.head(r) : this.head();
                return this.queryLinks(e, i)
            }
            return new o["default"](function(e) {
                e({
                    eof: !1
                })
            }
            )
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(430)
      , s = n(986)
      , c = n(10)
      , l = n(14)
      , u = {
        before: "before",
        after: "after"
    }
      , d = a.extend({
        model: s,
        initialize: function() {
            var e = this;
            a.prototype.initialize.call(this),
            this.hasMediaBefore = !0,
            this.hasMediaAfter = !0,
            this.listenTo(Store.Msg, "remove", function(t) {
                t.isMedia && e.remove(t)
            })
        },
        contains: function(e) {
            return this.models.indexOf(e) > -1
        },
        getAfter: function(e) {
            var t = this.models.indexOf(e);
            return t < 0 || t === this.models.length - 1 ? null : this.models[t + 1]
        },
        getBefore: function(e) {
            var t = this.models.indexOf(e);
            return t <= 0 ? null : this.models[t - 1]
        },
        loadEarlierMedias: function() {
            var e = this.head();
            e && this.queryMedia(null , e)
        },
        loadRecentMedias: function() {
            var e = this.last();
            e && this.queryMedia(null , e, u.after)
        },
        loadMoreAroundIfNeeded: function(e) {
            if (e) {
                var t = this.models.indexOf(e);
                t < 20 && this.hasMediaBefore && this.loadEarlierMedias(),
                this.models.length - t < 20 && this.hasMediaAfter && this.loadRecentMedias()
            }
        },
        queryMedia: function(e, t) {
            var n = this
              , r = arguments.length <= 2 || void 0 === arguments[2] ? u.before : arguments[2];
            if (!t) {
                var i = e.msgs.models;
                if (!i || 0 === i.length)
                    return new o["default"](function(e) {
                        e({
                            eof: !0
                        })
                    }
                    );
                this.add(i.filter(function(e) {
                    return e.isMedia
                }), {
                    at: 0
                });
                var a = this.models;
                if (this.downloadMedias(a),
                a.length <= 2 * c.MEDIA_QUERY_LIMIT) {
                    var s = 0 === a.length ? _.head(i) : _.head(a);
                    return this.queryMedia(e, s)
                }
                return new o["default"](function(e) {
                    e({
                        eof: !1
                    })
                }
                )
            }
            return r === u.before ? this.queryMediaBefore ? this.queryMediaBefore : (this.queryMediaBefore = Store.Msg.queryMedia(t.id.remote, c.MEDIA_QUERY_LIMIT, r, t.id).then(function(e) {
                (!e || e.length < c.MEDIA_QUERY_LIMIT) && (n.hasMediaBefore = !1);
                var t = [];
                return e && e.length > 0 && (t = e.filter(function(e) {
                    return e.isMedia
                }),
                n.downloadMedias(t)),
                n.add(t, {
                    at: 0
                }),
                {
                    length: t.length
                }
            })["catch"](l.WapDrop, _.noop)["finally"](function() {
                n.queryMediaBefore = null ,
                n.trigger("query_media_before")
            }),
            this.trigger("query_media_before"),
            this.queryMediaBefore) : r === u.after ? this.queryMediaAfter ? this.queryMediaAfter : this.queryMediaAfter = Store.Msg.queryMedia(t.id.remote, c.MEDIA_QUERY_LIMIT, r, t.id).then(function(e) {
                (!e || e.length < c.MEDIA_QUERY_LIMIT) && (n.hasMediaAfter = !1);
                var t = [];
                return e && e.length > 0 && (t = e.filter(function(e) {
                    return e.isMedia
                }),
                n.downloadMedias(t)),
                n.add(t),
                {
                    length: t.length
                }
            })["catch"](l.WapDrop, _.noop)["finally"](function() {
                n.queryMediaAfter = null ,
                n.trigger("query_media_after")
            }) : void 0
        },
        downloadMedias: function(e) {
            _.forEach(e, function(e) {
                e.downloadMedia()
            })
        }
    });
    e.exports = d
}
, function(e, t, n) {
    "use strict";
    var r = n(82)
      , i = r.extend({
        Collection: "ChatPreference",
        props: {
            id: "string",
            wallpaperColor: "string"
        }
    });
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    var r = n(430)
      , i = n(1255)
      , o = n(10)
      , a = r.extend({
        model: i,
        initialize: function() {
            r.prototype.initialize.call(this, {
                CachePolicy: {
                    id: "chat_preference",
                    policy: r.CACHE_POLICY.LOAD,
                    delay: 1e3
                }
            })
        },
        initializeFromCache: function() {
            this.get("defaultPreference") || this.add({
                id: "defaultPreference",
                wallpaperColor: o.DEFAULT_CHAT_WALLPAPER
            })
        },
        get: function(e, t) {
            return r.prototype.get.call(this, e, t) || r.prototype.get.call(this, "defaultPreference")
        }
    });
    e.exports = new a
}
, function(e, t, n) {
    "use strict";
    var r = n(10)
      , i = n(1)
      , o = n(24)
      , a = n(14)
      , s = {
        handle: function(e) {
            var t = e.shift();
            switch (t.type) {
            case "const":
                r[t.key] = t.value;
                break;
            case "read":
            case "unread":
                var n = Store.Chat.get(t.jid);
                n && ("read" === t.type ? n.markSeen() : "unread" === t.type && n.markUnseen());
                break;
            case "picture":
                Store.ProfilePicThumb.imageChanged(t.jid, t.tag);
                break;
            case "log":
                o.upload("server-requested");
                break;
            case "privacy":
                t.jid ? (Store.Presence.update(t.jid)["catch"](a.WapDrop, _.noop),
                Store.ProfilePicThumb.update(t.jid)["catch"](a.WapDrop, _.noop),
                Store.Status.update(t.jid)["catch"](a.WapDrop, _.noop)) : i.error("Store:Cmd:handle:privacy no jid", t)();
                break;
            case "identity":
                if (t.jid) {
                    var s = Store.Contact.get(t.jid);
                    s ? s.updateIdentity(t) : i.error("Store:Cmd:handle:identity no contact", t)()
                } else
                    i.error("Store:Cmd:handle:identity no jid", t)();
                break;
            default:
                i.warn("Store.Cmd:handle:unknown " + t.type, t)()
            }
        }
    };
    e.exports = s
}
, function(e, t, n) {
    "use strict";
    var r = n(82)
      , i = r.extend({
        idAttribute: "char",
        props: {
            "char": "string",
            variant: "string"
        }
    });
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    var r = n(430)
      , i = n(1258)
      , o = n(432)
      , a = r.extend({
        model: i,
        initialize: function() {
            r.prototype.initialize.call(this, {
                CachePolicy: {
                    id: "emoji_variant_collection",
                    policy: r.CACHE_POLICY.LOAD,
                    delay: 1e3
                }
            })
        },
        setVariant: function(e, t) {
            var n = o.skinToneEmojis[e];
            if (!n)
                throw new Error("attempt to store variantless emoji");
            this.gadd({
                "char": n,
                variant: t
            })
        },
        getVariant: function(e) {
            if (o.skinToneEmojis[e]) {
                var t = this.get(e);
                return t ? t.variant : null
            }
            throw new Error("attempt to get variantless emoji")
        }
    });
    e.exports = new a
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(1)
      , s = n(430)
      , c = n(1037)
      , l = n(45)
      , u = n(14)
      , d = n(23)
      , p = s.extend({
        model: c,
        initialize: function() {
            s.prototype.initialize.call(this, {
                staleCollection: !0
            })
        },
        onResume: function() {
            _.union(Store.Chat.where({
                active: !0
            }).filter(function(e) {
                return e.isGroup || e.isBroadcast
            }), Store.Chat.where({
                isBroadcast: !0
            })).forEach(function(e) {
                Store.GroupMetadata.find(e.id)["catch"](u.WapDrop, _.noop)
            })
        },
        _find: function(e) {
            var t = this;
            if (d.isGroup(e)) {
                var n = Store.Chat.get(e);
                return n && n.isReadOnly ? l.groupMetadataFindFromPhone(e).then(function(t) {
                    return "ok" === t.status ? t.data : "missing" === t.status ? void _.defer(function() {
                        Store.Chat.get(e)["delete"]()
                    }) : "error" === t.status ? (a.error("model:GroupMetadata:find error " + t.info)(),
                    o["default"].reject(new Error("model:GroupMetadata:find error"))) : void 0
                }) : l.groupMetadataFind(e).then(function(n) {
                    if (n.status >= 400)
                        return {
                            id: e,
                            stale: !1
                        };
                    var r = []
                      , i = t.get(e);
                    return i ? i.participants.set(n.participants) : r = n.participants,
                    t.updateSubject(e, n.subject),
                    {
                        id: n.id,
                        owner: n.owner,
                        creation: n.creation,
                        participants: r
                    }
                })
            }
            return d.isBroadcast(e) ? l.contactFindBroadcast(e).then(function(t) {
                if (200 === t.status) {
                    var n = Store.GroupMetadata.get(e);
                    if (n && !n.stale)
                        return o["default"].resolve(n);
                    var r = [];
                    return n ? n.participants.set(t.recipients) : r = t.recipients,
                    {
                        id: e,
                        participants: r
                    }
                }
                return 404 === t.status ? o["default"].reject("False broadcast list query.") : (a.error("models:GroupMetadataCollection:_find:bclist error: " + t.status)(),
                o["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: " + t.status)))
            }) : (a.log("groupMetadata:find trying to fetch non-group/bclist wid " + e)(),
            o["default"].reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid " + e)))
        },
        _handle: function(e) {
            return e
        },
        updateSubject: function(e, t) {
            _.isString(t) && Store.Contact.find(e).then(function(e) {
                e.name || (e.name = t)
            })
        }
    });
    e.exports = new p
}
, function(e, t, n) {
    "use strict";
    e.exports = {
        Blocklist: n(1248),
        Call: n(1250),
        Chat: n(1251),
        Cmd: n(1257),
        GroupMetadata: n(1260),
        Msg: n(1262),
        MsgInfo: n(1264),
        StarredMsg: n(1271),
        Mute: n(1265),
        Presence: n(1266),
        ProfilePicThumb: n(1267),
        Props: n(1268),
        RecentEmoji: n(1270),
        EmojiVariant: n(1259),
        Status: n(1272),
        ChatPreference: n(1256)
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e) {
        if (e.notifyName) {
            var t = Store.Contact.get(e.sender);
            t && !t.isMe && (!t.notifyName || t.notifyName.t < e.t) && (t.notifyName = {
                name: e.notifyName,
                t: e.t
            })
        }
    }
    function o(e, t, n, r) {
        var o = []
          , a = [];
        if (t.forEach(function(t, s) {
            t.id instanceof w || (v.error("msgCollection:_processMultipleMessages: el.id is not a MsgKey" + (new Error).stack)(),
            D.upload("forgot-to-create-msgkey"),
            t.id = new w({
                from: t.from,
                to: t.to,
                id: t.id,
                participant: t.participant,
                self: t.self
            })),
            _.isString(e) && b.isBroadcast(e) && delete t.broadcast,
            "ptt" === t.type && !t.id.fromMe && t.ack < 0 && (t.ack = 0);
            var c = Store.Msg.get(t.id);
            if (c) {
                t.ack < c.ack && delete t.ack;
                for (var l in t)
                    t.hasOwnProperty(l) && "undefined" == typeof t[l] && delete t[l];
                t.id.fromMe && !c.clientUrl && t.clientUrl && (c.promises.mediaPromise ? c.promises.mediaPromise.control.phoneResolved(!0) : t.mediaState = M.MEDIA_STATE.INIT),
                n.isHistory && (t.isNewMsg = !1);
                var u = c.t ? _.omit(t, "t") : t;
                c.set(u),
                n.isHistory && (c.recvFresh || r) && !c.search ? (v.warn("model:Msg:handle:processMM:" + (c.recvFresh ? "dup:" : "overlap:") + c.id)(),
                a.push(c)) : n.isHistory && c.search ? (c.search = !1,
                v.warn("model:Msg:handle:processMM load search as history " + c.id)(),
                o.push(c.toJSON())) : "search" !== n.add && "resync" !== n.add || o.push(c.toJSON()),
                i(c)
            } else
                M.typeIsMMS(t.type) && !t.clientUrl && (t.id.fromMe && 0 === t.ack ? t.mediaState = M.MEDIA_STATE.REMOTE_UPLOADING : t.mediaState = M.MEDIA_STATE.REMOTE_NEED_UPLOAD),
                "search" === n.add && (t.search = !0),
                n.update || o.push(t)
        }),
        0 === o.length && 0 === a.length) {
            if (e && n.pendingMsgsDone) {
                var s = Store.Chat.get(e);
                s && (s.pendingMsgs = !1)
            }
            return m["default"].resolve(t.map(function(e) {
                return Store.Msg.get(e.id)
            }))
        }
        var l = d(o).then(function(e) {
            var t = Store.Msg.add(e, {
                merge: !0
            });
            return _.each(t, function(e) {
                i(e)
            }),
            t
        });
        return e ? m["default"].all([l, Store.Chat.find(e)]).spread(function(i, o) {
            var s, l, d = "after" === n.add || "last" === n.add, p = !n.isHistory, h = !1;
            if ("unread" === n.add ? (s = r,
            o.msgChunks.push(s),
            l = n.firstUnreadKey) : "last" === n.add && n.resume ? (s = r,
            h = !0) : s = "function" == typeof r ? r() : r,
            c(t, i, a, o, d, s || o.msgs, l, h),
            n.pendingMsgsDone && (o.pendingMsgs = !1),
            p && b.isBroadcast(e) && i.forEach(function(t) {
                if ("broadcast_notification" === t.type) {
                    var n = Store.GroupMetadata.get(e);
                    "add" === t.subtype ? n.participants.add({
                        id: t.body
                    }, {
                        merge: !0
                    }) : "remove" === t.subtype && n.participants.remove(t.body),
                    o.groupMetadata.stale = !1
                } else
                    t.recvFresh && !t.isNotification && u(t)
            }),
            S.supportsFeature(S.F.RECENT_EMOJI_SYNC) && !Store.RecentEmoji.syncDue)
                for (var f = 0; f < i.length; f++) {
                    var m = i[f];
                    if (m.isNewMsg && m.isSentByMe && m.containsEmoji) {
                        Store.RecentEmoji.periodicSync();
                        break
                    }
                }
            return t.map(function(e) {
                return Store.Msg.get(e.id)
            })
        }) : l.then(function(e) {
            return t.map(function(e) {
                return Store.Msg.get(e.id)
            }).filter(function(e) {
                return !!e.chat
            })
        })
    }
    function a(e, t, n, r, i, o) {
        var a = r || t.msgs;
        if (e = _.isArray(e) ? e : [e],
        0 !== e.length) {
            var s = a === t.msgs;
            if (o) {
                s && v.error("models:msg:store:resetMostRecentMsgs .msgs === cmc !")(),
                s = !0,
                t.lastReceivedKey = _.last(e).id,
                a.add(e);
                var c = new N;
                c.replace(t.msgs),
                t.msgChunks.push(c),
                t.replaceMsgsCollection(a),
                t.msgs.trigger("change:last", t.msgs.last())
            } else
                n ? (s && (t.lastReceivedKey = _.last(e).id),
                a.add(e)) : a.add(e, {
                    at: 0
                });
            if (n && s || !Store.Msg.lastReceivedReceipt[t.id])
                for (var l = e.length, u = l - 1; u >= 0; u--) {
                    var d = e[u]
                      , p = d.id;
                    if (p.fromMe && !d.isNotification) {
                        Store.Msg.updateLastReceipt(p.remote, d.t);
                        break
                    }
                }
            i && !t.unreadMsgAnchor && (t.disableUnreadAnchor ? t.disableUnreadAnchor = !1 : t.unreadMsgAnchor = _.find(e, function(e) {
                return e.id.toString() === i.toString()
            }))
        }
    }
    function s(e, t, n, r, i) {
        var o, a, s, c = {}, l = {}, u = n.length, d = i;
        if (0 === u)
            return {
                msgs: t,
                collection: d
            };
        for (o = 0; o < u; o++)
            a = n[o],
            l[a.id] = a;
        for (u = t.length,
        o = 0; o < u; o++)
            a = t[o],
            c[a.id] = a;
        var p = [];
        for (u = e.length,
        o = 0; o < u; o++)
            if (a = e[o],
            s = c[a.id],
            s && p.push(s),
            s = l[a.id])
                if (s.recvFresh)
                    p.push(s),
                    r.removeMsg(s),
                    s.unset("recvFresh");
                else {
                    var h = r.getAllCMCs()
                      , f = _.find(h, function(e) {
                        return e.get(a.id)
                    });
                    i && f === i || (f ? (f.forEach(function(e) {
                        p.push(e),
                        delete l[e.id]
                    }),
                    f === r.msgs ? (r.replaceMsgsCollection(i),
                    d = r.msgs) : (r.notifyMsgCollectionMerge(i, f, i),
                    r.removeMsgsCollection(f))) : (v.error("models:Msg:reorder trying to merge CMC of orphaned message " + a.id, a)(),
                    p.push(l[a.id])))
                }
        return {
            msgs: p,
            collection: d
        }
    }
    function c(e, t, n, r, i, o, c, l) {
        var u = s(e, t, n, r, o);
        a(u.msgs, r, i, u.collection, c, l)
    }
    function l(e) {
        return _.isObject(e) ? JSON.parse((0,
        h["default"])(e)) : e
    }
    function u(e) {
        function t(t) {
            var n = new w({
                from: e.from,
                to: t,
                id: r.id
            });
            if (!Store.Msg.some(_.matches({
                id: n
            }))) {
                var i = l(e);
                i.to = t,
                i.id = n,
                i.broadcast = !0;
                var o = Store.Msg.add(i, {
                    merge: !0
                });
                Store.Chat.find(t).then(function(e) {
                    a(o, e, !0)
                })
            }
        }
        var n, r = e.id;
        if (!e.invis)
            if (e.recipients && 0 !== e.recipients.length)
                n = e.recipients,
                e.recipients.forEach(t);
            else {
                var i = Store.GroupMetadata.get(r.remote);
                i ? (n = l(i.participants),
                _.map(n, "id").forEach(t)) : v.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: " + r.remote)()
            }
        return n
    }
    function d(e) {
        return m["default"].all(e.map(function(e) {
            return ["image", "video"].indexOf(e.type) > -1 && !parseInt(e.width || 0, 10) && e.body ? P.loadImage("data:image/jpeg;base64," + e.body).then(function(t) {
                return e.width = t.width,
                e.height = t.height,
                e
            })["catch"](function(t) {
                return v.assert(!1, "fillInThumbnailDims", "model:msgs:fillInThumbnailDims thumb failed to load msg: " + e.id.toString() + " error: " + t)(t),
                e.width = void 0,
                e.height = void 0,
                e.body = void 0,
                m["default"].resolve(e)
            }) : m["default"].resolve(e)
        }))
    }
    var p = n(21)
      , h = r(p)
      , f = n(2)
      , m = r(f)
      , g = n(10)
      , v = n(1)
      , y = n(430)
      , E = n(14)
      , b = n(23)
      , S = n(101)
      , M = n(986)
      , C = n(46)
      , T = n(83)
      , w = n(55)
      , k = n(12)
      , x = n(45)
      , N = n(1017)
      , P = n(1005)
      , D = n(24)
      , O = 6e4
      , A = y.extend({
        model: M,
        initialize: function() {
            y.prototype.initialize.call(this),
            this.lastReceivedReceipt = {},
            this.preAck = {},
            this.pendingAdd = {},
            this.ftsCache = {},
            this.listenTo(k, "change:stream", function() {
                k.stream === k.STREAM.DISCONNECTED && (this.preAck = {})
            })
        },
        _findQuery: function(e) {
            var t, n = this;
            switch (e.direction) {
            case "before":
            case "after":
                t = e.direction;
                break;
            default:
                t = "before"
            }
            return x.msgFindQuery(t, e).then(function(r) {
                if (r.status >= 400)
                    return v.error("model:Msg:findQuery error " + r.status)(),
                    m["default"].reject(r.status);
                var i = function() {
                    var t = n.get(e)
                      , r = Store.Chat.get(e.remote);
                    return t ? t.msgChunk : r ? r.msgs : void 0
                };
                return r.forEach(function(e) {
                    e.invis = !0
                }),
                v.log("model:Msg:findQuery:got:" + r.length + ":" + e.direction)(),
                n.processMultipleMessages(e.remote, r, {
                    add: t,
                    isHistory: !0
                }, i)
            })
        },
        resyncChatMsgs: function(e, t) {
            var n = this
              , r = "number" != typeof t || isNaN(t) ? g.PAGE_SIZE : t;
            return x.msgFindQuery("before", {
                remote: e,
                count: r
            }).then(function(e) {
                return e.status >= 400 ? (v.error("model:Msg:resyncChatMsgs error " + e.status)(),
                m["default"].reject(e.status)) : n.processMultipleMessages(void 0, e, {
                    add: "resync"
                })
            })
        },
        getStarred: function(e, t, n, r) {
            var i = this
              , o = {
                count: "number" != typeof t || isNaN(t) ? g.PAGE_SIZE : t,
                chat: e && _.isString(e) ? e : void 0,
                remote: n && n.remote,
                id: n && n.id,
                fromMe: n && n.fromMe,
                participant: n && n.participant,
                media: r ? "gif" : void 0
            };
            return x.msgFindQuery("star", o).then(function(e) {
                return e.status >= 400 ? (v.error("model:Msg:getStarred error " + e.status)(),
                m["default"].reject(e.status)) : i.processMultipleMessages(void 0, e, {
                    add: "search"
                })
            })
        },
        incrementalStarredUpdate: function(e) {
            return this.processMultipleMessages(void 0, e, {
                add: "search"
            })
        },
        search: function R(e) {
            var t = arguments.length <= 1 || void 0 === arguments[1] ? 1 : arguments[1]
              , n = this
              , r = arguments[2]
              , i = arguments[3];
            if (1 !== t || i)
                return this._search(e, t, r, i);
            var o = this.ftsCache[e];
            if (o)
                return o;
            var R = this._search(e, t, r, i);
            this.ftsCache[e] = R;
            var a = function() {
                n.ftsCache[e] = null
            };
            return _.delay(a, O),
            R["catch"](a),
            R
        },
        _search: function(e, t, n, r) {
            var i = this
              , o = {
                searchTerm: e,
                page: t && _.isNumber(t) ? t : 1,
                count: n && _.isNumber(n) ? n : g.PAGE_SIZE,
                remote: r
            };
            return x.msgFindQuery("search", o).then(function(e) {
                if (e.status >= 400)
                    return v.error("model:Msg:search error " + e.status)(),
                    m["default"].reject(e.status);
                var t = _.isArray(e) ? e : e.messages
                  , n = !!_.isArray(e) || e.eof;
                return m["default"].props({
                    messages: i.processMultipleMessages(void 0, t, {
                        add: "search"
                    }),
                    eof: n
                })
            })
        },
        queryMedia: function(e, t, n, r, i) {
            var o = this
              , a = {
                remote: e,
                count: t && _.isNumber(t) ? t : g.PAGE_SIZE,
                id: r && r.id,
                fromMe: r && r.fromMe,
                participant: r && r.participant,
                direction: n || "before",
                media: i
            };
            return x.msgFindQuery("media", a).then(function(e) {
                return e.status >= 400 ? (v.error("model:Msg:media error " + e.status)(),
                m["default"].reject(e.status)) : o.processMultipleMessages(void 0, e, {
                    add: "search"
                })
            })
        },
        getContext: function(e, t) {
            var n = this
              , r = this.get(e);
            return r ? m["default"].all([x.msgFindQuery("before", e), x.msgFindQuery("after", e)]).spread(function(i, o) {
                return _.isArray(i) && _.isArray(o) ? (r.search = !1,
                m["default"].all([n.processMultipleMessages(e.remote, i, {
                    add: "before",
                    isHistory: !0
                }, t), n.processMultipleMessages(e.remote, o, {
                    add: "after",
                    isHistory: !0
                }, t)])) : (v.error("model:msg:getContext fetch error", i, o)(),
                m["default"].reject(i.status || o.status))
            }) : x.msgFindQuery("after", e).then(function(r) {
                return _.isArray(r) ? n.processMultipleMessages(e.remote, r, {
                    add: "after",
                    isHistory: !0
                }, t) : (v.error("model:msg:getContext:after fetch error", r)(),
                m["default"].reject(r.status))
            }).then(function(t) {
                var r = t[0]
                  , i = r.id.clone();
                return i.count = e.count + 1,
                m["default"].all([x.msgFindQuery("before", i).then(function(t) {
                    if (!_.isArray(t))
                        return v.error("model:msg:getContext:before fetch error", t)(),
                        m["default"].reject(t.status);
                    var i = t[t.length - 1]
                      , o = i.id;
                    if (!o.equals(e))
                        return v.error("model:msg:getContext:before ctx message mismatch", t)(),
                        m["default"].reject(405);
                    var a = function() {
                        return r.msgChunk
                    };
                    return n.processMultipleMessages(e.remote, t, {
                        add: "before",
                        isHistory: !0
                    }, a)
                }), m["default"].resolve(t)])
            })
        },
        handle: function(e) {
            function t(e, t) {
                var n = new w({
                    from: a.from,
                    to: e,
                    id: t,
                    participant: void 0,
                    selfDir: "out"
                })
                  , r = o.get(n);
                if (r) {
                    r.updateAck(a.ack),
                    o.updateLastReceipt(n.remote, a.t);
                    var i = n.remote;
                    b.isUser(i) && (Store.MsgInfo.update(t, a.from, e, a.ack, i, a.t),
                    b.isBroadcast(a.broadcast) && Store.MsgInfo.update(t, a.from, a.broadcast, a.ack, i, a.t))
                } else
                    v.log("Msg:out of order ack", a)(),
                    o.preAck[n] = a
            }
            var n, r, i, o = this, a = e.shift();
            if ("ack" === a.cmd) {
                var s = [a.to];
                if (b.isBroadcast(a.to) && 1 === a.ack) {
                    var c = Store.GroupMetadata.get(a.to);
                    c && Array.prototype.push.apply(s, _.map(c.participants.toArray(), "id"))
                }
                return s.forEach(function(e) {
                    t(e, a.id)
                }),
                !0
            }
            if ("acks" === a.cmd)
                return a.id.forEach(function(e) {
                    t(a.to, e)
                }),
                !0;
            if (a.msg)
                return a.msg.recvFresh = !0,
                a.msg.isNewMsg = !0,
                this.processMultipleMessages(a.chat, [a.msg], {
                    add: "after",
                    update: "update" === a.meta.add,
                    isHistory: !1
                }),
                !0;
            if (a.msgs) {
                var l = a.msgs.length;
                if (!l)
                    return !1;
                r = a.meta,
                r.isHistory = !0,
                "unread" === r.add && (r.firstUnreadKey = new w({
                    fromMe: r.unreadFromMe,
                    remote: a.chat,
                    id: r.unreadId,
                    participant: r.unreadParticipant
                }),
                i = new N);
                for (var u = 0; u < l; u++)
                    n = a.msgs[u],
                    n.invis = !0;
                return Store.Conn.platform === Store.Conn.PLATFORMS.IPHONE && this.trigger(g.COLLECTION_HAS_SYNCED),
                this.processMultipleMessages(a.chat, a.msgs, r, i),
                !0
            }
            if (a.recent) {
                r = a.meta,
                delete a.recent,
                delete a.meta,
                this.trigger(g.COLLECTION_HAS_SYNCED),
                r.isHistory = !0;
                for (var d in a)
                    "last" === r.add && r.resume && (i = new N),
                    n = a[d],
                    n.invis = !0,
                    this.processMultipleMessages(d, [n], r, i)
            } else
                v.log("************** Msg else clause. something strange is going on")()
        },
        _hasSynced: function() {
            return C.waitForBBEvent(this, g.COLLECTION_HAS_SYNCED)
        },
        "delete": function() {
            y.prototype["delete"].call(this),
            this.lastReceivedReceipt = {},
            this.preAck = {}
        },
        send: function(e) {
            return m["default"].callSynchronously(function() {
                var t = e.id
                  , n = e.toJSON();
                if (S.supportsFeature(S.F.SPAM) && Store.Chat.find(e.id.remote).then(function(e) {
                    e.isTrusted() || e.sendNotSpam()["catch"](_.noop)
                }),
                e.isNewMsg = !0,
                !e.isGroupMsg && Store.Blocklist.get(e.to))
                    return m["default"].reject(new E.ContactBlocked("Contact is blocked"));
                if (b.isBroadcast(n.to))
                    var r = u(n);
                delete n.status,
                delete n.mimetype,
                delete n.height,
                delete n.width,
                delete n.recipients,
                delete n.chat,
                delete n.broadcast,
                delete n.ack,
                delete n.invis,
                delete n.filehash,
                delete n.recvFresh,
                delete n.mediaData,
                T.isHttp(e.url) || delete n.url,
                T.isHttp(e.clientUrl) || delete n.clientUrl;
                for (var i in n)
                    null !== n[i] && "undefined" != typeof n[i] || delete n[i];
                return e.isMMS && (n.avparams = e.avParams()),
                "chat" !== n.type || "url" !== n.subtype || S.supportsFeature(S.F.URL) || delete n.subtype,
                n.quotedMsg && !S.supportsFeature(S.F.REPLIES_OUT) && (delete n.quotedMsg,
                delete n.quotedStanzaID,
                delete n.quotedParticipant),
                n.mentionedJidList && !S.supportsFeature(S.F.MENTIONS_OUT) && delete n.mentionedJidList,
                Store.Chat.find(e.id.remote).then(function(t) {
                    return t.sendSeen(),
                    m["default"].props({
                        reply: x.msgCreateRecord(n, e.local),
                        chat: t
                    })
                }).then(function(n) {
                    var i = n.reply
                      , o = n.chat;
                    if (200 === i.status) {
                        var a = t.remote
                          , s = t.fromMe && t.remote === Store.Conn.me ? 3 : i.data ? i.data.ack : 1;
                        return e.updateAck(s),
                        o.lastReceivedKey = t,
                        Store.Msg.updateLastReceipt(a, i.t),
                        b.isBroadcast(a) && (r ? r.forEach(function(e) {
                            var n = new w({
                                from: Store.Conn.me,
                                to: e.id,
                                id: t.id
                            })
                              , r = Store.Msg.get(n);
                            r && (r.ack = 1,
                            Store.Msg.updateLastReceipt(e, r.t),
                            Store.Chat.find(e).then(function(e) {
                                e.lastReceivedKey = n
                            }))
                        }) : v.log("model:msg:createRecord bclist server ack, no recipients")()),
                        "success"
                    }
                    return 408 !== i.status && v.assert(!1, "send-not-200", "Phone responded " + i.status)(),
                    "dropped"
                })["catch"](function(e) {
                    return v.error("model:msg:createRecord dropped msg: " + n.id)(n.type),
                    v.assert(!1, "send-msg-error", "Got error " + e)(e),
                    "dropped"
                })
            })
        },
        resyncReceipts: function() {
            v.log("Msg:resyncReceipts")();
            var e = [];
            for (var t in Store.Msg.lastReceivedReceipt) {
                var n, r = Store.Chat.get(t);
                if (n = r ? S.gte([0, 5]) ? r.getFirstMsgWithStatus() : r.getFirstMsgFromMe() : void 0) {
                    var i = n.id;
                    i.t = Store.Msg.lastReceivedReceipt[t] || n.t || 0,
                    e.push(i)
                } else
                    v.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: " + t)()
            }
            return 0 === e.length ? m["default"].resolve() : x.resyncReceipts(e).then(function(e) {
                _.isArray(e) ? (v.log("Msg:resyncReceipts success")(),
                e.forEach(function(e) {
                    Store.Msg.updateLastReceipt(e.id, e.t),
                    e.acks.forEach(function(t) {
                        if (4 === t.length) {
                            var n = new w({
                                fromMe: t[1],
                                remote: e.id,
                                id: t[0],
                                participant: t[2]
                            })
                              , r = Store.Msg.get(n);
                            r && r.updateAck(t[3])
                        } else
                            v.error("Msg:resyncReceipts invalid response: " + (0,
                            h["default"])(t))()
                    })
                })) : v.error("Msg:resyncReceipts error", e)()
            })["catch"](E.LogoutDrop, E.EphemeralDrop, E.BrowserReplacedDrop, _.noop)["catch"](function(e) {
                throw v.error("Msg:resyncReceipts dropped " + e + " " + (e ? e.stack : "no stack"))(),
                new Error("Msg:resyncReceipts dropped")
            })
        },
        updateLastReceipt: function(e, t) {
            var n = this.lastReceivedReceipt[e];
            (!n || t > n) && (this.lastReceivedReceipt[e] = t)
        },
        processMultipleMessages: function(e, t, n, r) {
            var i = this
              , a = arguments;
            if (e) {
                var s, c = this.pendingAdd[e];
                return s = c ? c.then(function() {
                    return o.apply(i, a)
                }) : o.apply(i, a),
                s["finally"](function() {
                    i.pendingAdd[e] === s && (i.pendingAdd[e] = null )
                }),
                this.pendingAdd[e] = s
            }
            return o.apply(i, a)
        }
    });
    e.exports = new A
}
, function(e, t, n) {
    "use strict";
    var r = n(82)
      , i = n(1107)
      , o = n(210)
      , a = n(438)
      , s = n(439)
      , c = r.extend({
        props: {
            id: "string",
            t: "number"
        },
        children: {
            contact: o
        },
        initialize: function() {
            this.contact = Store.Contact.gadd({
                id: this.id
            }),
            this.listenTo(this.contact, "all", this._getCachedEventBubblingHandler("contact"))
        },
        getCollection: function() {
            return this.collection
        }
    })
      , l = a.extend(s, {
        model: c,
        comparator: function(e, t) {
            return o.Comparator(e.contact, t.contact)
        },
        isStateStale: function(e) {
            var t = this.get(e);
            return t && t.stale
        }
    })
      , u = r.extend(i, {
        Collection: "MsgInfo",
        props: {
            id: "msgKey",
            isPTT: "boolean",
            playedRemaining: {
                type: "number",
                "default": 0
            },
            readRemaining: {
                type: "number",
                "default": 0
            },
            deliveryRemaining: {
                type: "number",
                "default": 0
            }
        },
        collections: {
            played: l,
            read: l,
            delivery: l
        },
        derived: {
            settled: {
                deps: ["isPTT", "playedRemaining", "readRemaining"],
                fn: function() {
                    return this.isPTT ? !this.playedRemaining : !this.readRemaining
                }
            }
        }
    });
    e.exports = u
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(1)
      , s = n(23)
      , c = n(55)
      , l = n(430)
      , u = n(986)
      , d = n(1263)
      , p = n(12)
      , h = n(45)
      , f = l.extend({
        model: d,
        initialize: function() {
            l.prototype.initialize.call(this, {
                staleCollection: !0
            })
        },
        _initializeStaleCollection: function() {
            var e = this;
            this.listenTo(p, "change:stream", function() {
                p.stream === p.STREAM.DISCONNECTED && e.forEach(function(e) {
                    e.settled || e.set("stale", !0)
                })
            })
        },
        _find: function(e) {
            var t = Store.Msg.get(e);
            return t ? t.isSentByMe ? h.queryMsgInfo(t.id).then(function(e) {
                return e.status >= 400 ? (a.log("model:MsgInfo:findQuery error " + e.status)(),
                o["default"].reject(e.status)) : (e.id = t.id,
                e.isPTT = t.type === u.TYPE.PTT,
                o["default"].resolve(e))
            }) : o["default"].reject("message not sent by me") : o["default"].reject("No message found for id: " + e)
        },
        update: function(e, t, n, r, i, o) {
            var l = new c({
                from: t,
                to: n,
                id: e,
                participant: i
            })
              , u = new c({
                from: t,
                to: n,
                id: e
            })
              , d = this.get(l) ? this.get(l) : this.get(u)
              , p = s.isUser(u.remote)
              , h = void 0
              , f = void 0;
            if (d)
                switch (r) {
                case 4:
                    if (h = d.played.get(i),
                    h || (d.played.add({
                        id: i,
                        t: o
                    }),
                    d.playedRemaining -= 1),
                    p)
                        break;
                case 3:
                    if (f = d.read.filter(function(e) {
                        return e.id === i
                    }),
                    d.read.remove(f),
                    3 === r && (d.read.add({
                        id: i,
                        t: o
                    }),
                    0 === f.length && (d.readRemaining -= 1)),
                    p)
                        break;
                case 2:
                    f = d.delivery.filter(function(e) {
                        return e.id === i
                    }),
                    d.delivery.remove(f),
                    2 === r && (d.delivery.add({
                        id: i,
                        t: o
                    }),
                    0 === f.length && (d.deliveryRemaining -= 1));
                    break;
                default:
                    a.error("model:MsgInfo:handle ack err: " + r, arguments)()
                }
        },
        handle: function(e) {
            var t = this
              , n = e.shift();
            switch (n.cmd) {
            case "ack":
                this.update(n.id, n.from, n.to, n.ack, n.participant, n.t);
                break;
            case "acks":
                n.id.forEach(function(e) {
                    t.update(e, n.from, n.to, n.ack, n.participant, n.t)
                })
            }
        }
    });
    e.exports = new f
}
, function(e, t, n) {
    "use strict";
    var r = n(1)
      , i = n(430)
      , o = n(1108)
      , a = n(15)
      , s = "global_mute"
      , c = !0
      , l = !0
      , u = !0
      , d = i.extend({
        model: o,
        initialize: function() {
            i.prototype.initialize.call(this, {
                CachePolicy: {
                    id: "mute",
                    policy: i.CACHE_POLICY.LOAD,
                    delay: 1e3
                }
            })
        },
        initializeFromCache: function() {
            var e = a.getGlobalSounds();
            this.setGlobalSounds(e);
            var t = a.getGlobalNotifications();
            this.setGlobalNotifications(t);
            var n = a.getGlobalPreviews();
            this.setGlobalPreviews(n)
        },
        saveToCache: function() {
            if (Store.Conn.me) {
                var e = this._config.CachePolicy.id;
                r.log("models:mute:cache-save: " + e)(),
                a.setCollection(e, [this.globalMute().toJSON()])
            }
        },
        globalMute: function() {
            var e = this.get(s);
            return e ? e : this.add({
                id: s
            })
        },
        getGlobalSounds: function() {
            return c
        },
        setGlobalSounds: function(e) {
            c = e,
            a.setGlobalSounds(e)
        },
        getGlobalNotifications: function() {
            return l
        },
        setGlobalNotifications: function(e) {
            l = e,
            a.setGlobalNotifications(e)
        },
        getGlobalPreviews: function() {
            return u
        },
        setGlobalPreviews: function(e) {
            u = e,
            a.setGlobalPreviews(e)
        },
        handle: function(e) {
            for (var t = 0; t < e.length; t++) {
                var n = e[t]
                  , r = Store.Chat.get(n.id);
                r && "mute" === n.type && r.mute.setMute(n.muteExpiration)
            }
        }
    });
    e.exports = new d
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(1)
      , s = n(430)
      , c = n(1038)
      , l = n(45)
      , u = n(69)
      , d = n(14)
      , p = s.extend({
        model: c,
        initialize: function() {
            s.prototype.initialize.call(this, {
                staleCollection: !0
            }),
            this.listenTo(u, "change:phoneActive", this.onPresenceSubscribabilityChange)
        },
        _find: function(e) {
            var t = this.gadd(e);
            return t.isUser ? (t.isSubscribed = !0,
            l.presenceSubscribe(e)["catch"](function(e) {
                return t.isSubscribed = !1,
                o["default"].reject(e)
            })["catch"](d.WapDrop, _.noop),
            l.lastseenFind(e).then(function(n) {
                return 423 === n.status ? {
                    id: e,
                    stale: !0,
                    hasData: !1
                } : 401 === n.status ? (t.handle({
                    id: e,
                    deny: !0
                }),
                {
                    id: e
                }) : (n.id = e,
                t.handle(n),
                {
                    id: e
                })
            })) : o["default"].resolve({
                id: e
            })
        },
        handle: function(e) {
            var t = e.shift();
            if (t.id === Store.Conn.me)
                "unavailable" === t.type ? this.forEach(function(e) {
                    "unavailable" === e.type || e.stale || this.add({
                        id: e.id,
                        type: "unavailable",
                        t: t.t,
                        stale: !1
                    }, {
                        merge: !0
                    })
                }
                .bind(this)) : a.log('models:presence:handle for self is not "unavailable" !')();
            else {
                var n = this.get(t.id);
                n && ("unsubscribe" === t.type ? n.set({
                    isSubscribed: !1,
                    stale: !0
                }) : (n.handle(t),
                n.stale = !1))
            }
        },
        onPresenceSubscribabilityChange: function() {
            u.phoneActive ? Store.Chat.forEach(function(e) {
                e.active && e.presence.isUser && e.presence.update()["catch"](d.WapDrop, _.noop)
            }) : this.forEach(function(e) {
                e.reset(),
                e.set({
                    stale: !0,
                    isSubscribed: !1
                })
            })
        }
    });
    e.exports = new p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(1)
      , s = n(430)
      , c = n(447)
      , l = n(15)
      , u = n(45)
      , d = n(14)
      , p = n(23)
      , h = n(443)
      , f = n(69)
      , m = n(12)
      , g = s.extend({
        model: c,
        initialize: function() {
            s.prototype.initialize.call(this, {
                staleCollection: !0,
                CachePolicy: {
                    id: "profile_pic_thumb",
                    trigger: "change:tag change:raw",
                    policy: s.CACHE_POLICY.LOAD,
                    delay: 5e3
                }
            }),
            this.listenTo(f, "change:phoneActive", function() {
                f.phoneActive && this.onPhoneActive()
            })
        },
        get: function(e) {
            var t = s.prototype.get.call(this, e);
            if (!_.isString(e))
                return t;
            var n = s.prototype.get.call(this, h(e));
            if (n) {
                if (this.remove(n, {
                    silent: !0
                }),
                t)
                    return t;
                var r = n.toJSON();
                return r.id = e,
                this.add(r, {
                    silent: !0
                })
            }
            return t ? t : void 0
        },
        saveToCache: function() {
            if (Store.Conn.me) {
                var e = this._config.CachePolicy.id
                  , t = this.models.filter(function(e) {
                    return p.isWid(e.id)
                });
                t = t.map(function(e) {
                    return e = e.toJSON(),
                    e.id = h(e.id),
                    e
                }),
                a.log("models:profilePic:cache-save: " + e)(),
                l.setCollection(e, t)
            }
        },
        onPhoneActive: function() {
            if (m.stream === m.STREAM.CONNECTED) {
                var e = [];
                this.forEach(function(t) {
                    t._uiObservers && t.stale && (t.tag || t.unset("tag", {
                        silent: !0
                    }),
                    e.push(t))
                }),
                this.resyncPictures(e)
            }
        },
        onResume: function() {
            var e = this.filter(_.property("_uiObservers")).map(function(e) {
                return e.tag || e.unset("tag", {
                    silent: !0
                }),
                e
            });
            this.resyncPictures(e)
        },
        _find: function(e) {
            var t = Store.Chat.get(e);
            return t && t.isReadOnly ? u.profilePicFindThumbFromPhone(e, this.get(e)) : u.profilePicFind(e).then(function(t) {
                return 401 === t.status ? {
                    id: e,
                    raw: void 0,
                    tag: ""
                } : 423 === t.status ? {
                    id: e,
                    stale: !0
                } : t.status >= 400 ? {
                    id: e,
                    tag: null
                } : "undefined" == typeof t.status ? {
                    id: e,
                    tag: t.tag,
                    raw: null ,
                    eurl: t.eurl
                } : void 0
            })["catch"](d.WapDrop, function() {
                return {
                    id: e,
                    stale: !0
                }
            })
        },
        imageChanged: function(e, t) {
            var n = Store.ProfilePicThumb.get(e);
            n && ("remove" === t ? n.unset("tag") : n.tag !== t && n.update()["catch"](d.WapDrop, _.noop))
        },
        resyncPictures: function(e) {
            return 0 === e.length ? o["default"].resolve() : u.resyncPictures(e.map(function(e) {
                return {
                    id: e.id,
                    tag: e.tag
                }
            })).then(function(e) {
                if (423 === e.status)
                    a.warn("ProfilePicThumbStore:resyncPictures blocked")();
                else {
                    if (e.status >= 400)
                        throw a.error("ProfilePicThumbStore:resyncPictures error " + e.status)(e),
                        new Error("ProfilePicThumbStore:resyncPictures error");
                    if (!_.isArray(e))
                        throw a.error("ProfilePicThumbStore:resyncPictures unknown reply", e)(),
                        new Error("ProfilePicThumbStore:resyncPictures unknown reply");
                    a.log("ProfilePicThumbStore:resyncPictures success")(),
                    e.forEach(function(e) {
                        var t = Store.ProfilePicThumb.get(e.id);
                        t && t.set({
                            tag: e.tag,
                            raw: void 0,
                            stale: !1
                        })
                    })
                }
            })["catch"](d.WapDrop, _.noop)["catch"](function(e) {
                a.error("ProfilePicThumbStore:resyncPictures dropped: " + e)()
            })
        }
    });
    e.exports = new g
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return "number" == typeof e && e > 0 ? e - 1 : s.MAX_GROUP_SIZE
    }
    function i(e) {
        return "number" == typeof e && e > 0 ? 1024 * e * 1024 : s.MAX_MEDIA_UPLOAD_SIZE
    }
    function o(e) {
        return "number" == typeof e && e > 0 ? 1024 * e : s.IMG_MAX_BYTES
    }
    function a(e) {
        var t;
        c.Global.webcBucket = e.bucket || null ;
        for (t in d)
            if ("undefined" != typeof e[t]) {
                var n, r, i = d[t];
                _.isArray(i) ? (n = i[0],
                r = i[1](e[t])) : (n = i,
                r = e[t]),
                n && (s[n] = r)
            }
        for (t in u.F)
            "undefined" != typeof e[t] && u.setFeature(t, !!e[t])
    }
    var s = n(10)
      , c = n(56)
      , l = n(45)
      , u = n(101)
      , d = {
        bucket: null ,
        gifSearch: "SHOW_GIF_SEARCH",
        imageMaxEdge: "IMG_MAX_EDGE",
        imageMaxKBytes: ["IMG_MAX_BYTES", o],
        maxParticipants: ["MAX_GROUP_SIZE", r],
        maxSubject: "MAX_SUBJECT_LENGTH",
        media: ["MAX_MEDIA_UPLOAD_SIZE", i]
    }
      , p = {
        handle: function(e) {
            var t = e.shift();
            "number" == typeof t.status && t.status >= 400 || a(t)
        },
        fetch: function() {
            return l.queryServerProps().then(function(e) {
                "number" == typeof e.status && e.status >= 400 || a(e)
            })
        }
    };
    e.exports = p
}
, function(e, t, n) {
    "use strict";
    var r = n(82)
      , i = r.extend({
        idAttribute: "char",
        props: {
            "char": "string",
            weight: "number"
        }
    });
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(10)
      , s = n(1)
      , c = n(430)
      , l = n(1269)
      , u = n(45)
      , d = n(14)
      , p = n(432)
      , h = n(101)
      , f = c.extend({
        model: l,
        comparator: function(e, t) {
            return e.weight > t.weight ? -1 : 1
        },
        initialize: function() {
            c.prototype.initialize.call(this, {
                CachePolicy: {
                    id: "recent_emoji_collection",
                    policy: c.CACHE_POLICY.LOAD,
                    delay: 2e3
                }
            }),
            this.listenTo(this, "change:weight change:length", this.sortTrimScale),
            this.dirty = !1,
            this.syncDue = !1
        },
        "delete": function() {
            c.prototype["delete"].call(this),
            this.dirty = !1,
            this.syncDue = !1
        },
        _findQuery: function(e) {
            return h.supportsFeature(h.F.RECENT_EMOJI_SYNC) ? u.recentEmojiQuery(e ? this.toArray() : void 0).then(function(e) {
                return _.isArray(e) ? (e.forEach(function(e) {
                    e["char"] = p.normalizeEmoji(e["char"])
                }),
                o["default"].resolve(e)) : (s.error("models:recentEmoji:findQuery error", e)(),
                o["default"].reject("recent emoji fetch error"))
            }) : o["default"].reject("gk recent emoji sync unsupported")
        },
        sync: function() {
            var e = this;
            return this.findQuery(this.dirty)["finally"](function() {
                e.dirty = !1
            })["catch"](d.WapDrop, _.isString, _.noop)
        },
        _sync: _.throttle(function(e, t) {
            e.sync()["finally"](t)
        }, a.EMOJI_SYNC_DELAY, {
            leading: !1
        }),
        periodicSync: function() {
            h.supportsFeature(h.F.RECENT_EMOJI_SYNC) && (s.log("models:recentEmoji:periodicSync due:" + this.syncDue + " dirty: " + this.dirty)(),
            this.syncDue = !0,
            this._sync(this, function() {
                this.syncDue = !1
            }
            .bind(this)))
        },
        sortTrimScale: function() {
            var e = this.length;
            e && (this.sort(),
            e > 30 && this.remove(this.models.slice(30)),
            _.head(this.models).weight < 10 && _.last(this.models).weight > .01 || this.forEach(function(t, n) {
                t.weight = 1 + 3 * ((e - n) / e)
            }))
        },
        increment: function(e) {
            this.forEach(function(t) {
                t["char"] === e ? t.weight += 1 : t.weight *= .9,
                t.weight = Math.round(1e3 * t.weight) / 1e3
            }),
            this.get(e) || this.add({
                "char": e,
                weight: 1
            }),
            this.dirty = !0,
            this.periodicSync()
        }
    });
    e.exports = new f
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(430)
      , s = n(986)
      , c = n(12)
      , l = n(101)
      , u = n(1)
      , d = n(10)
      , p = a.extend({
        model: s,
        initialize: function() {
            var e = this;
            a.prototype.initialize.call(this);
            var t = {
                NONE: "none",
                SYNCING: "syncing",
                READY: "ready"
            };
            this.ALL = "all",
            this.SYNC_STATES = t,
            this.syncState = {},
            this.syncState[this.ALL] = this.SYNC_STATES.NONE,
            this.syncedAll = {},
            this.loadMarker = {},
            this.syncPromise = o["default"].resolve(),
            this.listenTo(c, "change:stream", function() {
                c.stream === c.STREAM.DISCONNECTED ? e.syncState[e.ALL] = e.SYNC_STATES.NONE : c.stream === c.STREAM.CONNECTED && e["delete"]()
            })
        },
        comparator: function(e, t) {
            return t.t - e.t
        },
        process: function(e, t, n, r) {
            r ? this["delete"]() : this.update(e, t, n)
        },
        sync: function() {
            var e = this
              , t = arguments.length <= 0 || void 0 === arguments[0] || arguments[0]
              , n = arguments[1]
              , r = n || this.ALL;
            if (!t && this.syncState[r] === this.SYNC_STATES.READY || this.syncState[r] === this.SYNC_STATES.SYNCING)
                return this.syncPromise;
            if (l.supportsFeature(l.F.FULL_TEXT_SEARCH)) {
                var i, o = function() {
                    i = e;
                    var t = e.syncState[r] || e.SYNC_STATES.NONE;
                    if (e.syncState[r] = e.SYNC_STATES.SYNCING,
                    e.trigger("sync"),
                    !l.supportsFeature(l.F.STARRED_PAGINATION))
                        return e.syncPromise = e.syncPromise.then(function() {
                            return Store.Msg.getStarred().then(function(e) {
                                e.length && (i.loadMarker[r] = _.last(e).id),
                                i.set(e),
                                i.syncedAll[r] = !0,
                                i.syncState[r] = i.SYNC_STATES.READY,
                                i.trigger("sync")
                            })["catch"](function(e) {
                                u.error("starred msg sync error: ", e)(),
                                i.syncState[r] = t
                            })
                        }),
                        {
                            v: e.syncPromise
                        };
                    var o = function() {
                        var o = e.loadMarker[r];
                        return e.syncPromise = e.syncPromise.then(function() {
                            return Store.Msg.getStarred(n, d.PAGE_SIZE, o).then(function(e) {
                                e.length && (i.loadMarker[r] = _.last(e).id,
                                i.add(e, {
                                    silent: !0
                                })),
                                e.length < d.PAGE_SIZE && (i.syncedAll[r] = !0),
                                i.syncState[r] = i.SYNC_STATES.READY,
                                i.trigger("sync")
                            })["catch"](function(e) {
                                u.error("starred msg sync error: ", e)(),
                                i.syncState[r] = t
                            })
                        }),
                        {
                            v: {
                                v: e.syncPromise
                            }
                        }
                    }();
                    return "object" == typeof o ? o.v : void 0
                }();
                if ("object" == typeof o)
                    return o.v
            }
        },
        isSynced: function(e) {
            return this.syncedAll[this.ALL] || this.syncedAll[e]
        },
        update: function(e, t, n) {
            var r = this
              , i = this.ALL
              , a = this.syncState[i];
            a !== this.SYNC_STATES.NONE && (this.syncPromise = this.syncPromise.then(function() {
                if (e) {
                    r.syncState[i] = r.SYNC_STATES.SYNCING;
                    var s = t.length > 0 ? Store.Msg.incrementalStarredUpdate(t) : o["default"].resolve([]);
                    return s.then(function(e) {
                        r.add(e.concat(n), {
                            silent: !0
                        }),
                        r.syncState[i] = a,
                        r.trigger("sync")
                    })["catch"](function(e) {
                        u.error("models:starred:update:error: ", e)(),
                        r.syncState[i] = a
                    })
                }
                return r.filter(function(e) {
                    return !e.star
                }).forEach(function(e) {
                    r.remove(e.id)
                }),
                o["default"].resolve()
            }))
        },
        updateLoadMarker: function(e, t) {
            var n = this.loadMarker[t];
            if (e === n) {
                var r = this.get(n).t
                  , i = t === this.ALL ? this.filter(function(e) {
                    return e.t > r
                }) : this.filter(function(e) {
                    return e.chat.id === t && e.t > r
                });
                this.loadMarker[t] = i.length ? _.last(i).id : void 0
            }
        },
        removeSingleton: function(e, t) {
            var n = e.remote;
            this.updateLoadMarker(e, n),
            this.updateLoadMarker(e, this.ALL)
        },
        remove: function(e, t) {
            var n = this;
            Array.isArray(e) ? e.forEach(function(e) {
                return n.removeSingleton(e, t)
            }) : this.removeSingleton(e, t),
            a.prototype.remove.call(this, e, t)
        },
        "delete": function() {
            this.syncState = {},
            this.syncState[this.ALL] = this.SYNC_STATES.NONE,
            this.syncedAll = {},
            this.loadMarker = {},
            this.syncPromise = o["default"].resolve(),
            a.prototype["delete"].call(this)
        }
    });
    e.exports = new p
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(1)
      , c = n(430)
      , l = n(440)
      , u = n(45)
      , d = n(14)
      , p = n(69)
      , h = n(12)
      , f = n(9)
      , m = n(101)
      , g = n(68).ActionToast
      , v = n(68).ActionType
      , y = c.extend({
        model: l,
        initialize: function() {
            c.prototype.initialize.call(this, {
                staleCollection: !0
            }),
            this.listenTo(p, "change:phoneActive", function() {
                p.phoneActive && this.onPhoneActive()
            })
        },
        onPhoneActive: function() {
            h.stream === h.STREAM.CONNECTED && this.onResume()
        },
        onResume: function() {
            this.filter(_.property("_uiObservers")).forEach(function(e) {
                Store.Status.find(e.id)["catch"](d.WapDrop, _.noop)
            })
        },
        _find: function(e) {
            return u.statusFind(e).then(function(t) {
                return _.isNumber(t.status) ? 423 === t.status ? {
                    id: e,
                    stale: !0,
                    status: ""
                } : t.status >= 400 ? {
                    id: e,
                    status: ""
                } : void 0 : {
                    id: e,
                    status: t.status
                }
            })["catch"](d.WapDrop, function() {
                return {
                    id: e,
                    stale: !0,
                    status: ""
                }
            })
        },
        _handle: function(e) {
            return e
        },
        canSetMyStatus: function() {
            return m.supportsFeature(m.F.SET_STATUS)
        },
        setMyStatus: function() {
            var e = this
              , t = arguments.length <= 0 || void 0 === arguments[0] ? "" : arguments[0]
              , n = arguments[1];
            if (t = t.trim(),
            !t)
                return o["default"].reject(new d.ActionError);
            if (!this.canSetMyStatus())
                return o["default"].reject(new d.ActionError);
            var r = u.sendSetStatus(t)
              , i = new v(l10n.t("action_status_setting"))
              , c = this.get(Store.Conn.me).status;
            n = n || g.genId();
            var l = r.then(function(t) {
                return 200 === t.status ? new v(l10n.t("action_status_set"),l10n.t("action_undo"),e.setMyStatus.bind(e, c, n)) : t.status >= 400 ? new v(l10n.t("action_status_set_failed")) : void 0
            })["catch"](function(r) {
                throw s.error("models:statusCollection:setMyStatus dropped")(r),
                new v(l10n.t("action_status_set_failed"),l10n.t("action_try_again"),e.setMyStatus.bind(e, t, n))
            });
            return f.openToast(a.createElement(g, {
                id: n,
                initialAction: i,
                pendingAction: l
            })),
            r.bind(this).then(function(e) {
                200 !== e.status || e._duplicate || (this.get(Store.Conn.me).status = t)
            })
        }
    });
    e.exports = new y
}
, function(e, t) {
    e.exports = {
        Action: "keyboard_action",
        Event: "keyboard_event",
        Events: {
            LOGGED_IN: "logged_in",
            LOGGED_OUT: "logged_out",
            ARCHIVE: "archived",
            MUTE: "muted",
            READ: "read",
            READ_ONLY: "read_only",
            CHAT_KIND: "chat_kind",
            ZOOM: "zoom",
            LAUNCH: "launch"
        },
        Actions: {
            PREFERENCES: "preferences",
            NEW_CHAT: "new_chat",
            NEW_GROUP: "new_group",
            PROFILE_STATUS: "profile_status",
            LOGOUT: "logout",
            SEARCH: "search",
            ZOOM_IN: "zoom_in",
            ZOOM_OUT: "zoom_out",
            ZOOM_RESET: "zoom_reset",
            TOGGLE_UNREAD: "toggle_unread",
            DELETE_CHAT: "delete_chat",
            DELETE_GROUP: "delete_group",
            EXIT_GROUP: "exit_group",
            TOGGLE_ARCHIVE: "toggle_archive",
            TOGGLE_MUTE: "toggle_mute",
            SEARCH_CHAT: "search_chat",
            NEXT_CHAT: "next_chat",
            PREV_CHAT: "prev_chat",
            CONTACT_US: "contact_us",
            METRIC_UPDATE: "metric_update"
        },
        Metrics: {
            BETA_UPDATES: "beta_updates"
        }
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(6)
      , s = n(10)
      , c = n(81)
      , l = n(133)
      , u = n(134)
      , d = n(23)
      , p = n(69)
      , h = n(14)
      , f = n(998)
      , m = n(220)
      , g = a.createClass({
        displayName: "NotificationManager",
        mixins: [c, l, u],
        componentWillMount: function() {
            this.tone = new Audio(s.NOTIFICATION_TONE_PATH),
            this.regCmd("alert_new_msg", this.alertNewMsg),
            this.regCmd("alert_call", this.showCallNotification),
            this.regCmd("cancel_call", this.cancelCallNotification),
            this.addObserver(Store.Chat, "add remove reset change:archive change:unreadCount", this.updateUnreadCount),
            this.addObserver(Store.Chat, "change:hasUnread", this.closeNotifications),
            this.addObserver(p, "change:displayInfo", this.updateUnreadCount)
        },
        componentDidMount: function() {
            this.updateUnreadCount()
        },
        componentWillUnmount: function() {
            m.setTitleAndIcon(0),
            m.closeAllNotifications()
        },
        closeNotifications: function(e, t) {
            t || m.closeChatNotifications(e.id)
        },
        updateUnreadCount: function() {
            var e;
            e = p.displayInfo === p.INFO.OFFLINE ? -1 : p.displayInfo === p.INFO.TIMEOUT ? -1 : Store.Chat.filter(function(e) {
                return !e.archive && e.isDirty()
            }).length,
            this.count !== e && (this.count = e,
            m.setTitleAndIcon(e))
        },
        alertNewMsg: function(e) {
            var t = e.chat;
            if (!(document.hasFocus() && t.get("active") || Store.Mute.globalMute().isMuted)) {
                if (t.mute.isMuted) {
                    if (!e.isGroupMsg)
                        return;
                    if (!e.isMentioned(Store.Conn.me) && !e.isQuoted(Store.Conn.me))
                        return;
                    var n = Store.Chat.get(e.sender);
                    if (n && n.mute.isMuted)
                        return
                }
                if (Store.Mute.getGlobalNotifications() && this.showDesktopNotification(e),
                Store.Mute.getGlobalSounds())
                    if (t.isGroup) {
                        var r = Date.now()
                          , i = t.squelch || 0;
                        r > i && (this.playAudioNotification(),
                        Store.GroupMetadata.find(t.id).then(function(e) {
                            var n = e.participants.length
                              , i = 1e3 * Math.min(120, 30 + 5 * n);
                            t.squelch = r + i
                        })["catch"](h.WapDrop, function() {
                            t.squelch = r + 6e4
                        }))
                    } else
                        this.playAudioNotification()
            }
        },
        showCallNotification: function(e, t, n) {
            if (window.Notification && window.Notification.permission === s.PERMISSION_ALLOWED) {
                var r = Store.Contact.get(t)
                  , i = r ? r.get("formattedName") : d.formattedUser(t)
                  , a = n ? l10n.t("incoming_video_call_notification_title", {
                    name: i
                }) : l10n.t("incoming_voice_call_notification_title", {
                    name: i
                })
                  , c = l10n.t("incoming_call_notification_text");
                Store.ProfilePicThumb.find(t).timeout(1e3, "showCallNotificationTimeout").then(function(n) {
                    var r = n && n.get("img") ? n.get("img") : s.USER_DEFAULT_ICON;
                    m.showNotification(t, e, a, c, r, !0)
                })["catch"](h.WapDrop, o["default"].TimeoutError, function(n) {
                    m.showNotification(t, e, a, c, s.USER_DEFAULT_ICON, !0)
                }),
                Store.Mute.getGlobalSounds() && this.playAudioNotification()
            }
        },
        cancelCallNotification: function(e) {
            m.closeNotification(e),
            Store.Call.remove(Store.Call.get(e))
        },
        showDesktopNotification: function(e) {
            if (window.Notification && window.Notification.permission === s.PERMISSION_ALLOWED) {
                var t = e.get("chat")
                  , n = t.get("id")
                  , r = f.asDesktopNotification(e);
                r && r.charCodeAt(0) >= 128 && (r = " " + r);
                var i = t.isGroup ? s.GROUP_DEFAULT_ICON : s.USER_DEFAULT_ICON
                  , a = t.isGroup ? l10n.t("default_group_message_notification_title") : l10n.t("default_contact_message_notification_title");
                Store.ProfilePicThumb.find(n).timeout(1500, "showDesktopNotificationTimeout").then(function(o) {
                    var s = t.contact.formattedName || a
                      , c = o ? o.img : "";
                    m.showNotification(n, e.id, s, r, c || i, !1)
                })["catch"](h.WapDrop, o["default"].TimeoutError, function(o) {
                    var s = t.contact.formattedName || a;
                    m.showNotification(n, e.id, s, r, i, !1)
                })
            }
        },
        playAudioNotification: function() {
            this.tone.play()
        },
        render: function() {
            return null
        }
    });
    e.exports = g
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        s(this, r, e)
    }
    function i(e) {
        s(this, i, e)
    }
    var o = n(222)
      , a = o.defineProtobufClass
      , s = o.construct
      , c = 3
      , l = 13
      , u = 14;
    a(r, {
        publicKey: [1, l],
        identifier: [2, l]
    }),
    a(i, {
        version: [1, c],
        localFingerprint: [2, u, r],
        remoteFingerprint: [3, u, r]
    }),
    e.exports = {
        FingerprintData: r,
        CombinedFingerprint: i
    }
}
, function(e, t) {
    "use strict";
    var n = window.matchMedia("\nonly screen and (max-width: 1024px)\n")
      , r = {
        column: n.matches ? 2 : 3
    }
      , i = function(e) {
        var t = e.matches ? 2 : 3;
        if (r.column !== t) {
            r.column = t;
            var n = document.createEvent("Event");
            n.initEvent("columnChange", !0, !0),
            window.dispatchEvent(n)
        }
    };
    n.addListener(i),
    e.exports = r
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i(e, t) {
        var n = ""
          , r = ""
          , i = r + r
          , o = r + r + r
          , a = i + "([^" + r + "]+)" + o
          , s = r + r + r + r
          , c = r + r + r + r + r
          , l = s + "[^" + r + "]+" + c;
        if (e = e.replace(new RegExp(n,"g"), ""),
        e = e.replace(new RegExp("" + l,"g"), ""),
        e = e.replace(new RegExp("^[^" + r + "]+" + c + "(.*)","g"), "$1"),
        e = e.replace(new RegExp("(.*)" + s + "[^" + r + "]+$","g"), "$1"),
        !new RegExp("^" + a).test(e) && new RegExp("" + a,"g").test(e)) {
            for (var u, d = t.getRangeAt(0).startContainer, p = 0; p < 5 && !(u = d.getAttribute && d.getAttribute("data-id")); p++)
                d = d.parentNode;
            var h = Store.Msg.get(u);
            if (h) {
                var f = "[" + m.timeStr(h.t) + "]"
                  , g = h.senderObj.formattedUser;
                e = i + f + " " + g + ": " + o + e
            }
        }
        e = e.replace(new RegExp("^(.*)" + a + "$","g"), "$1");
        var v = e.match(new RegExp(a,"g"));
        return v && 1 === v.length && (e = e.replace(new RegExp(a,"g"), "")),
        e = e.replace(new RegExp("" + a,"g"), "\n$1"),
        "\n" === e.charAt(0) && (e = e.slice(1)),
        e
    }
    function o(e) {
        var t = _.range(e.rangeCount).map(function(t) {
            return e.getRangeAt(t).cloneContents()
        }).map(s).join("");
        return i(t, e)
    }
    function a(e) {
        var t = {}
          , n = _.range(e.rangeCount).map(function(t) {
            return e.getRangeAt(t).cloneContents()
        }).map(function(e) {
            return c(e, t)
        }).join("");
        return (0,
        p["default"])({
            text: i(n, e),
            jids: t
        })
    }
    function s(e) {
        return e instanceof HTMLImageElement ? e.alt : e.nodeType === Node.TEXT_NODE ? e.nodeValue : _.map(e.childNodes, s).join("")
    }
    function c(e, t) {
        if (e instanceof HTMLImageElement)
            return e.alt;
        if (e.nodeType === Node.TEXT_NODE)
            return e.nodeValue;
        if (u(e)) {
            var n = e.getAttribute("data-jid");
            return t[n] = !0,
            "@" + h.user(n)
        }
        var r = l(e) || ""
          , i = _.map(e.childNodes, function(e) {
            return c(e, t)
        }).join("");
        return r ? "" + r + i + r : i
    }
    function l(e) {
        switch (e.tagName) {
        case "CODE":
            return "```";
        case "STRONG":
            return "*";
        case "EM":
            return "_";
        case "DEL":
            return "~";
        default:
            return ""
        }
    }
    function u(e) {
        return e && e instanceof HTMLSpanElement && e.hasAttribute("data-jid") && e.getAttribute("data-display") === f.NodeToEmoji(e)
    }
    var d = n(21)
      , p = r(d)
      , h = n(23)
      , f = n(432)
      , m = n(137);
    e.exports = {
        asPlainText: o,
        asRichText: a
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(2)
      , o = r(i)
      , a = n(1290)
      , s = n(211)
      , c = n(1)
      , l = {
        enrich: function(e) {
            switch (s.previewType(e.mimetype)) {
            case "pdf":
                return this.enrichPdf(e);
            case "msoffice":
                return this.enrichDoc(e);
            default:
                return o["default"].resolve(e)
            }
        },
        enrichPdf: function(e) {
            var t, n = e.blob;
            return a.fileToPdf(n).then(function(n) {
                return t = n,
                a.pdfToImg(n, 1).then(function(t) {
                    return e.documentPreview = t,
                    e.documentPreview.pdfPages = n.numPages,
                    e
                })
            })["catch"](function(t) {
                return c.log("pdf preview generation failed", t)(),
                e
            })["finally"](function() {
                t && a.releasePdf(t)
            })
        },
        enrichDoc: function(e) {
            return o["default"].resolve(e)
        }
    };
    e.exports = l
}
, function(e, t) {
    "use strict";
    e.exports = {
        SMILEYS_PEOPLE: ["ordered1456", "ordered1500", "ordered1457", "ordered1458", "ordered1459", "ordered1460", "ordered1461", "ordered1462", "ordered1463", "ordered1465", "ordered1466", "ordered1522", "ordered1523", "ordered0078", "ordered1467", "ordered1468", "ordered1469", "ordered1480", "ordered1479", "ordered1481", "ordered1482", "ordered1484", "ordered1485", "ordered1483", "ordered1749", "ordered1751", "ordered1470", "ordered1755", "ordered1471", "ordered1510", "ordered1472", "ordered1473", "ordered1474", "ordered1524", "ordered1752", "ordered1507", "ordered1486", "ordered1487", "ordered1488", "ordered1489", "ordered1476", "ordered1477", "ordered1521", "ordered0077", "ordered1491", "ordered1478", "ordered1499", "ordered1497", "ordered1492", "ordered1502", "ordered1505", "ordered1496", "ordered1504", "ordered1503", "ordered1494", "ordered1495", "ordered1490", "ordered1493", "ordered1498", "ordered1475", "ordered1501", "ordered1509", "ordered1506", "ordered1748", "ordered1511", "ordered1750", "ordered1753", "ordered1508", "ordered1200", "ordered1205", "ordered1464", "ordered1105", "ordered1094", "ordered1095", "ordered1096", "ordered1106", "ordered0069", "ordered1103", "ordered1104", "ordered1754", "ordered1514", "ordered1512", "ordered1513", "ordered1515", "ordered1516", "ordered1517", "ordered1520", "ordered1519", "ordered1518", "ordered1576", "ordered0923", "ordered0911", "ordered0917", "ordered0893", "ordered0150", "ordered0899", "ordered0881", "ordered0887", "ordered0869", "ordered0875", "ordered0905", "ordered0063", "ordered0162", "ordered0156", "ordered1413", "ordered0929", "ordered1206", "ordered1606", "ordered1425", "ordered1756", "ordered1419", "ordered0168", "ordered1138", "ordered0867", "ordered0868", "ordered0855", "ordered0861", "ordered0853", "ordered0852", "ordered1446", "ordered0954", "ordered0955", "ordered1070", "ordered0956", "ordered0962", "ordered0968", "ordered0974", "ordered1029", "ordered1028", "ordered1058", "ordered1064", "ordered1040", "ordered1047", "ordered1046", "ordered1009", "ordered1008", "ordered1077", "ordered1076", "ordered1120", "ordered1119", "ordered1393", "ordered1392", "ordered0622", "ordered1088", "ordered1022", "ordered1097", "ordered1550", "ordered1549", "ordered1108", "ordered1107", "ordered1526", "ordered1525", "ordered1538", "ordered1537", "ordered1565", "ordered1564", "ordered1595", "ordered1594", "ordered1583", "ordered1582", "ordered1157", "ordered1156", "ordered1145", "ordered1144", "ordered1131", "ordered1021", "ordered1020", "ordered1700", "ordered1699", "ordered0685", "ordered0684", "ordered1005", "ordered1007", "ordered1006", "ordered1180", "ordered1181", "ordered1179", "ordered1176", "ordered1177", "ordered1175", "ordered0990", "ordered0992", "ordered0993", "ordered0991", "ordered0994", "ordered1000", "ordered1002", "ordered1003", "ordered1001", "ordered1004", "ordered0985", "ordered0987", "ordered0988", "ordered0986", "ordered0989", "ordered0995", "ordered0997", "ordered0998", "ordered0996", "ordered0999", "ordered0980", "ordered0982", "ordered0983", "ordered0981", "ordered0984", "ordered0944", "ordered0939", "ordered0940", "ordered0938", "ordered0941", "ordered0943", "ordered0942", "ordered1137", "ordered1171", "ordered0953", "ordered0950", "ordered0951", "ordered0952", "ordered0948", "ordered0949", "ordered0936", "ordered0658", "ordered0641", "ordered0935", "ordered0119", "ordered0640", "ordered0947", "ordered0945", "ordered0946", "ordered1229", "ordered0937", "ordered1404", "ordered1173", "ordered0493"],
        ANIMALS_NATURE: ["ordered0842", "ordered0837", "ordered0833", "ordered0845", "ordered0836", "ordered0847", "ordered0848", "ordered0828", "ordered0835", "ordered1763", "ordered0834", "ordered0843", "ordered0849", "ordered0844", "ordered0813", "ordered0841", "ordered1561", "ordered1562", "ordered1563", "ordered0806", "ordered0808", "ordered0827", "ordered0826", "ordered0824", "ordered0823", "ordered0825", "ordered0846", "ordered0811", "ordered0840", "ordered1766", "ordered0817", "ordered0815", "ordered0800", "ordered0818", "ordered0816", "ordered1405", "ordered1764", "ordered1762", "ordered0801", "ordered0822", "ordered0820", "ordered0819", "ordered0821", "ordered0832", "ordered0839", "ordered0799", "ordered0798", "ordered0794", "ordered0793", "ordered0791", "ordered0790", "ordered0792", "ordered0830", "ordered0831", "ordered0812", "ordered0804", "ordered0803", "ordered0805", "ordered0802", "ordered0810", "ordered0788", "ordered0789", "ordered0807", "ordered1765", "ordered1359", "ordered0809", "ordered0829", "ordered0796", "ordered0795", "ordered0851", "ordered0850", "ordered0797", "ordered0838", "ordered0542", "ordered0621", "ordered0539", "ordered0540", "ordered0541", "ordered0538", "ordered0552", "ordered0062", "ordered0553", "ordered0635", "ordered0633", "ordered0556", "ordered0555", "ordered0554", "ordered0551", "ordered0547", "ordered0548", "ordered0546", "ordered0544", "ordered0549", "ordered0545", "ordered1178", "ordered0557", "ordered0537", "ordered0620", "ordered0814", "ordered1406", "ordered0505", "ordered0504", "ordered0506", "ordered0512", "ordered0513", "ordered0514", "ordered0515", "ordered0508", "ordered0509", "ordered0510", "ordered0511", "ordered0517", "ordered0520", "ordered0518", "ordered0519", "ordered0521", "ordered0516", "ordered0206", "ordered0522", "ordered1212", "ordered0180", "ordered0057", "ordered0053", "ordered0525", "ordered0115", "ordered0526", "ordered0527", "ordered0054", "ordered0528", "ordered0116", "ordered0530", "ordered0107", "ordered1333", "ordered1201", "ordered0183", "ordered0529", "ordered0056", "ordered0114", "ordered0533", "ordered1204", "ordered0531", "ordered0532", "ordered0055", "ordered0060", "ordered1203", "ordered1202", "ordered0501"],
        FOOD_DRINK: ["ordered0568", "ordered0567", "ordered0569", "ordered0563", "ordered0564", "ordered0565", "ordered0562", "ordered0560", "ordered0572", "ordered0561", "ordered0571", "ordered0570", "ordered0566", "ordered0558", "ordered0559", "ordered0543", "ordered0550", "ordered0585", "ordered0600", "ordered0583", "ordered1767", "ordered0576", "ordered0575", "ordered0589", "ordered0604", "ordered0573", "ordered0584", "ordered0534", "ordered0574", "ordered0582", "ordered0535", "ordered0536", "ordered0581", "ordered0603", "ordered0590", "ordered0588", "ordered0602", "ordered0580", "ordered0578", "ordered0579", "ordered0577", "ordered0587", "ordered0586", "ordered0592", "ordered0593", "ordered0591", "ordered0601", "ordered0619", "ordered0599", "ordered0597", "ordered0598", "ordered0596", "ordered0616", "ordered0594", "ordered0595", "ordered0611", "ordered0612", "ordered0608", "ordered0609", "ordered0610", "ordered0615", "ordered0607", "ordered0606", "ordered0061", "ordered0613", "ordered0605", "ordered0614"],
        ACTIVITY: ["ordered0112", "ordered0681", "ordered0711", "ordered0113", "ordered0679", "ordered0742", "ordered0712", "ordered0666", "ordered0745", "ordered0780", "ordered0744", "ordered0743", "ordered0741", "ordered0781", "ordered0127", "ordered0652", "ordered0131", "ordered0680", "ordered0130", "ordered0683", "ordered0726", "ordered0725", "ordered0133", "ordered0132", "ordered0738", "ordered0737", "ordered0697", "ordered0696", "ordered0714", "ordered0713", "ordered1648", "ordered1647", "ordered0710", "ordered1676", "ordered1675", "ordered1688", "ordered1687", "ordered1720", "ordered1391", "ordered0643", "ordered0678", "ordered0708", "ordered0642", "ordered0709", "ordered0778", "ordered0664", "ordered0660", "ordered0648", "ordered0662", "ordered0657", "ordered0659", "ordered0661", "ordered0653", "ordered0656", "ordered0677", "ordered0674", "ordered0672", "ordered0675", "ordered0673", "ordered0676", "ordered0663", "ordered0665", "ordered0667", "ordered0668"],
        TRAVEL_PLACES: ["ordered1635", "ordered1633", "ordered1637", "ordered1624", "ordered1626", "ordered0740", "ordered1631", "ordered1629", "ordered1630", "ordered1628", "ordered1638", "ordered1639", "ordered1640", "ordered0739", "ordered1673", "ordered1663", "ordered1632", "ordered1625", "ordered1636", "ordered1634", "ordered1645", "ordered1644", "ordered1643", "ordered1615", "ordered1623", "ordered1641", "ordered1616", "ordered1617", "ordered1620", "ordered1642", "ordered1614", "ordered1618", "ordered1619", "ordered1622", "ordered1621", "ordered1613", "ordered1743", "ordered0148", "ordered1744", "ordered1745", "ordered0129", "ordered1742", "ordered1659", "ordered0128", "ordered1747", "ordered1612", "ordered1746", "ordered1227", "ordered0099", "ordered1662", "ordered0145", "ordered1627", "ordered1661", "ordered1660", "ordered1450", "ordered1646", "ordered0650", "ordered0651", "ordered0649", "ordered0749", "ordered0492", "ordered1452", "ordered0771", "ordered0126", "ordered0639", "ordered0124", "ordered0746", "ordered1451", "ordered0502", "ordered1454", "ordered0747", "ordered0144", "ordered0756", "ordered1740", "ordered1741", "ordered0496", "ordered0495", "ordered0754", "ordered0748", "ordered0755", "ordered0498", "ordered0497", "ordered0751", "ordered0494", "ordered0500", "ordered0503", "ordered0523", "ordered0629", "ordered0628", "ordered0499", "ordered0750", "ordered0774", "ordered0773", "ordered0757", "ordered1453", "ordered0758", "ordered0759", "ordered0752", "ordered0760", "ordered0770", "ordered0761", "ordered0762", "ordered0763", "ordered0764", "ordered0766", "ordered0768", "ordered0769", "ordered0767", "ordered1182", "ordered0753", "ordered0123", "ordered1361", "ordered1362", "ordered1360", "ordered0122"],
        OBJECTS: ["ordered0027", "ordered1282", "ordered1283", "ordered1228", "ordered0029", "ordered1431", "ordered1432", "ordered1433", "ordered1434", "ordered1407", "ordered1442", "ordered1230", "ordered1231", "ordered1232", "ordered1233", "ordered1293", "ordered1288", "ordered1289", "ordered1290", "ordered0654", "ordered1294", "ordered0647", "ordered1263", "ordered0058", "ordered1264", "ordered1265", "ordered1291", "ordered1292", "ordered0644", "ordered0645", "ordered0646", "ordered0038", "ordered0039", "ordered0037", "ordered1389", "ordered0040", "ordered0028", "ordered1266", "ordered1307", "ordered1308", "ordered1197", "ordered1334", "ordered1388", "ordered1439", "ordered1739", "ordered1225", "ordered1222", "ordered1221", "ordered1223", "ordered1224", "ordered1217", "ordered1220", "ordered1174", "ordered0101", "ordered1335", "ordered1336", "ordered0098", "ordered1737", "ordered0118", "ordered1337", "ordered0103", "ordered0120", "ordered1339", "ordered1199", "ordered1338", "ordered1445", "ordered0100", "ordered1738", "ordered1667", "ordered0110", "ordered0111", "ordered0782", "ordered1342", "ordered1295", "ordered1168", "ordered0102", "ordered1341", "ordered1340", "ordered1390", "ordered1170", "ordered1169", "ordered0524", "ordered1717", "ordered1719", "ordered1726", "ordered1734", "ordered1313", "ordered1443", "ordered1665", "ordered1731", "ordered1732", "ordered1735", "ordered1435", "ordered0125", "ordered1455", "ordered1733", "ordered0618", "ordered0630", "ordered0637", "ordered0617", "ordered0632", "ordered0631", "ordered0638", "ordered0772", "ordered0636", "ordered0149", "ordered1274", "ordered1273", "ordered1272", "ordered1172", "ordered1270", "ordered1269", "ordered1271", "ordered0779", "ordered1318", "ordered1275", "ordered1276", "ordered1277", "ordered1278", "ordered1279", "ordered1280", "ordered1261", "ordered1236", "ordered1237", "ordered1250", "ordered1243", "ordered1241", "ordered1242", "ordered1440", "ordered1441", "ordered1239", "ordered1238", "ordered1240", "ordered1437", "ordered1449", "ordered1438", "ordered1244", "ordered1234", "ordered1235", "ordered1436", "ordered1444", "ordered1281", "ordered1252", "ordered1253", "ordered1251", "ordered1254", "ordered1256", "ordered1257", "ordered1258", "ordered1259", "ordered1255", "ordered1319", "ordered1247", "ordered1408", "ordered1249", "ordered1248", "ordered0146", "ordered1245", "ordered1246", "ordered1664", "ordered0634", "ordered0775", "ordered0777", "ordered0682", "ordered0776", "ordered1411", "ordered1412", "ordered1409", "ordered1410", "ordered0175", "ordered1262", "ordered0174", "ordered1311", "ordered1312", "ordered1314", "ordered1315", "ordered1309", "ordered1310"],
        SYMBOLS: ["ordered0192", "ordered1191", "ordered1190", "ordered1189", "ordered1192", "ordered1184", "ordered0191", "ordered1185", "ordered1194", "ordered1183", "ordered1187", "ordered1186", "ordered1188", "ordered1193", "ordered1195", "ordered0074", "ordered0178", "ordered0073", "ordered1358", "ordered0076", "ordered0179", "ordered1343", "ordered1363", "ordered0075", "ordered0072", "ordered1736", "ordered0117", "ordered0079", "ordered0080", "ordered0081", "ordered0082", "ordered0083", "ordered0084", "ordered0085", "ordered0086", "ordered0087", "ordered0088", "ordered0089", "ordered0090", "ordered0222", "ordered0104", "ordered0481", "ordered0487", "ordered0070", "ordered0071", "ordered1285", "ordered1284", "ordered0484", "ordered0478", "ordered0486", "ordered0488", "ordered0485", "ordered0182", "ordered0228", "ordered0490", "ordered1215", "ordered0489", "ordered0211", "ordered0210", "ordered0482", "ordered0483", "ordered0480", "ordered0214", "ordered0215", "ordered0218", "ordered0219", "ordered0216", "ordered0226", "ordered0121", "ordered1260", "ordered1666", "ordered0185", "ordered0207", "ordered1198", "ordered0095", "ordered1711", "ordered1670", "ordered1674", "ordered1672", "ordered1326", "ordered1286", "ordered0190", "ordered0189", "ordered0187", "ordered0188", "ordered0015", "ordered0016", "ordered1216", "ordered1301", "ordered1302", "ordered1345", "ordered0105", "ordered0209", "ordered0106", "ordered1712", "ordered1344", "ordered0096", "ordered0479", "ordered1226", "ordered0184", "ordered0181", "ordered0186", "ordered0147", "ordered0507", "ordered0044", "ordered1196", "ordered0491", "ordered0198", "ordered0765", "ordered0477", "ordered1727", "ordered1728", "ordered1729", "ordered1730", "ordered0097", "ordered1668", "ordered1718", "ordered0217", "ordered1671", "ordered1713", "ordered1714", "ordered1716", "ordered1715", "ordered1669", "ordered0655", "ordered1287", "ordered0476", "ordered1332", "ordered1329", "ordered1328", "ordered1331", "ordered0018", "ordered0224", "ordered0225", "ordered0227", "ordered0220", "ordered0223", "ordered0221", "ordered0003", "ordered0004", "ordered0005", "ordered0006", "ordered0007", "ordered0008", "ordered0009", "ordered0010", "ordered0011", "ordered0012", "ordered1327", "ordered1330", "ordered0001", "ordered0002", "ordered0047", "ordered0041", "ordered0036", "ordered0042", "ordered0043", "ordered0034", "ordered0035", "ordered0030", "ordered0031", "ordered0032", "ordered0033", "ordered0048", "ordered1356", "ordered1357", "ordered0196", "ordered0201", "ordered0202", "ordered0203", "ordered0022", "ordered0023", "ordered0024", "ordered0021", "ordered0020", "ordered0019", "ordered0026", "ordered0025", "ordered0199", "ordered0200", "ordered1296", "ordered1297", "ordered1298", "ordered1300", "ordered1299", "ordered0670", "ordered0671", "ordered0208", "ordered0197", "ordered0176", "ordered0193", "ordered0194", "ordered0195", "ordered0177", "ordered1219", "ordered1218", "ordered0017", "ordered0013", "ordered0014", "ordered1322", "ordered1321", "ordered1323", "ordered1325", "ordered1324", "ordered0059", "ordered1320", "ordered0108", "ordered0109", "ordered1348", "ordered1349", "ordered1354", "ordered1355", "ordered1352", "ordered1353", "ordered1350", "ordered1351", "ordered1347", "ordered1346", "ordered0045", "ordered0046", "ordered0052", "ordered0051", "ordered0050", "ordered0049", "ordered0204", "ordered0205", "ordered1303", "ordered1304", "ordered1305", "ordered1306", "ordered1317", "ordered1316", "ordered1268", "ordered1267", "ordered0854", "ordered1213", "ordered1214", "ordered1448", "ordered0213", "ordered0212", "ordered0669", "ordered0091", "ordered0092", "ordered0093", "ordered0094", "ordered1364", "ordered1365", "ordered1366", "ordered1367", "ordered1368", "ordered1369", "ordered1370", "ordered1371", "ordered1372", "ordered1373", "ordered1374", "ordered1375", "ordered1376", "ordered1377", "ordered1378", "ordered1379", "ordered1380", "ordered1381", "ordered1382", "ordered1383", "ordered1384", "ordered1385", "ordered1386", "ordered1387"],
        FLAGS: ["ordered0231", "ordered0243", "ordered0234", "ordered0289", "ordered0239", "ordered0229", "ordered0236", "ordered0233", "ordered0237", "ordered0232", "ordered0238", "ordered0235", "ordered0242", "ordered0241", "ordered0240", "ordered0244", "ordered0260", "ordered0251", "ordered0247", "ordered0246", "ordered0263", "ordered0248", "ordered0264", "ordered0253", "ordered0255", "ordered0261", "ordered0257", "ordered0258", "ordered0245", "ordered0262", "ordered0259", "ordered0334", "ordered0464", "ordered0256", "ordered0250", "ordered0249", "ordered0252", "ordered0279", "ordered0345", "ordered0274", "ordered0265", "ordered0328", "ordered0352", "ordered0268", "ordered0441", "ordered0273", "ordered0275", "ordered0281", "ordered0266", "ordered0276", "ordered0347", "ordered0269", "ordered0267", "ordered0272", "ordered0277", "ordered0325", "ordered0278", "ordered0280", "ordered0282", "ordered0283", "ordered0286", "ordered0285", "ordered0287", "ordered0288", "ordered0290", "ordered0292", "ordered0436", "ordered0316", "ordered0294", "ordered0291", "ordered0296", "ordered0297", "ordered0300", "ordered0302", "ordered0299", "ordered0298", "ordered0303", "ordered0308", "ordered0402", "ordered0442", "ordered0304", "ordered0313", "ordered0307", "ordered0284", "ordered0310", "ordered0311", "ordered0317", "ordered0312", "ordered0306", "ordered0315", "ordered0320", "ordered0319", "ordered0309", "ordered0314", "ordered0321", "ordered0322", "ordered0326", "ordered0324", "ordered0323", "ordered0327", "ordered0337", "ordered0333", "ordered0329", "ordered0336", "ordered0335", "ordered0330", "ordered0332", "ordered0331", "ordered0338", "ordered0271", "ordered0340", "ordered0342", "ordered0339", "ordered0341", "ordered0353", "ordered0343", "ordered0346", "ordered0470", "ordered0351", "ordered0344", "ordered0354", "ordered0363", "ordered0355", "ordered0360", "ordered0359", "ordered0364", "ordered0357", "ordered0361", "ordered0362", "ordered0375", "ordered0371", "ordered0369", "ordered0383", "ordered0385", "ordered0382", "ordered0372", "ordered0380", "ordered0370", "ordered0377", "ordered0378", "ordered0381", "ordered0472", "ordered0384", "ordered0301", "ordered0367", "ordered0366", "ordered0374", "ordered0368", "ordered0379", "ordered0365", "ordered0386", "ordered0373", "ordered0387", "ordered0396", "ordered0395", "ordered0393", "ordered0388", "ordered0398", "ordered0392", "ordered0389", "ordered0391", "ordered0397", "ordered0390", "ordered0376", "ordered0349", "ordered0394", "ordered0399", "ordered0405", "ordered0412", "ordered0410", "ordered0400", "ordered0403", "ordered0413", "ordered0401", "ordered0404", "ordered0408", "ordered0406", "ordered0411", "ordered0409", "ordered0414", "ordered0415", "ordered0416", "ordered0418", "ordered0419", "ordered0254", "ordered0426", "ordered0348", "ordered0356", "ordered0407", "ordered0462", "ordered0469", "ordered0430", "ordered0435", "ordered0420", "ordered0431", "ordered0417", "ordered0422", "ordered0429", "ordered0425", "ordered0437", "ordered0428", "ordered0427", "ordered0421", "ordered0432", "ordered0473", "ordered0318", "ordered0350", "ordered0434", "ordered0295", "ordered0358", "ordered0423", "ordered0433", "ordered0439", "ordered0424", "ordered0270", "ordered0438", "ordered0454", "ordered0445", "ordered0455", "ordered0444", "ordered0447", "ordered0443", "ordered0446", "ordered0450", "ordered0452", "ordered0449", "ordered0451", "ordered0448", "ordered0440", "ordered0453", "ordered0457", "ordered0456", "ordered0230", "ordered0305", "ordered0458", "ordered0465", "ordered0459", "ordered0460", "ordered0467", "ordered0461", "ordered0463", "ordered0466", "ordered0468", "ordered0293", "ordered0471", "ordered0474", "ordered0475", "ordered1769", "ordered1770", "ordered1771"]
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(36)
      , o = r(i)
      , a = n(44)
      , s = r(a)
      , c = function() {
        function e() {
            (0,
            o["default"])(this, e)
        }
        return (0,
        s["default"])(e, [{
            key: "trigger",
            value: function(e) {}
        }]),
        e
    }();
    e.exports = new c
}
, function(e, t, n) {
    "use strict";
    var r = n(997)
      , i = 3;
    e.exports = {
        minHeight: function(e, t) {
            return {
                minHeight: e.length > i ? i * r.DEFAULT_HEIGHT + t : e.length * r.DEFAULT_HEIGHT + t
            }
        }
    }
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(1010)
      , m = n(216)
      , g = n(53)
      , v = n(1009)
      , y = v.matchAll
      , _ = function(e) {
        function t(e) {
            (0,
            s["default"])(this, t);
            var n = (0,
            d["default"])(this, (0,
            o["default"])(t).call(this));
            return n._length = e,
            n._regex = new RegExp("(" + m.arabic + "{" + e + "})(" + m.arabic + ")","g"),
            n
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "mutate",
            value: function(e, t) {
                return t[1] + "" + t[2]
            }
        }, {
            key: "match",
            value: function(e) {
                return g.isWebkit ? e.length <= this._length ? null : y(this._regex, e) : null
            }
        }, {
            key: "isFragment",
            get: function() {
                return !0
            }
        }, {
            key: "alwaysApply",
            get: function() {
                return !0
            }
        }]),
        t
    }(f);
    e.exports = _
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(894)
      , o = r(i)
      , a = n(52)
      , s = r(a)
      , c = n(36)
      , l = r(c)
      , u = n(44)
      , d = r(u)
      , p = n(208)
      , h = r(p)
      , f = n(207)
      , m = r(f)
      , g = n(1059)
      , v = n(896)
      , y = function(e) {
        function t(e) {
            (0,
            l["default"])(this, t);
            var n = (0,
            h["default"])(this, (0,
            s["default"])(t).call(this, e));
            return n.handlers = new o["default"],
            n.defaultHandler = null ,
            n
        }
        return (0,
        m["default"])(t, e),
        (0,
        d["default"])(t, [{
            key: "onMutatorNode",
            value: function() {
                for (var e = arguments.length, t = Array(e), n = 0; n < e; n++)
                    t[n] = arguments[n];
                var r = t[0].mutator
                  , i = this.getHandler(r) || this.defaultHandler;
                return v(i, 'Missing handler for "' + r.constructor + '"'),
                i.call.apply(i, [this].concat(t, [this.args]))
            }
        }, {
            key: "addHandler",
            value: function(e, t) {
                this.handlers.set(e, t)
            }
        }, {
            key: "setDefaultHandler",
            value: function(e) {
                this.defaultHandler = e
            }
        }, {
            key: "getHandler",
            value: function(e) {
                return this.handlers.get(e.constructor)
            }
        }]),
        t
    }(g);
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(54)
      , m = r(f)
      , g = n(1010)
      , v = n(432)
      , y = n(1009)
      , E = y.matchAll
      , b = {
        "(y)": "",
        "(n)": "",
        ":-)": "",
        ":-(": "",
        ":-p": "",
        ":-|": "",
        ":-\\": "",
        ":-d": "",
        ":-*": "",
        "<3": "",
        "^_^": "",
        ">_<": "",
        ";-)": ""
    }
      , S = (0,
    m["default"])(b).map(window._.escapeRegExp).join("|")
      , M = new RegExp("((?:" + S + ")+)","ig")
      , C = new RegExp("(" + S + ")","i")
      , T = new RegExp("([*_~\\s]|```)")
      , w = function(e) {
        function t() {
            var e = !(arguments.length <= 0 || void 0 === arguments[0]) && arguments[0];
            (0,
            s["default"])(this, t);
            var n = (0,
            d["default"])(this, (0,
            o["default"])(t).call(this));
            return n.skin = e,
            n
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "match",
            value: function(e) {
                return E(M, e, function(t, n) {
                    var r = e.substr(Math.max(0, t.index - 3), Math.min(3, t.index));
                    if (t.index && !T.test(r))
                        return null ;
                    var i = e.substr(t.index + t[0].length, 3);
                    return i && !T.test(i) ? null : t
                })
            }
        }, {
            key: "mutate",
            value: function(e) {
                var t = this
                  , n = _.compact(e.split(C))
                  , r = _.map(n, function(e) {
                    if (!e)
                        return e;
                    var n = b[e.toLowerCase()];
                    return n ? t.skin && v.skinToneEmojis[n] ? Store.EmojiVariant.getVariant(n) || n : n : e
                });
                return r.join("")
            }
        }, {
            key: "isFragment",
            get: function() {
                return !0
            }
        }]),
        t
    }(g);
    e.exports = w
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(892)
      , m = r(f)
      , g = n(433)
      , v = r(g)
      , y = n(1283)
      , _ = n(984)
      , E = n(9)
      , b = n(1009)
      , S = b.jsx
      , M = n(6)
      , C = n(1042)
      , T = n(1115)
      , w = n(1056)
      , k = n(1057)
      , x = n(1060)
      , N = n(1061)
      , P = n(1116)
      , D = n(1058)
      , O = n(1146)
      , A = function(e, t) {
        var n = t.match.href;
        return {
            href: n,
            title: n,
            rel: "noopener noreferrer",
            target: "_blank"
        }
    }
      , R = function(e, t, n) {
        var r = (0,
        v["default"])(n, 1)
          , i = r[0];
        return {
            emoji: i
        }
    }
      , I = function() {
        return {
            className: "matched-text"
        }
    }
      , L = function(e, t) {
        var n = t.match.jid
          , r = Store.Contact.gadd({
            id: n
        })
          , i = function() {
            var e = Store.Chat.gadd(r.id);
            E.chatInfoDrawer(e)
        };
        return {
            onClick: i,
            className: "matched-mention",
            "data-jid": n,
            "data-display": "@" + r.display
        }
    }
      , F = function(e) {
        var t = e.children
          , n = (0,
        m["default"])(e, ["children"])
          , r = (0,
        v["default"])(t, 1)
          , i = r[0];
        return M.createElement("span", n, M.createElement("span", {
            className: "at-symbol"
        }, "@"), i.substring(1))
    }
      , U = function(e) {
        function t() {
            var e;
            (0,
            s["default"])(this, t);
            for (var n = arguments.length, r = Array(n), i = 0; i < n; i++)
                r[i] = arguments[i];
            var a = (0,
            d["default"])(this, (e = (0,
            o["default"])(t)).call.apply(e, [this].concat(r)));
            return a.addHandler(T, S.make(O, T, R)),
            a.addHandler(k, S.make("a", k, A)),
            a.addHandler(C, S.make("code", C)),
            a.addHandler(N, S.make("strong", N)),
            a.addHandler(w, S.make("em", w)),
            a.addHandler(x, S.make("del", x)),
            a.addHandler(P, S.make("span", P, I)),
            a.addHandler(D, S.make(F, D, L)),
            a
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "onRoot",
            value: function(e) {
                return _(e.reduce(function(e, t, n) {
                    return e["root-child-" + n] = t,
                    e
                }, {}))
            }
        }, {
            key: "onDelimiter",
            value: function() {
                return null
            }
        }]),
        t
    }(y);
    e.exports = U
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(1059)
      , m = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "onRoot",
            value: function(e) {
                return e.join("")
            }
        }, {
            key: "onMutatorNode",
            value: function(e, t) {
                return t.join("")
            }
        }]),
        t
    }(f);
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(52)
      , o = r(i)
      , a = n(36)
      , s = r(a)
      , c = n(44)
      , l = r(c)
      , u = n(208)
      , d = r(u)
      , p = n(207)
      , h = r(p)
      , f = n(1059)
      , m = function(e) {
        function t() {
            return (0,
            s["default"])(this, t),
            (0,
            d["default"])(this, (0,
            o["default"])(t).apply(this, arguments))
        }
        return (0,
        h["default"])(t, e),
        (0,
        l["default"])(t, [{
            key: "onRoot",
            value: function(e) {
                return e.join("")
            }
        }, {
            key: "onMutatorNode",
            value: function(e, t) {
                return t.join("")
            }
        }, {
            key: "onDelimiter",
            value: function() {
                return ""
            }
        }]),
        t
    }(f);
    e.exports = m
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i() {
        return v++,
        g ? g : new window.AudioContext
    }
    function o() {
        v--,
        0 === v && g && (g.close && g.close(),
        g = void 0)
    }
    var a = n(2)
      , s = r(a)
      , c = n(36)
      , l = r(c)
      , u = n(44)
      , d = r(u)
      , p = n(1120)
      , h = n(435)
      , f = n(13)
      , m = "audio/wav"
      , g = void 0
      , v = 0
      , y = function() {
        function e(t) {
            (0,
            l["default"])(this, e),
            this.oggBlob = t
        }
        return (0,
        d["default"])(e, [{
            key: "generateBlob",
            value: function() {
                return this.oggBlobToWAVBlob(this.oggBlob, 1)
            }
        }, {
            key: "oggBlobToWAVBlob",
            value: function(e) {
                var t = this
                  , n = arguments.length <= 1 || void 0 === arguments[1] ? 2 : arguments[1];
                return new s["default"](function(r, a) {
                    var s = new p
                      , c = []
                      , l = []
                      , u = i()
                      , d = {
                        outputBufferSampleRate: u.sampleRate,
                        bufferLength: 4096
                    };
                    s.onmessage = function(e) {
                        if (null === e.data) {
                            for (var i = function(e) {
                                c.forEach(function(t, n) {
                                    t = t[e] || t[0];
                                    for (var r = 0; r < t.length; r++)
                                        l.push(t[r])
                                })
                            }, a = 0; a < n; a++)
                                i(a);
                            var s = t.encodeWAV(l, u, n)
                              , d = new Blob([s.readByteArray()],{
                                type: m
                            });
                            o(),
                            r(d)
                        } else
                            c.push(e.data),
                            n = c[0].length
                    }
                    ,
                    s.postMessage({
                        command: "decode-init",
                        config: d
                    }),
                    h.blobToArrayBuffer(e).then(function(e) {
                        s.postMessage({
                            command: "decode",
                            pages: new Uint8Array(e)
                        }),
                        s.postMessage({
                            command: "decode-done"
                        })
                    })
                }
                )
            }
        }, {
            key: "encodeWAV",
            value: function(e, t, n) {
                var r = new f(44 + 2 * e.length,(!0));
                r.writeString("RIFF"),
                r.writeUint32(36 + 2 * e.length),
                r.writeString("WAVE"),
                r.writeString("fmt "),
                r.writeUint32(16),
                r.writeUint16(1),
                r.writeUint16(n),
                r.writeUint32(t.sampleRate),
                r.writeUint32(t.sampleRate * n * 2),
                r.writeUint16(2 * n),
                r.writeUint16(16),
                r.writeString("data"),
                r.writeUint32(2 * e.length);
                for (var i = 0; i < e.length; i++) {
                    var o = Math.max(-1, Math.min(e[i], 1));
                    o *= o > 0 ? 32767 : 32768,
                    r.writeInt16(Math.floor(o))
                }
                return r
            }
        }]),
        e
    }();
    e.exports = y
}
, function(e, t, n) {
    "use strict";
    var r = n(1120)
      , i = function o(e) {
        if (!o.isRecordingSupported())
            throw "Recording is not supported in this browser";
        this.audioContext = new window.AudioContext,
        this.config = e = e || {},
        this.config.command = "encode-init",
        this.config.bufferLength = e.bufferLength || 4096,
        this.config.monitorGain = e.monitorGain || 0,
        this.config.numberOfChannels = e.numberOfChannels || 1,
        this.config.originalSampleRate = this.audioContext.sampleRate,
        this.config.encoderSampleRate = e.encoderSampleRate || 48e3,
        this.config.streamPages = e.streamPages || !1,
        this.config.leaveStreamOpen = e.leaveStreamOpen || !1,
        this.config.maxBuffersPerPage = e.maxBuffersPerPage || 40,
        this.config.encoderApplication = e.encoderApplication || 2049,
        this.config.encoderFrameSize = e.encoderFrameSize || 20,
        this.config.streamOptions = e.streamOptions || {
            optional: [],
            mandatory: {
                googEchoCancellation: !1,
                googAutoGainControl: !1,
                googNoiseSuppression: !1,
                googHighpassFilter: !1
            }
        },
        this.state = "inactive",
        this.eventTarget = document.createDocumentFragment(),
        this.createAudioNodes()
    };
    i.isRecordingSupported = function() {
        return window.AudioContext && navigator.getUserMedia
    }
    ,
    i.prototype.addEventListener = function(e, t, n) {
        this.eventTarget.addEventListener(e, t, n)
    }
    ,
    i.prototype.clearStream = function() {
        this.stream && (this.stream.getTracks().forEach(function(e) {
            e.stop()
        }),
        delete this.stream)
    }
    ,
    i.prototype.createAudioNodes = function() {
        var e = this;
        this.scriptProcessorNode = this.audioContext.createScriptProcessor(this.config.bufferLength, this.config.numberOfChannels, this.config.numberOfChannels),
        this.scriptProcessorNode.onaudioprocess = function(t) {
            e.encodeBuffers(t.inputBuffer)
        }
        ,
        this.monitorNode = this.audioContext.createGain(),
        this.setMonitorGain(this.config.monitorGain),
        this.config.sampleRate < this.audioContext.sampleRate && this.createButterworthFilter()
    }
    ,
    i.prototype.createButterworthFilter = function() {
        this.filterNode = this.audioContext.createBiquadFilter(),
        this.filterNode2 = this.audioContext.createBiquadFilter(),
        this.filterNode3 = this.audioContext.createBiquadFilter(),
        this.filterNode.type = this.filterNode2.type = this.filterNode3.type = "lowpass";
        var e = this.config.sampleRate / 2;
        this.filterNode.frequency.value = this.filterNode2.frequency.value = this.filterNode3.frequency.value = e - e / 3.5355,
        this.filterNode.Q.value = .51764,
        this.filterNode2.Q.value = .70711,
        this.filterNode3.Q.value = 1.93184,
        this.filterNode.connect(this.filterNode2),
        this.filterNode2.connect(this.filterNode3),
        this.filterNode3.connect(this.scriptProcessorNode)
    }
    ,
    i.prototype.encodeBuffers = function(e) {
        if ("recording" === this.state) {
            for (var t = [], n = 0; n < e.numberOfChannels; n++)
                t[n] = e.getChannelData(n);
            this.encoder.postMessage({
                command: "encode",
                buffers: t
            }),
            this.duration += e.duration,
            this.eventTarget.dispatchEvent(new CustomEvent("duration",{
                detail: this.duration
            }))
        }
    }
    ,
    i.prototype.initStream = function(e) {
        if (this.stream)
            return void this.eventTarget.dispatchEvent(new Event("streamReady"));
        if (e)
            return this.stream = e,
            this.sourceNode = this.audioContext.createMediaStreamSource(e),
            this.sourceNode.connect(this.filterNode || this.scriptProcessorNode),
            this.sourceNode.connect(this.monitorNode),
            void this.eventTarget.dispatchEvent(new Event("streamReady"));
        var t = this;
        navigator.getUserMedia({
            audio: this.config.streamOptions
        }, function(e) {
            t.stream = e,
            t.sourceNode = t.audioContext.createMediaStreamSource(e),
            t.sourceNode.connect(t.filterNode || t.scriptProcessorNode),
            t.sourceNode.connect(t.monitorNode),
            t.eventTarget.dispatchEvent(new Event("streamReady"))
        }, function(e) {
            t.eventTarget.dispatchEvent(new ErrorEvent("streamError",{
                error: e
            }))
        })
    }
    ,
    i.prototype.pause = function() {
        "recording" === this.state && (this.state = "paused",
        this.eventTarget.dispatchEvent(new Event("pause")))
    }
    ,
    i.prototype.removeEventListener = function(e, t, n) {
        this.eventTarget.removeEventListener(e, t, n)
    }
    ,
    i.prototype.resume = function() {
        "paused" === this.state && (this.state = "recording",
        this.eventTarget.dispatchEvent(new Event("resume")))
    }
    ,
    i.prototype.setMonitorGain = function(e) {
        this.monitorNode.gain.value = e
    }
    ,
    i.prototype.start = function() {
        if ("inactive" === this.state && this.stream) {
            var e = this;
            this.encoder = new r,
            this.config.streamPages ? this.encoder.addEventListener("message", function(t) {
                e.streamPage(t.data)
            }) : (this.recordedPages = [],
            this.totalLength = 0,
            this.encoder.addEventListener("message", function(t) {
                e.storePage(t.data)
            })),
            this.encodeBuffers = function() {
                delete this.encodeBuffers
            }
            ,
            this.duration = 0,
            this.state = "recording",
            this.monitorNode.connect(this.audioContext.destination),
            this.scriptProcessorNode.connect(this.audioContext.destination),
            this.eventTarget.dispatchEvent(new Event("start")),
            this.eventTarget.dispatchEvent(new CustomEvent("duration",{
                detail: this.duration
            })),
            this.encoder.postMessage(this.config)
        }
    }
    ,
    i.prototype.stop = function() {
        "inactive" !== this.state && (this.state = "inactive",
        this.audioContext.close && this.audioContext.close(),
        this.monitorNode.disconnect(),
        this.scriptProcessorNode.disconnect(),
        this.config.leaveStreamOpen || this.clearStream(),
        this.encoder.postMessage({
            command: "encode-done"
        }))
    }
    ,
    i.prototype.storePage = function(e) {
        if (this.recordedPages.push(e),
        this.totalLength += e.length,
        4 & e[5]) {
            for (var t = new Uint8Array(this.totalLength), n = 0, r = 0; r < this.recordedPages.length; r++)
                t.set(this.recordedPages[r], n),
                n += this.recordedPages[r].length;
            this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{
                detail: new Blob([t],{
                    type: "audio/ogg; codecs=opus"
                })
            })),
            this.recordedPages = [],
            this.eventTarget.dispatchEvent(new Event("stop"))
        }
    }
    ,
    i.prototype.streamPage = function(e) {
        this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{
            detail: new Blob([e],{
                type: "audio/ogg; codecs=opus"
            })
        })),
        4 & e[5] && this.eventTarget.dispatchEvent(new Event("stop"))
    }
    ,
    e.exports = i
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    function i() {
        return p.loopOnError(function(e) {
            return u["default"].delay(h.expBackoff(e, 12e4, 0, 0)).then(function() {
                return new u["default"](function(e, t) {
                    n.e(91).then(function(t) {
                        var r = n(1071);
                        r.PDFJS.workerSrc = "./pdf.worker.js",
                        e(r)
                    }
                    .bind(null , n))["catch"](function(e) {
                        n.oe(e)
                    })
                }
                )
            })
        })
    }
    var o = n(36)
      , a = r(o)
      , s = n(44)
      , c = r(s)
      , l = n(2)
      , u = r(l)
      , d = n(1005)
      , p = n(46)
      , h = n(103);
    n(1298);
    var f = function() {
        function e() {
            (0,
            a["default"])(this, e)
        }
        return (0,
        c["default"])(e, null , [{
            key: "fileToPdf",
            value: function(e) {
                var t = URL.createObjectURL(e);
                return i().then(function(e) {
                    return e.PDFJS.getDocument(t)
                })
            }
        }, {
            key: "releasePdf",
            value: function(e) {
                return e.destroy()
            }
        }, {
            key: "pdfToImg",
            value: function(e, t) {
                var n = document.createElement("canvas");
                return e.getPage(t).then(function(e) {
                    var t = e.getViewport(1)
                      , r = n.getContext("2d");
                    n.height = t.height,
                    n.width = t.width;
                    var i = {
                        canvasContext: r,
                        viewport: t
                    };
                    return e.render(i)
                }).then(function() {
                    return d.canvasToBlob(n)
                }).then(function(e) {
                    var t = n.height
                      , r = n.width
                      , i = URL.createObjectURL(e);
                    return {
                        url: i,
                        thumbUrl: i,
                        width: r,
                        height: t
                    }
                })
            }
        }]),
        e
    }();
    e.exports = f
}
, function(e, t, n) {
    "use strict";
    function r(e) {
        return e && e.__esModule ? e : {
            "default": e
        }
    }
    var i = n(54)
      , o = r(i)
      , a = n(44)
      , s = r(a)
      , c = n(36)
      , l = r(c)
      , u = function p(e) {
        (0,
        l["default"])(this, p),
        this.promise = e,
        this.lastUsedTime = this.createdTime = +Date.now()
    }
      , d = function() {
        function e(t, n) {
            var r = n.maxCached
              , i = void 0 === r ? 10 : r
              , o = n.maxAge
              , a = void 0 === o ? 1 / 0 : o
              , s = n.shouldCache;
            (0,
            l["default"])(this, e),
            this._cache = {},
            this._maxCached = i,
            this._maxAge = a,
            this._createPromiseFunc = t,
            this._shouldCacheFunc = s
        }
        return (0,
        s["default"])(e, [{
            key: "getOrRun",
            value: function() {
                for (var e = this, t = arguments.length, n = Array(t), r = 0; r < t; r++)
                    n[r] = arguments[r];
                var i = n[0]
                  , a = this._cache;
                if (this._maxAge !== 1 / 0)
                    for (var s = Date.now() - this._maxAge, c = (0,
                    o["default"])(a), l = 0; l < c.length; l++) {
                        var d = c[l];
                        a[d].createdTime < s && delete a[d]
                    }
                var p = a[i];
                if (p)
                    return p.lastUsedTime = +Date.now(),
                    p.promise;
                var h = (0,
                o["default"])(a);
                if (h.length >= this._maxCached) {
                    for (var f = void 0, m = void 0, g = 0; g < h.length; g++) {
                        var v = h[g]
                          , y = a[v];
                        (!m || y.lastUsedTime < m) && (m = y.lastUsedTime,
                        f = v)
                    }
                    delete a[f]
                }
                var _ = this._createPromiseFunc.apply(void 0, n);
                return a[i] = new u(_),
                _.then(function(t) {
                    var n = e._shouldCacheFunc;
                    n && e._cache[i] === _ && !n(t) && delete e._cache[i]
                })["catch"](function() {
                    e._cache[i] === _ && delete e._cache[i]
                }),
                _
            }
        }]),
        e
    }();
    e.exports = d
}
, , , function(e, t, n) {
    e.exports = n.p + "img/600127bdb5f7627ede5cd4ef320f55b0.png"
}
, function(e, t) {
    e.exports = [65, 26, 32, 26, 73, 1, 11, 1, 5, 1, 6, 23, 24, 31, 32, 449, 451, 7, 21, 2, 16, 5, 14, 1, 130, 4, 6, 2, 4, 4, 5, 1, 7, 1, 2, 3, 4, 1, 2, 20, 21, 83, 84, 140, 147, 166, 167, 38, 40, 7, 8, 39, 40, 1, 7, -1, 46, -1, 2, -1, 3, -1, 3, -1, 2, -56, 64, -1, 3, -1, 2, -1, 14, -48, 82, -3, 4, -101, 116, -2, 9, -2, 12, -23, 24, -30, 57, -91, 102, -58, 67, -2, 6, -28, 32, -1, 10, -1, 4, -1, 6, -43, 46, -135, 167, 55, 56, 1, 2, 4, 12, 4, 5, 3, 10, 10, 12, 29, 30, 2, 3, 8, 10, 2, 4, 22, 23, 7, 8, 1, 4, 4, 7, 4, 10, 2, 4, 2, 3, 1, 9, 1, 5, 2, 3, 3, 7, 12, 14, 7, 15, 1, 2, 6, 10, 2, 4, 22, 23, 7, 8, 2, 3, 2, 3, 2, 6, 3, 27, 4, 5, 1, 8, 10, 12, 3, 17, 1, 2, 9, 10, 3, 4, 22, 23, 7, 8, 2, 3, 5, 8, 4, 12, 1, 2, 2, 5, 1, 16, 2, 6, 11, 19, 1, 9, 2, 3, 8, 10, 2, 4, 22, 23, 7, 8, 2, 3, 5, 8, 2, 3, 1, 7, 2, 4, 2, 12, 1, 5, 2, 3, 3, 7, 18, 29, 1, 2, 6, 9, 3, 4, 4, 7, 2, 3, 1, 2, 2, 5, 2, 5, 3, 6, 12, 16, 2, 3, 2, 5, 3, 4, 3, 6, 1, 7, 1, 15, 13, 27, 3, 4, 8, 9, 3, 4, 23, 24, 16, 19, 1, 4, 4, 23, 3, 8, 2, 6, 10, 25, 1, 3, 2, 3, 8, 9, 3, 4, 23, 24, 10, 11, 5, 8, 8, 9, 3, 4, 2, 11, 2, 9, 1, 2, 2, 6, 10, 11, 2, 17, 2, 3, 8, 9, 3, 4, 41, 43, 4, 9, 3, 4, 3, 4, 1, 9, 1, 8, 3, 7, 16, 19, 7, 9, 2, 3, 18, 21, 24, 25, 9, 10, 1, 3, 7, 15, 3, 9, 8, 14, 10, 12, 3, 15, 48, 49, 2, 14, 7, 15, 13, 50, 2, 3, 1, 3, 2, 3, 1, 3, 1, 7, 4, 5, 7, 8, 3, 4, 1, 2, 1, 3, 2, 3, 4, 5, 2, 11, 1, 3, 5, 6, 1, 10, 10, 12, 4, 36, 24, 26, 27, 28, 1, 2, 1, 6, 10, 11, 36, 54, 1, 6, 1, 3, 5, 54, 8, 9, 6, 7, 13, 50, 45, 49, 1, 7, 1, 3, 2, 4, 25, 27, 4, 7, 16, 20, 13, 14, 2, 4, 6, 7, 15, 16, 40, 41, 1, 6, 1, 3, 377, 378, 4, 6, 7, 8, 1, 2, 4, 6, 41, 42, 4, 6, 33, 34, 4, 6, 7, 8, 1, 2, 4, 6, 15, 16, 57, 58, 4, 6, 67, 72, 29, 32, 16, 32, 86, 88, 6, 9, 639, 640, 26, 31, 89, 96, 13, 14, 4, 18, 18, 21, 2, 11, 18, 32, 13, 14, 3, 18, 52, 54, 1, 8, 8, 9, 2, 13, 7, 8, 1, 4, 10, 48, 10, 16, 88, 96, 41, 42, 1, 6, 70, 80, 31, 35, 4, 6, 3, 7, 2, 3, 6, 19, 40, 42, 5, 16, 44, 48, 26, 32, 11, 48, 23, 25, 2, 5, 56, 57, 1, 10, 1, 2, 2, 10, 6, 19, 10, 16, 10, 16, 14, 100, 48, 49, 1, 6, 1, 2, 5, 6, 9, 13, 27, 36, 9, 14, 32, 36, 2, 4, 1, 4, 56, 57, 1, 3, 3, 4, 1, 4, 2, 10, 48, 56, 2, 7, 15, 18, 51, 115, 8, 19, 1, 14, 1, 8, 4, 5, 6, 7, 2, 11, 192, 256, 278, 280, 6, 8, 38, 40, 6, 8, 8, 9, 1, 2, 1, 2, 1, 2, 31, 33, 53, 54, 7, 8, 1, 4, 3, 4, 7, 10, 4, 6, 6, 10, 13, 18, 3, 4, 7, 24, 1, 1, -1, 98, 1, 14, 1, 17, 13, 114, 1, 5, 1, 3, 10, 11, 1, 4, 5, 11, 1, 2, 1, 2, 1, 2, 4, 5, 11, 13, 4, 9, 5, 9, 2, 18, 41, 470, 69, 95, 1, 263, 78, 528, 1, 340, 256, 1024, 47, 48, 47, 48, 133, 139, 4, 7, 2, 14, 38, 39, 1, 6, 1, 3, 56, 63, 2, 17, 23, 32, 7, 8, 7, 8, 7, 8, 7, 8, 7, 8, 7, 8, 7, 8, 7, 557, 3, 28, 9, 13, 2, 3, 5, 7, 5, 9, 86, 92, 3, 4, 90, 91, 4, 9, 41, 44, 94, 95, 43, 96, 45, 48, 48, 64, 28, 31, 50, 65, 12, 16, 47, 48, 119, 123, 99, 101, 31, 32, 6582, 6656, 20950, 20992, 1165, 1232, 317, 320, 28, 48, 47, 64, 30, 32, 80, 82, 6, 48, 102, 103, 37, 39, 8, 71, 11, 12, 3, 4, 4, 5, 25, 27, 1, 9, 8, 16, 52, 64, 68, 78, 12, 36, 12, 14, 38, 46, 25, 36, 2, 13, 30, 36, 48, 49, 2, 6, 2, 3, 17, 18, 11, 15, 7, 8, 25, 26, 41, 47, 2, 4, 2, 13, 3, 4, 8, 9, 1, 3, 10, 12, 32, 33, 51, 52, 1, 4, 2, 4, 5, 7, 1, 2, 1, 25, 17, 19, 8, 19, 6, 8, 6, 8, 6, 15, 7, 8, 7, 8, 54, 64, 117, 118, 2, 3, 4, 7, 10, 16, 11172, 11184, 23, 27, 49, 2101, 6766, 6768, 106, 144, 7, 19, 5, 10, -1, 2, -10, 11, -532, 534, -144, 176, -13, 14, -2, 114, -143, 177, 26, 32, 26, 37, 89, 92, 6, 8, 6, 8, 6, 8, 3, 38, 12, 13, 26, 27, 19, 20, 2, 3, 15, 17, 14, 48, 123, 128, 1, 2, 1, 5, 45, 48, 9, 153, 45, 176, 29, 32, 49, 96, 36, 48, 27, 32, 38, 48, 30, 31, 37, 41, 14, 56, 158, 160, 10, 96, 40, 48, 52, 63, 1, 145, 311, 320, 22, 32, 8, 160, -287, 288, -225, 228, -1, 3, -5, 9, -40, 43, -4, 5, -165, 167, -82, 89, -800, 831, -385, 385, 1, 2, 54, 69, 7, 31, 10, 28, 49, 53, 2, 4, 7, 21, 25, 32, 10, 19, 36, 41, 1, 10, 14, 26, 35, 36, 3, 14, 52, 61, 11, 14, 1, 3, 16, 17, 20, 31, 18, 19, 28, 31, 2, 3, 1, 3, 6, 72, 7, 8, 1, 2, 4, 5, 15, 16, 11, 17, 47, 48, 3, 16, 10, 18, 2, 3, 8, 10, 2, 4, 22, 23, 7, 8, 2, 3, 5, 8, 3, 4, 4, 6, 2, 4, 3, 5, 1, 7, 1, 6, 7, 291, 51, 57, 1, 2, 4, 6, 1, 3, 4, 12, 10, 176, 50, 56, 4, 6, 1, 3, 27, 63, 51, 59, 2, 3, 1, 3, 4, 15, 10, 48, 43, 44, 1, 2, 2, 8, 1, 10, 10, 64, 26, 32, 2, 6, 1, 10, 16, 368, 83, 95, 1, 449, 57, 1344, 922, 1024, 111, 112, 5, 16, 196, 2944, 1071, 5120, 583, 9216, 569, 576, 31, 32, 10, 14, 2, 98, 30, 37, 1, 11, 48, 55, 15, 25, 10, 11, 7, 8, 21, 26, 19, 899, 69, 80, 47, 67, 13, 16493, 2, 3072, 107, 112, 13, 16, 9, 16, 10, 12, 1, 3, 1, 4961, 246, 256, 39, 41, 62, 65, 9, 25, 2, 9, 30, 34, 59, 434, 18, 160, 85, 86, 71, 72, 2, 4, 1, 3, 2, 4, 4, 5, 12, 13, 1, 2, 7, 8, 65, 66, 4, 6, 8, 9, 7, 8, 28, 29, 4, 5, 5, 6, 1, 4, 7, 8, 340, 342, 51, 52, 57, 58, 57, 58, 57, 58, 57, 58, 8, 60, 512, 567, 4, 54, 8, 9, 14, 15, 7, 3451, -208, 215, -1561, 1563, -270, 542, 31, 32, 58, 64, 43, 118, 29, 42, 43, 48, 9, 16, 2, 3504, 42711, 42752, 4149, 4160, 222, 224, 5762, 16352, 542, 788480, 65534, 65536, 65534]
}
, function(e, t, n) {
    e.exports = function() {
        return n(452)('/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */\n!function(t){function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var e={};return n.m=t,n.c=e,n.oe=function(t){throw t},n.p="/",n(n.s=31)}([function(t,n,e){!function(e,r){t.exports=n=r()}(this,function(){var t=t||function(t,n){var e={},r=e.lib={},i=r.Base=function(){function t(){}return{extend:function(n){t.prototype=this;var e=new t;return n&&e.mixIn(n),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),o=r.WordArray=i.extend({init:function(t,e){t=this.words=t||[],e!=n?this.sigBytes=e:this.sigBytes=4*t.length},toString:function(t){return(t||u).stringify(this)},concat:function(t){var n=this.words,e=t.words,r=this.sigBytes,i=t.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var a=e[o>>>2]>>>24-o%4*8&255;n[r+o>>>2]|=a<<24-(r+o)%4*8}else for(var o=0;o<i;o+=4)n[r+o>>>2]=e[o>>>2];return this.sigBytes+=i,this},clamp:function(){var n=this.words,e=this.sigBytes;n[e>>>2]&=4294967295<<32-e%4*8,n.length=t.ceil(e/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(n){for(var e,r=[],i=function(n){var n=n,e=987654321,r=4294967295;return function(){e=36969*(65535&e)+(e>>16)&r,n=18e3*(65535&n)+(n>>16)&r;var i=(e<<16)+n&r;return i/=4294967296,i+=.5,i*(t.random()>.5?1:-1)}},a=0;a<n;a+=4){var u=i(4294967296*(e||t.random()));e=987654071*u(),r.push(4294967296*u()|0)}return new o.init(r,n)}}),a=e.enc={},u=a.Hex={stringify:function(t){for(var n=t.words,e=t.sigBytes,r=[],i=0;i<e;i++){var o=n[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(t){for(var n=t.length,e=[],r=0;r<n;r+=2)e[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new o.init(e,n/2)}},c=a.Latin1={stringify:function(t){for(var n=t.words,e=t.sigBytes,r=[],i=0;i<e;i++){var o=n[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(t){for(var n=t.length,e=[],r=0;r<n;r++)e[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new o.init(e,n)}},f=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(n){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},s=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=f.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(n){var e=this._data,r=e.words,i=e.sigBytes,a=this.blockSize,u=4*a,c=i/u;c=n?t.ceil(c):t.max((0|c)-this._minBufferSize,0);var f=c*a,s=t.min(4*f,i);if(f){for(var l=0;l<f;l+=a)this._doProcessBlock(r,l);var p=r.splice(0,f);e.sigBytes-=s}return new o.init(p,s)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),l=(r.Hasher=s.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){s.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var n=this._doFinalize();return n},blockSize:16,_createHelper:function(t){return function(n,e){return new t.init(e).finalize(n)}},_createHmacHelper:function(t){return function(n,e){return new l.HMAC.init(t,e).finalize(n)}}}),e.algo={});return e}(Math);return t})},function(t,n){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,n){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,n,e){t.exports=!e(7)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,e){var r=e(8);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,n,e){var r=e(8),i=e(2).document,o=r(i)&&r(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,e){var r=e(2),i=e(1),o=e(14),a=e(45),u="prototype",c=function(t,n,e){var f,s,l,p=t&c.F,h=t&c.G,d=t&c.S,v=t&c.P,m=t&c.B,g=t&c.W,y=h?i:i[n]||(i[n]={}),_=y[u],x=h?r:d?r[n]:(r[n]||{})[u];h&&(e=n);for(f in e)s=!p&&x&&void 0!==x[f],s&&f in y||(l=s?x[f]:e[f],y[f]=h&&"function"!=typeof x[f]?e[f]:m&&s?o(l,r):g&&x[f]==l?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n[u]=t[u],n}(l):v&&"function"==typeof l?o(Function.call,l):l,v&&((y.virtual||(y.virtual={}))[f]=l,t&c.R&&_&&!_[f]&&a(_,f,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n){t.exports=function(t){try{return!!t()}catch(n){return!0}}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,e){!function(r,i){t.exports=n=i(e(0))}(this,function(t){return function(){var n=t,e=n.lib,r=e.WordArray,i=n.enc;i.Base64={stringify:function(t){var n=t.words,e=t.sigBytes,r=this._map;t.clamp();for(var i=[],o=0;o<e;o+=3)for(var a=n[o>>>2]>>>24-o%4*8&255,u=n[o+1>>>2]>>>24-(o+1)%4*8&255,c=n[o+2>>>2]>>>24-(o+2)%4*8&255,f=a<<16|u<<8|c,s=0;s<4&&o+.75*s<e;s++)i.push(r.charAt(f>>>6*(3-s)&63));var l=r.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(t){var n=t.length,e=this._map,i=e.charAt(64);if(i){var o=t.indexOf(i);o!=-1&&(n=o)}for(var a=[],u=0,c=0;c<n;c++)if(c%4){var f=e.indexOf(t.charAt(c-1))<<c%4*2,s=e.indexOf(t.charAt(c))>>>6-c%4*2,l=f|s;a[u>>>2]|=l<<24-u%4*8,u++}return r.create(a,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64})},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,n,e,r){function i(t){l.isFunction(n)?this.message=n.apply(this,arguments):arguments.length>0?this.message=""+t:n?this.message=n:this.message=this.name;var e=this.message!==this.name?this.name+": "+this.message:this.name,i=new Error(e).stack;if(!i)try{throw new Error(e)}catch(o){i=o.stack,i||(i="Error: "+e+"\\n    at (unspecified)")}this.stack=i,l.isFunction(r)&&r.apply(this,l.tail(arguments))}return e=e||Error,i.prototype=(0,s["default"])(e.prototype),i.prototype.name=t,i}function o(t,n){return l.reduce(t,function(t,e,r){var o,a;return l.isString(r)?(o=r,a=e):o=e,t[o]=i(o,a,n),t},{})}function a(t){this.event=t;try{return(0,c["default"])(t)}catch(n){return""+t}}var u=e(35),c=r(u),f=e(12),s=r(f),l=e(24),p=i("WAPStatusCode"),h=i("401",null,p),d=i("404",null,p),v=i("500",null,p),m=i("WapDrop"),g=i("EphemeralDrop",null,m),y=i("LogoutDrop",null,m),_=i("Server5xxDrop",null,m),x=i("ConventionViolationDrop",null,m),w=i("BrowserReplacedDrop",null,m),b=i("ShouldLoop"),k=i("GaveUpRetry"),E=i("GUMError"),A=o({NotSupportedError:"The operation is not supported.",PermissionDeniedError:"The user did not grant permission for the operation",ConstraintNotSatisfiedError:"One of the mandatory Constraints could not be satisfied.",OverconstrainedError:"Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.",NotFoundError:"The object can not be found here.",AbortError:"The operation was aborted.",SourceUnavailableError:"The source of the MediaStream could not be accessed due to a hardware error (e.g. lock from another process)."},E),S=i("MediaNeedsReupload"),j=i("MediaFileError"),C=i("InvalidMediaFileType",null,j),z=i("MediaFileTooLarge",function(t){return this.file=t,"File ("+t.type+") size = "+t.size},j),M=i("MediaEncryptionError",null,j),O=i("MediaFileFailedLoad",null,j),B=i("ImageError","Image failed to load.",null,function(t,n){this.src=t,this.status=n,this.target={src:t,status:n}}),I=i("ServerStatusError","Server replied with a fail status code",null,function(t,n){this.url=t,this.status=n}),R=i("ContactBlocked","Contact is blocked",null,function(t){this.contact=t}),U=i("CapabilityError"),T=i("CapabilityUnsupported",null,U,function(t){this.jidCapabilities=t}),F=i("CapabilityInvalid",null,U),W=i("CapabilityUnknown",null,U),D=i("MediaMissing","Media is no longer available on your phone"),L=i("MediaUnsupported","Media format is unsupported"),P=i("MediaLoadError",null,null,function(t){this.src=t}),q=i("MediaDragDropError",null,P,function(t){this.src=t}),N=i("SocketError",a),H=i("SocketClosed",a),K=i("SocketNotOpen",function(t){return"socket not open, is "+t}),J=i("BlockedByProxy");t.exports={define:i,defineAll:o,QueryDrop:i("QueryDrop"),WapDrop:m,EphemeralDrop:g,LogoutDrop:y,Server5xxDrop:_,ConventionViolationDrop:x,BrowserReplacedDrop:w,ShouldLoop:b,GaveUpRetry:k,MediaFileError:j,InvalidMediaFileType:C,MediaFileTooLarge:z,MediaEncryptionError:M,MediaFileFailedLoad:O,WAPStatusCode:p,E401:h,E404:d,E500:v,SocketError:N,SocketClosed:H,SocketNotOpen:K,BlockedByProxy:J,ImageError:B,ServerStatusError:I,ContactBlocked:R,MediaNeedsReupload:S,MediaMissing:D,MediaLoadError:P,MediaDragDropError:q,MediaUnsupportedError:L,CapabilityError:U,CapabilityUnsupported:T,CapabilityInvalid:F,CapabilityUnknown:W,CanNotSendUnencrypted:i("CanNotSendUnencrypted"),ActionError:i("ActionError","Could not perform action."),GUM:l.defaults(A,{GUMError:E,PERMISSION_DENIED:A.PermissionDeniedError,NOT_SUPPORTED_ERROR:A.ConstraintNotSatisfiedError,MANDATORY_UNSATISFIED_ERROR:A.NotFoundError}),Unmount:i("unmount"),ActiveChatChanged:i("ActiveChatChanged")}},function(t,n){"use strict";function e(t){if((Array.isArray(t)||t instanceof ArrayBuffer)&&(t=new Uint8Array(t)),t.length<=a)return r(t);for(var n=[],e=0;e<t.length;e+=a)n.push(r(t.subarray(e,e+a)));return n.join("")}function r(t){for(var n=Math.ceil(4*t.length/3),e=4*Math.ceil(t.length/3),r=new Array(e),i=0,o=0;i<e;i+=4,o+=3){var a=t[o]<<16|t[o+1]<<8|t[o+2];r[i]=a>>18,r[i+1]=a>>12&63,r[i+2]=a>>6&63,r[i+3]=63&a}for(var u=0;u<n;u++){var c=r[u];c<26?r[u]=65+c:c<52?r[u]=71+c:c<62?r[u]=c-4:62===c?r[u]=43:r[u]=47}for(var f=n;f<e;f++)r[f]=61;return String.fromCharCode.apply(String,r)}function i(t){for(var n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],e=t.length,r=new Int32Array(e+e%4),i=0;i<e;i++){var o=t.charCodeAt(i);if(65<=o&&o<=90)r[i]=o-65;else if(97<=o&&o<=122)r[i]=o-71;else if(48<=o&&o<=57)r[i]=o+4;else if(43===o)r[i]=62;else{if(47!==o){if(61===o){e=i;break}return null}r[i]=63}}for(var a=r.length/4,u=0,c=0;u<a;u++,c+=4)r[u]=r[c]<<18|r[c+1]<<12|r[c+2]<<6|r[c+3];for(var f=Math.floor(3*e/4),s=new Uint8Array(f),l=0,p=0;p+3<=f;l++,p+=3){var h=r[l];s[p]=h>>16,s[p+1]=h>>8&255,s[p+2]=255&h}switch(f-p){case 2:s[p]=r[l]>>16,s[p+1]=r[l]>>8&255;break;case 1:s[p]=r[l]>>16}return n?Array.prototype.slice.call(s):s.buffer}function o(t){return t.replace(/\\+/g,"-").replace(/\\//g,"_")}var a=3e3;t.exports={encode:e,decode:i,urlSafe:o}},function(t,n,e){t.exports={"default":e(39),__esModule:!0}},function(t,n){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,n,e){var r=e(42);t.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,i){return t.call(n,e,r,i)}}return function(){return t.apply(n,arguments)}}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can\'t call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,e){t.exports=e(2).document&&document.documentElement},function(t,n,e){var r=e(4),i=e(46),o=e(59),a=Object.defineProperty;n.f=e(3)?Object.defineProperty:function(t,n,e){if(r(t),n=o(n,!0),r(e),i)try{return a(t,n,e)}catch(u){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(51),i=e(16);t.exports=Object.keys||function(t){return r(t,i)}},function(t,n,e){var r=e(54)("keys"),i=e(60);t.exports=function(t){return r[t]||(r[t]=i(t))}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},function(t,n,e){var r=e(48),i=e(15);t.exports=function(t){return r(i(t))}},function(t,n,e){!function(r,i){t.exports=n=i(e(0))}(this,function(t){!function(){var n=t,e=n.lib,r=e.Base,i=n.enc,o=i.Utf8,a=n.algo;a.HMAC=r.extend({init:function(t,n){t=this._hasher=new t.init,"string"==typeof n&&(n=o.parse(n));var e=t.blockSize,r=4*e;n.sigBytes>r&&(n=t.finalize(n)),n.clamp();for(var i=this._oKey=n.clone(),a=this._iKey=n.clone(),u=i.words,c=a.words,f=0;f<e;f++)u[f]^=1549556828,c[f]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher,e=n.finalize(t);n.reset();var r=n.finalize(this._oKey.clone().concat(e));return r}})}()})},function(t,n,e){var r;(function(t,i){(function(){function o(t,n){return t.set(n[0],n[1]),t}function a(t,n){return t.add(n),t}function u(t,n,e){var r=e.length;switch(r){case 0:return t.call(n);case 1:return t.call(n,e[0]);case 2:return t.call(n,e[0],e[1]);case 3:return t.call(n,e[0],e[1],e[2])}return t.apply(n,e)}function c(t,n,e,r){for(var i=-1,o=t?t.length:0;++i<o;){var a=t[i];n(r,a,e(a),t)}return r}function f(t,n){for(var e=-1,r=t?t.length:0;++e<r&&n(t[e],e,t)!==!1;);return t}function s(t,n){for(var e=t?t.length:0;e--&&n(t[e],e,t)!==!1;);return t}function l(t,n){for(var e=-1,r=t?t.length:0;++e<r;)if(!n(t[e],e,t))return!1;return!0}function p(t,n){for(var e=-1,r=t?t.length:0,i=0,o=[];++e<r;){var a=t[e];n(a,e,t)&&(o[i++]=a)}return o}function h(t,n){var e=t?t.length:0;return!!e&&b(t,n,0)>-1}function d(t,n,e){for(var r=-1,i=t?t.length:0;++r<i;)if(e(n,t[r]))return!0;return!1}function v(t,n){for(var e=-1,r=t?t.length:0,i=Array(r);++e<r;)i[e]=n(t[e],e,t);return i}function m(t,n){for(var e=-1,r=n.length,i=t.length;++e<r;)t[i+e]=n[e];return t}function g(t,n,e,r){var i=-1,o=t?t.length:0;for(r&&o&&(e=t[++i]);++i<o;)e=n(e,t[i],i,t);return e}function y(t,n,e,r){var i=t?t.length:0;for(r&&i&&(e=t[--i]);i--;)e=n(e,t[i],i,t);return e}function _(t,n){for(var e=-1,r=t?t.length:0;++e<r;)if(n(t[e],e,t))return!0;return!1}function x(t,n,e){var r;return e(t,function(t,e,i){if(n(t,e,i))return r=e,!1}),r}function w(t,n,e,r){for(var i=t.length,o=e+(r?1:-1);r?o--:++o<i;)if(n(t[o],o,t))return o;return-1}function b(t,n,e){if(n!==n)return P(t,e);for(var r=e-1,i=t.length;++r<i;)if(t[r]===n)return r;return-1}function k(t,n,e,r){for(var i=e-1,o=t.length;++i<o;)if(r(t[i],n))return i;return-1}function E(t,n){var e=t?t.length:0;return e?j(t,n)/e:St}function A(t,n,e,r,i){return i(t,function(t,i,o){e=r?(r=!1,t):n(e,t,i,o)}),e}function S(t,n){var e=t.length;for(t.sort(n);e--;)t[e]=t[e].value;return t}function j(t,n){for(var e,r=-1,i=t.length;++r<i;){var o=n(t[r]);o!==Y&&(e=e===Y?o:e+o)}return e}function C(t,n){for(var e=-1,r=Array(t);++e<t;)r[e]=n(e);return r}function z(t,n){return v(n,function(n){return[n,t[n]]})}function M(t){return function(n){return t(n)}}function O(t,n){return v(n,function(n){return t[n]})}function B(t,n){return t.has(n)}function I(t,n){for(var e=-1,r=t.length;++e<r&&b(n,t[e],0)>-1;);return e}function R(t,n){for(var e=t.length;e--&&b(n,t[e],0)>-1;);return e}function U(t){return t&&t.Object===Object?t:null}function T(t,n){for(var e=t.length,r=0;e--;)t[e]===n&&r++;return r}function F(t){return ze[t]}function W(t){return Me[t]}function D(t){return"\\\\"+Be[t]}function L(t,n){return null==t?Y:t[n]}function P(t,n,e){for(var r=t.length,i=n+(e?1:-1);e?i--:++i<r;){var o=t[i];if(o!==o)return i}return-1}function q(t){var n=!1;if(null!=t&&"function"!=typeof t.toString)try{n=!!(t+"")}catch(e){}return n}function N(t){for(var n,e=[];!(n=t.next()).done;)e.push(n.value);return e}function H(t){var n=-1,e=Array(t.size);return t.forEach(function(t,r){e[++n]=[r,t]}),e}function K(t,n){for(var e=-1,r=t.length,i=0,o=[];++e<r;){var a=t[e];a!==n&&a!==rt||(t[e]=rt,o[i++]=e)}return o}function J(t){var n=-1,e=Array(t.size);return t.forEach(function(t){e[++n]=t}),e}function $(t){var n=-1,e=Array(t.size);return t.forEach(function(t){e[++n]=[t,t]}),e}function V(t){if(!t||!ke.test(t))return t.length;for(var n=we.lastIndex=0;we.test(t);)n++;return n}function X(t){return t.match(we)}function G(t){return Oe[t]}function Z(t){function n(t){if(yu(t)&&!gl(t)&&!(t instanceof i)){if(t instanceof r)return t;if(Mf.call(t,"__wrapped__"))return lo(t)}return new r(t)}function e(){}function r(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=Y}function i(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=jt,this.__views__=[]}function U(){var t=new i(this.__wrapped__);return t.__actions__=ei(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ei(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ei(this.__views__),t}function Tn(){if(this.__filtered__){var t=new i(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Fn(){var t=this.__wrapped__.value(),n=this.__dir__,e=gl(t),r=n<0,i=e?t.length:0,o=qi(0,i,this.__views__),a=o.start,u=o.end,c=u-a,f=r?u:a-1,s=this.__iteratees__,l=s.length,p=0,h=ts(c,this.__takeCount__);if(!e||i<tt||i==c&&h==c)return Fr(t,this.__actions__);var d=[];t:for(;c--&&p<h;){f+=n;for(var v=-1,m=t[f];++v<l;){var g=s[v],y=g.iteratee,_=g.type,x=y(m);if(_==wt)m=x;else if(!x){if(_==xt)continue t;break t}}d[p++]=m}return d}function Wn(t){var n=-1,e=t?t.length:0;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}function Dn(){this.__data__=ls?ls(null):{}}function Ln(t){return this.has(t)&&delete this.__data__[t]}function Pn(t){var n=this.__data__;if(ls){var e=n[t];return e===et?Y:e}return Mf.call(n,t)?n[t]:Y}function qn(t){var n=this.__data__;return ls?n[t]!==Y:Mf.call(n,t)}function Nn(t,n){var e=this.__data__;return e[t]=ls&&n===Y?et:n,this}function Hn(t){var n=-1,e=t?t.length:0;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}function Kn(){this.__data__=[]}function Jn(t){var n=this.__data__,e=de(n,t);if(e<0)return!1;var r=n.length-1;return e==r?n.pop():Kf.call(n,e,1),!0}function $n(t){var n=this.__data__,e=de(n,t);return e<0?Y:n[e][1]}function Vn(t){return de(this.__data__,t)>-1}function Xn(t,n){var e=this.__data__,r=de(e,t);return r<0?e.push([t,n]):e[r][1]=n,this}function Gn(t){var n=-1,e=t?t.length:0;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}function Zn(){this.__data__={hash:new Wn,map:new(us||Hn),string:new Wn}}function Yn(t){return Ti(this,t)["delete"](t)}function Qn(t){return Ti(this,t).get(t)}function te(t){return Ti(this,t).has(t)}function ne(t,n){return Ti(this,t).set(t,n),this}function ee(t){var n=-1,e=t?t.length:0;for(this.__data__=new Gn;++n<e;)this.add(t[n])}function re(t){return this.__data__.set(t,et),this}function ie(t){return this.__data__.has(t)}function oe(t){this.__data__=new Hn(t)}function ae(){this.__data__=new Hn}function ue(t){return this.__data__["delete"](t)}function ce(t){return this.__data__.get(t)}function fe(t){return this.__data__.has(t)}function se(t,n){var e=this.__data__;return e instanceof Hn&&e.__data__.length==tt&&(e=this.__data__=new Gn(e.__data__)),e.set(t,n),this}function le(t,n,e,r){return t===Y||nu(t,Af[e])&&!Mf.call(r,e)?n:t}function pe(t,n,e){(e===Y||nu(t[n],e))&&("number"!=typeof n||e!==Y||n in t)||(t[n]=e)}function he(t,n,e){var r=t[n];Mf.call(t,n)&&nu(r,e)&&(e!==Y||n in t)||(t[n]=e)}function de(t,n){for(var e=t.length;e--;)if(nu(t[e][0],n))return e;return-1}function ve(t,n,e,r){return ks(t,function(t,i,o){n(r,t,e(t),o)}),r}function me(t,n){return t&&ri(n,rc(n),t)}function ge(t,n){for(var e=-1,r=null==t,i=n.length,o=Array(i);++e<i;)o[e]=r?Y:tc(t,n[e]);return o}function ye(t,n,e){return t===t&&(e!==Y&&(t=t<=e?t:e),n!==Y&&(t=t>=n?t:n)),t}function we(t,n,e,r,i,o,a){var u;if(r&&(u=o?r(t,i,o,a):r(t)),u!==Y)return u;if(!gu(t))return t;var c=gl(t);if(c){if(u=Hi(t),!n)return ei(t,u)}else{var s=Pi(t),l=s==Ut||s==Tt;if(yl(t))return Hr(t,n);if(s==Dt||s==Mt||l&&!o){if(q(t))return o?t:{};if(u=Ki(l?{}:t),!n)return ii(t,me(u,t))}else{if(!Ce[s])return o?t:{};u=Ji(t,s,we,n)}}a||(a=new oe);var p=a.get(t);if(p)return p;if(a.set(t,u),!c)var h=e?Oi(t):rc(t);return f(h||t,function(i,o){h&&(o=i,i=t[o]),he(u,o,we(i,n,e,r,o,t,a))}),u}function ze(t){var n=rc(t),e=n.length;return function(r){if(null==r)return!e;for(var i=e;i--;){var o=n[i],a=t[o],u=r[o];if(u===Y&&!(o in Object(r))||!a(u))return!1}return!0}}function Me(t){return gu(t)?Nf(t):{}}function Oe(t,n,e){if("function"!=typeof t)throw new kf(nt);return Jf(function(){t.apply(Y,e)},n)}function Be(t,n,e,r){var i=-1,o=h,a=!0,u=t.length,c=[],f=n.length;if(!u)return c;e&&(n=v(n,M(e))),r?(o=d,a=!1):n.length>=tt&&(o=B,a=!1,n=new ee(n));t:for(;++i<u;){var s=t[i],l=e?e(s):s;if(s=r||0!==s?s:0,a&&l===l){for(var p=f;p--;)if(n[p]===l)continue t;c.push(s)}else o(n,l,r)||c.push(s)}return c}function Ue(t,n){var e=!0;return ks(t,function(t,r,i){return e=!!n(t,r,i)}),e}function Te(t,n,e){for(var r=-1,i=t.length;++r<i;){var o=t[r],a=n(o);if(null!=a&&(u===Y?a===a&&!Bu(a):e(a,u)))var u=a,c=o}return c}function We(t,n,e,r){var i=t.length;for(e=Du(e),e<0&&(e=-e>i?0:i+e),r=r===Y||r>i?i:Du(r),r<0&&(r+=i),r=e>r?0:Lu(r);e<r;)t[e++]=n;return t}function De(t,n){var e=[];return ks(t,function(t,r,i){n(t,r,i)&&e.push(t)}),e}function Le(t,n,e,r,i){var o=-1,a=t.length;for(e||(e=Vi),i||(i=[]);++o<a;){var u=t[o];n>0&&e(u)?n>1?Le(u,n-1,e,r,i):m(i,u):r||(i[i.length]=u)}return i}function Ne(t,n){return t&&As(t,n,rc)}function He(t,n){return t&&Ss(t,n,rc)}function Ke(t,n){return p(n,function(n){return du(t[n])})}function Je(t,n){n=Yi(n,t)?[n]:qr(n);for(var e=0,r=n.length;null!=t&&e<r;)t=t[fo(n[e++])];return e&&e==r?t:Y}function $e(t,n,e){var r=n(t);return gl(t)?r:m(r,e(t))}function Ve(t,n){return t>n}function Xe(t,n){return null!=t&&(Mf.call(t,n)||"object"==typeof t&&n in t&&null===Di(t))}function Ge(t,n){return null!=t&&n in Object(t)}function Ze(t,n,e){return t>=ts(n,e)&&t<Qf(n,e)}function Ye(t,n,e){for(var r=e?d:h,i=t[0].length,o=t.length,a=o,u=Array(o),c=1/0,f=[];a--;){var s=t[a];a&&n&&(s=v(s,M(n))),c=ts(s.length,c),u[a]=!e&&(n||i>=120&&s.length>=120)?new ee(a&&s):Y}s=t[0];var l=-1,p=u[0];t:for(;++l<i&&f.length<c;){var m=s[l],g=n?n(m):m;if(m=e||0!==m?m:0,!(p?B(p,g):r(f,g,e))){for(a=o;--a;){var y=u[a];if(!(y?B(y,g):r(t[a],g,e)))continue t}p&&p.push(g),f.push(m)}}return f}function Qe(t,n,e,r){return Ne(t,function(t,i,o){n(r,e(t),i,o)}),r}function tr(t,n,e){Yi(n,t)||(n=qr(n),t=uo(t,n),n=Oo(n));var r=null==t?t:t[fo(n)];return null==r?Y:u(r,t,e)}function nr(t,n,e,r,i){return t===n||(null==t||null==n||!gu(t)&&!yu(n)?t!==t&&n!==n:er(t,n,nr,e,r,i))}function er(t,n,e,r,i,o){var a=gl(t),u=gl(n),c=Ot,f=Ot;a||(c=Pi(t),c=c==Mt?Dt:c),u||(f=Pi(n),f=f==Mt?Dt:f);var s=c==Dt&&!q(t),l=f==Dt&&!q(n),p=c==f;if(p&&!s)return o||(o=new oe),a||Iu(t)?Ci(t,n,e,r,i,o):zi(t,n,c,e,r,i,o);if(!(i&vt)){var h=s&&Mf.call(t,"__wrapped__"),d=l&&Mf.call(n,"__wrapped__");if(h||d){var v=h?t.value():t,m=d?n.value():n;return o||(o=new oe),e(v,m,r,i,o)}}return!!p&&(o||(o=new oe),Mi(t,n,e,r,i,o))}function rr(t,n,e,r){var i=e.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var u=e[i];if(a&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++i<o;){u=e[i];var c=u[0],f=t[c],s=u[1];if(a&&u[2]){if(f===Y&&!(c in t))return!1}else{var l=new oe;if(r)var p=r(f,s,c,t,n,l);if(!(p===Y?nr(s,f,r,dt|vt,l):p))return!1}}return!0}function ir(t){if(!gu(t)||no(t))return!1;var n=du(t)||q(t)?Uf:Mn;return n.test(so(t))}function or(t){return"function"==typeof t?t:null==t?Jc:"object"==typeof t?gl(t)?lr(t[0],t[1]):sr(t):tf(t)}function ar(t){return Yf(Object(t))}function ur(t){t=null==t?t:Object(t);var n=[];for(var e in t)n.push(e);return n}function cr(t,n){return t<n}function fr(t,n){var e=-1,r=iu(t)?Array(t.length):[];return ks(t,function(t,i,o){r[++e]=n(t,i,o)}),r}function sr(t){var n=Fi(t);return 1==n.length&&n[0][2]?io(n[0][0],n[0][1]):function(e){return e===t||rr(e,t,n)}}function lr(t,n){return Yi(t)&&ro(n)?io(fo(t),n):function(e){var r=tc(e,t);return r===Y&&r===n?ec(e,t):nr(n,r,Y,dt|vt)}}function pr(t,n,e,r,i){if(t!==n){if(!gl(n)&&!Iu(n))var o=ic(n);f(o||n,function(a,u){if(o&&(u=a,a=n[u]),gu(a))i||(i=new oe),hr(t,n,u,e,pr,r,i);else{var c=r?r(t[u],a,u+"",t,n,i):Y;c===Y&&(c=a),pe(t,u,c)}})}}function hr(t,n,e,r,i,o,a){var u=t[e],c=n[e],f=a.get(c);if(f)return void pe(t,e,f);var s=o?o(u,c,e+"",t,n,a):Y,l=s===Y;l&&(s=c,gl(c)||Iu(c)?gl(u)?s=u:ou(u)?s=ei(u):(l=!1,s=we(c,!0)):ju(c)||eu(c)?eu(u)?s=qu(u):!gu(u)||r&&du(u)?(l=!1,s=we(c,!0)):s=u:l=!1),a.set(c,s),l&&i(s,c,r,o,a),a["delete"](c),pe(t,e,s)}function dr(t,n){var e=t.length;if(e)return n+=n<0?e:0,Gi(n,e)?t[n]:Y}function vr(t,n,e){var r=-1;n=v(n.length?n:[Jc],M(Ui()));var i=fr(t,function(t,e,i){var o=v(n,function(n){return n(t)});return{criteria:o,index:++r,value:t}});return S(i,function(t,n){return Qr(t,n,e)})}function mr(t,n){return t=Object(t),g(n,function(n,e){return e in t&&(n[e]=t[e]),n},{})}function gr(t,n){for(var e=-1,r=Bi(t),i=r.length,o={};++e<i;){var a=r[e],u=t[a];n(u,a)&&(o[a]=u)}return o}function yr(t){return function(n){return null==n?Y:n[t]}}function _r(t){return function(n){return Je(n,t)}}function xr(t,n,e,r){var i=r?k:b,o=-1,a=n.length,u=t;for(t===n&&(n=ei(n)),e&&(u=v(t,M(e)));++o<a;)for(var c=0,f=n[o],s=e?e(f):f;(c=i(u,s,c,r))>-1;)u!==t&&Kf.call(u,c,1),Kf.call(t,c,1);return t}function wr(t,n){for(var e=t?n.length:0,r=e-1;e--;){var i=n[e];if(e==r||i!==o){var o=i;if(Gi(i))Kf.call(t,i,1);else if(Yi(i,t))delete t[fo(i)];else{var a=qr(i),u=uo(t,a);null!=u&&delete u[fo(Oo(a))]}}}return t}function br(t,n){return t+Vf(es()*(n-t+1))}function kr(t,n,e,r){for(var i=-1,o=Qf($f((n-t)/(e||1)),0),a=Array(o);o--;)a[r?o:++i]=t,t+=e;return a}function Er(t,n){var e="";if(!t||n<1||n>Et)return e;do n%2&&(e+=t),n=Vf(n/2),n&&(t+=t);while(n);return e}function Ar(t,n,e,r){n=Yi(n,t)?[n]:qr(n);for(var i=-1,o=n.length,a=o-1,u=t;null!=u&&++i<o;){var c=fo(n[i]);if(gu(u)){var f=e;if(i!=a){var s=u[c];f=r?r(s,c,u):Y,f===Y&&(f=null==s?Gi(n[i+1])?[]:{}:s)}he(u,c,f)}u=u[c]}return t}function Sr(t,n,e){var r=-1,i=t.length;n<0&&(n=-n>i?0:i+n),e=e>i?i:e,e<0&&(e+=i),i=n>e?0:e-n>>>0,n>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+n];return o}function jr(t,n){var e;return ks(t,function(t,r,i){return e=n(t,r,i),!e}),!!e}function Cr(t,n,e){var r=0,i=t?t.length:r;if("number"==typeof n&&n===n&&i<=zt){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!Bu(a)&&(e?a<=n:a<n)?r=o+1:i=o}return i}return zr(t,n,Jc,e)}function zr(t,n,e,r){n=e(n);for(var i=0,o=t?t.length:0,a=n!==n,u=null===n,c=Bu(n),f=n===Y;i<o;){var s=Vf((i+o)/2),l=e(t[s]),p=l!==Y,h=null===l,d=l===l,v=Bu(l);if(a)var m=r||d;else m=f?d&&(r||p):u?d&&p&&(r||!h):c?d&&p&&!h&&(r||!v):!h&&!v&&(r?l<=n:l<n);m?i=s+1:o=s}return ts(o,Ct)}function Mr(t,n){for(var e=-1,r=t.length,i=0,o=[];++e<r;){var a=t[e],u=n?n(a):a;if(!e||!nu(u,c)){var c=u;o[i++]=0===a?0:a}}return o}function Or(t){return"number"==typeof t?t:Bu(t)?St:+t}function Br(t){if("string"==typeof t)return t;if(Bu(t))return bs?bs.call(t):"";var n=t+"";return"0"==n&&1/t==-kt?"-0":n}function Ir(t,n,e){var r=-1,i=h,o=t.length,a=!0,u=[],c=u;if(e)a=!1,i=d;else if(o>=tt){var f=n?null:Cs(t);if(f)return J(f);a=!1,i=B,c=new ee}else c=n?[]:u;t:for(;++r<o;){var s=t[r],l=n?n(s):s;if(s=e||0!==s?s:0,a&&l===l){for(var p=c.length;p--;)if(c[p]===l)continue t;n&&c.push(l),u.push(s)}else i(c,l,e)||(c!==u&&c.push(l),u.push(s))}return u}function Rr(t,n){n=Yi(n,t)?[n]:qr(n),t=uo(t,n);var e=fo(Oo(n));return!(null!=t&&Xe(t,e))||delete t[e]}function Ur(t,n,e,r){return Ar(t,n,e(Je(t,n)),r)}function Tr(t,n,e,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&n(t[o],o,t););return e?Sr(t,r?0:o,r?o+1:i):Sr(t,r?o+1:0,r?i:o)}function Fr(t,n){var e=t;return e instanceof i&&(e=e.value()),g(n,function(t,n){return n.func.apply(n.thisArg,m([t],n.args))},e)}function Wr(t,n,e){for(var r=-1,i=t.length;++r<i;)var o=o?m(Be(o,t[r],n,e),Be(t[r],o,n,e)):t[r];return o&&o.length?Ir(o,n,e):[]}function Dr(t,n,e){for(var r=-1,i=t.length,o=n.length,a={};++r<i;){var u=r<o?n[r]:Y;e(a,t[r],u)}return a}function Lr(t){return ou(t)?t:[]}function Pr(t){return"function"==typeof t?t:Jc}function qr(t){return gl(t)?t:Rs(t)}function Nr(t,n,e){var r=t.length;return e=e===Y?r:e,!n&&e>=r?t:Sr(t,n,e)}function Hr(t,n){if(n)return t.slice();var e=new t.constructor(t.length);return t.copy(e),e}function Kr(t){var n=new t.constructor(t.byteLength);return new Df(n).set(new Df(t)),n}function Jr(t,n){var e=n?Kr(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)}function $r(t,n,e){var r=n?e(H(t),!0):H(t);return g(r,o,new t.constructor)}function Vr(t){var n=new t.constructor(t.source,Sn.exec(t));return n.lastIndex=t.lastIndex,n}function Xr(t,n,e){var r=n?e(J(t),!0):J(t);return g(r,a,new t.constructor)}function Gr(t){return ws?Object(ws.call(t)):{}}function Zr(t,n){var e=n?Kr(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)}function Yr(t,n){if(t!==n){var e=t!==Y,r=null===t,i=t===t,o=Bu(t),a=n!==Y,u=null===n,c=n===n,f=Bu(n);if(!u&&!f&&!o&&t>n||o&&a&&c&&!u&&!f||r&&a&&c||!e&&c||!i)return 1;if(!r&&!o&&!f&&t<n||f&&e&&i&&!r&&!o||u&&e&&i||!a&&i||!c)return-1}return 0}function Qr(t,n,e){for(var r=-1,i=t.criteria,o=n.criteria,a=i.length,u=e.length;++r<a;){var c=Yr(i[r],o[r]);if(c){if(r>=u)return c;var f=e[r];return c*("desc"==f?-1:1)}}return t.index-n.index}function ti(t,n,e,r){for(var i=-1,o=t.length,a=e.length,u=-1,c=n.length,f=Qf(o-a,0),s=Array(c+f),l=!r;++u<c;)s[u]=n[u];for(;++i<a;)(l||i<o)&&(s[e[i]]=t[i]);for(;f--;)s[u++]=t[i++];return s}function ni(t,n,e,r){for(var i=-1,o=t.length,a=-1,u=e.length,c=-1,f=n.length,s=Qf(o-u,0),l=Array(s+f),p=!r;++i<s;)l[i]=t[i];for(var h=i;++c<f;)l[h+c]=n[c];for(;++a<u;)(p||i<o)&&(l[h+e[a]]=t[i++]);return l}function ei(t,n){var e=-1,r=t.length;for(n||(n=Array(r));++e<r;)n[e]=t[e];return n}function ri(t,n,e,r){e||(e={});for(var i=-1,o=n.length;++i<o;){var a=n[i],u=r?r(e[a],t[a],a,e,t):t[a];he(e,a,u)}return e}function ii(t,n){return ri(t,Li(t),n)}function oi(t,n){return function(e,r){var i=gl(e)?c:ve,o=n?n():{};return i(e,t,Ui(r),o)}}function ai(t){return Ka(function(n,e){var r=-1,i=e.length,o=i>1?e[i-1]:Y,a=i>2?e[2]:Y;for(o=t.length>3&&"function"==typeof o?(i--,o):Y,a&&Zi(e[0],e[1],a)&&(o=i<3?Y:o,i=1),n=Object(n);++r<i;){var u=e[r];u&&t(n,u,r,o)}return n})}function ui(t,n){return function(e,r){if(null==e)return e;if(!iu(e))return t(e,r);for(var i=e.length,o=n?i:-1,a=Object(e);(n?o--:++o<i)&&r(a[o],o,a)!==!1;);return e}}function ci(t){return function(n,e,r){for(var i=-1,o=Object(n),a=r(n),u=a.length;u--;){var c=a[t?u:++i];if(e(o[c],c,o)===!1)break}return n}}function fi(t,n,e){function r(){var n=this&&this!==Pe&&this instanceof r?o:t;return n.apply(i?e:this,arguments)}var i=n&it,o=pi(t);return r}function si(t){return function(n){n=Hu(n);var e=ke.test(n)?X(n):Y,r=e?e[0]:n.charAt(0),i=e?Nr(e,1).join(""):n.slice(1);return r[t]()+i}}function li(t){return function(n){return g(qc(bc(n).replace(_e,"")),t,"")}}function pi(t){return function(){var n=arguments;switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3]);case 5:return new t(n[0],n[1],n[2],n[3],n[4]);case 6:return new t(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var e=Me(t.prototype),r=t.apply(e,n);return gu(r)?r:e}}function hi(t,n,e){function r(){for(var o=arguments.length,a=Array(o),c=o,f=Ri(r);c--;)a[c]=arguments[c];var s=o<3&&a[0]!==f&&a[o-1]!==f?[]:K(a,f);if(o-=s.length,o<e)return Ei(t,n,mi,r.placeholder,Y,a,s,Y,Y,e-o);var l=this&&this!==Pe&&this instanceof r?i:t;return u(l,this,a)}var i=pi(t);return r}function di(t){return function(n,e,r){\nvar i=Object(n);if(e=Ui(e,3),!iu(n))var o=rc(n);var a=t(o||n,function(t,n){return o&&(n=t,t=i[n]),e(t,n,i)},r);return a>-1?n[o?o[a]:a]:Y}}function vi(t){return Ka(function(n){n=Le(n,1);var e=n.length,i=e,o=r.prototype.thru;for(t&&n.reverse();i--;){var a=n[i];if("function"!=typeof a)throw new kf(nt);if(o&&!u&&"wrapper"==Ii(a))var u=new r([],(!0))}for(i=u?i:e;++i<e;){a=n[i];var c=Ii(a),f="wrapper"==c?zs(a):Y;u=f&&to(f[0])&&f[1]==(lt|ut|ft|pt)&&!f[4].length&&1==f[9]?u[Ii(f[0])].apply(u,f[3]):1==a.length&&to(a)?u[c]():u.thru(a)}return function(){var t=arguments,r=t[0];if(u&&1==t.length&&gl(r)&&r.length>=tt)return u.plant(r).value();for(var i=0,o=e?n[i].apply(this,t):r;++i<e;)o=n[i].call(this,o);return o}})}function mi(t,n,e,r,i,o,a,u,c,f){function s(){for(var g=arguments.length,y=Array(g),_=g;_--;)y[_]=arguments[_];if(d)var x=Ri(s),w=T(y,x);if(r&&(y=ti(y,r,i,d)),o&&(y=ni(y,o,a,d)),g-=w,d&&g<f){var b=K(y,x);return Ei(t,n,mi,s.placeholder,e,y,b,u,c,f-g)}var k=p?e:this,E=h?k[t]:t;return g=y.length,u?y=co(y,u):v&&g>1&&y.reverse(),l&&c<g&&(y.length=c),this&&this!==Pe&&this instanceof s&&(E=m||pi(E)),E.apply(k,y)}var l=n&lt,p=n&it,h=n&ot,d=n&(ut|ct),v=n&ht,m=h?Y:pi(t);return s}function gi(t,n){return function(e,r){return Qe(e,t,n(r),{})}}function yi(t){return function(n,e){var r;if(n===Y&&e===Y)return 0;if(n!==Y&&(r=n),e!==Y){if(r===Y)return e;"string"==typeof n||"string"==typeof e?(n=Br(n),e=Br(e)):(n=Or(n),e=Or(e)),r=t(n,e)}return r}}function _i(t){return Ka(function(n){return n=1==n.length&&gl(n[0])?v(n[0],M(Ui())):v(Le(n,1,Xi),M(Ui())),Ka(function(e){var r=this;return t(n,function(t){return u(t,r,e)})})})}function xi(t,n){n=n===Y?" ":Br(n);var e=n.length;if(e<2)return e?Er(n,t):n;var r=Er(n,$f(t/V(n)));return ke.test(n)?Nr(X(r),0,t).join(""):r.slice(0,t)}function wi(t,n,e,r){function i(){for(var n=-1,c=arguments.length,f=-1,s=r.length,l=Array(s+c),p=this&&this!==Pe&&this instanceof i?a:t;++f<s;)l[f]=r[f];for(;c--;)l[f++]=arguments[++n];return u(p,o?e:this,l)}var o=n&it,a=pi(t);return i}function bi(t){return function(n,e,r){return r&&"number"!=typeof r&&Zi(n,e,r)&&(e=r=Y),n=Pu(n),n=n===n?n:0,e===Y?(e=n,n=0):e=Pu(e)||0,r=r===Y?n<e?1:-1:Pu(r)||0,kr(n,e,r,t)}}function ki(t){return function(n,e){return"string"==typeof n&&"string"==typeof e||(n=Pu(n),e=Pu(e)),t(n,e)}}function Ei(t,n,e,r,i,o,a,u,c,f){var s=n&ut,l=s?a:Y,p=s?Y:a,h=s?o:Y,d=s?Y:o;n|=s?ft:st,n&=~(s?st:ft),n&at||(n&=~(it|ot));var v=[t,n,i,h,l,d,p,u,c,f],m=e.apply(Y,v);return to(t)&&Is(m,v),m.placeholder=r,m}function Ai(t){var n=wf[t];return function(t,e){if(t=Pu(t),e=ts(Du(e),292)){var r=(Hu(t)+"e").split("e"),i=n(r[0]+"e"+(+r[1]+e));return r=(Hu(i)+"e").split("e"),+(r[0]+"e"+(+r[1]-e))}return n(t)}}function Si(t){return function(n){var e=Pi(n);return e==Ft?H(n):e==qt?$(n):z(n,t(n))}}function ji(t,n,e,r,i,o,a,u){var c=n&ot;if(!c&&"function"!=typeof t)throw new kf(nt);var f=r?r.length:0;if(f||(n&=~(ft|st),r=i=Y),a=a===Y?a:Qf(Du(a),0),u=u===Y?u:Du(u),f-=i?i.length:0,n&st){var s=r,l=i;r=i=Y}var p=c?Y:zs(t),h=[t,n,e,r,i,s,l,o,a,u];if(p&&oo(h,p),t=h[0],n=h[1],e=h[2],r=h[3],i=h[4],u=h[9]=null==h[9]?c?0:t.length:Qf(h[9]-f,0),!u&&n&(ut|ct)&&(n&=~(ut|ct)),n&&n!=it)d=n==ut||n==ct?hi(t,n,u):n!=ft&&n!=(it|ft)||i.length?mi.apply(Y,h):wi(t,n,e,r);else var d=fi(t,n,e);var v=p?js:Is;return v(d,h)}function Ci(t,n,e,r,i,o){var a=i&vt,u=t.length,c=n.length;if(u!=c&&!(a&&c>u))return!1;var f=o.get(t);if(f)return f==n;var s=-1,l=!0,p=i&dt?new ee:Y;for(o.set(t,n);++s<u;){var h=t[s],d=n[s];if(r)var v=a?r(d,h,s,n,t,o):r(h,d,s,t,n,o);if(v!==Y){if(v)continue;l=!1;break}if(p){if(!_(n,function(t,n){if(!p.has(n)&&(h===t||e(h,t,r,i,o)))return p.add(n)})){l=!1;break}}else if(h!==d&&!e(h,d,r,i,o)){l=!1;break}}return o["delete"](t),l}function zi(t,n,e,r,i,o,a){switch(e){case Vt:if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case $t:return!(t.byteLength!=n.byteLength||!r(new Df(t),new Df(n)));case Bt:case It:return+t==+n;case Rt:return t.name==n.name&&t.message==n.message;case Wt:return t!=+t?n!=+n:t==+n;case Pt:case Nt:return t==n+"";case Ft:var u=H;case qt:var c=o&vt;if(u||(u=J),t.size!=n.size&&!c)return!1;var f=a.get(t);return f?f==n:(o|=dt,a.set(t,n),Ci(u(t),u(n),r,i,o,a));case Ht:if(ws)return ws.call(t)==ws.call(n)}return!1}function Mi(t,n,e,r,i,o){var a=i&vt,u=rc(t),c=u.length,f=rc(n),s=f.length;if(c!=s&&!a)return!1;for(var l=c;l--;){var p=u[l];if(!(a?p in n:Xe(n,p)))return!1}var h=o.get(t);if(h)return h==n;var d=!0;o.set(t,n);for(var v=a;++l<c;){p=u[l];var m=t[p],g=n[p];if(r)var y=a?r(g,m,p,n,t,o):r(m,g,p,t,n,o);if(!(y===Y?m===g||e(m,g,r,i,o):y)){d=!1;break}v||(v="constructor"==p)}if(d&&!v){var _=t.constructor,x=n.constructor;_!=x&&"constructor"in t&&"constructor"in n&&!("function"==typeof _&&_ instanceof _&&"function"==typeof x&&x instanceof x)&&(d=!1)}return o["delete"](t),d}function Oi(t){return $e(t,rc,Li)}function Bi(t){return $e(t,ic,Os)}function Ii(t){for(var n=t.name+"",e=ds[n],r=Mf.call(ds,n)?e.length:0;r--;){var i=e[r],o=i.func;if(null==o||o==t)return i.name}return n}function Ri(t){var e=Mf.call(n,"placeholder")?n:t;return e.placeholder}function Ui(){var t=n.iteratee||$c;return t=t===$c?or:t,arguments.length?t(arguments[0],arguments[1]):t}function Ti(t,n){var e=t.__data__;return Qi(n)?e["string"==typeof n?"string":"hash"]:e.map}function Fi(t){for(var n=rc(t),e=n.length;e--;){var r=n[e],i=t[r];n[e]=[r,i,ro(i)]}return n}function Wi(t,n){var e=L(t,n);return ir(e)?e:Y}function Di(t){return Xf(Object(t))}function Li(t){return Pf(Object(t))}function Pi(t){return If.call(t)}function qi(t,n,e){for(var r=-1,i=e.length;++r<i;){var o=e[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":n-=a;break;case"take":n=ts(n,t+a);break;case"takeRight":t=Qf(t,n-a)}}return{start:t,end:n}}function Ni(t,n,e){n=Yi(n,t)?[n]:qr(n);for(var r,i=-1,o=n.length;++i<o;){var a=fo(n[i]);if(!(r=null!=t&&e(t,a)))break;t=t[a]}if(r)return r;var o=t?t.length:0;return!!o&&mu(o)&&Gi(a,o)&&(gl(t)||Ou(t)||eu(t))}function Hi(t){var n=t.length,e=t.constructor(n);return n&&"string"==typeof t[0]&&Mf.call(t,"index")&&(e.index=t.index,e.input=t.input),e}function Ki(t){return"function"!=typeof t.constructor||eo(t)?{}:Me(Di(t))}function Ji(t,n,e,r){var i=t.constructor;switch(n){case $t:return Kr(t);case Bt:case It:return new i((+t));case Vt:return Jr(t,r);case Xt:case Gt:case Zt:case Yt:case Qt:case tn:case nn:case en:case rn:return Zr(t,r);case Ft:return $r(t,r,e);case Wt:case Nt:return new i(t);case Pt:return Vr(t);case qt:return Xr(t,r,e);case Ht:return Gr(t)}}function $i(t){var n=t?t.length:Y;return mu(n)&&(gl(t)||Ou(t)||eu(t))?C(n,String):null}function Vi(t){return gl(t)||eu(t)}function Xi(t){return gl(t)&&!(2==t.length&&!du(t[0]))}function Gi(t,n){return n=null==n?Et:n,!!n&&("number"==typeof t||Bn.test(t))&&t>-1&&t%1==0&&t<n}function Zi(t,n,e){if(!gu(e))return!1;var r=typeof n;return!!("number"==r?iu(e)&&Gi(n,e.length):"string"==r&&n in e)&&nu(e[n],t)}function Yi(t,n){if(gl(t))return!1;var e=typeof t;return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!Bu(t))||(mn.test(t)||!vn.test(t)||null!=n&&t in Object(n))}function Qi(t){var n=typeof t;return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t}function to(t){var e=Ii(t),r=n[e];if("function"!=typeof r||!(e in i.prototype))return!1;if(t===r)return!0;var o=zs(r);return!!o&&t===o[0]}function no(t){return!!Cf&&Cf in t}function eo(t){var n=t&&t.constructor,e="function"==typeof n&&n.prototype||Af;return t===e}function ro(t){return t===t&&!gu(t)}function io(t,n){return function(e){return null!=e&&(e[t]===n&&(n!==Y||t in Object(e)))}}function oo(t,n){var e=t[1],r=n[1],i=e|r,o=i<(it|ot|lt),a=r==lt&&e==ut||r==lt&&e==pt&&t[7].length<=n[8]||r==(lt|pt)&&n[7].length<=n[8]&&e==ut;if(!o&&!a)return t;r&it&&(t[2]=n[2],i|=e&it?0:at);var u=n[3];if(u){var c=t[3];t[3]=c?ti(c,u,n[4]):u,t[4]=c?K(t[3],rt):n[4]}return u=n[5],u&&(c=t[5],t[5]=c?ni(c,u,n[6]):u,t[6]=c?K(t[5],rt):n[6]),u=n[7],u&&(t[7]=u),r&lt&&(t[8]=null==t[8]?n[8]:ts(t[8],n[8])),null==t[9]&&(t[9]=n[9]),t[0]=n[0],t[1]=i,t}function ao(t,n,e,r,i,o){return gu(t)&&gu(n)&&pr(t,n,Y,ao,o.set(n,t)),t}function uo(t,n){return 1==n.length?t:Je(t,Sr(n,0,-1))}function co(t,n){for(var e=t.length,r=ts(n.length,e),i=ei(t);r--;){var o=n[r];t[r]=Gi(o,e)?i[o]:Y}return t}function fo(t){if("string"==typeof t||Bu(t))return t;var n=t+"";return"0"==n&&1/t==-kt?"-0":n}function so(t){if(null!=t){try{return zf.call(t)}catch(n){}try{return t+""}catch(n){}}return""}function lo(t){if(t instanceof i)return t.clone();var n=new r(t.__wrapped__,t.__chain__);return n.__actions__=ei(t.__actions__),n.__index__=t.__index__,n.__values__=t.__values__,n}function po(t,n,e){n=(e?Zi(t,n,e):n===Y)?1:Qf(Du(n),0);var r=t?t.length:0;if(!r||n<1)return[];for(var i=0,o=0,a=Array($f(r/n));i<r;)a[o++]=Sr(t,i,i+=n);return a}function ho(t){for(var n=-1,e=t?t.length:0,r=0,i=[];++n<e;){var o=t[n];o&&(i[r++]=o)}return i}function vo(){for(var t=arguments.length,n=Array(t?t-1:0),e=arguments[0],r=t;r--;)n[r-1]=arguments[r];return t?m(gl(e)?ei(e):[e],Le(n,1)):[]}function mo(t,n,e){var r=t?t.length:0;return r?(n=e||n===Y?1:Du(n),Sr(t,n<0?0:n,r)):[]}function go(t,n,e){var r=t?t.length:0;return r?(n=e||n===Y?1:Du(n),n=r-n,Sr(t,0,n<0?0:n)):[]}function yo(t,n){return t&&t.length?Tr(t,Ui(n,3),!0,!0):[]}function _o(t,n){return t&&t.length?Tr(t,Ui(n,3),!0):[]}function xo(t,n,e,r){var i=t?t.length:0;return i?(e&&"number"!=typeof e&&Zi(t,n,e)&&(e=0,r=i),We(t,n,e,r)):[]}function wo(t,n,e){var r=t?t.length:0;if(!r)return-1;var i=null==e?0:Du(e);return i<0&&(i=Qf(r+i,0)),w(t,Ui(n,3),i)}function bo(t,n,e){var r=t?t.length:0;if(!r)return-1;var i=r-1;return e!==Y&&(i=Du(e),i=e<0?Qf(r+i,0):ts(i,r-1)),w(t,Ui(n,3),i,!0)}function ko(t){var n=t?t.length:0;return n?Le(t,1):[]}function Eo(t){var n=t?t.length:0;return n?Le(t,kt):[]}function Ao(t,n){var e=t?t.length:0;return e?(n=n===Y?1:Du(n),Le(t,n)):[]}function So(t){for(var n=-1,e=t?t.length:0,r={};++n<e;){var i=t[n];r[i[0]]=i[1]}return r}function jo(t){return t&&t.length?t[0]:Y}function Co(t,n,e){var r=t?t.length:0;if(!r)return-1;var i=null==e?0:Du(e);return i<0&&(i=Qf(r+i,0)),b(t,n,i)}function zo(t){return go(t,1)}function Mo(t,n){return t?Zf.call(t,n):""}function Oo(t){var n=t?t.length:0;return n?t[n-1]:Y}function Bo(t,n,e){var r=t?t.length:0;if(!r)return-1;var i=r;if(e!==Y&&(i=Du(e),i=(i<0?Qf(r+i,0):ts(i,r-1))+1),n!==n)return P(t,i-1,!0);for(;i--;)if(t[i]===n)return i;return-1}function Io(t,n){return t&&t.length?dr(t,Du(n)):Y}function Ro(t,n){return t&&t.length&&n&&n.length?xr(t,n):t}function Uo(t,n,e){return t&&t.length&&n&&n.length?xr(t,n,Ui(e)):t}function To(t,n,e){return t&&t.length&&n&&n.length?xr(t,n,Y,e):t}function Fo(t,n){var e=[];if(!t||!t.length)return e;var r=-1,i=[],o=t.length;for(n=Ui(n,3);++r<o;){var a=t[r];n(a,r,t)&&(e.push(a),i.push(r))}return wr(t,i),e}function Wo(t){return t?is.call(t):t}function Do(t,n,e){var r=t?t.length:0;return r?(e&&"number"!=typeof e&&Zi(t,n,e)?(n=0,e=r):(n=null==n?0:Du(n),e=e===Y?r:Du(e)),Sr(t,n,e)):[]}function Lo(t,n){return Cr(t,n)}function Po(t,n,e){return zr(t,n,Ui(e))}function qo(t,n){var e=t?t.length:0;if(e){var r=Cr(t,n);if(r<e&&nu(t[r],n))return r}return-1}function No(t,n){return Cr(t,n,!0)}function Ho(t,n,e){return zr(t,n,Ui(e),!0)}function Ko(t,n){var e=t?t.length:0;if(e){var r=Cr(t,n,!0)-1;if(nu(t[r],n))return r}return-1}function Jo(t){return t&&t.length?Mr(t):[]}function $o(t,n){return t&&t.length?Mr(t,Ui(n)):[]}function Vo(t){return mo(t,1)}function Xo(t,n,e){return t&&t.length?(n=e||n===Y?1:Du(n),Sr(t,0,n<0?0:n)):[]}function Go(t,n,e){var r=t?t.length:0;return r?(n=e||n===Y?1:Du(n),n=r-n,Sr(t,n<0?0:n,r)):[]}function Zo(t,n){return t&&t.length?Tr(t,Ui(n,3),!1,!0):[]}function Yo(t,n){return t&&t.length?Tr(t,Ui(n,3)):[]}function Qo(t){return t&&t.length?Ir(t):[]}function ta(t,n){return t&&t.length?Ir(t,Ui(n)):[]}function na(t,n){return t&&t.length?Ir(t,Y,n):[]}function ea(t){if(!t||!t.length)return[];var n=0;return t=p(t,function(t){if(ou(t))return n=Qf(t.length,n),!0}),C(n,function(n){return v(t,yr(n))})}function ra(t,n){if(!t||!t.length)return[];var e=ea(t);return null==n?e:v(e,function(t){return u(n,Y,t)})}function ia(t,n){return Dr(t||[],n||[],he)}function oa(t,n){return Dr(t||[],n||[],Ar)}function aa(t){var e=n(t);return e.__chain__=!0,e}function ua(t,n){return n(t),t}function ca(t,n){return n(t)}function fa(){return aa(this)}function sa(){return new r(this.value(),this.__chain__)}function la(){this.__values__===Y&&(this.__values__=Fu(this.value()));var t=this.__index__>=this.__values__.length,n=t?Y:this.__values__[this.__index__++];return{done:t,value:n}}function pa(){return this}function ha(t){for(var n,r=this;r instanceof e;){var i=lo(r);i.__index__=0,i.__values__=Y,n?o.__wrapped__=i:n=i;var o=i;r=r.__wrapped__}return o.__wrapped__=t,n}function da(){var t=this.__wrapped__;if(t instanceof i){var n=t;return this.__actions__.length&&(n=new i(this)),n=n.reverse(),n.__actions__.push({func:ca,args:[Wo],thisArg:Y}),new r(n,this.__chain__)}return this.thru(Wo)}function va(){return Fr(this.__wrapped__,this.__actions__)}function ma(t,n,e){var r=gl(t)?l:Ue;return e&&Zi(t,n,e)&&(n=Y),r(t,Ui(n,3))}function ga(t,n){var e=gl(t)?p:De;return e(t,Ui(n,3))}function ya(t,n){return Le(Ea(t,n),1)}function _a(t,n){return Le(Ea(t,n),kt)}function xa(t,n,e){return e=e===Y?1:Du(e),Le(Ea(t,n),e)}function wa(t,n){var e=gl(t)?f:ks;return e(t,Ui(n,3))}function ba(t,n){var e=gl(t)?s:Es;return e(t,Ui(n,3))}function ka(t,n,e,r){t=iu(t)?t:mc(t),e=e&&!r?Du(e):0;var i=t.length;return e<0&&(e=Qf(i+e,0)),Ou(t)?e<=i&&t.indexOf(n,e)>-1:!!i&&b(t,n,e)>-1}function Ea(t,n){var e=gl(t)?v:fr;return e(t,Ui(n,3))}function Aa(t,n,e,r){return null==t?[]:(gl(n)||(n=null==n?[]:[n]),e=r?Y:e,gl(e)||(e=null==e?[]:[e]),vr(t,n,e))}function Sa(t,n,e){var r=gl(t)?g:A,i=arguments.length<3;return r(t,Ui(n,4),e,i,ks)}function ja(t,n,e){var r=gl(t)?y:A,i=arguments.length<3;return r(t,Ui(n,4),e,i,Es)}function Ca(t,n){var e=gl(t)?p:De;return n=Ui(n,3),e(t,function(t,e,r){return!n(t,e,r)})}function za(t){var n=iu(t)?t:mc(t),e=n.length;return e>0?n[br(0,e-1)]:Y}function Ma(t,n,e){var r=-1,i=Fu(t),o=i.length,a=o-1;for(n=(e?Zi(t,n,e):n===Y)?1:ye(Du(n),0,o);++r<n;){var u=br(r,a),c=i[u];i[u]=i[r],i[r]=c}return i.length=n,i}function Oa(t){return Ma(t,jt)}function Ba(t){if(null==t)return 0;if(iu(t)){var n=t.length;return n&&Ou(t)?V(t):n}if(yu(t)){var e=Pi(t);if(e==Ft||e==qt)return t.size}return rc(t).length}function Ia(t,n,e){var r=gl(t)?_:jr;return e&&Zi(t,n,e)&&(n=Y),r(t,Ui(n,3))}function Ra(){return _f.now()}function Ua(t,n){if("function"!=typeof n)throw new kf(nt);return t=Du(t),function(){if(--t<1)return n.apply(this,arguments)}}function Ta(t,n,e){return n=e?Y:n,n=t&&null==n?t.length:n,ji(t,lt,Y,Y,Y,Y,n)}function Fa(t,n){var e;if("function"!=typeof n)throw new kf(nt);return t=Du(t),function(){return--t>0&&(e=n.apply(this,arguments)),t<=1&&(n=Y),e}}function Wa(t,n,e){n=e?Y:n;var r=ji(t,ut,Y,Y,Y,Y,Y,n);return r.placeholder=Wa.placeholder,r}function Da(t,n,e){n=e?Y:n;var r=ji(t,ct,Y,Y,Y,Y,Y,n);return r.placeholder=Da.placeholder,r}function La(t,n,e){function r(n){var e=p,r=h;return p=h=Y,y=n,v=t.apply(r,e)}function i(t){return y=t,m=Jf(u,n),_?r(t):v}function o(t){var e=t-g,r=t-y,i=n-e;return x?ts(i,d-r):i}function a(t){var e=t-g,r=t-y;return g===Y||e>=n||e<0||x&&r>=d}function u(){var t=Ra();return a(t)?c(t):void(m=Jf(u,o(t)))}function c(t){return m=Y,w&&p?r(t):(p=h=Y,v)}function f(){y=0,p=g=h=m=Y}function s(){return m===Y?v:c(Ra())}function l(){var t=Ra(),e=a(t);if(p=arguments,h=this,g=t,e){if(m===Y)return i(g);if(x)return m=Jf(u,n),r(g)}return m===Y&&(m=Jf(u,n)),v}var p,h,d,v,m,g,y=0,_=!1,x=!1,w=!0;if("function"!=typeof t)throw new kf(nt);return n=Pu(n)||0,gu(e)&&(_=!!e.leading,x="maxWait"in e,d=x?Qf(Pu(e.maxWait)||0,n):d,w="trailing"in e?!!e.trailing:w),l.cancel=f,l.flush=s,l}function Pa(t){return ji(t,ht)}function qa(t,n){if("function"!=typeof t||n&&"function"!=typeof n)throw new kf(nt);var e=function(){var r=arguments,i=n?n.apply(this,r):r[0],o=e.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return e.cache=o.set(i,a),a};return e.cache=new(qa.Cache||Gn),e}function Na(t){if("function"!=typeof t)throw new kf(nt);return function(){return!t.apply(this,arguments)}}function Ha(t){return Fa(2,t)}function Ka(t,n){if("function"!=typeof t)throw new kf(nt);return n=Qf(n===Y?t.length-1:Du(n),0),function(){for(var e=arguments,r=-1,i=Qf(e.length-n,0),o=Array(i);++r<i;)o[r]=e[n+r];switch(n){case 0:return t.call(this,o);case 1:return t.call(this,e[0],o);case 2:return t.call(this,e[0],e[1],o)}var a=Array(n+1);for(r=-1;++r<n;)a[r]=e[r];return a[n]=o,u(t,this,a)}}function Ja(t,n){if("function"!=typeof t)throw new kf(nt);return n=n===Y?0:Qf(Du(n),0),Ka(function(e){var r=e[n],i=Nr(e,0,n);return r&&m(i,r),u(t,this,i)})}function $a(t,n,e){var r=!0,i=!0;if("function"!=typeof t)throw new kf(nt);return gu(e)&&(r="leading"in e?!!e.leading:r,i="trailing"in e?!!e.trailing:i),La(t,n,{leading:r,maxWait:n,trailing:i})}function Va(t){return Ta(t,1)}function Xa(t,n){return n=null==n?Jc:n,pl(n,t)}function Ga(){if(!arguments.length)return[];var t=arguments[0];return gl(t)?t:[t]}function Za(t){return we(t,!1,!0)}function Ya(t,n){return we(t,!1,!0,n)}function Qa(t){return we(t,!0,!0)}function tu(t,n){return we(t,!0,!0,n)}function nu(t,n){return t===n||t!==t&&n!==n}function eu(t){return ou(t)&&Mf.call(t,"callee")&&(!Hf.call(t,"callee")||If.call(t)==Mt)}function ru(t){return yu(t)&&If.call(t)==$t}function iu(t){return null!=t&&mu(Ms(t))&&!du(t)}function ou(t){return yu(t)&&iu(t)}function au(t){return t===!0||t===!1||yu(t)&&If.call(t)==Bt}function uu(t){return yu(t)&&If.call(t)==It}function cu(t){return!!t&&1===t.nodeType&&yu(t)&&!ju(t)}function fu(t){if(iu(t)&&(gl(t)||Ou(t)||du(t.splice)||eu(t)||yl(t)))return!t.length;if(yu(t)){var n=Pi(t);if(n==Ft||n==qt)return!t.size}for(var e in t)if(Mf.call(t,e))return!1;return!(hs&&rc(t).length)}function su(t,n){return nr(t,n)}function lu(t,n,e){e="function"==typeof e?e:Y;var r=e?e(t,n):Y;return r===Y?nr(t,n,e):!!r}function pu(t){return!!yu(t)&&(If.call(t)==Rt||"string"==typeof t.message&&"string"==typeof t.name)}function hu(t){return"number"==typeof t&&Gf(t)}function du(t){var n=gu(t)?If.call(t):"";return n==Ut||n==Tt}function vu(t){return"number"==typeof t&&t==Du(t)}function mu(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Et}function gu(t){var n=typeof t;return!!t&&("object"==n||"function"==n)}function yu(t){return!!t&&"object"==typeof t}function _u(t){return yu(t)&&Pi(t)==Ft}function xu(t,n){return t===n||rr(t,n,Fi(n))}function wu(t,n,e){return e="function"==typeof e?e:Y,rr(t,n,Fi(n),e)}function bu(t){return Su(t)&&t!=+t}function ku(t){if(Bs(t))throw new xf("This method is not supported with `core-js`. Try https://github.com/es-shims.");return ir(t)}function Eu(t){return null===t}function Au(t){return null==t}function Su(t){return"number"==typeof t||yu(t)&&If.call(t)==Wt}function ju(t){if(!yu(t)||If.call(t)!=Dt||q(t))return!1;var n=Di(t);if(null===n)return!0;var e=Mf.call(n,"constructor")&&n.constructor;return"function"==typeof e&&e instanceof e&&zf.call(e)==Bf}function Cu(t){return gu(t)&&If.call(t)==Pt}function zu(t){return vu(t)&&t>=-Et&&t<=Et}function Mu(t){return yu(t)&&Pi(t)==qt}function Ou(t){return"string"==typeof t||!gl(t)&&yu(t)&&If.call(t)==Nt}function Bu(t){return"symbol"==typeof t||yu(t)&&If.call(t)==Ht}function Iu(t){return yu(t)&&mu(t.length)&&!!je[If.call(t)]}function Ru(t){return t===Y}function Uu(t){return yu(t)&&Pi(t)==Kt}function Tu(t){return yu(t)&&If.call(t)==Jt}function Fu(t){if(!t)return[];if(iu(t))return Ou(t)?X(t):ei(t);if(qf&&t[qf])return N(t[qf]());var n=Pi(t),e=n==Ft?H:n==qt?J:mc;return e(t)}function Wu(t){if(!t)return 0===t?t:0;if(t=Pu(t),t===kt||t===-kt){var n=t<0?-1:1;return n*At}return t===t?t:0}function Du(t){var n=Wu(t),e=n%1;return n===n?e?n-e:n:0}function Lu(t){return t?ye(Du(t),0,jt):0}function Pu(t){if("number"==typeof t)return t;if(Bu(t))return St;if(gu(t)){var n=du(t.valueOf)?t.valueOf():t;t=gu(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(xn,"");var e=zn.test(t);return e||On.test(t)?Re(t.slice(2),e?2:8):Cn.test(t)?St:+t}function qu(t){return ri(t,ic(t))}function Nu(t){return ye(Du(t),-Et,Et)}function Hu(t){return null==t?"":Br(t)}function Ku(t,n){var e=Me(t);return n?me(e,n):e}function Ju(t,n){return x(t,Ui(n,3),Ne)}function $u(t,n){return x(t,Ui(n,3),He)}function Vu(t,n){return null==t?t:As(t,Ui(n,3),ic)}function Xu(t,n){return null==t?t:Ss(t,Ui(n,3),ic)}function Gu(t,n){return t&&Ne(t,Ui(n,3))}function Zu(t,n){return t&&He(t,Ui(n,3))}function Yu(t){return null==t?[]:Ke(t,rc(t))}function Qu(t){return null==t?[]:Ke(t,ic(t))}function tc(t,n,e){var r=null==t?Y:Je(t,n);return r===Y?e:r}function nc(t,n){return null!=t&&Ni(t,n,Xe)}function ec(t,n){return null!=t&&Ni(t,n,Ge)}function rc(t){var n=eo(t);if(!n&&!iu(t))return ar(t);var e=$i(t),r=!!e,i=e||[],o=i.length;for(var a in t)!Xe(t,a)||r&&("length"==a||Gi(a,o))||n&&"constructor"==a||i.push(a);return i}function ic(t){for(var n=-1,e=eo(t),r=ur(t),i=r.length,o=$i(t),a=!!o,u=o||[],c=u.length;++n<i;){var f=r[n];a&&("length"==f||Gi(f,c))||"constructor"==f&&(e||!Mf.call(t,f))||u.push(f)}return u}function oc(t,n){var e={};return n=Ui(n,3),Ne(t,function(t,r,i){e[n(t,r,i)]=t}),e}function ac(t,n){var e={};return n=Ui(n,3),Ne(t,function(t,r,i){e[r]=n(t,r,i)}),e}function uc(t,n){return n=Ui(n),gr(t,function(t,e){return!n(t,e)})}function cc(t,n){return null==t?{}:gr(t,Ui(n))}function fc(t,n,e){n=Yi(n,t)?[n]:qr(n);var r=-1,i=n.length;for(i||(t=Y,i=1);++r<i;){var o=null==t?Y:t[fo(n[r])];o===Y&&(r=i,o=e),t=du(o)?o.call(t):o}return t}function sc(t,n,e){return null==t?t:Ar(t,n,e)}function lc(t,n,e,r){return r="function"==typeof r?r:Y,null==t?t:Ar(t,n,e,r)}function pc(t,n,e){var r=gl(t)||Iu(t);if(n=Ui(n,4),null==e)if(r||gu(t)){var i=t.constructor;e=r?gl(t)?new i:[]:du(i)?Me(Di(t)):{}}else e={};return(r?f:Ne)(t,function(t,r,i){return n(e,t,r,i)}),e}function hc(t,n){return null==t||Rr(t,n)}function dc(t,n,e){return null==t?t:Ur(t,n,Pr(e))}function vc(t,n,e,r){return r="function"==typeof r?r:Y,null==t?t:Ur(t,n,Pr(e),r)}function mc(t){return t?O(t,rc(t)):[]}function gc(t){return null==t?[]:O(t,ic(t))}function yc(t,n,e){return e===Y&&(e=n,n=Y),e!==Y&&(e=Pu(e),e=e===e?e:0),n!==Y&&(n=Pu(n),n=n===n?n:0),ye(Pu(t),n,e)}function _c(t,n,e){return n=Pu(n)||0,e===Y?(e=n,n=0):e=Pu(e)||0,t=Pu(t),Ze(t,n,e)}function xc(t,n,e){if(e&&"boolean"!=typeof e&&Zi(t,n,e)&&(n=e=Y),e===Y&&("boolean"==typeof n?(e=n,n=Y):"boolean"==typeof t&&(e=t,t=Y)),t===Y&&n===Y?(t=0,n=1):(t=Pu(t)||0,n===Y?(n=t,t=0):n=Pu(n)||0),t>n){var r=t;t=n,n=r}if(e||t%1||n%1){var i=es();return ts(t+i*(n-t+Ie("1e-"+((i+"").length-1))),n)}return br(t,n)}function wc(t){return Hl(Hu(t).toLowerCase())}function bc(t){return t=Hu(t),t&&t.replace(In,F).replace(xe,"")}function kc(t,n,e){t=Hu(t),n=Br(n);var r=t.length;return e=e===Y?r:ye(Du(e),0,r),e-=n.length,e>=0&&t.indexOf(n,e)==e}function Ec(t){return t=Hu(t),t&&ln.test(t)?t.replace(fn,W):t}function Ac(t){return t=Hu(t),t&&_n.test(t)?t.replace(yn,"\\\\$&"):t}function Sc(t,n,e){t=Hu(t),n=Du(n);var r=n?V(t):0;if(!n||r>=n)return t;var i=(n-r)/2;return xi(Vf(i),e)+t+xi($f(i),e)}function jc(t,n,e){t=Hu(t),n=Du(n);var r=n?V(t):0;return n&&r<n?t+xi(n-r,e):t}function Cc(t,n,e){t=Hu(t),n=Du(n);var r=n?V(t):0;return n&&r<n?xi(n-r,e)+t:t}function zc(t,n,e){return e||null==n?n=0:n&&(n=+n),t=Hu(t).replace(xn,""),ns(t,n||(jn.test(t)?16:10))}function Mc(t,n,e){return n=(e?Zi(t,n,e):n===Y)?1:Du(n),Er(Hu(t),n)}function Oc(){var t=arguments,n=Hu(t[0]);return t.length<3?n:rs.call(n,t[1],t[2])}function Bc(t,n,e){return e&&"number"!=typeof e&&Zi(t,n,e)&&(n=e=Y),(e=e===Y?jt:e>>>0)?(t=Hu(t),t&&("string"==typeof n||null!=n&&!Cu(n))&&(n=Br(n),""==n&&ke.test(t))?Nr(X(t),0,e):os.call(t,n,e)):[]}function Ic(t,n,e){return t=Hu(t),e=ye(Du(e),0,t.length),t.lastIndexOf(Br(n),e)==e}function Rc(t,e,r){var i=n.templateSettings;r&&Zi(t,e,r)&&(e=Y),t=Hu(t),e=kl({},e,i,le);var o,a,u=kl({},e.imports,i.imports,le),c=rc(u),f=O(u,c),s=0,l=e.interpolate||Rn,p="__p += \'",h=bf((e.escape||Rn).source+"|"+l.source+"|"+(l===dn?An:Rn).source+"|"+(e.evaluate||Rn).source+"|$","g"),d="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++Se+"]")+"\\n";t.replace(h,function(n,e,r,i,u,c){return r||(r=i),p+=t.slice(s,c).replace(Un,D),e&&(o=!0,p+="\' +\\n__e("+e+") +\\n\'"),u&&(a=!0,p+="\';\\n"+u+";\\n__p += \'"),r&&(p+="\' +\\n((__t = ("+r+")) == null ? \'\' : __t) +\\n\'"),s=c+n.length,n}),p+="\';\\n";var v=e.variable;v||(p="with (obj) {\\n"+p+"\\n}\\n"),p=(a?p.replace(on,""):p).replace(an,"$1").replace(un,"$1;"),p="function("+(v||"obj")+") {\\n"+(v?"":"obj || (obj = {});\\n")+"var __t, __p = \'\'"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\\nfunction print() { __p += __j.call(arguments, \'\') }\\n":";\\n")+p+"return __p\\n}";var m=Kl(function(){return Function(c,d+"return "+p).apply(Y,f)});if(m.source=p,pu(m))throw m;return m}function Uc(t){return Hu(t).toLowerCase()}function Tc(t){return Hu(t).toUpperCase()}function Fc(t,n,e){if(t=Hu(t),t&&(e||n===Y))return t.replace(xn,"");if(!t||!(n=Br(n)))return t;var r=X(t),i=X(n),o=I(r,i),a=R(r,i)+1;return Nr(r,o,a).join("")}function Wc(t,n,e){if(t=Hu(t),t&&(e||n===Y))return t.replace(bn,"");if(!t||!(n=Br(n)))return t;var r=X(t),i=R(r,X(n))+1;return Nr(r,0,i).join("")}function Dc(t,n,e){if(t=Hu(t),t&&(e||n===Y))return t.replace(wn,"");if(!t||!(n=Br(n)))return t;var r=X(t),i=I(r,X(n));return Nr(r,i).join("")}function Lc(t,n){var e=mt,r=gt;if(gu(n)){var i="separator"in n?n.separator:i;e="length"in n?Du(n.length):e,r="omission"in n?Br(n.omission):r}t=Hu(t);var o=t.length;if(ke.test(t)){var a=X(t);o=a.length}if(e>=o)return t;var u=e-V(r);if(u<1)return r;var c=a?Nr(a,0,u).join(""):t.slice(0,u);if(i===Y)return c+r;if(a&&(u+=c.length-u),Cu(i)){if(t.slice(u).search(i)){var f,s=c;for(i.global||(i=bf(i.source,Hu(Sn.exec(i))+"g")),i.lastIndex=0;f=i.exec(s);)var l=f.index;c=c.slice(0,l===Y?u:l)}}else if(t.indexOf(Br(i),u)!=u){var p=c.lastIndexOf(i);p>-1&&(c=c.slice(0,p))}return c+r}function Pc(t){return t=Hu(t),t&&sn.test(t)?t.replace(cn,G):t}function qc(t,n,e){return t=Hu(t),n=e?Y:n,n===Y&&(n=Ee.test(t)?be:kn),t.match(n)||[]}function Nc(t){var n=t?t.length:0,e=Ui();return t=n?v(t,function(t){if("function"!=typeof t[1])throw new kf(nt);return[e(t[0]),t[1]]}):[],Ka(function(e){for(var r=-1;++r<n;){var i=t[r];if(u(i[0],this,e))return u(i[1],this,e)}})}function Hc(t){return ze(we(t,!0))}function Kc(t){return function(){return t}}function Jc(t){return t}function $c(t){return or("function"==typeof t?t:we(t,!0))}function Vc(t){return sr(we(t,!0))}function Xc(t,n){return lr(t,we(n,!0))}function Gc(t,n,e){var r=rc(n),i=Ke(n,r);null!=e||gu(n)&&(i.length||!r.length)||(e=n,n=t,t=this,i=Ke(n,rc(n)));var o=!(gu(e)&&"chain"in e&&!e.chain),a=du(t);return f(i,function(e){var r=n[e];t[e]=r,a&&(t.prototype[e]=function(){var n=this.__chain__;if(o||n){var e=t(this.__wrapped__),i=e.__actions__=ei(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),e.__chain__=n,e}return r.apply(t,m([this.value()],arguments))})}),t}function Zc(){return Pe._===this&&(Pe._=Rf),this}function Yc(){}function Qc(t){return t=Du(t),Ka(function(n){return dr(n,t)})}function tf(t){return Yi(t)?yr(fo(t)):_r(t)}function nf(t){return function(n){return null==t?Y:Je(t,n)}}function ef(){return[]}function rf(){return!1}function of(){return{}}function af(){return""}function uf(){return!0}function cf(t,n){if(t=Du(t),t<1||t>Et)return[];var e=jt,r=ts(t,jt);n=Ui(n),t-=jt;for(var i=C(r,n);++e<t;)n(e);return i}function ff(t){return gl(t)?v(t,fo):Bu(t)?[t]:ei(Rs(t))}function sf(t){var n=++Of;return Hu(t)+n}function lf(t){return t&&t.length?Te(t,Jc,Ve):Y}function pf(t,n){return t&&t.length?Te(t,Ui(n),Ve):Y}function hf(t){return E(t,Jc)}function df(t,n){return E(t,Ui(n))}function vf(t){return t&&t.length?Te(t,Jc,cr):Y}function mf(t,n){return t&&t.length?Te(t,Ui(n),cr):Y}function gf(t){return t&&t.length?j(t,Jc):0}function yf(t,n){return t&&t.length?j(t,Ui(n)):0}t=t?qe.defaults({},t,qe.pick(Pe,Ae)):Pe;var _f=t.Date,xf=t.Error,wf=t.Math,bf=t.RegExp,kf=t.TypeError,Ef=t.Array.prototype,Af=t.Object.prototype,Sf=t.String.prototype,jf=t["__core-js_shared__"],Cf=function(){var t=/[^.]+$/.exec(jf&&jf.keys&&jf.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),zf=t.Function.prototype.toString,Mf=Af.hasOwnProperty,Of=0,Bf=zf.call(Object),If=Af.toString,Rf=Pe._,Uf=bf("^"+zf.call(Mf).replace(yn,"\\\\$&").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,"$1.*?")+"$"),Tf=Fe?t.Buffer:Y,Ff=t.Reflect,Wf=t.Symbol,Df=t.Uint8Array,Lf=Ff?Ff.enumerate:Y,Pf=Object.getOwnPropertySymbols,qf="symbol"==typeof(qf=Wf&&Wf.iterator)?qf:Y,Nf=Object.create,Hf=Af.propertyIsEnumerable,Kf=Ef.splice,Jf=function(n,e){return t.setTimeout.call(Pe,n,e)},$f=wf.ceil,Vf=wf.floor,Xf=Object.getPrototypeOf,Gf=t.isFinite,Zf=Ef.join,Yf=Object.keys,Qf=wf.max,ts=wf.min,ns=t.parseInt,es=wf.random,rs=Sf.replace,is=Ef.reverse,os=Sf.split,as=Wi(t,"DataView"),us=Wi(t,"Map"),cs=Wi(t,"Promise"),fs=Wi(t,"Set"),ss=Wi(t,"WeakMap"),ls=Wi(Object,"create"),ps=ss&&new ss,hs=!Hf.call({valueOf:1},"valueOf"),ds={},vs=so(as),ms=so(us),gs=so(cs),ys=so(fs),_s=so(ss),xs=Wf?Wf.prototype:Y,ws=xs?xs.valueOf:Y,bs=xs?xs.toString:Y;n.templateSettings={escape:pn,evaluate:hn,interpolate:dn,variable:"",imports:{_:n}},n.prototype=e.prototype,n.prototype.constructor=n,r.prototype=Me(e.prototype),r.prototype.constructor=r,i.prototype=Me(e.prototype),i.prototype.constructor=i,Wn.prototype.clear=Dn,Wn.prototype["delete"]=Ln,Wn.prototype.get=Pn,Wn.prototype.has=qn,Wn.prototype.set=Nn,Hn.prototype.clear=Kn,Hn.prototype["delete"]=Jn,Hn.prototype.get=$n,Hn.prototype.has=Vn,Hn.prototype.set=Xn,Gn.prototype.clear=Zn,Gn.prototype["delete"]=Yn,Gn.prototype.get=Qn,Gn.prototype.has=te,Gn.prototype.set=ne,ee.prototype.add=ee.prototype.push=re,ee.prototype.has=ie,oe.prototype.clear=ae,oe.prototype["delete"]=ue,oe.prototype.get=ce,oe.prototype.has=fe,oe.prototype.set=se;var ks=ui(Ne),Es=ui(He,!0),As=ci(),Ss=ci(!0);Lf&&!Hf.call({valueOf:1},"valueOf")&&(ur=function(t){return N(Lf(t))});var js=ps?function(t,n){return ps.set(t,n),t}:Jc,Cs=fs&&1/J(new fs([,-0]))[1]==kt?function(t){return new fs(t)}:Yc,zs=ps?function(t){return ps.get(t)}:Yc,Ms=yr("length");Pf||(Li=ef);var Os=Pf?function(t){for(var n=[];t;)m(n,Li(t)),t=Di(t);return n}:Li;(as&&Pi(new as(new ArrayBuffer(1)))!=Vt||us&&Pi(new us)!=Ft||cs&&Pi(cs.resolve())!=Lt||fs&&Pi(new fs)!=qt||ss&&Pi(new ss)!=Kt)&&(Pi=function(t){var n=If.call(t),e=n==Dt?t.constructor:Y,r=e?so(e):Y;if(r)switch(r){case vs:return Vt;case ms:return Ft;case gs:return Lt;case ys:return qt;case _s:return Kt}return n});var Bs=jf?du:rf,Is=function(){var t=0,n=0;return function(e,r){var i=Ra(),o=_t-(i-n);if(n=i,o>0){if(++t>=yt)return e}else t=0;return js(e,r)}}(),Rs=qa(function(t){var n=[];return Hu(t).replace(gn,function(t,e,r,i){n.push(r?i.replace(En,"$1"):e||t)}),n}),Us=Ka(function(t,n){return ou(t)?Be(t,Le(n,1,ou,!0)):[]}),Ts=Ka(function(t,n){var e=Oo(n);return ou(e)&&(e=Y),ou(t)?Be(t,Le(n,1,ou,!0),Ui(e)):[]}),Fs=Ka(function(t,n){var e=Oo(n);return ou(e)&&(e=Y),ou(t)?Be(t,Le(n,1,ou,!0),Y,e):[]}),Ws=Ka(function(t){var n=v(t,Lr);return n.length&&n[0]===t[0]?Ye(n):[]}),Ds=Ka(function(t){var n=Oo(t),e=v(t,Lr);return n===Oo(e)?n=Y:e.pop(),e.length&&e[0]===t[0]?Ye(e,Ui(n)):[]}),Ls=Ka(function(t){var n=Oo(t),e=v(t,Lr);return n===Oo(e)?n=Y:e.pop(),e.length&&e[0]===t[0]?Ye(e,Y,n):[]}),Ps=Ka(Ro),qs=Ka(function(t,n){n=Le(n,1);var e=t?t.length:0,r=ge(t,n);return wr(t,v(n,function(t){return Gi(t,e)?+t:t}).sort(Yr)),r}),Ns=Ka(function(t){return Ir(Le(t,1,ou,!0))}),Hs=Ka(function(t){var n=Oo(t);return ou(n)&&(n=Y),Ir(Le(t,1,ou,!0),Ui(n))}),Ks=Ka(function(t){var n=Oo(t);return ou(n)&&(n=Y),Ir(Le(t,1,ou,!0),Y,n)}),Js=Ka(function(t,n){return ou(t)?Be(t,n):[]}),$s=Ka(function(t){return Wr(p(t,ou))}),Vs=Ka(function(t){var n=Oo(t);return ou(n)&&(n=Y),Wr(p(t,ou),Ui(n))}),Xs=Ka(function(t){var n=Oo(t);return ou(n)&&(n=Y),Wr(p(t,ou),Y,n)}),Gs=Ka(ea),Zs=Ka(function(t){var n=t.length,e=n>1?t[n-1]:Y;return e="function"==typeof e?(t.pop(),\ne):Y,ra(t,e)}),Ys=Ka(function(t){t=Le(t,1);var n=t.length,e=n?t[0]:0,o=this.__wrapped__,a=function(n){return ge(n,t)};return!(n>1||this.__actions__.length)&&o instanceof i&&Gi(e)?(o=o.slice(e,+e+(n?1:0)),o.__actions__.push({func:ca,args:[a],thisArg:Y}),new r(o,this.__chain__).thru(function(t){return n&&!t.length&&t.push(Y),t})):this.thru(a)}),Qs=oi(function(t,n,e){Mf.call(t,e)?++t[e]:t[e]=1}),tl=di(wo),nl=di(bo),el=oi(function(t,n,e){Mf.call(t,e)?t[e].push(n):t[e]=[n]}),rl=Ka(function(t,n,e){var r=-1,i="function"==typeof n,o=Yi(n),a=iu(t)?Array(t.length):[];return ks(t,function(t){var c=i?n:o&&null!=t?t[n]:Y;a[++r]=c?u(c,t,e):tr(t,n,e)}),a}),il=oi(function(t,n,e){t[e]=n}),ol=oi(function(t,n,e){t[e?0:1].push(n)},function(){return[[],[]]}),al=Ka(function(t,n){if(null==t)return[];var e=n.length;return e>1&&Zi(t,n[0],n[1])?n=[]:e>2&&Zi(n[0],n[1],n[2])&&(n=[n[0]]),n=1==n.length&&gl(n[0])?n[0]:Le(n,1,Xi),vr(t,n,[])}),ul=Ka(function(t,n,e){var r=it;if(e.length){var i=K(e,Ri(ul));r|=ft}return ji(t,r,n,e,i)}),cl=Ka(function(t,n,e){var r=it|ot;if(e.length){var i=K(e,Ri(cl));r|=ft}return ji(n,r,t,e,i)}),fl=Ka(function(t,n){return Oe(t,1,n)}),sl=Ka(function(t,n,e){return Oe(t,Pu(n)||0,e)});qa.Cache=Gn;var ll=Ka(function(t,n){n=1==n.length&&gl(n[0])?v(n[0],M(Ui())):v(Le(n,1,Xi),M(Ui()));var e=n.length;return Ka(function(r){for(var i=-1,o=ts(r.length,e);++i<o;)r[i]=n[i].call(this,r[i]);return u(t,this,r)})}),pl=Ka(function(t,n){var e=K(n,Ri(pl));return ji(t,ft,Y,n,e)}),hl=Ka(function(t,n){var e=K(n,Ri(hl));return ji(t,st,Y,n,e)}),dl=Ka(function(t,n){return ji(t,pt,Y,Y,Y,Le(n,1))}),vl=ki(Ve),ml=ki(function(t,n){return t>=n}),gl=Array.isArray,yl=Tf?function(t){return t instanceof Tf}:rf,_l=ki(cr),xl=ki(function(t,n){return t<=n}),wl=ai(function(t,n){if(hs||eo(n)||iu(n))return void ri(n,rc(n),t);for(var e in n)Mf.call(n,e)&&he(t,e,n[e])}),bl=ai(function(t,n){if(hs||eo(n)||iu(n))return void ri(n,ic(n),t);for(var e in n)he(t,e,n[e])}),kl=ai(function(t,n,e,r){ri(n,ic(n),t,r)}),El=ai(function(t,n,e,r){ri(n,rc(n),t,r)}),Al=Ka(function(t,n){return ge(t,Le(n,1))}),Sl=Ka(function(t){return t.push(Y,le),u(kl,Y,t)}),jl=Ka(function(t){return t.push(Y,ao),u(Bl,Y,t)}),Cl=gi(function(t,n,e){t[n]=e},Kc(Jc)),zl=gi(function(t,n,e){Mf.call(t,n)?t[n].push(e):t[n]=[e]},Ui),Ml=Ka(tr),Ol=ai(function(t,n,e){pr(t,n,e)}),Bl=ai(function(t,n,e,r){pr(t,n,e,r)}),Il=Ka(function(t,n){return null==t?{}:(n=v(Le(n,1),fo),mr(t,Be(Bi(t),n)))}),Rl=Ka(function(t,n){return null==t?{}:mr(t,v(Le(n,1),fo))}),Ul=Si(rc),Tl=Si(ic),Fl=li(function(t,n,e){return n=n.toLowerCase(),t+(e?wc(n):n)}),Wl=li(function(t,n,e){return t+(e?"-":"")+n.toLowerCase()}),Dl=li(function(t,n,e){return t+(e?" ":"")+n.toLowerCase()}),Ll=si("toLowerCase"),Pl=li(function(t,n,e){return t+(e?"_":"")+n.toLowerCase()}),ql=li(function(t,n,e){return t+(e?" ":"")+Hl(n)}),Nl=li(function(t,n,e){return t+(e?" ":"")+n.toUpperCase()}),Hl=si("toUpperCase"),Kl=Ka(function(t,n){try{return u(t,Y,n)}catch(e){return pu(e)?e:new xf(e)}}),Jl=Ka(function(t,n){return f(Le(n,1),function(n){n=fo(n),t[n]=ul(t[n],t)}),t}),$l=vi(),Vl=vi(!0),Xl=Ka(function(t,n){return function(e){return tr(e,t,n)}}),Gl=Ka(function(t,n){return function(e){return tr(t,e,n)}}),Zl=_i(v),Yl=_i(l),Ql=_i(_),tp=bi(),np=bi(!0),ep=yi(function(t,n){return t+n}),rp=Ai("ceil"),ip=yi(function(t,n){return t/n}),op=Ai("floor"),ap=yi(function(t,n){return t*n}),up=Ai("round"),cp=yi(function(t,n){return t-n});return n.after=Ua,n.ary=Ta,n.assign=wl,n.assignIn=bl,n.assignInWith=kl,n.assignWith=El,n.at=Al,n.before=Fa,n.bind=ul,n.bindAll=Jl,n.bindKey=cl,n.castArray=Ga,n.chain=aa,n.chunk=po,n.compact=ho,n.concat=vo,n.cond=Nc,n.conforms=Hc,n.constant=Kc,n.countBy=Qs,n.create=Ku,n.curry=Wa,n.curryRight=Da,n.debounce=La,n.defaults=Sl,n.defaultsDeep=jl,n.defer=fl,n.delay=sl,n.difference=Us,n.differenceBy=Ts,n.differenceWith=Fs,n.drop=mo,n.dropRight=go,n.dropRightWhile=yo,n.dropWhile=_o,n.fill=xo,n.filter=ga,n.flatMap=ya,n.flatMapDeep=_a,n.flatMapDepth=xa,n.flatten=ko,n.flattenDeep=Eo,n.flattenDepth=Ao,n.flip=Pa,n.flow=$l,n.flowRight=Vl,n.fromPairs=So,n.functions=Yu,n.functionsIn=Qu,n.groupBy=el,n.initial=zo,n.intersection=Ws,n.intersectionBy=Ds,n.intersectionWith=Ls,n.invert=Cl,n.invertBy=zl,n.invokeMap=rl,n.iteratee=$c,n.keyBy=il,n.keys=rc,n.keysIn=ic,n.map=Ea,n.mapKeys=oc,n.mapValues=ac,n.matches=Vc,n.matchesProperty=Xc,n.memoize=qa,n.merge=Ol,n.mergeWith=Bl,n.method=Xl,n.methodOf=Gl,n.mixin=Gc,n.negate=Na,n.nthArg=Qc,n.omit=Il,n.omitBy=uc,n.once=Ha,n.orderBy=Aa,n.over=Zl,n.overArgs=ll,n.overEvery=Yl,n.overSome=Ql,n.partial=pl,n.partialRight=hl,n.partition=ol,n.pick=Rl,n.pickBy=cc,n.property=tf,n.propertyOf=nf,n.pull=Ps,n.pullAll=Ro,n.pullAllBy=Uo,n.pullAllWith=To,n.pullAt=qs,n.range=tp,n.rangeRight=np,n.rearg=dl,n.reject=Ca,n.remove=Fo,n.rest=Ka,n.reverse=Wo,n.sampleSize=Ma,n.set=sc,n.setWith=lc,n.shuffle=Oa,n.slice=Do,n.sortBy=al,n.sortedUniq=Jo,n.sortedUniqBy=$o,n.split=Bc,n.spread=Ja,n.tail=Vo,n.take=Xo,n.takeRight=Go,n.takeRightWhile=Zo,n.takeWhile=Yo,n.tap=ua,n.throttle=$a,n.thru=ca,n.toArray=Fu,n.toPairs=Ul,n.toPairsIn=Tl,n.toPath=ff,n.toPlainObject=qu,n.transform=pc,n.unary=Va,n.union=Ns,n.unionBy=Hs,n.unionWith=Ks,n.uniq=Qo,n.uniqBy=ta,n.uniqWith=na,n.unset=hc,n.unzip=ea,n.unzipWith=ra,n.update=dc,n.updateWith=vc,n.values=mc,n.valuesIn=gc,n.without=Js,n.words=qc,n.wrap=Xa,n.xor=$s,n.xorBy=Vs,n.xorWith=Xs,n.zip=Gs,n.zipObject=ia,n.zipObjectDeep=oa,n.zipWith=Zs,n.entries=Ul,n.entriesIn=Tl,n.extend=bl,n.extendWith=kl,Gc(n,n),n.add=ep,n.attempt=Kl,n.camelCase=Fl,n.capitalize=wc,n.ceil=rp,n.clamp=yc,n.clone=Za,n.cloneDeep=Qa,n.cloneDeepWith=tu,n.cloneWith=Ya,n.deburr=bc,n.divide=ip,n.endsWith=kc,n.eq=nu,n.escape=Ec,n.escapeRegExp=Ac,n.every=ma,n.find=tl,n.findIndex=wo,n.findKey=Ju,n.findLast=nl,n.findLastIndex=bo,n.findLastKey=$u,n.floor=op,n.forEach=wa,n.forEachRight=ba,n.forIn=Vu,n.forInRight=Xu,n.forOwn=Gu,n.forOwnRight=Zu,n.get=tc,n.gt=vl,n.gte=ml,n.has=nc,n.hasIn=ec,n.head=jo,n.identity=Jc,n.includes=ka,n.indexOf=Co,n.inRange=_c,n.invoke=Ml,n.isArguments=eu,n.isArray=gl,n.isArrayBuffer=ru,n.isArrayLike=iu,n.isArrayLikeObject=ou,n.isBoolean=au,n.isBuffer=yl,n.isDate=uu,n.isElement=cu,n.isEmpty=fu,n.isEqual=su,n.isEqualWith=lu,n.isError=pu,n.isFinite=hu,n.isFunction=du,n.isInteger=vu,n.isLength=mu,n.isMap=_u,n.isMatch=xu,n.isMatchWith=wu,n.isNaN=bu,n.isNative=ku,n.isNil=Au,n.isNull=Eu,n.isNumber=Su,n.isObject=gu,n.isObjectLike=yu,n.isPlainObject=ju,n.isRegExp=Cu,n.isSafeInteger=zu,n.isSet=Mu,n.isString=Ou,n.isSymbol=Bu,n.isTypedArray=Iu,n.isUndefined=Ru,n.isWeakMap=Uu,n.isWeakSet=Tu,n.join=Mo,n.kebabCase=Wl,n.last=Oo,n.lastIndexOf=Bo,n.lowerCase=Dl,n.lowerFirst=Ll,n.lt=_l,n.lte=xl,n.max=lf,n.maxBy=pf,n.mean=hf,n.meanBy=df,n.min=vf,n.minBy=mf,n.stubArray=ef,n.stubFalse=rf,n.stubObject=of,n.stubString=af,n.stubTrue=uf,n.multiply=ap,n.nth=Io,n.noConflict=Zc,n.noop=Yc,n.now=Ra,n.pad=Sc,n.padEnd=jc,n.padStart=Cc,n.parseInt=zc,n.random=xc,n.reduce=Sa,n.reduceRight=ja,n.repeat=Mc,n.replace=Oc,n.result=fc,n.round=up,n.runInContext=Z,n.sample=za,n.size=Ba,n.snakeCase=Pl,n.some=Ia,n.sortedIndex=Lo,n.sortedIndexBy=Po,n.sortedIndexOf=qo,n.sortedLastIndex=No,n.sortedLastIndexBy=Ho,n.sortedLastIndexOf=Ko,n.startCase=ql,n.startsWith=Ic,n.subtract=cp,n.sum=gf,n.sumBy=yf,n.template=Rc,n.times=cf,n.toFinite=Wu,n.toInteger=Du,n.toLength=Lu,n.toLower=Uc,n.toNumber=Pu,n.toSafeInteger=Nu,n.toString=Hu,n.toUpper=Tc,n.trim=Fc,n.trimEnd=Wc,n.trimStart=Dc,n.truncate=Lc,n.unescape=Pc,n.uniqueId=sf,n.upperCase=Nl,n.upperFirst=Hl,n.each=wa,n.eachRight=ba,n.first=jo,Gc(n,function(){var t={};return Ne(n,function(e,r){Mf.call(n.prototype,r)||(t[r]=e)}),t}(),{chain:!1}),n.VERSION=Q,f(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){n[t].placeholder=n}),f(["drop","take"],function(t,n){i.prototype[t]=function(e){var r=this.__filtered__;if(r&&!n)return new i(this);e=e===Y?1:Qf(Du(e),0);var o=this.clone();return r?o.__takeCount__=ts(e,o.__takeCount__):o.__views__.push({size:ts(e,jt),type:t+(o.__dir__<0?"Right":"")}),o},i.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),f(["filter","map","takeWhile"],function(t,n){var e=n+1,r=e==xt||e==bt;i.prototype[t]=function(t){var n=this.clone();return n.__iteratees__.push({iteratee:Ui(t,3),type:e}),n.__filtered__=n.__filtered__||r,n}}),f(["head","last"],function(t,n){var e="take"+(n?"Right":"");i.prototype[t]=function(){return this[e](1).value()[0]}}),f(["initial","tail"],function(t,n){var e="drop"+(n?"":"Right");i.prototype[t]=function(){return this.__filtered__?new i(this):this[e](1)}}),i.prototype.compact=function(){return this.filter(Jc)},i.prototype.find=function(t){return this.filter(t).head()},i.prototype.findLast=function(t){return this.reverse().find(t)},i.prototype.invokeMap=Ka(function(t,n){return"function"==typeof t?new i(this):this.map(function(e){return tr(e,t,n)})}),i.prototype.reject=function(t){return t=Ui(t,3),this.filter(function(n){return!t(n)})},i.prototype.slice=function(t,n){t=Du(t);var e=this;return e.__filtered__&&(t>0||n<0)?new i(e):(t<0?e=e.takeRight(-t):t&&(e=e.drop(t)),n!==Y&&(n=Du(n),e=n<0?e.dropRight(-n):e.take(n-t)),e)},i.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},i.prototype.toArray=function(){return this.take(jt)},Ne(i.prototype,function(t,e){var o=/^(?:filter|find|map|reject)|While$/.test(e),a=/^(?:head|last)$/.test(e),u=n[a?"take"+("last"==e?"Right":""):e],c=a||/^find/.test(e);u&&(n.prototype[e]=function(){var e=this.__wrapped__,f=a?[1]:arguments,s=e instanceof i,l=f[0],p=s||gl(e),h=function(t){var e=u.apply(n,m([t],f));return a&&d?e[0]:e};p&&o&&"function"==typeof l&&1!=l.length&&(s=p=!1);var d=this.__chain__,v=!!this.__actions__.length,g=c&&!d,y=s&&!v;if(!c&&p){e=y?e:new i(this);var _=t.apply(e,f);return _.__actions__.push({func:ca,args:[h],thisArg:Y}),new r(_,d)}return g&&y?t.apply(this,f):(_=this.thru(h),g?a?_.value()[0]:_.value():_)})}),f(["pop","push","shift","sort","splice","unshift"],function(t){var e=Ef[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",i=/^(?:pop|shift)$/.test(t);n.prototype[t]=function(){var t=arguments;if(i&&!this.__chain__){var n=this.value();return e.apply(gl(n)?n:[],t)}return this[r](function(n){return e.apply(gl(n)?n:[],t)})}}),Ne(i.prototype,function(t,e){var r=n[e];if(r){var i=r.name+"",o=ds[i]||(ds[i]=[]);o.push({name:e,func:r})}}),ds[mi(Y,ot).name]=[{name:"wrapper",func:Y}],i.prototype.clone=U,i.prototype.reverse=Tn,i.prototype.value=Fn,n.prototype.at=Ys,n.prototype.chain=fa,n.prototype.commit=sa,n.prototype.next=la,n.prototype.plant=ha,n.prototype.reverse=da,n.prototype.toJSON=n.prototype.valueOf=n.prototype.value=va,qf&&(n.prototype[qf]=pa),n}var Y,Q="4.13.1",tt=200,nt="Expected a function",et="__lodash_hash_undefined__",rt="__lodash_placeholder__",it=1,ot=2,at=4,ut=8,ct=16,ft=32,st=64,lt=128,pt=256,ht=512,dt=1,vt=2,mt=30,gt="...",yt=150,_t=16,xt=1,wt=2,bt=3,kt=1/0,Et=9007199254740991,At=1.7976931348623157e308,St=NaN,jt=4294967295,Ct=jt-1,zt=jt>>>1,Mt="[object Arguments]",Ot="[object Array]",Bt="[object Boolean]",It="[object Date]",Rt="[object Error]",Ut="[object Function]",Tt="[object GeneratorFunction]",Ft="[object Map]",Wt="[object Number]",Dt="[object Object]",Lt="[object Promise]",Pt="[object RegExp]",qt="[object Set]",Nt="[object String]",Ht="[object Symbol]",Kt="[object WeakMap]",Jt="[object WeakSet]",$t="[object ArrayBuffer]",Vt="[object DataView]",Xt="[object Float32Array]",Gt="[object Float64Array]",Zt="[object Int8Array]",Yt="[object Int16Array]",Qt="[object Int32Array]",tn="[object Uint8Array]",nn="[object Uint8ClampedArray]",en="[object Uint16Array]",rn="[object Uint32Array]",on=/\\b__p \\+= \'\';/g,an=/\\b(__p \\+=) \'\' \\+/g,un=/(__e\\(.*?\\)|\\b__t\\)) \\+\\n\'\';/g,cn=/&(?:amp|lt|gt|quot|#39|#96);/g,fn=/[&<>"\'`]/g,sn=RegExp(cn.source),ln=RegExp(fn.source),pn=/<%-([\\s\\S]+?)%>/g,hn=/<%([\\s\\S]+?)%>/g,dn=/<%=([\\s\\S]+?)%>/g,vn=/\\.|\\[(?:[^[\\]]*|(["\'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,mn=/^\\w*$/,gn=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(\\.|\\[\\])(?:\\4|$))/g,yn=/[\\\\^$.*+?()[\\]{}|]/g,_n=RegExp(yn.source),xn=/^\\s+|\\s+$/g,wn=/^\\s+/,bn=/\\s+$/,kn=/[a-zA-Z0-9]+/g,En=/\\\\(\\\\)?/g,An=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g,Sn=/\\w*$/,jn=/^0x/i,Cn=/^[-+]0x[0-9a-f]+$/i,zn=/^0b[01]+$/i,Mn=/^\\[object .+?Constructor\\]$/,On=/^0o[0-7]+$/i,Bn=/^(?:0|[1-9]\\d*)$/,In=/[\\xc0-\\xd6\\xd8-\\xde\\xdf-\\xf6\\xf8-\\xff]/g,Rn=/($^)/,Un=/[\'\\n\\r\\u2028\\u2029\\\\]/g,Tn="\\\\ud800-\\\\udfff",Fn="\\\\u0300-\\\\u036f\\\\ufe20-\\\\ufe23",Wn="\\\\u20d0-\\\\u20f0",Dn="\\\\u2700-\\\\u27bf",Ln="a-z\\\\xdf-\\\\xf6\\\\xf8-\\\\xff",Pn="\\\\xac\\\\xb1\\\\xd7\\\\xf7",qn="\\\\x00-\\\\x2f\\\\x3a-\\\\x40\\\\x5b-\\\\x60\\\\x7b-\\\\xbf",Nn="\\\\u2000-\\\\u206f",Hn=" \\\\t\\\\x0b\\\\f\\\\xa0\\\\ufeff\\\\n\\\\r\\\\u2028\\\\u2029\\\\u1680\\\\u180e\\\\u2000\\\\u2001\\\\u2002\\\\u2003\\\\u2004\\\\u2005\\\\u2006\\\\u2007\\\\u2008\\\\u2009\\\\u200a\\\\u202f\\\\u205f\\\\u3000",Kn="A-Z\\\\xc0-\\\\xd6\\\\xd8-\\\\xde",Jn="\\\\ufe0e\\\\ufe0f",$n=Pn+qn+Nn+Hn,Vn="[\']",Xn="["+Tn+"]",Gn="["+$n+"]",Zn="["+Fn+Wn+"]",Yn="\\\\d+",Qn="["+Dn+"]",te="["+Ln+"]",ne="[^"+Tn+$n+Yn+Dn+Ln+Kn+"]",ee="\\\\ud83c[\\\\udffb-\\\\udfff]",re="(?:"+Zn+"|"+ee+")",ie="[^"+Tn+"]",oe="(?:\\\\ud83c[\\\\udde6-\\\\uddff]){2}",ae="[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]",ue="["+Kn+"]",ce="\\\\u200d",fe="(?:"+te+"|"+ne+")",se="(?:"+ue+"|"+ne+")",le="(?:"+Vn+"(?:d|ll|m|re|s|t|ve))?",pe="(?:"+Vn+"(?:D|LL|M|RE|S|T|VE))?",he=re+"?",de="["+Jn+"]?",ve="(?:"+ce+"(?:"+[ie,oe,ae].join("|")+")"+de+he+")*",me=de+he+ve,ge="(?:"+[Qn,oe,ae].join("|")+")"+me,ye="(?:"+[ie+Zn+"?",Zn,oe,ae,Xn].join("|")+")",_e=RegExp(Vn,"g"),xe=RegExp(Zn,"g"),we=RegExp(ee+"(?="+ee+")|"+ye+me,"g"),be=RegExp([ue+"?"+te+"+"+le+"(?="+[Gn,ue,"$"].join("|")+")",se+"+"+pe+"(?="+[Gn,ue+fe,"$"].join("|")+")",ue+"?"+fe+"+"+le,ue+"+"+pe,Yn,ge].join("|"),"g"),ke=RegExp("["+ce+Tn+Fn+Wn+Jn+"]"),Ee=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ae=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","isFinite","parseInt","setTimeout"],Se=-1,je={};je[Xt]=je[Gt]=je[Zt]=je[Yt]=je[Qt]=je[tn]=je[nn]=je[en]=je[rn]=!0,je[Mt]=je[Ot]=je[$t]=je[Bt]=je[Vt]=je[It]=je[Rt]=je[Ut]=je[Ft]=je[Wt]=je[Dt]=je[Pt]=je[qt]=je[Nt]=je[Kt]=!1;var Ce={};Ce[Mt]=Ce[Ot]=Ce[$t]=Ce[Vt]=Ce[Bt]=Ce[It]=Ce[Xt]=Ce[Gt]=Ce[Zt]=Ce[Yt]=Ce[Qt]=Ce[Ft]=Ce[Wt]=Ce[Dt]=Ce[Pt]=Ce[qt]=Ce[Nt]=Ce[Ht]=Ce[tn]=Ce[nn]=Ce[en]=Ce[rn]=!0,Ce[Rt]=Ce[Ut]=Ce[Kt]=!1;var ze={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"},Me={"&":"&amp;","<":"&lt;",">":"&gt;",\'"\':"&quot;","\'":"&#39;","`":"&#96;"},Oe={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":\'"\',"&#39;":"\'","&#96;":"`"},Be={"\\\\":"\\\\","\'":"\'","\\n":"n","\\r":"r","\\u2028":"u2028","\\u2029":"u2029"},Ie=parseFloat,Re=parseInt,Ue="object"==typeof n&&n,Te=Ue&&"object"==typeof t&&t,Fe=Te&&Te.exports===Ue,We=U("object"==typeof i&&i),De=U("object"==typeof self&&self),Le=U("object"==typeof this&&this),Pe=We||De||Le||Function("return this")(),qe=Z();(De||{})._=qe,r=function(){return qe}.call(n,e,n,t),!(r!==Y&&(t.exports=r))}).call(this)}).call(n,e(71)(t),function(){return this}())},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){return CryptoJS.lib.WordArray.create(new Uint8Array(t))}function o(t,n){return t instanceof ArrayBuffer||t instanceof Uint8Array||(t=new Uint8Array(t)),n instanceof ArrayBuffer||n instanceof Uint8Array||(n=new Uint8Array(n)),l.build(t,n).readBuffer()}var a=e(34),u=r(a),c=e(10),f=e(32),s=e(11),l=e(33),p=e(30),h={image:"WhatsApp Image Keys",video:"WhatsApp Video Keys",audio:"WhatsApp Audio Keys",ptt:"WhatsApp Audio Keys",document:"WhatsApp Document Keys"},d={decryptE2EMediaWithWebCrypto:function(t,n,e,r){if(n.length<10)throw new c.MediaEncryptionError("ciphertext too short: "+n.length);var i=this.computeKeys(t,e),a=i.iv,u=i.cipherKey,f=i.macKey,l={name:"HMAC",hash:{name:"SHA-256"}},h={name:"AES-CBC",iv:new Uint8Array(a)};return this.getWebCrypto().then(function(e){var i=s.encode(n.slice(-10)),d=n.slice(0,-10),v=o(a,d);return e.importKey("raw",new Uint8Array(f),l,!1,["sign"]).then(function(t){return e.sign(l,t,v)}).then(function(t){var n=s.encode(new Uint8Array(t)),e=s.encode(s.decode(n).slice(0,10));if(!e||!i||e!==i)throw new c.MediaEncryptionError("hmac fail computed: "+e+" given: "+i)}).then(function(){return e.importKey("raw",new Uint8Array(u),h,!1,["decrypt"])}).then(function(t){return e.decrypt(h,t,d)}).then(function(n){return new Blob([n],{type:p.getMediaMimeType(t,n,r)})})})["catch"](c.MediaEncryptionError,function(t){throw t})["catch"](function(t){return!(t instanceof c.MediaEncryptionError)},function(t){throw new c.MediaEncryptionError("encryption error: "+t+"; stack: "+t.stack)})},encryptE2EMediaWithWebCrypto:function(t,n,e){var r=this.computeKeys(t,e),i=r.iv,a=r.cipherKey,u=r.macKey,f={name:"HMAC",hash:{name:"SHA-256"}},s={name:"AES-CBC",iv:new Uint8Array(i)};return this.getWebCrypto().then(function(t){return t.importKey("raw",new Uint8Array(a),s,!1,["encrypt"]).then(function(e){return t.encrypt(s,e,n)}).then(function(n){var e=o(i,n);return t.importKey("raw",new Uint8Array(u),f,!1,["sign"]).then(function(n){return t.sign(f,n,e)}).then(function(t){var e=t.slice(0,10),r=o(n,e);return new Blob([r])})})})["catch"](c.MediaEncryptionError,function(t){throw t})["catch"](function(t){return!(t instanceof c.MediaEncryptionError)},function(t){throw new c.MediaEncryptionError("encryption error: "+t+"; stack: "+t.stack)})},decryptE2EMediaWithCryptoJS:function(t,n,e,r){try{if(n.length<10)throw new c.MediaEncryptionError("ciphertext too short: "+n.length);var a=this.computeKeys(t,e),u=a.iv,f=a.cipherKey,l=a.macKey,h=s.encode(n.slice(-10)),d=n.slice(0,-10),v=o(u,d),m=CryptoJS.lib.WordArray.create(v),g=CryptoJS.HmacSHA256(m,i(l)).toString(CryptoJS.enc.Base64),y=s.encode(s.decode(g).slice(0,10));if(!y||!h||y!==h)throw new c.MediaEncryptionError("hmac fail computed: "+y+" given: "+h);var _=CryptoJS.AES.decrypt({ciphertext:CryptoJS.lib.WordArray.create(d),salt:void 0},i(f),{iv:i(u),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),x=s.decode(_.toString(CryptoJS.enc.Base64));return new Blob([x],{type:p.getMediaMimeType(t,x,r)})}catch(w){throw w instanceof c.MediaEncryptionError?w:new c.MediaEncryptionError("unknown decrypt error: "+w+" stack: "+w.stack)}},encryptE2EMediaWithCryptoJS:function(t,n,e){try{var r=this.computeKeys(t,e),o=r.iv,a=r.cipherKey,u=r.macKey,f=CryptoJS.AES.encrypt(CryptoJS.lib.WordArray.create(n),i(a),{iv:i(o),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),l=f.iv.concat(f.ciphertext),p=CryptoJS.HmacSHA256(l,i(u));p.sigBytes=10,p.clamp();var h=f.ciphertext.concat(p),d=s.decode(h.toString(CryptoJS.enc.Base64));return new Blob([d])}catch(v){throw v instanceof c.MediaEncryptionError?v:new c.MediaEncryptionError("unknown encrypt error: "+v+" stack: "+v.stack)}},computeKeys:function(t,n){var e=h[t];if(!n||!e)throw new c.MediaEncryptionError("computeKeys fail: !!mediakey: "+!!n+" info: "+e+" type: "+t);var r=f.extractAndExpand(s.decode(n),void 0,e,112,!0);if(!r||r.length<112)throw new c.MediaEncryptionError("computeKeys:hkdf error");return{iv:r.slice(0,16),cipherKey:r.slice(16,48),macKey:r.slice(48,80),refKey:r.slice(80,112)}},getWebCryptoObject:function(){return new u["default"](function(t,n){var e=window.crypto||window.msCrypto;e?t(e):n("browser doesn\'t support crypto")})},getWebCrypto:function(){return this.getWebCryptoObject().then(function(t){var n=t.subtle||t.webkitSubtle;return n?n:u["default"].reject("browser doesn\'t support crypto.subtle")})}};t.exports=d},function(t,n,e){!function(r,i,o){t.exports=n=i(e(0),e(9),e(66),e(65),e(64))}(this,function(t){return function(){var n=t,e=n.lib,r=e.BlockCipher,i=n.algo,o=[],a=[],u=[],c=[],f=[],s=[],l=[],p=[],h=[],d=[];!function(){for(var t=[],n=0;n<256;n++)n<128?t[n]=n<<1:t[n]=n<<1^283;for(var e=0,r=0,n=0;n<256;n++){var i=r^r<<1^r<<2^r<<3^r<<4;i=i>>>8^255&i^99,o[e]=i,a[i]=e;var v=t[e],m=t[v],g=t[m],y=257*t[i]^16843008*i;u[e]=y<<24|y>>>8,c[e]=y<<16|y>>>16,f[e]=y<<8|y>>>24,s[e]=y;var y=16843009*g^65537*m^257*v^16843008*e;l[i]=y<<24|y>>>8,p[i]=y<<16|y>>>16,h[i]=y<<8|y>>>24,d[i]=y,e?(e=v^t[t[t[g^v]]],r^=t[t[r]]):e=r=1}}();var v=[0,1,2,4,8,16,32,64,128,27,54],m=i.AES=r.extend({_doReset:function(){for(var t=this._key,n=t.words,e=t.sigBytes/4,r=this._nRounds=e+6,i=4*(r+1),a=this._keySchedule=[],u=0;u<i;u++)if(u<e)a[u]=n[u];else{var c=a[u-1];u%e?e>6&&u%e==4&&(c=o[c>>>24]<<24|o[c>>>16&255]<<16|o[c>>>8&255]<<8|o[255&c]):(c=c<<8|c>>>24,c=o[c>>>24]<<24|o[c>>>16&255]<<16|o[c>>>8&255]<<8|o[255&c],c^=v[u/e|0]<<24),a[u]=a[u-e]^c}for(var f=this._invKeySchedule=[],s=0;s<i;s++){var u=i-s;if(s%4)var c=a[u];else var c=a[u-4];s<4||u<=4?f[s]=c:f[s]=l[o[c>>>24]]^p[o[c>>>16&255]]^h[o[c>>>8&255]]^d[o[255&c]]}},encryptBlock:function(t,n){this._doCryptBlock(t,n,this._keySchedule,u,c,f,s,o)},decryptBlock:function(t,n){var e=t[n+1];t[n+1]=t[n+3],t[n+3]=e,this._doCryptBlock(t,n,this._invKeySchedule,l,p,h,d,a);var e=t[n+1];t[n+1]=t[n+3],t[n+3]=e},_doCryptBlock:function(t,n,e,r,i,o,a,u){for(var c=this._nRounds,f=t[n]^e[0],s=t[n+1]^e[1],l=t[n+2]^e[2],p=t[n+3]^e[3],h=4,d=1;d<c;d++){var v=r[f>>>24]^i[s>>>16&255]^o[l>>>8&255]^a[255&p]^e[h++],m=r[s>>>24]^i[l>>>16&255]^o[p>>>8&255]^a[255&f]^e[h++],g=r[l>>>24]^i[p>>>16&255]^o[f>>>8&255]^a[255&s]^e[h++],y=r[p>>>24]^i[f>>>16&255]^o[s>>>8&255]^a[255&l]^e[h++];f=v,s=m,l=g,p=y}var v=(u[f>>>24]<<24|u[s>>>16&255]<<16|u[l>>>8&255]<<8|u[255&p])^e[h++],m=(u[s>>>24]<<24|u[l>>>16&255]<<16|u[p>>>8&255]<<8|u[255&f])^e[h++],g=(u[l>>>24]<<24|u[p>>>16&255]<<16|u[f>>>8&255]<<8|u[255&s])^e[h++],y=(u[p>>>24]<<24|u[f>>>16&255]<<16|u[s>>>8&255]<<8|u[255&l])^e[h++];t[n]=v,t[n+1]=m,t[n+2]=g,t[n+3]=y},keySize:8});n.AES=r._createHelper(m)}(),t.AES})},function(t,n,e){!function(r,i,o){t.exports=n=i(e(0),e(68),e(23))}(this,function(t){return t.HmacSHA256})},function(t,n,e){!function(r,i){t.exports=n=i(e(0))}(this,function(t){return function(){if("function"==typeof ArrayBuffer){var n=t,e=n.lib,r=e.WordArray,i=r.init,o=r.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,e=[],r=0;r<n;r++)e[r>>>2]|=t[r]<<24-r%4*8;i.call(this,e,n)}else i.apply(this,arguments)};o.prototype=r}}(),t.lib.WordArray})},function(t,n,e){"use strict";function r(t,n,e,i){if(o.isArray(t)||o.isString(t)){o.isString(t)&&(t=[t]);for(var a=0;a<t.length;a++)n[t[a]]=i+e}else for(var u in t)r(t[u],n,u,i+e)}function i(t){var n;try{n=t?JSON.parse(t):a}catch(e){return null}var i={};return r(n,i,"",""),i}var o=e(24),a=e(70);t.exports=i},function(t,n,e){"use strict";function r(){return _.chain(u).pickBy(function(t,n){return"document"===t.msgType&&t.canSend}).keys().value().join(",")}var i=e(29),o=e(10),a=e(69),u={"text/plain":{ext:"TXT",msgType:"document",icon:"icon-doc-txt",canSend:!1},"text/rtf":{ext:"RTF",msgType:"document",icon:"icon-doc-doc",canSend:!1,signatureMimetype:"application/rtf"},"application/pdf":{ext:"PDF",msgType:"document",icon:"icon-doc-pdf",canSend:!0,signatureMimetype:"application/pdf",previewType:"pdf"},"application/msword":{ext:"DOC",msgType:"document",icon:"icon-doc-doc",canSend:!1,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-excel":{ext:"XLS",msgType:"document",icon:"icon-doc-xls",canSend:!1,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-powerpoint":{ext:"PPT",msgType:"document",icon:"icon-doc-ppt",canSend:!1,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:"DOCX",msgType:"document",icon:"icon-doc-doc",canSend:!1,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{ext:"PPTX",msgType:"document",icon:"icon-doc-ppt",canSend:!1,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{ext:"XLSX",msgType:"document",icon:"icon-doc-xls",canSend:!1,signatureMimetype:"application/zip",previewType:"msoffice"},"audio/aac":{msgType:"audio"},"audio/mp4":{msgType:"audio"},"audio/amr":{msgType:"audio"},"audio/mpeg":{msgType:"audio"},"audio/ogg; codecs=opus":{msgType:"audio"},"video/mp4":{msgType:"video"},"video/3gpp":{msgType:"video"},"image/jpeg":{msgType:"image"}},c={MIMETYPES:u,DOC_MIMES:r(),EXT_TO_MIME:i(),updateDocMimes:function(t){if("*"===t)c.DOC_MIMES="*";else if(_.isString(t)){var n=t.split(",");for(var e in u){var i=u[e];"document"===i.msgType&&(_.isString(i.ext)&&n.indexOf(i.ext.toLowerCase())>-1?i.canSend=!0:i.canSend=!1)}c.DOC_MIMES=r()}},isAllowedDocumentMimetype:function(t,n){var e=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];for(var r in u){var i=u[r];if("document"===i.msgType){var o=e?i.signatureMimetype:r;if(o===t&&i.canSend&&n&&n.toLowerCase().endsWith(i.ext.toLowerCase()))return r}}return!1},getExtension:function(t){var n=u[t];return n?"."+(n.ext||t.split("/")[1]).toLowerCase():""},previewType:function(t){var n=_.find(u,function(n,e){return n.previewType&&(e===t||n.signatureMimetype===t)});return n?n.previewType:void 0},getMediaMimeType:function(t,n,e){if(e)return e;var r=a(new Uint8Array(n,0,Math.min(262,n.byteLength)));if(r)return r.mime;if("image"===t)return"image/jpeg";throw new o.MediaEncryptionError("unknown mime decrypt error for type:"+t)}};t.exports=c},function(t,n,e){"use strict";function r(t){var n=t.data,e=n.type,r=n.buffer,i=n.mediaKey,a=n.mimetype;postMessage(o.decryptE2EMediaWithCryptoJS(e,r,i,a))}function i(t){var n=t.data,e=n.type,r=n.buffer,i=n.mediaKey;postMessage(o.encryptE2EMediaWithCryptoJS(e,r,i))}self.CryptoJS=e(0),e(28),e(9),e(27),e(26);var o=e(25);self.onmessage=function(t){switch(t.data.command){case"decrypt-e2e-media":r(t);break;case"encrypt-e2e-media":i(t);break;default:throw new Error("unknown crypto worker command: "+t.data.command)}}},function(t,n,e){"use strict";function r(t){return"string"==typeof t?t:CryptoJS.lib.WordArray.create(new Uint8Array(t))}function i(t,n){return c.decode(t.toString(CryptoJS.enc.Base64),!!n)}function o(t){var n=arguments.length<=1||void 0===arguments[1]?new Uint8Array(f):arguments[1],e=arguments[2];return i(CryptoJS.HmacSHA256(r(t),r(n)),e)}function a(t,n,e,o){if(e<0||e>255*f)return null;var a=r(t),u=r(n),c=Math.ceil(e/f),s=new Array(c+1);s[0]="";for(var l=new Uint8Array(1),p=0;p<c;p++){l[0]=p+1;var h=CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA256,a);h.update(s[p]),h.update(u),h.update(r(l)),s[p+1]=h.finalize()}for(var d=new Uint8Array(e),v=0,m=0;v<c;v++)for(var g=new Uint8Array(i(s[v+1])),y=0;y<f&&m<e;y++,m++)d[m]=g[y];return o?Array.prototype.slice.call(d):d.buffer}function u(t,n,e,r,i){return a(o(t,n),e,r,i)}var c=e(11),f=32;t.exports={extract:o,expand:a,extractAndExpand:u}},function(t,n){"use strict";function e(){var t=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0],n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];t instanceof ArrayBuffer&&(t=new Uint8Array(t)),"number"==typeof t?(this._buffer=new Uint8Array(t),this._readEndIndex=0):t instanceof ArrayBuffer?(this._buffer=new Uint8Array(t),this._readEndIndex=t.byteLength):t instanceof Uint8Array?(this._buffer=t,this._readEndIndex=t.length):(this._buffer=null,this._readEndIndex=0),this._readIndex=0,this._writeIndex=this._readEndIndex,this._view=null,this._littleEndian=!!n,this._hiddenWrites=0}function r(){for(var t=0,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];for(var a=0;a<r.length;a++){var u=r[a];"string"==typeof u?t+=i(u):"number"==typeof u?t++:u instanceof e?t+=u.size():u instanceof ArrayBuffer?t+=u.byteLength:u instanceof Uint8Array&&(t+=u.length)}var c=new e(t);return c.write.apply(c,r),c}function i(t){if(t===m)return g;for(var n=0,e=0;e<t.length;e++){var r=t.charCodeAt(e);r<128?n++:r<2048?n+=2:r<55296||57344<=r&&r<=65535?n+=3:(a(t,e,r),e++,n+=4)}return m=t,g=n}function o(t,n,e){t._hiddenWrites++;var r=t._writeIndex;try{n(t,e),r=t._writeIndex}finally{t._hiddenWrites--,t._writeIndex=r}}function a(t,n,e){if(e<55296||56320<=e)throw new TypeError("Invalid first surrogate at wchar-position "+n+\' in "\'+t+\'"\');if(++n===t.length)throw new TypeError(\'String ends with incomplete surrogate pair in "\'+t+\'"\');var r=t.charCodeAt(n);if(r<56320||57344<=r)throw new TypeError("Invalid second surrogate at wchar-position "+n+\' in "\'+t+\'"\')}function u(t,n,e,r){if("number"!=typeof t||t!==t||Math.floor(t)!==t||t<n||t>=e)throw new TypeError("string"==typeof t?\'WriteError: string "\'+t+\'" is not a valid \'+r:"WriteError: "+t+" is not a valid "+r)}function c(t){return t._view||(t._view=new DataView(t._buffer.buffer,t._buffer.byteOffset))}function f(t,n){if(n<0)throw new Error("ReadError: given negative number of bytes to read");var e=t._readIndex,r=e+n;if(r>t._readEndIndex)throw new Error(e===t._readEndIndex?"ReadError: tried to read from depleted binary":"ReadError: tried to read beyond end of binary");return t._readIndex=r,e}function s(t,n){var e=t._writeIndex,r=e+n,i=t._buffer;if(!i||r>i.length){var o=Math.max(r,i?2*i.length:64),a=new Uint8Array(o);i&&a.set(i),t._buffer=a,t._view=null}return t._writeIndex=r,t._hiddenWrites||(t._readEndIndex=r),e}function l(t,n,e){var r=f(e,8),i=c(e),o=i.getInt32(n?r+4:r,n),a=i.getInt32(n?r:r+4,n);return h(t,o,a)}function p(t,n,e){var r=s(e,8),i=t<0;i&&(t=-t);var o=Math.floor(t/4294967296),a=t-4294967296*o,u=c(e);if(u.setUint32(n?r+4:r,o,n),u.setUint32(n?r:r+4,a,n),i){for(var f=e._buffer,l=r;l<r+8;l++)f[l]=255&~f[l];var p=255;if(n)for(var h=r;h<r+8&&255===p;h++)p=f[h],f[h]=255===p?0:p+1;else for(var d=r+7;d>=r&&255===p;d--)p=f[d],f[d]=255===p?0:p+1}}function h(t,n,r){var i=n>>20,o=0===i||t&&i===-1,a=n>=0?n:t?n:4294967296+n,u=r>=0?r:4294967296+r,c=4294967296*a+u;return o?c:e.onLongLong(c,t,n,r)}var d=65533,v=new Uint8Array(10);e.prototype={size:function(){return this._readEndIndex-this._readIndex},peek:function(t){var n=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1],e=this._readIndex;try{return t(this,n)}finally{this._readIndex=e}},advance:function(t){f(this,t)},readUint8:function(){return this._buffer[f(this,1)]},readInt8:function(){var t=f(this,1);return c(this).getInt8(t)},readUint16:function(){var t=arguments.length<=0||void 0===arguments[0]?this._littleEndian:arguments[0],n=f(this,2);return c(this).getUint16(n,t)},readInt32:function(){var t=arguments.length<=0||void 0===arguments[0]?this._littleEndian:arguments[0],n=f(this,4);return c(this).getInt32(n,t)},readUint32:function(){var t=arguments.length<=0||void 0===arguments[0]?this._littleEndian:arguments[0],n=f(this,4);return c(this).getUint32(n,t)},readInt64:function(){var t=arguments.length<=0||void 0===arguments[0]?this._littleEndian:arguments[0];return l(!0,t,this)},readUint64:function(){var t=arguments.length<=0||void 0===arguments[0]?this._littleEndian:arguments[0];return l(!1,t,this)},readFloat32:function(){var t=arguments.length<=0||void 0===arguments[0]?this._littleEndian:arguments[0],n=f(this,4);return c(this).getFloat32(n,t)},readFloat64:function(){var t=arguments.length<=0||void 0===arguments[0]?this._littleEndian:arguments[0],n=f(this,8);return c(this).getFloat64(n,t)},readVarInt:function(){var t=this._readIndex,n=this._readEndIndex-t,e=this._buffer;\nn<=0&&f(this,1);var r=void 0,i=e[t];for(r=1;r<n&&r<11&&128&i;r++)i=e[t+r];var o=r;if(o>10||10===o&&e[t+9]>1)throw new Error("ParseError: varint exceeds 64 bits");128&i&&f(this,o+1),f(this,o);var a=0,u=0;for(r=0;r<3&&r<o;r++,u+=7)a|=(127&e[t+r])<<u;if(o<4)return a;var c=0;for(u=0,r=3;r<6&&r<o;r++,u+=7)c|=(127&e[t+r])<<u;if(o<5)return c<<21|a;if(o<7)return 2097152*c+a;var s=0;for(u=0,r=6;r<9&&r<o;r++,u+=7)s|=(127&e[t+r])<<u;10===o&&(s|=(1&e[t+9])<<21);var l=s<<10|c>>11,p=c<<21|a;return h(!0,l,p)},readBuffer:function(){var t=arguments.length<=0||void 0===arguments[0]?this.size():arguments[0];if(0===t)return new ArrayBuffer(0);var n=f(this,t),e=this._buffer,r=n+e.byteOffset,i=e.buffer;return 0===r&&this._readIndex===i.byteLength?i:i.slice(r,r+t)},readByteArray:function(){var t=arguments.length<=0||void 0===arguments[0]?this.size():arguments[0];if(0===t)return new Uint8Array(0);var n=f(this,t);return this._buffer.subarray(n,n+t)},readBinary:function(){var t=arguments.length<=0||void 0===arguments[0]?this.size():arguments[0],n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1];if(0===t)return new e((void 0),n);var r=f(this,t),i=this._buffer.subarray(r,r+t);return new e(i,n)},readString:function(t){for(var n=f(this,t),e=n+t,r=this._buffer,i=[],o=void 0,a=n,u=t;a<e;a++,u--){i.length>5e3&&(o||(o=[]),o.push(String.fromCharCode.apply(String,i)),i=[]);var c=0|r[a];if(0===(128&c))i.push(c);else if(u>=2&&192===(224&c)){var s=0|r[a+1];if(128===(192&s)){var l=(31&c)<<6|63&s;l>=128?(a++,u--,i.push(l)):i.push(d)}else i.push(d)}else if(u>=3&&224===(240&c)){var p=0|r[a+1],h=0|r[a+2];if(128===(192&p)&&128===(192&h)){var v=(15&c)<<12|(63&p)<<6|63&h;v>=2048&&!(55296<=v&&v<57344)?(a+=2,u-=2,i.push(v)):i.push(d)}else i.push(d)}else if(u>=4&&240===(248&c)){var m=0|r[a+1],g=0|r[a+2],y=0|r[a+3];if(128===(192&m)&&128===(192&g)&&128===(192&y)){var _=(7&c)<<18|(63&m)<<12|(63&g)<<6|63&y;if(_>=65536&&_<=1114111){a+=3,u-=3;var x=_-65536;i.push(55296|x>>10,56320|1023&x)}else i.push(d)}else i.push(d)}else i.push(d)}var w=String.fromCharCode.apply(String,i);return o?(o.push(w),o.join("")):w},write:function(){for(var t=0;t<arguments.length;t++){var n=arguments[t];"string"==typeof n?this.writeString(n):"number"==typeof n?this.writeUint8(n):n instanceof e?this.writeBinary(n):n instanceof ArrayBuffer?this.writeBuffer(n):n instanceof Uint8Array&&this.writeByteArray(n)}},writeUint8:function(t){u(t,0,256,"uint8");var n=s(this,1);this._buffer[n]=t},writeInt8:function(t){u(t,-128,128,"signed int8");var n=s(this,1);this._buffer[n]=t},writeUint16:function(t){var n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1];u(t,0,65536,"uint16");var e=s(this,2);c(this).setUint16(e,t,n)},writeInt16:function(t){var n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1];u(t,-32768,32768,"signed int16");var e=s(this,2);c(this).setInt16(e,t,n)},writeUint32:function(t){var n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1];u(t,0,4294967296,"uint32");var e=s(this,4);c(this).setUint32(e,t,n)},writeInt32:function(t){var n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1];u(t,-2147483648,2147483648,"signed int32");var e=s(this,4);c(this).setInt32(e,t,n)},writeUint64:function(t){var n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1];u(t,-0x8000000000000000,0x8000000000000000,"signed int64"),p(t,n,this)},writeInt64:function(t){var n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1];u(t,0,0x10000000000000000,"uint64"),p(t,n,this)},writeFloat32:function(t){var n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1],e=s(this,4);c(this).setFloat32(e,t,n)},writeFloat64:function(t){var n=arguments.length<=1||void 0===arguments[1]?this._littleEndian:arguments[1],e=s(this,8);c(this).setFloat64(e,t,n)},writeVarInt:function(t){u(t,-0x8000000000000000,0x8000000000000000,"varint (signed int64)");var n=t<0;n&&(t=-t);for(var e=t<128&&1||t<16384&&2||t<2097152&&3||t<268435456&&4||t<34359738368&&5||t<4398046511104&&6||t<562949953421312&&7||t<72057594037927940&&8||9,r=s(this,n?10:e),i=this._buffer,o=t,a=r,c=e;c>4;c--){var f=Math.floor(o/128),l=o-128*f;i[a++]=128|127&l,o=f}for(;c>1;c--)i[a++]=128|127&o,o>>=7;if(i[a++]=o,n){for(var p=r;p<a;p++)i[p]=128|127&~i[p];for(var h=a;h<r+9;h++)i[h]=255;i[r+9]=1;for(var d=255,v=r;v<r+9&&255===d;v++)d=i[v],i[v]=255===d?128:d+1}},writeBinary:function(t){var n=t._readIndex,e=t._readEndIndex;if(n!==e){var r=s(this,e-n);this._buffer.set(t._buffer.subarray(n,e),r)}},writeBuffer:function(t){this.writeByteArray(new Uint8Array(t))},writeByteArray:function(t){var n=s(this,t.length);this._buffer.set(t,n)},writeString:function(t){for(var n=s(this,i(t)),e=this._buffer,r=0;r<t.length;r++){var o=t.charCodeAt(r);if(o<128)e[n++]=o;else if(o<2048)e[n++]=192|o>>6,e[n++]=128|63&o;else if(o<55296||57344<=o)e[n++]=224|o>>12,e[n++]=128|o>>6&63,e[n++]=128|63&o;else{var a=65536+((1023&o)<<10|1023&t.charCodeAt(++r));e[n++]=240|a>>18,e[n++]=128|a>>12&63,e[n++]=128|a>>6&63,e[n++]=128|63&a}}},writeBytes:function(){for(var t=0;t<arguments.length;t++)u(arguments[t],0,256,"byte");for(var n=s(this,arguments.length),e=this._buffer,r=0;r<arguments.length;r++)e[n+r]=arguments[r]},writeWithVarIntLength:function(t,n){var e=this._writeIndex;o(this,t,n);var r=this._writeIndex;this.writeVarInt(r-e);for(var i=this._writeIndex-r,a=this._buffer,u=0;u<i;u++)v[u]=a[r+u];for(var c=r-1;c>=e;c--)a[c+i]=a[c];for(var f=0;f<i;f++)a[e+f]=v[f]}},e.onLongLong=function(t){throw new Error("ReadError: integer exceeded 52 bits ("+t+")")},e.build=r;var m="",g=0;e.numUtf8Bytes=i,t.exports=e},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,n){var e=this;this._flags=0,this._value=void 0,this._onFulfilled=void 0,this._onRejected=void 0,this._context=void 0,this._resolveLevel=0,this._control=void 0,this.x=void 0,this._parent=void 0,this._child=void 0,this._children=void 0,this.control=void 0,n&&(this._context=n["this"]),"function"==typeof t&&(this._onFulfilled=t,this._flags|=at,this._flags|=pt,U(t,this._context,function(t){return A(e,0,!0,!1,t)},function(t){return A(e,0,!1,!1,t)}))}function o(t){if(void 0===t)return gt;if(k(t))return t;var n=new i;return A(n,0,!0,!1,t),W(n,ht),n}function a(t){var n=new i;return n._value=t,W(n,ot|ht),nt.push(n),n}function u(t){return new i(function(n,e){function r(t){if(0===--i){for(var e=[],r=0;r<o.length;r++){var a=o[r];e.push(a&&a._flags&vt?a._value:t)}n(e)}return t}var i=t.length;if(0===i)return void n([]);for(var o=new Array(t.length),a=0;a<t.length;a++)o[a]=E(t[a],r,e)})}function c(t,n){this.errors=t||[],this.message=n||this.errors.length+" errors"}function f(t){var n="";if(t._flags&lt){var e=t._onFulfilled||t._onRejected;n=e.call(t._context,Y)}else if(t._control)n=".addRawControl("+t._control.name+", "+t._control.foo+")";else if(t._flags&ct)n=".endWithControls("+(0,H["default"])(t.control)+")";else if(t._flags&ht)n=t._flags&it?"Promise.resolve("+(void 0===t._value?"":t._value)+")":"Promise.reject("+(void 0===t._value?"":t._value)+")";else if(t._flags&pt)switch(t._flags&vt){case ot:n="new Promise("+t._onFulfilled+")";break;case mt:n="new Promise("+t._onFulfilled+")";break;case it:n="new Promise("+t._onFulfilled+")"}else t._onFulfilled&&t._onRejected?n=".then("+t._onFulfilled+", "+t._onRejected+")":t._onFulfilled?n=".then("+t._onFulfilled+")":t._onRejected&&(n=".catch("+t._onRejected+")");return n}function s(t,n){return new i(function(e){var r=b(n);k(r)&&W(r,ut),setTimeout(e,t,r)})}function l(t){this.message=t||"StackPromise timed out"}function p(t,n){var e=void 0;if(arguments.length>2){e=new Array(arguments.length-2);for(var r=2;r<arguments.length;r++)e[r-2]=arguments[r]}return new i(function(r){r(t.apply(n,e))})}function h(t,n,e,r){this.name=t,this.foo=n,this.lightning=!!e,this.canRunMultipleTimes=!!r}function d(t,n){function e(){for(var e=void 0,r=t._parent;r&&!(r._flags&vt)&&!(r._flags&ct);r=r._parent)!r._control||r._control.name!==n||r._flags&at||(e=r);if(!e)return i.NO_ACTIVE_CONTROL;e._control.canRunMultipleTimes||W(e,at);var o=void 0;if(arguments.length>0){o=new Array(arguments.length);for(var a=0;a<arguments.length;a++)o[a]=arguments[a]}return e._control.foo.call(e._context,function(t){return S(e,e._resolveLevel,!0,!1,t)},function(t){return S(e,e._resolveLevel,!1,!1,t)},e._parent,o)}return e}function v(t){this.message=t,this.stack=new Error(t||this.name).stack}function m(t,n,e,r){n(new v(r&&r[0]))}function g(){0===J&&(V.length||nt.length)&&(J=1,_t||(_t=y()),_t())}function y(){var t=void 0,n=void 0;return"undefined"==typeof MutationObserver||window&&window.navigator&&window.navigator.standalone?"function"==typeof L["default"]?function(){(0,L["default"])(R)}:function(){setTimeout(R,0)}:(t=document.createElement("div"),n=new MutationObserver(R),n.observe(t,{attributes:!0}),function(){t.setAttribute("tick",1&K)})}function _(t){return t===Y?".tap()":G}function x(t,n){W(t,ut),n._parent=t,t._children?t._children.push(n):t._child?(t._children=[t._child,n],t._child=void 0):t._child=n}function w(t){if(t&&("object"==typeof t||"function"==typeof t)){var n=void 0;try{n=t.then}catch(e){return tt=e,Q}if("function"==typeof n)return n}}function b(t){if(!t||k(t))return t;var n=w(t);return n===Q?a(tt):n?new i(function(e,r){n.call(t,e,r)}):t}function k(t){return t instanceof i}function E(t,n,e){t=b(t);var r=k(t),i=void 0,u=void 0,c=!1,f=void 0;if(r){if(!(t._flags&vt))return W(t.then(n,e),ft);W(t,ut),c=!!(t._flags&st),f=t._context,i=t._flags&it?n:e,u=t._value}else i=n,u=t;if(!i)return o(t).then();u=F(i,f,u,!0);var s=void 0;if(u===Q)s=a(tt);else{if(u===Z)return o(t).then(n,e);if(u===G)return r?t.then():o(t);s=o(u)}return c&&(s=s.cancellable()),void 0!==f&&(s=s.bind(f)),s}function A(t,n,e,r,i){if(n===t._resolveLevel){var o=++t._resolveLevel;if(W(t,at),!e)return void O(t,!1,r,i);if(i===t)t._parent=void 0,O(t,!1,r,new TypeError("promise resolved to itself"));else if(k(i)){var a=i._flags&vt;a===mt?x(i,t):(t._parent=i,W(t,dt),W(i,ut),O(t,a===it,r,i._value))}else{var u=w(i);u===Q?(t._parent=void 0,O(t,!1,r,tt)):u?(t._parent=void 0,U(u,i,function(n){return A(t,o,!0,!1,n)},function(n){return A(t,o,!1,!1,n)})):O(t,!0,r,i)}}}function S(t,n,e,r,i){n===t._resolveLevel&&(j(t),A(t,n,e,r,i))}function j(t){if(t._parent){var n=t._parent;if(t._parent=void 0,n._child===t)n._child=void 0;else if(n._children){for(var e=n._children,r=0;r<e.length;r++)if(e[r]===t){e.splice(r,1);break}0===e.length&&(n._children=void 0)}}}function C(t){if(null===t||void 0===t)throw new Error("Invalid .catch guard "+t);if("function"==typeof t)return t;if("object"==typeof t)throw new Error("Object guards in .catch are currently unsupported");return function(n){return n===t}}function z(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(r===Error||r.prototype instanceof Error){if(n instanceof r)return!0}else if(r(n))return!0}return!1}function M(t,n){function e(e,r){return e===Y?".catch(..., "+n+")":t&&!z(t,e)?G:r?Z:n.call(this,e)}return e}function O(t,n,e,r){if(W(t,at|(n?it:ot)),t._value=r,t._child)B(t._child,n,e,r,t),t._child=void 0;else if(t._children){var i=t._children;t._children=void 0;for(var o=0;o<i.length;o++)B(i[o],n,e,r,t)}else n||t._flags&ut||nt.push(t)}function B(t,n,e,r,i){t._resolveLevel++;var o=T(t,n);if(o&&t._flags&ft){W(t,at);var a=F(o,t._context,r,!0);if(a!==Z)return void(a===Q?(t._parent=void 0,O(t,!1,e,tt)):a===G?O(t,n,e,r):(t._parent=void 0,A(t,t._resolveLevel,!0,e,a)));t._flags&=~at}o?((e?X:V).push(t),g()):O(t,n,e,r)}function I(t,n){for(;0!==t.length;)n.push(t.pop())}function R(){for(;0!==$.length||0!==V.length;){0===$.length&&I(V,$);var t=$.pop(),n=t._parent,e=!!(n&&n._flags&it),r=n&&n._value,o=T(t,e);if(W(t,at),o){var a=void 0;do a=F(o,t._context,r,!1);while(a===Z);a===Q?(r=tt,e=!1,t._parent=void 0):a!==G&&(r=a,e=!0,t._parent=void 0)}t._flags&vt||(A(t,t._resolveLevel,e,!0,r),I(X,$))}for(J--,K++;0!==nt.length;){var u=nt.pop();u._flags&ut||rt.push(u)}for(;0!==et.length;){var c=et.pop();c._flags&ut||i.onPossiblyUnhandledRejection(c._value,c)}var f=et;et=rt,rt=f}function U(t,n,e,r){try{t.call(n,e,r)}catch(i){r(i)}}function T(t,n){if(!(t._flags&at))return n?t._onFulfilled:t._onRejected}function F(t,n,e,r){try{return r?t.call(n,e,!0):t.call(n,e)}catch(i){return tt=i,Q}}function W(t,n){return t._flags|=n,t}var D=e(37),L=r(D),P=e(12),q=r(P),N=e(36),H=r(N),K=0,J=0,$=[],V=[],X=[],G={sentinel:"CONTINUE_AS_IF_NO_HANDLER"},Z={sentinel:"RETRY_ASYNCHRONOUSLY"},Y={sentinel:"TO_STRING"},Q={sentinel:"DID_ERROR"},tt=null,nt=[],et=[],rt=[],it=1,ot=2,at=4,ut=8,ct=16,ft=32,st=64,lt=128,pt=256,ht=512,dt=1024,vt=it|ot,mt=0,gt=void 0;i.resolve=o,i.reject=a,i.prototype.then=function(t,n){"function"!=typeof t&&(t=void 0),"function"!=typeof n&&(n=void 0);var e=new i;e._onFulfilled=t,e._onRejected=n,e._context=this._context,this._flags&st&&W(e,st);var r=this._flags&vt;return r===mt?x(this,e):(W(this,ut),(r===it?t:n)?(e._parent=this,V.push(e),g()):(e._parent=this,W(e,r),e._value=this._value,r===ot&&nt.push(e))),e},i.prototype["catch"]=function(t){var n=arguments.length-1;if(0===n)return this.then(void 0,t);for(var e=new Array(n),r=0;r<n;r++)e[r]=C(arguments[r]);var i=M(e,arguments[n]),o=E(this,void 0,i);return o._onRejected&&W(o,lt),o},i.prototype.bind=function(t){var n=this.then();return n._context=t,n},i.prototype.end=function(t){var n=this.then();if(W(n,ct),n.control={},n._context=void 0,t){var e=t.controls;if(e)for(var r=0;r<e.length;r++){var i=e[r];n.control[i]=d(n,i)}return n}},i.prototype.endWithControls=function(){var t=this.then();W(t,ct),t.control={},t._context=void 0;for(var n=0;n<arguments.length;n++){var e=arguments[n];t.control[e]=d(t,e)}return t},i.all=u,i.any=function(t){return new i(function(n,e){function r(t){if(0===--i){for(var n=[],r=0;r<o.length;r++){var a=o[r];n.push(a&&a._flags&vt?a._value:t)}e(new c(n))}return t}var i=t.length;0===i&&e(new c([],"StackPromise.any called with []"));for(var o=new Array(t.length),a=0;a<t.length;a++)o[a]=E(t[a],n,r)})},i.props=function(t){function n(t){for(var n={},r=0;r<t.length;r++)n[e[r]]=t[r];return n}var e=(0,H["default"])(t),r=i.all(e.map(function(n){return t[n]}));switch(r._flags&vt){case ot:return r;case mt:return W(r.then(n),ft);case it:return r._value=n(r._value),r}},i.map=function(t,n){function e(t){return function(e){return r&&n(e,t)}}var r=!0,i=u(t.map(function(t,n){return o(t).then(e(n))}));switch(i._flags&vt){case ot:r=!1;break;case mt:i=i["catch"](function(){return r=!1,G}),W(i,ft);break;case it:}return i},i.reduce=function(t,n,e){return o(t).reduce(n,e)},i.prototype.reduce=function(t,n){return n=b(n),E(this,function(e,r){function i(){for(var e=o.length;;){var r=f,a=o[r];if(k(a))switch(a._flags&vt){case ot:return a;case mt:return a.then(i);case it:a=a._value}if(k(n))switch(n._flags&vt){case ot:return n;case mt:return n.then(i);case it:n=n._value}var u=t.call(c,n,a,r,e);if(++f===e)return u;if(u=b(u),k(u))switch(u._flags&vt){case ot:return u;case mt:return n=u,u.then(i);case it:W(u,ut),n=u._value}else n=u}}if(0===e.length)return n;if(r)return Z;for(var o=new Array(e.length),a=0;a<e.length;a++){var u=o[a]=b(e[a]);k(u)&&W(u,ut)}var c=this,f=0;return i()})},i.each=function(t,n){return o(t).each(n)},i.prototype.each=function(t){function n(n,r,i,o){return e.push(r),t.call(this,r,i,o)}var e=[];return this.reduce(n)["return"](e)},i.mapSeries=function(t,n){return o(t).mapSeries(n)},i.prototype.mapSeries=function(t){function n(n,e,r,i){var o=b(t.call(this,e,r,i));return k(o)?o.then(function(t){return n.push(t),n}):(n.push(o),n)}return this.reduce(n,[])},i.race=function(t){var n=b(t);if(k(n)){var e=n.then(function(t){return i.race(t)});return e._context=void 0,e._flags&=~st,e}return new i(function(t,e){for(var r=0;r<n.length;r++){var i=b(n[r]);if(!k(i)||i._flags&vt)for(t(i),r++;r<n.length;r++){var o=n[r];k(o)&&W(o,ut)}else i.then(t,e)}})},c.prototype=(0,q["default"])(Error.prototype,{name:{value:"AggregateError"}}),i.AggregateError=c,i.onPossiblyUnhandledRejection=function(t,n){console.error("StackPromise did not catch "+t,n,t)},i.prototype.toString=function(){for(var t=[],n=void 0,e=this,r=!1;e;e=e._parent){n=e,!r&&e._flags&vt&&(r=!0,e._flags&ht||(e._flags&it?t.push("[resolved value: "+e._value+"]"):t.push("[rejected reason: "+e._value+"]")));var i=f(e);e._flags&dt&&(i="~"+i),t.push(i)}return t.reverse(),n._flags&(ht|pt)||(t[0]="[Promise]"+t[0]),t.join("\\n")},i.delay=s,i.prototype.delay=function(t){return this.then(function(n){return s(t,n)})},i.prototype.timeout=function(t,n){function e(e){return e===Y?".timeout("+t+", "+n+")":(clearTimeout(r),G)}if((this._flags&vt)!==mt)return this.then();var r=void 0,i=this.then(e,e);return W(i,ft|lt),r=setTimeout(function(t,n){if(!(t._flags&vt)){var e=n instanceof Error?n:new l(n);S(t,0,!1,!1,e)}},t,i,n),i},l.prototype=(0,q["default"])(Error.prototype,{name:{value:"TimeoutError"}}),i.TimeoutError=l,i.prototype.isFulfilled=function(){return!!(this._flags&it)},i.prototype.isRejected=function(){return!!(this._flags&ot)},i.prototype.isPending=function(){return!(this._flags&vt)},i.prototype.value=function(){if(this._flags&it)return this._value;throw new Error(this._flags&ot?"value() called on StackPromise that was rejected":"value() called on StackPromise that is pending")},i.prototype.reason=function(){if(this._flags&ot)return this._value;throw new Error(this._flags&it?"reason() called on StackPromise that was fulfilled, not rejected":"reason() called on StackPromise that is pending")},i.callSynchronously=p,i.wrap=function(t){return function(){var n=this,e=void 0;if(arguments.length>0){e=new Array(arguments.length);for(var r=0;r<arguments.length;r++)e[r]=arguments[r]}var i=function(r){return r===Y?".wrap("+t+").apply("+n+", ["+e+"])":t.apply(n,e)},a=o().then(i);return W(a,lt),a}},i.wrapSync=function(t){return function(){try{return o(t.apply(this,arguments))}catch(n){return a(n)}}},i.loop=function(t,n){return o(n).loop(t)},i.prototype.loop=function(t){var n=E(this.then(function(e){function r(e){return p(t,i,a,e,o++).then(function(t){if(!(n._flags&vt))return r(t)})}var i=this,o=0,a=function(t){return S(n,0,!0,!1,t)};return r(e)}),function(n){return n===Y?".loop("+t+")":G});return W(n,lt),n},i.prototype.checkpoint=function(t){return t=o(t),this.then(function(n){return t._flags&ot?t:n})},i.prototype["finally"]=function(t){function n(n){return n===Y?".finally("+t+")":(t.call(this,n),G)}return W(this.then(n,n),lt)},i.prototype.get=function(t){var n=this.then(function(n){return n===Y?".get(\'"+t+"\')":n[t]});return W(n,lt),n},i.prototype.tap=function(t){function n(n){return n===Y?".tap("+t+")":(t.call(this,n),G)}return"function"!=typeof t?W(this.then(_),lt):W(this.then(n),lt)},i.prototype.spread=function(t){var n=this.then(function(n){return n===Y?".spread("+t+")":t.apply(this,n)});return W(n,lt),n},i.prototype["return"]=function(t){switch(this._flags&vt){case ot:return this.then();case mt:case it:t=b(t),k(t)&&W(t,ut);var n=E(this,function(n){return n===Y?".return("+t+")":t});return W(n,lt),n}},i.prototype["throw"]=function(t){return this["return"](a(t))},i.Control=h,i.NO_ACTIVE_CONTROL=new Error("No active control was found."),i.prototype.addControl=function(t){if(!(t instanceof h))throw new Error("addControl must be given Control, but got "+t);var n=this.then(t.lightning?void 0:_);return n._control=t,n},i.prototype.addRawControl=function(t,n,e,r){return this.addControl(new h(t,n,e,r))},i.prototype.addResolveControl=function(t,n,e,r){function i(t,e,r,i){try{t(n.apply(this,i))}catch(o){e(o)}}return this.addControl(new h(t,i,e,r))},i.prototype.addRejectControl=function(t,n,e,r){function i(t,e,r,i){try{e(n.apply(this,i))}catch(o){e(o)}}return this.addControl(new h(t,i,e,r))},v.prototype=(0,q["default"])(Error.prototype,{name:{value:"CancellationError"}}),i.CancellationError=v;var yt=new h("cancel",m,(!1),(!1));i.prototype.addCancelControl=function(){return W(this.addControl(yt),st)},i.sit=function(t,n){var e=new i;return e._control=new h(t,function(t,e,r,i){t(n?n.apply(void 0,i):i&&i[0])}),e},i.prototype.cancellable=function(){return W(this.then(),st)},i.prototype.uncancellable=function(){var t=this.then();return t._flags&=~st,t},i.prototype.cancel=function(t){for(var n=void 0,e=this;e&&!(e._flags&vt);e=e._parent)e._flags&st&&(n=e);if(n)if(void 0===t&&(t=new v),T(n,!1)){var r=new i;j(n),x(r,n),S(r,0,!1,!1,t)}else S(n,n._resolveLevel,!1,!1,t)};var _t=void 0;gt=new i,A(gt,0,!0,!1,void 0),t.exports=i},function(t,n,e){t.exports={"default":e(38),__esModule:!0}},function(t,n,e){t.exports={"default":e(40),__esModule:!0}},function(t,n,e){t.exports={"default":e(41),__esModule:!0}},function(t,n,e){var r=e(1),i=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}},function(t,n,e){e(61);var r=e(1).Object;t.exports=function(t,n){return r.create(t,n)}},function(t,n,e){e(62),t.exports=e(1).Object.keys},function(t,n,e){e(63),t.exports=e(1).setImmediate},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,e){var r=e(22),i=e(57),o=e(56);t.exports=function(t){return function(n,e,a){var u,c=r(n),f=i(c.length),s=o(a,f);if(t&&e!=e){for(;f>s;)if(u=c[s++],u!=u)return!0}else for(;f>s;s++)if((t||s in c)&&c[s]===e)return t||s||0;return!t&&-1}}},function(t,n){var e={}.hasOwnProperty;t.exports=function(t,n){return e.call(t,n)}},function(t,n,e){var r=e(18),i=e(53);t.exports=e(3)?function(t,n,e){return r.f(t,n,i(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n,e){t.exports=!e(3)&&!e(7)(function(){return 7!=Object.defineProperty(e(5)("div"),"a",{get:function(){return 7}}).a})},function(t,n){t.exports=function(t,n,e){var r=void 0===e;switch(n.length){case 0:return r?t():t.call(e);case 1:return r?t(n[0]):t.call(e,n[0]);case 2:return r?t(n[0],n[1]):t.call(e,n[0],n[1]);case 3:return r?t(n[0],n[1],n[2]):t.call(e,n[0],n[1],n[2]);case 4:return r?t(n[0],n[1],n[2],n[3]):t.call(e,n[0],n[1],n[2],n[3])}return t.apply(e,n)}},function(t,n,e){var r=e(13);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,n,e){var r=e(4),i=e(50),o=e(16),a=e(20)("IE_PROTO"),u=function(){},c="prototype",f=function(){var t,n=e(5)("iframe"),r=o.length,i="<",a=">";for(n.style.display="none",e(17).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(i+"script"+a+"document.F=Object"+i+"/script"+a),t.close(),f=t.F;r--;)delete f[c][o[r]];return f()};t.exports=Object.create||function(t,n){var e;return null!==t?(u[c]=r(t),e=new u,u[c]=null,e[a]=t):e=f(),void 0===n?e:i(e,n)}},function(t,n,e){var r=e(18),i=e(4),o=e(19);t.exports=e(3)?Object.defineProperties:function(t,n){i(t);for(var e,a=o(n),u=a.length,c=0;u>c;)r.f(t,e=a[c++],n[e]);return t}},function(t,n,e){var r=e(44),i=e(22),o=e(43)(!1),a=e(20)("IE_PROTO");t.exports=function(t,n){var e,u=i(t),c=0,f=[];for(e in u)e!=a&&r(u,e)&&f.push(e);for(;n.length>c;)r(u,e=n[c++])&&(~o(f,e)||f.push(e));return f}},function(t,n,e){var r=e(6),i=e(1),o=e(7);t.exports=function(t,n){var e=(i.Object||{})[t]||Object[t],a={};a[t]=n(e),r(r.S+r.F*o(function(){e(1)}),"Object",a)}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,e){var r=e(2),i="__core-js_shared__",o=r[i]||(r[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,e){var r,i,o,a=e(14),u=e(47),c=e(17),f=e(5),s=e(2),l=s.process,p=s.setImmediate,h=s.clearImmediate,d=s.MessageChannel,v=0,m={},g="onreadystatechange",y=function(){var t=+this;if(m.hasOwnProperty(t)){var n=m[t];delete m[t],n()}},_=function(t){y.call(t.data)};p&&h||(p=function(t){for(var n=[],e=1;arguments.length>e;)n.push(arguments[e++]);return m[++v]=function(){u("function"==typeof t?t:Function(t),n)},r(v),v},h=function(t){delete m[t]},"process"==e(13)(l)?r=function(t){l.nextTick(a(y,t,1))}:d?(i=new d,o=i.port2,i.port1.onmessage=_,r=a(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(r=function(t){s.postMessage(t+"","*")},s.addEventListener("message",_,!1)):r=g in f("script")?function(t){c.appendChild(f("script"))[g]=function(){c.removeChild(this),y.call(t)}}:function(t){setTimeout(a(y,t,1),0)}),t.exports={set:p,clear:h}},function(t,n,e){var r=e(21),i=Math.max,o=Math.min;t.exports=function(t,n){return t=r(t),t<0?i(t+n,0):o(t,n)}},function(t,n,e){var r=e(21),i=Math.min;t.exports=function(t){return t>0?i(r(t),9007199254740991):0}},function(t,n,e){var r=e(15);t.exports=function(t){return Object(r(t))}},function(t,n,e){var r=e(8);t.exports=function(t,n){if(!r(t))return t;var e,i;if(n&&"function"==typeof(e=t.toString)&&!r(i=e.call(t)))return i;if("function"==typeof(e=t.valueOf)&&!r(i=e.call(t)))return i;if(!n&&"function"==typeof(e=t.toString)&&!r(i=e.call(t)))return i;throw TypeError("Can\'t convert object to primitive value")}},function(t,n){var e=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+r).toString(36))}},function(t,n,e){var r=e(6);r(r.S,"Object",{create:e(49)})},function(t,n,e){var r=e(58),i=e(19);e(52)("keys",function(){return function(t){return i(r(t))}})},function(t,n,e){var r=e(6),i=e(55);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,e){!function(r,i){t.exports=n=i(e(0))}(this,function(t){t.lib.Cipher||function(n){var e=t,r=e.lib,i=r.Base,o=r.WordArray,a=r.BufferedBlockAlgorithm,u=e.enc,c=(u.Utf8,u.Base64),f=e.algo,s=f.EvpKDF,l=r.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(t,n){return this.create(this._ENC_XFORM_MODE,t,n)},createDecryptor:function(t,n){return this.create(this._DEC_XFORM_MODE,t,n)},init:function(t,n,e){this.cfg=this.cfg.extend(e),this._xformMode=t,this._key=n,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){t&&this._append(t);var n=this._doFinalize();return n},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?k:x}return function(n){return{encrypt:function(e,r,i){return t(r).encrypt(n,e,r,i)},decrypt:function(e,r,i){return t(r).decrypt(n,e,r,i)}}}}()}),p=(r.StreamCipher=l.extend({_doFinalize:function(){var t=this._process(!0);return t},blockSize:1}),e.mode={}),h=r.BlockCipherMode=i.extend({createEncryptor:function(t,n){return this.Encryptor.create(t,n)},createDecryptor:function(t,n){return this.Decryptor.create(t,n)},init:function(t,n){this._cipher=t,this._iv=n}}),d=p.CBC=function(){function t(t,e,r){var i=this._iv;if(i){var o=i;this._iv=n}else var o=this._prevBlock;for(var a=0;a<r;a++)t[e+a]^=o[a]}var e=h.extend();return e.Encryptor=e.extend({processBlock:function(n,e){var r=this._cipher,i=r.blockSize;t.call(this,n,e,i),r.encryptBlock(n,e),this._prevBlock=n.slice(e,e+i)}}),e.Decryptor=e.extend({processBlock:function(n,e){var r=this._cipher,i=r.blockSize,o=n.slice(e,e+i);r.decryptBlock(n,e),t.call(this,n,e,i),this._prevBlock=o}}),e}(),v=e.pad={},m=v.Pkcs7={pad:function(t,n){for(var e=4*n,r=e-t.sigBytes%e,i=r<<24|r<<16|r<<8|r,a=[],u=0;u<r;u+=4)a.push(i);var c=o.create(a,r);t.concat(c)},unpad:function(t){var n=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=n}},g=(r.BlockCipher=l.extend({cfg:l.cfg.extend({mode:d,padding:m}),reset:function(){l.reset.call(this);var t=this.cfg,n=t.iv,e=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=e.createEncryptor;else{var r=e.createDecryptor;this._minBufferSize=1}this._mode=r.call(e,this,n&&n.words)},_doProcessBlock:function(t,n){this._mode.processBlock(t,n)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var n=this._process(!0)}else{var n=this._process(!0);t.unpad(n)}return n},blockSize:4}),r.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),y=e.format={},_=y.OpenSSL={stringify:function(t){var n=t.ciphertext,e=t.salt;if(e)var r=o.create([1398893684,1701076831]).concat(e).concat(n);else var r=n;return r.toString(c)},parse:function(t){var n=c.parse(t),e=n.words;if(1398893684==e[0]&&1701076831==e[1]){var r=o.create(e.slice(2,4));e.splice(0,4),n.sigBytes-=16}return g.create({ciphertext:n,salt:r})}},x=r.SerializableCipher=i.extend({cfg:i.extend({format:_}),encrypt:function(t,n,e,r){r=this.cfg.extend(r);var i=t.createEncryptor(e,r),o=i.finalize(n),a=i.cfg;return g.create({ciphertext:o,key:e,iv:a.iv,algorithm:t,mode:a.mode,padding:a.padding,blockSize:t.blockSize,formatter:r.format})},decrypt:function(t,n,e,r){r=this.cfg.extend(r),n=this._parse(n,r.format);var i=t.createDecryptor(e,r).finalize(n.ciphertext);return i},_parse:function(t,n){return"string"==typeof t?n.parse(t,this):t}}),w=e.kdf={},b=w.OpenSSL={execute:function(t,n,e,r){r||(r=o.random(8));var i=s.create({keySize:n+e}).compute(t,r),a=o.create(i.words.slice(n),4*e);return i.sigBytes=4*n,g.create({key:i,iv:a,salt:r})}},k=r.PasswordBasedCipher=x.extend({cfg:x.cfg.extend({kdf:b}),encrypt:function(t,n,e,r){r=this.cfg.extend(r);var i=r.kdf.execute(e,t.keySize,t.ivSize);r.iv=i.iv;var o=x.encrypt.call(this,t,n,i.key,r);return o.mixIn(i),o},decrypt:function(t,n,e,r){r=this.cfg.extend(r),n=this._parse(n,r.format);var i=r.kdf.execute(e,t.keySize,t.ivSize,n.salt);r.iv=i.iv;var o=x.decrypt.call(this,t,n,i.key,r);return o}})}()})},function(t,n,e){!function(r,i,o){t.exports=n=i(e(0),e(67),e(23))}(this,function(t){return function(){var n=t,e=n.lib,r=e.Base,i=e.WordArray,o=n.algo,a=o.MD5,u=o.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:a,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,n){for(var e=this.cfg,r=e.hasher.create(),o=i.create(),a=o.words,u=e.keySize,c=e.iterations;a.length<u;){f&&r.update(f);var f=r.update(t).finalize(n);r.reset();for(var s=1;s<c;s++)f=r.finalize(f),r.reset();o.concat(f)}return o.sigBytes=4*u,o}});n.EvpKDF=function(t,n,e){return u.create(e).compute(t,n)}}(),t.EvpKDF})},function(t,n,e){!function(r,i){t.exports=n=i(e(0))}(this,function(t){return function(n){function e(t,n,e,r,i,o,a){var u=t+(n&e|~n&r)+i+a;return(u<<o|u>>>32-o)+n}function r(t,n,e,r,i,o,a){var u=t+(n&r|e&~r)+i+a;return(u<<o|u>>>32-o)+n}function i(t,n,e,r,i,o,a){var u=t+(n^e^r)+i+a;return(u<<o|u>>>32-o)+n}function o(t,n,e,r,i,o,a){var u=t+(e^(n|~r))+i+a;return(u<<o|u>>>32-o)+n}var a=t,u=a.lib,c=u.WordArray,f=u.Hasher,s=a.algo,l=[];!function(){for(var t=0;t<64;t++)l[t]=4294967296*n.abs(n.sin(t+1))|0}();var p=s.MD5=f.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,n){for(var a=0;a<16;a++){var u=n+a,c=t[u];t[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var f=this._hash.words,s=t[n+0],p=t[n+1],h=t[n+2],d=t[n+3],v=t[n+4],m=t[n+5],g=t[n+6],y=t[n+7],_=t[n+8],x=t[n+9],w=t[n+10],b=t[n+11],k=t[n+12],E=t[n+13],A=t[n+14],S=t[n+15],j=f[0],C=f[1],z=f[2],M=f[3];j=e(j,C,z,M,s,7,l[0]),M=e(M,j,C,z,p,12,l[1]),z=e(z,M,j,C,h,17,l[2]),C=e(C,z,M,j,d,22,l[3]),j=e(j,C,z,M,v,7,l[4]),M=e(M,j,C,z,m,12,l[5]),z=e(z,M,j,C,g,17,l[6]),C=e(C,z,M,j,y,22,l[7]),j=e(j,C,z,M,_,7,l[8]),M=e(M,j,C,z,x,12,l[9]),z=e(z,M,j,C,w,17,l[10]),C=e(C,z,M,j,b,22,l[11]),j=e(j,C,z,M,k,7,l[12]),M=e(M,j,C,z,E,12,l[13]),z=e(z,M,j,C,A,17,l[14]),C=e(C,z,M,j,S,22,l[15]),j=r(j,C,z,M,p,5,l[16]),M=r(M,j,C,z,g,9,l[17]),z=r(z,M,j,C,b,14,l[18]),C=r(C,z,M,j,s,20,l[19]),j=r(j,C,z,M,m,5,l[20]),M=r(M,j,C,z,w,9,l[21]),z=r(z,M,j,C,S,14,l[22]),C=r(C,z,M,j,v,20,l[23]),j=r(j,C,z,M,x,5,l[24]),M=r(M,j,C,z,A,9,l[25]),z=r(z,M,j,C,d,14,l[26]),C=r(C,z,M,j,_,20,l[27]),j=r(j,C,z,M,E,5,l[28]),M=r(M,j,C,z,h,9,l[29]),z=r(z,M,j,C,y,14,l[30]),C=r(C,z,M,j,k,20,l[31]),j=i(j,C,z,M,m,4,l[32]),M=i(M,j,C,z,_,11,l[33]),z=i(z,M,j,C,b,16,l[34]),C=i(C,z,M,j,A,23,l[35]),j=i(j,C,z,M,p,4,l[36]),M=i(M,j,C,z,v,11,l[37]),z=i(z,M,j,C,y,16,l[38]),C=i(C,z,M,j,w,23,l[39]),j=i(j,C,z,M,E,4,l[40]),M=i(M,j,C,z,s,11,l[41]),z=i(z,M,j,C,d,16,l[42]),C=i(C,z,M,j,g,23,l[43]),j=i(j,C,z,M,x,4,l[44]),M=i(M,j,C,z,k,11,l[45]),z=i(z,M,j,C,S,16,l[46]),\nC=i(C,z,M,j,h,23,l[47]),j=o(j,C,z,M,s,6,l[48]),M=o(M,j,C,z,y,10,l[49]),z=o(z,M,j,C,A,15,l[50]),C=o(C,z,M,j,m,21,l[51]),j=o(j,C,z,M,k,6,l[52]),M=o(M,j,C,z,d,10,l[53]),z=o(z,M,j,C,w,15,l[54]),C=o(C,z,M,j,p,21,l[55]),j=o(j,C,z,M,_,6,l[56]),M=o(M,j,C,z,S,10,l[57]),z=o(z,M,j,C,g,15,l[58]),C=o(C,z,M,j,E,21,l[59]),j=o(j,C,z,M,v,6,l[60]),M=o(M,j,C,z,b,10,l[61]),z=o(z,M,j,C,h,15,l[62]),C=o(C,z,M,j,x,21,l[63]),f[0]=f[0]+j|0,f[1]=f[1]+C|0,f[2]=f[2]+z|0,f[3]=f[3]+M|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;e[i>>>5]|=128<<24-i%32;var o=n.floor(r/4294967296),a=r;e[(i+64>>>9<<4)+15]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e[(i+64>>>9<<4)+14]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(e.length+1),this._process();for(var u=this._hash,c=u.words,f=0;f<4;f++){var s=c[f];c[f]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return u},clone:function(){var t=f.clone.call(this);return t._hash=this._hash.clone(),t}});a.MD5=f._createHelper(p),a.HmacMD5=f._createHmacHelper(p)}(Math),t.MD5})},function(t,n,e){!function(r,i){t.exports=n=i(e(0))}(this,function(t){return function(){var n=t,e=n.lib,r=e.WordArray,i=e.Hasher,o=n.algo,a=[],u=o.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,n){for(var e=this._hash.words,r=e[0],i=e[1],o=e[2],u=e[3],c=e[4],f=0;f<80;f++){if(f<16)a[f]=0|t[n+f];else{var s=a[f-3]^a[f-8]^a[f-14]^a[f-16];a[f]=s<<1|s>>>31}var l=(r<<5|r>>>27)+c+a[f];l+=f<20?(i&o|~i&u)+1518500249:f<40?(i^o^u)+1859775393:f<60?(i&o|i&u|o&u)-1894007588:(i^o^u)-899497514,c=u,u=o,o=i<<30|i>>>2,i=r,r=l}e[0]=e[0]+r|0,e[1]=e[1]+i|0,e[2]=e[2]+o|0,e[3]=e[3]+u|0,e[4]=e[4]+c|0},_doFinalize:function(){var t=this._data,n=t.words,e=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[(r+64>>>9<<4)+14]=Math.floor(e/4294967296),n[(r+64>>>9<<4)+15]=e,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA1=i._createHelper(u),n.HmacSHA1=i._createHmacHelper(u)}(),t.SHA1})},function(t,n,e){!function(r,i){t.exports=n=i(e(0))}(this,function(t){return function(n){var e=t,r=e.lib,i=r.WordArray,o=r.Hasher,a=e.algo,u=[],c=[];!function(){function t(t){for(var e=n.sqrt(t),r=2;r<=e;r++)if(!(t%r))return!1;return!0}function e(t){return 4294967296*(t-(0|t))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(u[i]=e(n.pow(r,.5))),c[i]=e(n.pow(r,1/3)),i++),r++}();var f=[],s=a.SHA256=o.extend({_doReset:function(){this._hash=new i.init(u.slice(0))},_doProcessBlock:function(t,n){for(var e=this._hash.words,r=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],l=e[6],p=e[7],h=0;h<64;h++){if(h<16)f[h]=0|t[n+h];else{var d=f[h-15],v=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,m=f[h-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;f[h]=v+f[h-7]+g+f[h-16]}var y=u&s^~u&l,_=r&i^r&o^i&o,x=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),w=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25),b=p+w+y+c[h]+f[h],k=x+_;p=l,l=s,s=u,u=a+b|0,a=o,o=i,i=r,r=b+k|0}e[0]=e[0]+r|0,e[1]=e[1]+i|0,e[2]=e[2]+o|0,e[3]=e[3]+a|0,e[4]=e[4]+u|0,e[5]=e[5]+s|0,e[6]=e[6]+l|0,e[7]=e[7]+p|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[(i+64>>>9<<4)+14]=n.floor(r/4294967296),e[(i+64>>>9<<4)+15]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=o._createHelper(s),e.HmacSHA256=o._createHmacHelper(s)}(Math),t.SHA256})},function(t,n){"use strict";t.exports=function(t){return t&&t.length>1?255===t[0]&&216===t[1]&&255===t[2]?{ext:"jpg",mime:"image/jpeg"}:137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]?{ext:"png",mime:"image/png"}:71===t[0]&&73===t[1]&&70===t[2]?{ext:"gif",mime:"image/gif"}:87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]?{ext:"webp",mime:"image/webp"}:(73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3])&&67===t[8]&&82===t[9]?{ext:"cr2",mime:"image/x-canon-cr2"}:73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3]?{ext:"tif",mime:"image/tiff"}:66===t[0]&&77===t[1]?{ext:"bmp",mime:"image/bmp"}:73===t[0]&&73===t[1]&&188===t[2]?{ext:"jxr",mime:"image/vnd.ms-photo"}:56===t[0]&&66===t[1]&&80===t[2]&&83===t[3]?{ext:"psd",mime:"image/vnd.adobe.photoshop"}:80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]&&109===t[30]&&105===t[31]&&109===t[32]&&101===t[33]&&116===t[34]&&121===t[35]&&112===t[36]&&101===t[37]&&97===t[38]&&112===t[39]&&112===t[40]&&108===t[41]&&105===t[42]&&99===t[43]&&97===t[44]&&116===t[45]&&105===t[46]&&111===t[47]&&110===t[48]&&47===t[49]&&101===t[50]&&112===t[51]&&117===t[52]&&98===t[53]&&43===t[54]&&122===t[55]&&105===t[56]&&112===t[57]?{ext:"epub",mime:"application/epub+zip"}:80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]&&77===t[30]&&69===t[31]&&84===t[32]&&65===t[33]&&45===t[34]&&73===t[35]&&78===t[36]&&70===t[37]&&47===t[38]&&109===t[39]&&111===t[40]&&122===t[41]&&105===t[42]&&108===t[43]&&108===t[44]&&97===t[45]&&46===t[46]&&114===t[47]&&115===t[48]&&97===t[49]?{ext:"xpi",mime:"application/x-xpinstall"}:80!==t[0]||75!==t[1]||3!==t[2]&&5!==t[2]&&7!==t[2]||4!==t[3]&&6!==t[3]&&8!==t[3]?117===t[257]&&115===t[258]&&116===t[259]&&97===t[260]&&114===t[261]?{ext:"tar",mime:"application/x-tar"}:82!==t[0]||97!==t[1]||114!==t[2]||33!==t[3]||26!==t[4]||7!==t[5]||0!==t[6]&&1!==t[6]?31===t[0]&&139===t[1]&&8===t[2]?{ext:"gz",mime:"application/gzip"}:66===t[0]&&90===t[1]&&104===t[2]?{ext:"bz2",mime:"application/x-bzip2"}:55===t[0]&&122===t[1]&&188===t[2]&&175===t[3]&&39===t[4]&&28===t[5]?{ext:"7z",mime:"application/x-7z-compressed"}:120===t[0]&&1===t[1]?{ext:"dmg",mime:"application/x-apple-diskimage"}:0===t[0]&&0===t[1]&&0===t[2]&&(24===t[3]||32===t[3])&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]||51===t[0]&&103===t[1]&&112===t[2]&&53===t[3]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&109===t[8]&&112===t[9]&&52===t[10]&&50===t[11]&&109===t[16]&&112===t[17]&&52===t[18]&&49===t[19]&&109===t[20]&&112===t[21]&&52===t[22]&&50===t[23]&&105===t[24]&&115===t[25]&&111===t[26]&&109===t[27]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&105===t[8]&&115===t[9]&&111===t[10]&&109===t[11]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&109===t[8]&&112===t[9]&&52===t[10]&&50===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&0===t[15]?{ext:"mp4",mime:"video/mp4"}:0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&77===t[8]&&52===t[9]&&86===t[10]?{ext:"m4v",mime:"video/x-m4v"}:77===t[0]&&84===t[1]&&104===t[2]&&100===t[3]?{ext:"mid",mime:"audio/midi"}:109===t[31]&&97===t[32]&&116===t[33]&&114===t[34]&&111===t[35]&&115===t[36]&&107===t[37]&&97===t[38]?{ext:"mkv",mime:"video/x-matroska"}:26===t[0]&&69===t[1]&&223===t[2]&&163===t[3]?{ext:"webm",mime:"video/webm"}:0===t[0]&&0===t[1]&&0===t[2]&&20===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]?{ext:"mov",mime:"video/quicktime"}:82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&65===t[8]&&86===t[9]&&73===t[10]?{ext:"avi",mime:"video/x-msvideo"}:48===t[0]&&38===t[1]&&178===t[2]&&117===t[3]&&142===t[4]&&102===t[5]&&207===t[6]&&17===t[7]&&166===t[8]&&217===t[9]?{ext:"wmv",mime:"video/x-ms-wmv"}:0===t[0]&&0===t[1]&&1===t[2]&&"b"===t[3].toString(16)[0]?{ext:"mpg",mime:"video/mpeg"}:73===t[0]&&68===t[1]&&51===t[2]||255===t[0]&&251===t[1]?{ext:"mp3",mime:"audio/mpeg"}:102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&77===t[8]&&52===t[9]&&65===t[10]||77===t[0]&&52===t[1]&&65===t[2]&&32===t[3]?{ext:"m4a",mime:"audio/m4a"}:79===t[28]&&112===t[29]&&117===t[30]&&115===t[31]&&72===t[32]&&101===t[33]&&97===t[34]&&100===t[35]?{ext:"opus",mime:"audio/opus"}:79===t[0]&&103===t[1]&&103===t[2]&&83===t[3]?{ext:"ogg",mime:"audio/ogg"}:102===t[0]&&76===t[1]&&97===t[2]&&67===t[3]?{ext:"flac",mime:"audio/x-flac"}:82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&65===t[9]&&86===t[10]&&69===t[11]?{ext:"wav",mime:"audio/x-wav"}:35===t[0]&&33===t[1]&&65===t[2]&&77===t[3]&&82===t[4]&&10===t[5]?{ext:"amr",mime:"audio/amr"}:37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]?{ext:"pdf",mime:"application/pdf"}:77===t[0]&&90===t[1]?{ext:"exe",mime:"application/x-msdownload"}:67!==t[0]&&70!==t[0]||87!==t[1]||83!==t[2]?123===t[0]&&92===t[1]&&114===t[2]&&116===t[3]&&102===t[4]?{ext:"rtf",mime:"application/rtf"}:119===t[0]&&79===t[1]&&70===t[2]&&70===t[3]&&(0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]||79===t[4]&&84===t[5]&&84===t[6]&&79===t[7])?{ext:"woff",mime:"application/font-woff"}:119===t[0]&&79===t[1]&&70===t[2]&&50===t[3]&&(0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]||79===t[4]&&84===t[5]&&84===t[6]&&79===t[7])?{ext:"woff2",mime:"application/font-woff"}:76===t[34]&&80===t[35]&&(0===t[8]&&0===t[9]&&1===t[10]||1===t[8]&&0===t[9]&&2===t[10]||2===t[8]&&0===t[9]&&2===t[10])?{ext:"eot",mime:"application/octet-stream"}:0===t[0]&&1===t[1]&&0===t[2]&&0===t[3]&&0===t[4]?{ext:"ttf",mime:"application/font-sfnt"}:79===t[0]&&84===t[1]&&84===t[2]&&79===t[3]&&0===t[4]?{ext:"otf",mime:"application/font-sfnt"}:0===t[0]&&0===t[1]&&1===t[2]&&0===t[3]?{ext:"ico",mime:"image/x-icon"}:70===t[0]&&76===t[1]&&86===t[2]&&1===t[3]?{ext:"flv",mime:"video/x-flv"}:37===t[0]&&33===t[1]?{ext:"ps",mime:"application/postscript"}:253===t[0]&&55===t[1]&&122===t[2]&&88===t[3]&&90===t[4]&&0===t[5]?{ext:"xz",mime:"application/x-xz"}:83===t[0]&&81===t[1]&&76===t[2]&&105===t[3]?{ext:"sqlite",mime:"application/x-sqlite3"}:78===t[0]&&69===t[1]&&83===t[2]&&26===t[3]?{ext:"nes",mime:"application/x-nintendo-nes-rom"}:67===t[0]&&114===t[1]&&50===t[2]&&52===t[3]?{ext:"crx",mime:"application/x-google-chrome-extension"}:77===t[0]&&83===t[1]&&67===t[2]&&70===t[3]||73===t[0]&&83===t[1]&&99===t[2]&&40===t[3]?{ext:"cab",mime:"application/vnd.ms-cab-compressed"}:33===t[0]&&60===t[1]&&97===t[2]&&114===t[3]&&99===t[4]&&104===t[5]&&62===t[6]&&10===t[7]&&100===t[8]&&101===t[9]&&98===t[10]&&105===t[11]&&97===t[12]&&110===t[13]&&45===t[14]&&98===t[15]&&105===t[16]&&110===t[17]&&97===t[18]&&114===t[19]&&121===t[20]?{ext:"deb",mime:"application/x-deb"}:33===t[0]&&60===t[1]&&97===t[2]&&114===t[3]&&99===t[4]&&104===t[5]&&62===t[6]?{ext:"ar",mime:"application/x-unix-archive"}:237===t[0]&&171===t[1]&&238===t[2]&&219===t[3]?{ext:"rpm",mime:"application/x-rpm"}:31===t[0]&&160===t[1]||31===t[0]&&157===t[1]?{ext:"Z",mime:"application/x-compress"}:76===t[0]&&90===t[1]&&73===t[2]&&80===t[3]?{ext:"lz",mime:"application/x-lzip"}:208===t[0]&&207===t[1]&&17===t[2]&&224===t[3]&&161===t[4]&&177===t[5]&&26===t[6]&&225===t[7]?{ext:"msi",mime:"application/x-msi"}:null:{ext:"swf",mime:"application/x-shockwave-flash"}:{ext:"rar",mime:"application/x-rar-compressed"}:{ext:"zip",mime:"application/zip"}:null}},function(t,n){t.exports={"application/":{applixware:"aw","atom+xml":"atom","atomcat+xml":"atomcat","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-":{capability:"cdmia",container:"cdmic",domain:"cdmid",object:"cdmio",queue:"cdmiq"},"davmount+xml":"davmount","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc",ecmascript:"ecma","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-":{tdpfr:"pfr",woff:"woff"},"gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix","java-":{archive:"jar",vm:"class","serialized-object":"ser"},javascript:"js",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mac-":{binhex40:"hqx",compactpro:"cpt"},"mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx",mathematica:["ma","nb","mb"],"mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps",pdf:"pdf","pgp-":{encrypted:"pgp",signature:["asc","sig"]},pkcs10:"p10","pkcs7-":{mime:["p7m","p7c"],signature:"p7s"},pkcs8:"p8","pkix-":{cert:"cer",crl:"crl",pkipath:"pkipath","attr-cert":"ac"},pkixcmp:"pki","pls+xml":"pls",postscript:["ai","eps","ps"],"pskc+xml":"pskcxml","rdf+xml":"rdf","reginfo+xml":"rif","resource-":{"lists+xml":"rl","lists-diff+xml":"rld"},"rpki-":{ghostbusters:"gbr",manifest:"mft",roa:"roa"},"rsd+xml":"rsd","rss+xml":"rss",rtf:"rtf","sbml+xml":"sbml","scvp-":{"cv-":{request:"scq",response:"scs"},"vp-":{request:"spq",response:"spp"}},sdp:"sdp","set-":{"payment-initiation":"setpay","registration-initiation":"setreg"},"shf+xml":"shf","smil+xml":["smi","smil"],"sparql-":{query:"rq","results+xml":"srx"},srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","vnd.":{acucobol:"acu",acucorp:["atc","acutc"],"adobe.":{fxp:["fxp","fxpl"],"xdp+xml":"xdp",xfdf:"xfdf","formscentral.fcdt":"fcdt","air-application-installer-package+zip":"air"},"apple.":{"installer+xml":"mpkg",mpegurl:"m3u8"},audiograph:"aep",bmi:"bmi",businessobjects:"rep","chemdraw+xml":"cdxml",cinderella:"cdy",claymore:"cla",commonspace:"csp",cosmocaller:"cmc","crick.":{clicker:"clkx","clicker.":{keyboard:"clkk",palette:"clkp",template:"clkt",wordbank:"clkw"}},"curl.":{car:"car",pcurl:"pcurl"},dart:"dart","dece.":{data:["uvf","uvvf","uvd","uvvd"],"ttml+xml":["uvt","uvvt"],unspecified:["uvx","uvvx"],zip:["uvz","uvvz"]},dna:"dna",dpgraph:"dpg",dreamfactory:"dfac","dvb.":{ait:"ait",service:"svc"},dynageo:"geo",enliven:"nml","epson.":{esf:"esf",msf:"msf",quickanime:"qam",salt:"slt",ssf:"ssf"},"eszigno3+xml":["es3","et3"],"ezpix-":{album:"ez2","package":"ez3"},fdf:"fdf","fdsn.":{mseed:"mseed",seed:["seed","dataless"]},flographit:"gph",framemaker:["fm","frame","maker","book"],"frogans.":{fnc:"fnc",ltf:"ltf"},"fujitsu.":{oasys:"oas",oasys2:"oa2",oasys3:"oa3",oasysgp:"fg5",oasysprs:"bh2"},"fujixerox.":{ddd:"ddd",docuworks:"xdw","docuworks.binder":"xbd"},fuzzysheet:"fzs","geogebra.":{file:"ggb",tool:"ggt"},geonext:"gxt",geoplan:"g2w",geospace:"g3w",gmx:"gmx",grafeq:["gqf","gqs"],"groove-":{account:"gac",help:"ghf",injector:"grv","tool-":{message:"gtm",template:"tpl"},vcard:"vcg","identity-message":"gim"},"hal+xml":"hal",hbci:"hbci","hp-":{hpgl:"hpgl",hpid:"hpid",hps:"hps",jlyt:"jlt",pcl:"pcl",pclxl:"pclxl"},"ibm.":{minipay:"mpy",modcap:["afp","listafp","list3820"],"rights-management":"irm","secure-container":"sc"},iccprofile:["icc","icm"],igloader:"igl","immervision-":{ivp:"ivp",ivu:"ivu"},intergeo:"i2g","intu.":{qbo:"qbo",qfx:"qfx"},jam:"jam",jisp:"jisp",kahootz:["ktz","ktr"],"kde.":{karbon:"karbon",kchart:"chrt",kformula:"kfo",kivio:"flw",kontour:"kon",kpresenter:["kpr","kpt"],kspread:"ksp",kword:["kwd","kwt"]},kenameaapp:"htke",kidspiration:"kia",kinar:["kne","knp"],koan:["skp","skd","skt","skm"],"lotus-":{approach:"apr",freelance:"pre",notes:"nsf",organizer:"org",screencam:"scm",wordpro:"lwp","1-2-3":"123"},mcd:"mcd",medcalcdata:"mc1",mfer:"mwf",mfmp:"mfm","micrografx.":{flo:"flo",igx:"igx"},mif:"mif","mobius.":{daf:"daf",dis:"dis",mbk:"mbk",mqy:"mqy",msl:"msl",plc:"plc",txf:"txf"},"mophun.":{application:"mpn",certificate:"mpc"},"ms-":{artgalry:"cil",excel:["xls","xlm","xla","xlc","xlt","xlw"],"excel.":{"sheet.":{"macroenabled.12":"xlsm","binary.macroenabled.12":"xlsb"},"addin.macroenabled.12":"xlam","template.macroenabled.12":"xltm"},fontobject:"eot",htmlhelp:"chm",ims:"ims",lrm:"lrm",officetheme:"thmx","pki.":{seccat:"cat",stl:"stl"},powerpoint:["ppt","pps","pot"],"powerpoint.":{"addin.macroenabled.12":"ppam","presentation.macroenabled.12":"pptm","slide.macroenabled.12":"sldm","slideshow.macroenabled.12":"ppsm","template.macroenabled.12":"potm"},project:["mpp","mpt"],"word.":{"document.macroenabled.12":"docm","template.macroenabled.12":"dotm"},works:["wps","wks","wcm","wdb"],wpl:"wpl",xpsdocument:"xps","cab-compressed":"cab"},mseq:"mseq",musician:"mus",mynfc:"taglet",nitf:["ntf","nitf"],"noblenet-":{directory:"nnd",sealer:"nns",web:"nnw"},"nokia.":{"radio-":{preset:"rpst",presets:"rpss"},"n-gage.":{data:"ngdat","symbian.install":"n-gage"}},"novadigm.":{edm:"edm",edx:"edx",ext:"ext"},"osgi.":{dp:"dp",subsystem:"esa"},palm:["pdb","pqa","oprc"],pawaafile:"paw","pg.":{format:"str",osasli:"ei6"},picsel:"efif",pocketlearn:"plf",powerbuilder6:"pbd","recordare.":{musicxml:"mxl","musicxml+xml":"musicxml"},"rn-":{realmedia:"rm","realmedia-vbr":"rmvb"},seemail:"see",sema:"sema",semd:"semd",semf:"semf",smaf:"mmf","spotfire.":{dxp:"dxp",sfs:"sfs"},"stardivision.":{calc:"sdc",draw:"sda",impress:"sdd",math:"smf",writer:["sdw","vor"],"writer-global":"sgl"},"stepmania.":{"package":"smzip",stepchart:"sm"},svd:"svd","syncml+xml":"xsm","syncml.":{"dm+wbxml":"bdm","dm+xml":"xdm"},trueapp:"tra",ufdl:["ufd","ufdl"],umajin:"umj",unity:"unityweb","uoml+xml":"uoml",vcx:"vcx",visio:["vsd","vst","vss","vsw"],visionary:"vis",vsf:"vsf","wap.":{wbxml:"wbxml",wmlc:"wmlc",wmlscriptc:"wmlsc"},webturbo:"wtb",wordperfect:"wpd",wqd:"wqd",xara:"xar",xfdl:"xfdl","yamaha.":{"hv-":{dic:"hvd",script:"hvs",voice:"hvp"},openscoreformat:"osf","smaf-":{audio:"saf",phrase:"spf"},"openscoreformat.osfpvg+xml":"osfpvg"},zul:["zir","zirz"],"3gpp2.tcap":"tcap","accpac.simply.":{aso:"aso",imp:"imp"},"ahead.space":"ahead","airzip.filesecure.":{azf:"azf",azs:"azs"},"amazon.ebook":"azw","americandynamics.acc":"acc","amiga.ami":"ami","anser-web-":{"certificate-issue-initiation":"cii","funds-transfer-initiation":"fti"},"aristanetworks.swi":"swi","blueice.multipass":"mpm","cloanto.rp9":"rp9","clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"cluetrust.cartomobile-":{config:"c11amc","config-pkg":"c11amz"},"contact.cmsg":"cdbcmsg","criticaltools.wbs+xml":"wbs","ctc-posml":"pml","cups-ppd":"ppd","dolby.mlp":"mlp","ds-keypoint":"kpxx","ecowin.chart":"mag","fluxtime.clip":"ftc","fsc.weblaunch":"fsc","genomatix.tuxedo":"txd","geometry-explorer":["gex","gre"],"google-earth.":{"kml+xml":"kml",kmz:"kmz"},"handheld-entertainment+xml":"zmm","insors.igm":"igm","intercon.formnet":["xpw","xpx"],"ipunplugged.rcprofile":"rcprofile","irepository.package+xml":"irp","is-xpr":"xpr","isac.fcs":"fcs","kodak-descriptor":"sse","las.las+xml":"lasxml","macports.portpkg":"portpkg","mediastation.cdkey":"cdkey","mozilla.xul+xml":"xul","muvee.style":"msty","neurolanguage.nlu":"nlu","oasis.opendocument.":{chart:"odc",database:"odb",formula:"odf",graphics:"odg",image:"odi",presentation:"odp",spreadsheet:"ods",text:"odt","text-":{master:"odm",template:"ott",web:"oth"},"chart-template":"otc","formula-template":"odft","graphics-template":"otg","image-template":"oti","presentation-template":"otp","spreadsheet-template":"ots"},"olpc-sugar":"xo","oma.dd2+xml":"dd2","openofficeorg.extension":"oxt","openxmlformats-officedocument.":{"presentationml.":{presentation:"pptx",slide:"sldx",slideshow:"ppsx",template:"potx"},"spreadsheetml.":{sheet:"xlsx",template:"xltx"},"wordprocessingml.":{document:"docx",template:"dotx"}},"pmi.widget":"wg","previewsystems.box":"box","proteus.magazine":"mgz","pvi.ptid1":"ptid","quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"realvnc.bed":"bed","rig.cryptonote":"cryptonote","rim.cod":"cod","route66.link66+xml":"link66","sailingtracker.track":"st","shana.informed.":{formdata:"ifm",formtemplate:"itp",interchange:"iif","package":"ipk"},"simtech-mindmapper":["twd","twds"],"smart.teacher":"teacher","solent.sdkm+xml":["sdkm","sdkd"],"sun.xml.":{calc:"sxc",draw:"sxd",impress:"sxi",math:"sxm",writer:"sxw","writer.":{global:"sxg",template:"stw"},"calc.template":"stc","draw.template":"std","impress.template":"sti"},"sus-calendar":["sus","susp"],"symbian.install":["sis","sisx"],"tcpdump.pcap":["pcap","cap","dmp"],"tmobile-livetv":"tmo","trid.tpt":"tpt","triscape.mxs":"mxs","uiq.theme":"utz","wolfram.player":"nbp","wt.stf":"stf","zzazz.deck+xml":"zaz","3gpp.pic-bw-":{large:"plb",small:"psb","var":"pvb"},"3m.post-it-notes":"pwn","android.package-archive":"apk","antix.game-component":"atx","astraea-software.iota":"iota","chipnuts.karaoke-mmd":"mmd","data-vision.rdz":"rdz","denovo.fcselayout-link":"fe_launch","hhe.lesson-player":"les","hydrostatix.sof-data":"sfd-hdstx","jcp.javame.midlet-rms":"rms","joost.joda-archive":"joda","llamagraphics.life-balance.":{desktop:"lbd","exchange+xml":"lbe"},"osgeo.mapguide.package":"mgp","publishare-delta-tree":"qps","tao.intent-module-archive":"tao","yellowriver-custom-menu":"cmp"},"voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-":{abiword:"abw","authorware-":{bin:["aab","x32","u32","vox"],map:"aam",seg:"aas"},bcpio:"bcpio",bittorrent:"torrent",blorb:["blb","blorb"],bzip:"bz",bzip2:["bz2","boz"],cbr:["cbr","cba","cbt","cbz","cb7"],cdlink:"vcd",chat:"chat",conference:"nsc",cpio:"cpio",csh:"csh",director:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],doom:"wad","dtbncx+xml":"ncx","dtbook+xml":"dtb","dtbresource+xml":"res",dvi:"dvi",envoy:"evy",eva:"eva","font-":{bdf:"bdf",ghostscript:"gsf",otf:"otf",pcf:"pcf",snf:"snf",ttf:["ttf","ttc"],type1:["pfa","pfb","pfm","afm"],"linux-psf":"psf"},freearc:"arc",futuresplash:"spl",glulx:"ulx",gnumeric:"gnumeric",gtar:"gtar",hdf:"hdf",latex:"latex",mie:"mie","ms-":{application:"application",shortcut:"lnk",wmd:"wmd",wmz:"wmz",xbap:"xbap"},msaccess:"mdb",msbinder:"obd",mscardfile:"crd",msclip:"clp",msdownload:["exe","dll","com","bat","msi"],msmediaview:["mvb","m13","m14"],msmetafile:["wmf","wmz","emf","emz"],msmoney:"mny",mspublisher:"pub",msschedule:"scd",msterminal:"trm",mswrite:"wri",netcdf:["nc","cdf"],nzb:"nzb",pkcs12:["p12","pfx"],"pkcs7-":{certificates:["p7b","spc"],certreqresp:"p7r"},sh:"sh",shar:"shar",sql:"sql",stuffit:"sit",stuffitx:"sitx",subrip:"srt",sv4cpio:"sv4cpio",sv4crc:"sv4crc",tads:"gam",tar:"tar",tcl:"tcl",tex:"tex",texinfo:["texinfo","texi"],tgif:"obj",ustar:"ustar",xfig:"fig","xliff+xml":"xlf",xpinstall:"xpi",xz:"xz",zmachine:["z1","z2","z3","z4","z5","z6","z7","z8"],"7z-compressed":"7z","ace-compressed":"ace","apple-diskimage":"dmg","cfs-compressed":"cfs","chess-pgn":"pgn","debian-package":["deb","udeb"],"dgc-compressed":"dgc","gca-compressed":"gca","gramps-xml":"gramps","install-instructions":"install","iso9660-image":"iso","lzh-compressed":["lzh","lha"],"mobipocket-ebook":["prc","mobi"],"rar-compressed":"rar","shockwave-flash":"swf","silverlight-app":"xap","t3vm-image":"t3","tex-tfm":"tfm","wais-source":"src","java-jnlp-file":"jnlp","research-info-systems":"ris","x509-ca-cert":["der","crt"]},"xaml+xml":"xaml","xenc+xml":"xenc","xhtml+xml":["xhtml","xht"],xml:["xml","xsl"],"xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xspf+xml":"xspf","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",zip:"zip","andrew-inset":"ez","cu-seeme":"cu","octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"oebps-package+xml":"opf","pics-rules":"prf","prs.cww":"cww","rls-services+xml":"rs","timestamped-data":"tsd","xcap-diff+xml":"xdf","xml-dtd":"dtd","patch-ops-error+xml":"xer","relax-ng-compact-syntax":"rnc"},"audio/":{adpcm:"adp",basic:["au","snd"],midi:["mid","midi","kar","rmi"],mp4:["m4a","mp4a"],mpeg:["mpga","mp2","mp2a","mp3","m2a","m3a"],ogg:["oga","ogg","spx"],s3m:"s3m",silk:"sil","vnd.":{dra:"dra",dts:"dts","nuera.":{ecelp4800:"ecelp4800",ecelp7470:"ecelp7470",ecelp9600:"ecelp9600"},rip:"rip","dece.audio":["uva","uvva"],"digital-winds":"eol","dts.hd":"dtshd","lucent.voice":"lvp","ms-playready.media.pya":"pya"},webm:"weba","x-":{aac:"aac",aiff:["aif","aiff","aifc"],caf:"caf",flac:"flac",matroska:"mka",mpegurl:"m3u","ms-":{wax:"wax",wma:"wma"},"pn-":{realaudio:["ram","ra"],"realaudio-plugin":"rmp"},wav:"wav"},xm:"xm"},"image/":{bmp:"bmp",cgm:"cgm",g3fax:"g3",gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],ktx:"ktx",png:"png",sgi:"sgi","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.":{djvu:["djvu","djv"],dwg:"dwg",dxf:"dxf",fastbidsheet:"fbs",fpx:"fpx",fst:"fst","ms-":{modi:"mdi",photo:"wdp"},xiff:"xif","adobe.photoshop":"psd","dece.graphic":["uvi","uvvi","uvg","uvvg"],"dvb.subtitle":"sub","fujixerox.edmics-":{mmr:"mmr",rlc:"rlc"},"net-fpx":"npx","wap.wbmp":"wbmp"},webp:"webp","x-":{"3ds":"3ds",cmx:"cmx",freehand:["fh","fhc","fh4","fh5","fh7"],icon:"ico",pcx:"pcx",pict:["pic","pct"],"portable-":{anymap:"pnm",bitmap:"pbm",graymap:"pgm",pixmap:"ppm"},rgb:"rgb",tga:"tga",xbitmap:"xbm",xpixmap:"xpm",xwindowdump:"xwd","cmu-raster":"ras","mrsid-image":"sid"},"prs.btif":"btif"},"model/":{iges:["igs","iges"],mesh:["msh","mesh","silo"],"vnd.":{"collada+xml":"dae",dwf:"dwf",gdl:"gdl",gtw:"gtw",mts:"mts",vtu:"vtu"},vrml:["wrl","vrml"],"x3d+binary":["x3db","x3dbz"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"]},"text/":{calendar:["ics","ifb"],css:"css",csv:"csv",html:["html","htm"],n3:"n3",plain:["txt","text","conf","def","list","log","in"],richtext:"rtx",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl",vcard:"vcard","vnd.":{curl:"curl","curl.":{dcurl:"dcurl",mcurl:"mcurl",scurl:"scurl"},fly:"fly",graphviz:"gv","in3d.":{"3dml":"3dml",spot:"spot"},"wap.":{wml:"wml",wmlscript:"wmls"},"dvb.subtitle":"sub","fmi.flexstor":"flx","sun.j2me.app-descriptor":"jad"},"x-":{asm:["s","asm"],c:["c","cc","cxx","cpp","h","hh","dic"],fortran:["f","for","f77","f90"],nfo:"nfo",opml:"opml",pascal:["p","pas"],setext:"etx",sfv:"sfv",uuencode:"uu",vcalendar:"vcs",vcard:"vcf","java-source":"java"},"cache-manifest":"appcache","uri-list":["uri","uris","urls"],"prs.lines.tag":"dsc","tab-separated-values":"tsv"},"video/":{"3gpp":"3gp","3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],mp4:["mp4","mp4v","mpg4"],mpeg:["mpeg","mpg","mpe","m1v","m2v"],ogg:"ogv",quicktime:["qt","mov"],"vnd.":{"dece.":{hd:["uvh","uvvh"],mobile:["uvm","uvvm"],pd:["uvp","uvvp"],sd:["uvs","uvvs"],video:["uvv","uvvv"]},fvt:"fvt",mpegurl:["mxu","m4u"],vivo:"viv","dvb.file":"dvb","uvvu.mp4":["uvu","uvvu"],"ms-playready.media.pyv":"pyv"},webm:"webm","x-":{f4v:"f4v",fli:"fli",flv:"flv",m4v:"m4v",matroska:["mkv","mk3d","mks"],mng:"mng","ms-":{asf:["asf","asx"],vob:"vob",wm:"wm",wmv:"wmv",wmx:"wmx",wvx:"wvx"},msvideo:"avi",smv:"smv","sgi-movie":"movie"}},"chemical/x-":{cdx:"cdx",cif:"cif",cmdf:"cmdf",cml:"cml",csml:"csml",xyz:"xyz"},"message/rfc822":["eml","mime"],"x-conference/x-cooltalk":"ice"}},function(t,n){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}}]);', n.p + "d08c0738e0c5106556e8.worker.js");
    }
}
, function(e, t, n) {
    e.exports = function() {
        return new Worker(n.p + "fd80ce843d0b3f094582.worker.js")
    }
}
, function(e, t, n) {
    e.exports = function() {
        return new Worker(n.p + "pdf.worker.js")
    }
}
]));
